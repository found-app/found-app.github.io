(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[644],{4613:function(a){!function(c,b){a.exports=b()}(this,function(){"use strict";var c,d,b;function a(g,a){if(c){if(d){var f="var sharedChunk = {}; ("+c+")(sharedChunk); ("+d+")(sharedChunk);",e={};c(e),b=a(e),"undefined"!=typeof window&&(b.workerUrl=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})))}else d=a}else c=a}return a(["exports"],function(a){var H,df=aW;function aW(a,b,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*b,this.by=3*(d-b)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=b,this.p2x=c,this.p2y=d}function ac(a,b,c,d){let e=new df(a,b,c,d);return function(a){return e.solve(a)}}aW.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(b,d){if(void 0===d&&(d=1e-6),b<0)return 0;if(b>1)return 1;for(var a=b,c=0;c<8;c++){var e=this.sampleCurveX(a)-b;if(Math.abs(e)<d)return a;var g=this.sampleCurveDerivativeX(a);if(1e-6>Math.abs(g))break;a-=e/g}var f=0,h=1;for(a=b,c=0;c<20&&!(Math.abs((e=this.sampleCurveX(a))-b)<d);c++)b>e?f=a:h=a,a=.5*(h-f)+f;return a},solve:function(a,b){return this.sampleCurveY(this.solveCurveX(a,b))}};let aX=ac(.25,.1,.25,1);function aY(a,b,c){return Math.min(c,Math.max(b,a))}function aZ(e,a,c){let b=c-a,d=((e-a)%b+b)%b+a;return d===a?c:d}function a$(a,...d){for(let b of d)for(let c in b)a[c]=b[c];return a}let dg=1;function a_(a,b){a.forEach(a=>{b[a]&&(b[a]=b[a].bind(b))})}function a0(a,d,e){let c={};for(let b in a)c[b]=d.call(e||this,a[b],b,a);return c}function a1(a,d,e){let c={};for(let b in a)d.call(e||this,a[b],b,a)&&(c[b]=a[b]);return c}function a2(a){return Array.isArray(a)?a.map(a2):"object"==typeof a&&a?a0(a,a2):a}let dh={};function a3(a){dh[a]||("undefined"!=typeof console&&console.warn(a),dh[a]=!0)}function di(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}function dj(a){let e=0;for(let b,c,d=0,f=a.length,g=f-1;d<f;g=d++)b=a[d],c=a[g],e+=(c.x-b.x)*(b.y+c.y);return e}function a4(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function a5(c){let a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,c,d,e)=>{let b=d||e;return a[c]=!b||b.toLowerCase(),""}),a["max-age"]){let b=parseInt(a["max-age"],10);isNaN(b)?delete a["max-age"]:a["max-age"]=b}return a}let dk,I,dl=null;function a6(b){if(null==dl){let a=b.navigator?b.navigator.userAgent:null;dl=!!b.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return dl}function a7(a){return"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap}let a8={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){let b=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(b)}},getImageData(a,b=0){let c=window.document.createElement("canvas"),d=c.getContext("2d");if(!d)throw Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,d.drawImage(a,0,0,a.width,a.height),d.getImageData(-b,-b,a.width+2*b,a.height+2*b)},resolveURL:a=>(dk||(dk=document.createElement("a")),dk.href=a,dk.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==I&&(I=matchMedia("(prefers-reduced-motion: reduce)")),I.matches)}};var J=ad;function ad(a,b){this.x=a,this.y=b}ad.prototype={clone:function(){return new ad(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,b){return this.clone()._rotateAround(a,b)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var b=a.x-this.x,c=a.y-this.y;return b*b+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,b){return Math.atan2(this.x*b-this.y*a,this.x*a+this.y*b)},_matMult:function(a){var b=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=b,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=c*this.x+b*this.y;return this.x=b*this.x-c*this.y,this.y=d,this},_rotateAround:function(b,a){var c=Math.cos(b),d=Math.sin(b),e=a.y+d*(this.x-a.x)+c*(this.y-a.y);return this.x=a.x+c*(this.x-a.x)-d*(this.y-a.y),this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ad.convert=function(a){return a instanceof ad?a:Array.isArray(a)?new ad(a[0],a[1]):a};let a9={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},dm="mapbox-tiles",dn,dp,dq=500,dr=50;function ds(){"undefined"==typeof caches||dn||(dn=caches.open(dm))}let dt=1/0,ba={supported:!1,testSupport:function(a){!dv&&K&&(dw?dx(a):du=a)}},du,K,dv=!1,dw=!1;function dx(a){let b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,K),a.isContextLost())return;ba.supported=!0}catch(c){}a.deleteTexture(b),dv=!0}"undefined"!=typeof document&&((K=document.createElement("img")).onload=function(){du&&dx(du),du=null,dw=!0},K.onerror=function(){dv=!0,du=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let ae={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ae);class af extends Error{constructor(a,b,c,d){super(`AJAXError: ${b} (${a}): ${c}`),this.status=a,this.statusText=b,this.url=c,this.body=d}}let bb=a4()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function dy(a,d){let b=new AbortController,c=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:bb(),signal:b.signal}),e=!1,f=!1;return"json"===a.type&&c.headers.set("Accept","application/json"),((b,g,h)=>{if(f)return;let i=Date.now();fetch(c).then(b=>b.ok?((b,g,h)=>{("arrayBuffer"===a.type?b.arrayBuffer():"json"===a.type?b.json():b.text()).then(a=>{f||(g&&h&&function(e,a,c){if(ds(),!dn)return;let d={status:a.status,statusText:a.statusText,headers:new Headers};a.headers.forEach((a,b)=>d.headers.set(b,a));let b=a5(a.headers.get("Cache-Control")||"");b["no-store"]||(b["max-age"]&&d.headers.set("Expires",new Date(c+1e3*b["max-age"]).toUTCString()),new Date(d.headers.get("Expires")).getTime()-c<42e4||function(a,b){if(void 0===dp)try{new Response(new ReadableStream),dp=!0}catch(c){dp=!1}dp?b(a.body):a.blob().then(b)}(a,a=>{let b=new Response(a,d);ds(),dn&&dn.then(a=>a.put(function(a){let b=a.indexOf("?");return b<0?a:a.slice(0,b)}(e.url),b)).catch(a=>a3(a.message))}))}(c,g,h),e=!0,d(null,a,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(a=>{f||d(Error(a.message))})})(b,null,i):b.blob().then(c=>d(new af(b.status,b.statusText,a.url,c)))).catch(a=>{20!==a.code&&d(Error(a.message))})})(),{cancel(){f=!0,e||b.abort()}}}let bc=function(a,b){var c;if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(a4()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,b);if(!a4()){let d=a.url.substring(0,a.url.indexOf("://"));return(a9.REGISTERED_PROTOCOLS[d]||dy)(a,b)}}if(!(/^file:/.test(c=a.url)||/^file:/.test(bb())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return dy(a,b);if(a4()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,b,void 0,!0)}return function(b,d){let a=new XMLHttpRequest;for(let c in a.open(b.method||"GET",b.url,!0),"arrayBuffer"===b.type&&(a.responseType="arraybuffer"),b.headers)a.setRequestHeader(c,b.headers[c]);return"json"===b.type&&(a.responseType="text",a.setRequestHeader("Accept","application/json")),a.withCredentials="include"===b.credentials,a.onerror=()=>{d(Error(a.statusText))},a.onload=()=>{if((a.status>=200&&a.status<300||0===a.status)&&null!==a.response){let c=a.response;if("json"===b.type)try{c=JSON.parse(a.response)}catch(e){return d(e)}d(null,c,a.getResponseHeader("Cache-Control"),a.getResponseHeader("Expires"))}else{let f=new Blob([a.response],{type:a.getResponseHeader("Content-Type")});d(new af(a.status,a.statusText,b.url,f))}},a.send(b.body),{cancel:()=>a.abort()}}(a,b)},bd=function(a,b){return bc(a$(a,{type:"arrayBuffer"}),b)};function dz(b){let a=window.document.createElement("a");return a.href=b,a.protocol===window.document.location.protocol&&a.host===window.document.location.host}let dA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",be,bf;be=[],bf=0;let bg=function(a,c){if(ba.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),bf>=a9.MAX_PARALLEL_IMAGE_REQUESTS){let b={requestParameters:a,callback:c,cancelled:!1,cancel(){this.cancelled=!0}};return be.push(b),b}bf++;let d=!1,e=()=>{if(!d)for(d=!0,bf--;be.length&&bf<a9.MAX_PARALLEL_IMAGE_REQUESTS;){let a=be.shift(),{requestParameters:b,callback:c,cancelled:e}=a;e||(a.cancel=bg(b,c).cancel)}},f=bd(a,(a,b,d,f)=>{e(),a?c(a):b&&function(a,b){"function"==typeof createImageBitmap?function(a,c){let b=new Blob([new Uint8Array(a)],{type:"image/png"});createImageBitmap(b).then(a=>{c(null,a)}).catch(a=>{c(Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(a,b):function(b,d){let a=new Image;a.onload=()=>{d(null,a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=dA})},a.onerror=()=>d(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let c=new Blob([new Uint8Array(b)],{type:"image/png"});a.src=b.byteLength?URL.createObjectURL(c):dA}(a,b)}(b,(a,b)=>{null!=a?c(a):null!=b&&c(null,b,{cacheControl:d,expires:f})})});return{cancel(){f.cancel(),e()}}};function dB(a,c,b){b[a]&& -1!==b[a].indexOf(c)||(b[a]=b[a]||[],b[a].push(c))}function dC(b,d,a){if(a&&a[b]){let c=a[b].indexOf(d);-1!==c&&a[b].splice(c,1)}}class ag{constructor(a,b={}){a$(this,b),this.type=a}}class bh extends ag{constructor(a,b={}){super("error",a$({error:a},b))}}class L{on(a,b){return this._listeners=this._listeners||{},dB(a,b,this._listeners),this}off(a,b){return dC(a,b,this._listeners),dC(a,b,this._oneTimeListeners),this}once(a,b){return this._oneTimeListeners=this._oneTimeListeners||{},dB(a,b,this._oneTimeListeners),this}fire(a,e){"string"==typeof a&&(a=new ag(a,e||{}));let b=a.type;if(this.listens(b)){a.target=this;let f=this._listeners&&this._listeners[b]?this._listeners[b].slice():[];for(let g of f)g.call(this,a);let h=this._oneTimeListeners&&this._oneTimeListeners[b]?this._oneTimeListeners[b].slice():[];for(let c of h)dC(b,c,this._oneTimeListeners),c.call(this,a);let d=this._eventedParent;d&&(a$(a,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),d.fire(a))}else a instanceof bh&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,b){return this._eventedParent=a,this._eventedParentData=b,this}}var b={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class bi{constructor(b,a,d,c){this.message=(b?`${b}: `:"")+d,c&&(this.identifier=c),null!=a&&a.__line__&&(this.line=a.__line__)}}function bj(a){let b=a.value;return b?[new bi(a.key,b,"constants have been deprecated as of v8")]:[]}function dD(a,...d){for(let b of d)for(let c in b)a[c]=b[c];return a}function dE(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function dF(a){if(Array.isArray(a))return a.map(dF);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){let b={};for(let c in a)b[c]=dF(a[c]);return b}return dE(a)}class dG extends Error{constructor(b,a){super(a),this.message=a,this.key=b}}class dH{constructor(a,b=[]){for(let[c,d]of(this.parent=a,this.bindings={},b))this.bindings[c]=d}concat(a){return new dH(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]|| !!this.parent&&this.parent.has(a)}}let bk={kind:"null"},d={kind:"number"},h={kind:"string"},g={kind:"boolean"},r={kind:"color"},v={kind:"object"},j={kind:"value"},bl={kind:"collator"},bm={kind:"formatted"},bn={kind:"resolvedImage"};function s(a,b){return{kind:"array",itemType:a,N:b}}function dI(a){if("array"===a.kind){let b=dI(a.itemType);return"number"==typeof a.N?`array<${b}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${b}>`}return a.kind}let dJ=[bk,d,h,g,r,bm,v,s(j),bn];function dK(b,a){if("error"===a.kind)return null;if("array"===b.kind){if("array"===a.kind&&(0===a.N&&"value"===a.itemType.kind||!dK(b.itemType,a.itemType))&&("number"!=typeof b.N||b.N===a.N))return null}else{if(b.kind===a.kind)return null;if("value"===b.kind){for(let c of dJ)if(!dK(c,a))return null}}return`Expected ${dI(b)} but found ${dI(a)} instead.`}function dL(b,a){return a.some(a=>a.kind===b.kind)}function dM(b,a){return a.some(a=>"null"===a?null===b:"array"===a?Array.isArray(b):"object"===a?b&&!Array.isArray(b)&&"object"==typeof b:a===typeof b)}var bo,dN={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function dO(a){return(a=Math.round(a))<0?0:a>255?255:a}function dP(a){return dO("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function dQ(a){var b;return(b="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:b>1?1:b}function dR(b,c,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?b+(c-b)*a*6:2*a<1?c:3*a<2?b+(c-b)*(2/3-a)*6:b}try{bo=({}).parseCSSColor=function(l){var a,b=l.replace(/ /g,"").toLowerCase();if(b in dN)return dN[b].slice();if("#"===b[0])return 4===b.length?(a=parseInt(b.substr(1),16))>=0&&a<=4095?[(3840&a)>>4|(3840&a)>>8,240&a|(240&a)>>4,15&a|(15&a)<<4,1]:null:7===b.length&&(a=parseInt(b.substr(1),16))>=0&&a<=16777215?[(16711680&a)>>16,(65280&a)>>8,255&a,1]:null;var e=b.indexOf("("),k=b.indexOf(")");if(-1!==e&&k+1===b.length){var m=b.substr(0,e),c=b.substr(e+1,k-(e+1)).split(","),f=1;switch(m){case"rgba":if(4!==c.length)break;f=dQ(c.pop());case"rgb":return 3!==c.length?null:[dP(c[0]),dP(c[1]),dP(c[2]),f];case"hsla":if(4!==c.length)break;f=dQ(c.pop());case"hsl":if(3!==c.length)break;var h=(parseFloat(c[0])%360+360)%360/360,i=dQ(c[1]),d=dQ(c[2]),g=d<=.5?d*(i+1):d+i-d*i,j=2*d-g;return[dO(255*dR(j,g,h+1/3)),dO(255*dR(j,g,h)),dO(255*dR(j,g,h-1/3)),f]}}return null}}catch(dS){}class m{constructor(a,b,c,d=1){this.r=a,this.g=b,this.b=c,this.a=d}static parse(b){if(!b)return;if(b instanceof m)return b;if("string"!=typeof b)return;let a=bo(b);return a?new m(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){let[a,b,c,d]=this.toArray();return`rgba(${Math.round(a)},${Math.round(b)},${Math.round(c)},${d})`}toArray(){let{r:b,g:c,b:d,a:a}=this;return 0===a?[0,0,0,0]:[255*b/a,255*c/a,255*d/a,a]}}m.black=new m(0,0,0,1),m.white=new m(1,1,1,1),m.transparent=new m(0,0,0,0),m.red=new m(1,0,0,1);class dT{constructor(b,a,c){this.sensitivity=b?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,b){return this.collator.compare(a,b)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dU{constructor(a,b,c,d,e){this.text=a,this.image=b,this.scale=c,this.fontStack=d,this.textColor=e}}class dV{constructor(a){this.sections=a}static fromString(a){return new dV([new dU(a,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(a=>0!==a.text.length||a.image&&0!==a.image.name.length)}static factory(a){return a instanceof dV?a:dV.fromString(a)}toString(){return 0===this.sections.length?"":this.sections.map(a=>a.text).join("")}serialize(){let b=["format"];for(let a of this.sections){if(a.image){b.push(["image",a.image.name]);continue}b.push(a.text);let c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),b.push(c)}return b}}class bp{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new bp({name:a,available:!1}):null}serialize(){return["image",this.name]}}function dW(b,c,d,a){return"number"==typeof b&&b>=0&&b<=255&&"number"==typeof c&&c>=0&&c<=255&&"number"==typeof d&&d>=0&&d<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[b,c,d,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[b,c,d,a]:[b,c,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function dX(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof m||a instanceof dT||a instanceof dV||a instanceof bp)return!0;if(Array.isArray(a)){for(let b of a)if(!dX(b))return!1;return!0}if("object"==typeof a){for(let c in a)if(!dX(a[c]))return!1;return!0}return!1}function dY(a){if(null===a)return bk;if("string"==typeof a)return h;if("boolean"==typeof a)return g;if("number"==typeof a)return d;if(a instanceof m)return r;if(a instanceof dT)return bl;if(a instanceof dV)return bm;if(a instanceof bp)return bn;if(Array.isArray(a)){let e=a.length,b;for(let f of a){let c=dY(f);if(b){if(b===c)continue;b=j;break}b=c}return s(b||j,e)}return v}function dZ(a){let b=typeof a;return null===a?"":"string"===b||"number"===b||"boolean"===b?String(a):a instanceof m||a instanceof dV||a instanceof bp?a.toString():JSON.stringify(a)}class bq{constructor(a,b){this.type=a,this.value=b}static parse(b,d){if(2!==b.length)return d.error(`'literal' expression requires exactly one argument, but found ${b.length-1} instead.`);if(!dX(b[1]))return d.error("invalid value");let e=b[1],c=dY(e),a=d.expectedType;return"array"===c.kind&&0===c.N&&a&&"array"===a.kind&&("number"!=typeof a.N||0===a.N)&&(c=a),new bq(c,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof m?["rgba"].concat(this.value.toArray()):this.value instanceof dV?this.value.serialize():this.value}}class d${constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}let d_={string:h,number:d,boolean:g,object:v};class w{constructor(a,b){this.type=a,this.args=b}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let e,b=1,g=a[0];if("array"===g){let f,h;if(a.length>2){let d=a[1];if("string"!=typeof d||!(d in d_)||"object"===d)return c.error('The item type argument of "array" must be one of string, number, boolean',1);f=d_[d],b++}else f=j;if(a.length>3){if(null!==a[2]&&("number"!=typeof a[2]||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);h=a[2],b++}e=s(f,h)}else e=d_[g];let i=[];for(;b<a.length;b++){let k=c.parse(a[b],b,j);if(!k)return null;i.push(k)}return new w(e,i)}evaluate(c){for(let a=0;a<this.args.length;a++){let b=this.args[a].evaluate(c);if(!dK(this.type,dY(b)))return b;if(a===this.args.length-1)throw new d$(`Expected value to be of type ${dI(this.type)}, but found ${dI(dY(b))} instead.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){let a=this.type,c=[a.kind];if("array"===a.kind){let b=a.itemType;if("string"===b.kind||"number"===b.kind||"boolean"===b.kind){c.push(b.kind);let d=a.N;("number"==typeof d||this.args.length>1)&&c.push(d)}}return c.concat(this.args.map(a=>a.serialize()))}}class br{constructor(a){this.type=bm,this.sections=a}static parse(c,b){if(c.length<2)return b.error("Expected at least one argument.");let m=c[1];if(!Array.isArray(m)&&"object"==typeof m)return b.error("First argument must be an image or text section.");let e=[],i=!1;for(let f=1;f<=c.length-1;++f){let a=c[f];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;let n=null;if(a["font-scale"]&&!(n=b.parse(a["font-scale"],1,d)))return null;let o=null;if(a["text-font"]&&!(o=b.parse(a["text-font"],1,s(h))))return null;let p=null;if(a["text-color"]&&!(p=b.parse(a["text-color"],1,r)))return null;let k=e[e.length-1];k.scale=n,k.font=o,k.textColor=p}else{let l=b.parse(c[f],1,j);if(!l)return null;let g=l.type.kind;if("string"!==g&&"value"!==g&&"null"!==g&&"resolvedImage"!==g)return b.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,e.push({content:l,scale:null,font:null,textColor:null})}}return new br(e)}evaluate(a){return new dV(this.sections.map(b=>{let c=b.content.evaluate(a);return dY(c)===bn?new dU("",c,null,null,null):new dU(dZ(c),null,b.scale?b.scale.evaluate(a):null,b.font?b.font.evaluate(a).join(","):null,b.textColor?b.textColor.evaluate(a):null)}))}eachChild(b){for(let a of this.sections)b(a.content),a.scale&&b(a.scale),a.font&&b(a.font),a.textColor&&b(a.textColor)}outputDefined(){return!1}serialize(){let c=["format"];for(let a of this.sections){c.push(a.content.serialize());let b={};a.scale&&(b["font-scale"]=a.scale.serialize()),a.font&&(b["text-font"]=a.font.serialize()),a.textColor&&(b["text-color"]=a.textColor.serialize()),c.push(b)}return c}}class bs{constructor(a){this.type=bn,this.input=a}static parse(b,a){if(2!==b.length)return a.error("Expected two arguments.");let c=a.parse(b[1],1,h);return c?new bs(c):a.error("No image name provided.")}evaluate(a){let c=this.input.evaluate(a),b=bp.fromString(c);return b&&a.availableImages&&(b.available=a.availableImages.indexOf(c)> -1),b}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let d0={"to-boolean":g,"to-color":r,"to-number":d,"to-string":h};class y{constructor(a,b){this.type=a,this.args=b}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let d=a[0];if(("to-boolean"===d||"to-string"===d)&&2!==a.length)return c.error("Expected one argument.");let g=d0[d],e=[];for(let b=1;b<a.length;b++){let f=c.parse(a[b],b,j);if(!f)return null;e.push(f)}return new y(g,e)}evaluate(b){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(b));if("color"===this.type.kind){let a,c;for(let g of this.args){if(a=g.evaluate(b),c=null,a instanceof m)return a;if("string"==typeof a){let e=b.parseColor(a);if(e)return e}else if(Array.isArray(a)&&!(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:dW(a[0],a[1],a[2],a[3])))return new m(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new d$(c||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let d=null;for(let h of this.args){if(null===(d=h.evaluate(b)))return 0;let f=Number(d);if(!isNaN(f))return f}throw new d$(`Could not convert ${JSON.stringify(d)} to number.`)}return"formatted"===this.type.kind?dV.fromString(dZ(this.args[0].evaluate(b))):"resolvedImage"===this.type.kind?bp.fromString(dZ(this.args[0].evaluate(b))):dZ(this.args[0].evaluate(b))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if("formatted"===this.type.kind)return new br([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new bs(this.args[0]).serialize();let a=[`to-${this.type.kind}`];return this.eachChild(b=>{a.push(b.serialize())}),a}}let d1=["Unknown","Point","LineString","Polygon"];class d2{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?d1[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let b=this._parseColorCache[a];return b||(b=this._parseColorCache[a]=m.parse(a)),b}}class ah{constructor(a,b,c,d){this.name=a,this.type=b,this._evaluate=c,this.args=d}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(f,c){let j=f[0],b=ah.definitions[j];if(!b)return c.error(`Unknown expression "${j}". If you wanted a literal array, use ["literal", [...]].`,0);let q=Array.isArray(b)?b[0]:b.type,m=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,h=m.filter(([a])=>!Array.isArray(a)||a.length===f.length-1),e=null;for(let[a,r]of h){e=new el(c.registry,c.path,null,c.scope);let d=[],n=!1;for(let i=1;i<f.length;i++){let s=f[i],t=Array.isArray(a)?a[i-1]:a.type,o=e.parse(s,1+d.length,t);if(!o){n=!0;break}d.push(o)}if(!n){if(Array.isArray(a)&&a.length!==d.length)e.error(`Expected ${a.length} arguments, but found ${d.length} instead.`);else{for(let g=0;g<d.length;g++){let u=Array.isArray(a)?a[g]:a.type,v=d[g];e.concat(g+1).checkSubtype(u,v.type)}if(0===e.errors.length)return new ah(j,q,r,d)}}}if(1===h.length)c.errors.push(...e.errors);else{let w=(h.length?h:m).map(([b])=>{var a;return Array.isArray(a=b)?`(${a.map(dI).join(", ")})`:`(${dI(a.type)}...)`}).join(" | "),k=[];for(let l=1;l<f.length;l++){let p=c.parse(f[l],1+k.length);if(!p)return null;k.push(dI(p.type))}c.error(`Expected arguments of type ${w}, but found (${k.join(", ")}) instead.`)}return null}static register(b,a){for(let c in ah.definitions=a,a)b[c]=ah}}class bt{constructor(a,b,c){this.type=bl,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=b}static parse(c,b){if(2!==c.length)return b.error("Expected one argument.");let a=c[1];if("object"!=typeof a||Array.isArray(a))return b.error("Collator options argument must be an object.");let d=b.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,g);if(!d)return null;let e=b.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,g);if(!e)return null;let f=null;return!a.locale||(f=b.parse(a.locale,1,h))?new bt(d,e,f):null}evaluate(a){return new dT(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){let a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function d3(a,b){a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[0]),a[3]=Math.max(a[3],b[1])}function d4(a,b){return!(a[0]<=b[0]||a[2]>=b[2]||a[1]<=b[1]||a[3]>=b[3])}function d5(a,c){let d=(180+a[0])/360,e=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,b=Math.pow(2,c.z);return[Math.round(d*b*8192),Math.round(e*b*8192)]}function d6(a,b,c){let d=a[0]-b[0],e=a[1]-b[1],f=a[0]-c[0],g=a[1]-c[1];return d*g-f*e==0&&d*f<=0&&e*g<=0}function d7(h,i){var d,b,e;let f=!1;for(let g=0,j=i.length;g<j;g++){let c=i[g];for(let a=0,k=c.length;a<k-1;a++){if(d6(h,c[a],c[a+1]))return!1;(b=c[a])[1]>(d=h)[1]!=(e=c[a+1])[1]>d[1]&&d[0]<(e[0]-b[0])*(d[1]-b[1])/(e[1]-b[1])+b[0]&&(f=!f)}}return f}function d8(c,b){for(let a=0;a<b.length;a++)if(d7(c,b[a]))return!0;return!1}function d9(b,c,a,d){let e=d[0]-a[0],f=d[1]-a[1],g=(b[0]-a[0])*f-e*(b[1]-a[1]),h=(c[0]-a[0])*f-e*(c[1]-a[1]);return g>0&&h<0||g<0&&h>0}function ea(i,j,k){var a,b,c,d,g,h;for(let f of k)for(let e=0;e<f.length-1;++e)if(0!=(g=[(d=f[e+1])[0]-(c=f[e])[0],d[1]-c[1]])[0]*(h=[(b=j)[0]-(a=i)[0],b[1]-a[1]])[1]-g[1]*h[0]&&d9(a,b,c,d)&&d9(c,d,a,b))return!0;return!1}function eb(a,d){for(let c=0;c<a.length;++c)if(!d7(a[c],d))return!1;for(let b=0;b<a.length-1;++b)if(ea(a[b],a[b+1],d))return!1;return!0}function ec(c,b){for(let a=0;a<b.length;a++)if(eb(c,b[a]))return!0;return!1}function ed(b,g,h){let d=[];for(let a=0;a<b.length;a++){let e=[];for(let c=0;c<b[a].length;c++){let f=d5(b[a][c],h);d3(g,f),e.push(f)}d.push(e)}return d}function ee(b,d,e){let c=[];for(let a=0;a<b.length;a++){let f=ed(b[a],d,e);c.push(f)}return c}function ef(a,f,b,c){if(a[0]<b[0]||a[0]>b[2]){let d=.5*c,e=a[0]-b[0]>d?-c:b[0]-a[0]>d?c:0;0===e&&(e=a[0]-b[2]>d?-c:b[2]-a[0]>d?c:0),a[0]+=e}d3(f,a)}function eg(f,g,h,a){let i=8192*Math.pow(2,a.z),b=[8192*a.x,8192*a.y],c=[];for(let j of f)for(let d of j){let e=[d.x+b[0],d.y+b[1]];ef(e,g,h,i),c.push(e)}return c}function eh(j,a,k,c){var b;let e=8192*Math.pow(2,c.z),f=[8192*c.x,8192*c.y],d=[];for(let l of j){let g=[];for(let h of l){let i=[h.x+f[0],h.y+f[1]];d3(a,i),g.push(i)}d.push(g)}if(a[2]-a[0]<=e/2)for(let m of((b=a)[0]=b[1]=1/0,b[2]=b[3]=-1/0,d))for(let n of m)ef(n,a,k,e);return d}class bu{constructor(a,b){this.type=g,this.geojson=a,this.geometries=b}static parse(b,d){if(2!==b.length)return d.error(`'within' expression requires exactly one argument, but found ${b.length-1} instead.`);if(dX(b[1])){let a=b[1];if("FeatureCollection"===a.type)for(let c=0;c<a.features.length;++c){let e=a.features[c].geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new bu(a,a.features[c].geometry)}else if("Feature"===a.type){let f=a.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new bu(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new bu(a,a)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(null!=a.geometry()&&null!=a.canonicalID()){if("Point"===a.geometryType())return function(e,b){let c=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],d=e.canonicalID();if("Polygon"===b.type){let f=ed(b.coordinates,a,d),g=eg(e.geometry(),c,a,d);if(!d4(c,a))return!1;for(let h of g)if(!d7(h,f))return!1}if("MultiPolygon"===b.type){let i=ee(b.coordinates,a,d),j=eg(e.geometry(),c,a,d);if(!d4(c,a))return!1;for(let k of j)if(!d8(k,i))return!1}return!0}(a,this.geometries);if("LineString"===a.geometryType())return function(e,b){let c=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],d=e.canonicalID();if("Polygon"===b.type){let f=ed(b.coordinates,a,d),g=eh(e.geometry(),c,a,d);if(!d4(c,a))return!1;for(let h of g)if(!eb(h,f))return!1}if("MultiPolygon"===b.type){let i=ee(b.coordinates,a,d),j=eh(e.geometry(),c,a,d);if(!d4(c,a))return!1;for(let k of j)if(!ec(k,i))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ei(a){if(a instanceof ah&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof bu)return!1;let b=!0;return a.eachChild(a=>{b&&!ei(a)&&(b=!1)}),b}function ej(a){if(a instanceof ah&&"feature-state"===a.name)return!1;let b=!0;return a.eachChild(a=>{b&&!ej(a)&&(b=!1)}),b}function ek(a,b){if(a instanceof ah&&b.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(a=>{c&&!ek(a,b)&&(c=!1)}),c}class bv{constructor(b,a){this.type=a.type,this.name=b,this.boundExpression=a}static parse(c,b){if(2!==c.length||"string"!=typeof c[1])return b.error("'var' expression requires exactly one string literal argument.");let a=c[1];return b.scope.has(a)?new bv(a,b.scope.get(a)):b.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class el{constructor(b,a=[],c,d=new dH,e=[]){this.registry=b,this.path=a,this.key=a.map(a=>`[${a}]`).join(""),this.scope=d,this.errors=e,this.expectedType=c}parse(a,b,d,e,c={}){return b?this.concat(b,d,e)._parse(a,c):this._parse(a,c)}_parse(a,f){function g(a,b,c){return"assert"===c?new w(b,[a]):"coerce"===c?new y(b,[a]):a}if(null!==a&&"string"!=typeof a&&"boolean"!=typeof a&&"number"!=typeof a||(a=["literal",a]),Array.isArray(a)){if(0===a.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let d=a[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let h=this.registry[d];if(h){let b=h.parse(a,this);if(!b)return null;if(this.expectedType){let c=this.expectedType,e=b.type;if("string"!==c.kind&&"number"!==c.kind&&"boolean"!==c.kind&&"object"!==c.kind&&"array"!==c.kind||"value"!==e.kind){if("color"!==c.kind&&"formatted"!==c.kind&&"resolvedImage"!==c.kind||"value"!==e.kind&&"string"!==e.kind){if(this.checkSubtype(c,e))return null}else b=g(b,c,f.typeAnnotation||"coerce")}else b=g(b,c,f.typeAnnotation||"assert")}if(!(b instanceof bq)&&"resolvedImage"!==b.type.kind&&em(b)){let i=new d2;try{b=new bq(b.type,b.evaluate(i))}catch(j){return this.error(j.message),null}}return b}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===a?"'undefined' value invalid. Use null instead.":"object"==typeof a?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,c,b){let d="number"==typeof a?this.path.concat(a):this.path,e=b?this.scope.concat(b):this.scope;return new el(this.registry,d,c||null,e,this.errors)}error(a,...b){let c=`${this.key}${b.map(a=>`[${a}]`).join("")}`;this.errors.push(new dG(c,a))}checkSubtype(b,c){let a=dK(b,c);return a&&this.error(a),a}}function em(a){if(a instanceof bv)return em(a.boundExpression);if(a instanceof ah&&"error"===a.name||a instanceof bt||a instanceof bu)return!1;let c=a instanceof y||a instanceof w,b=!0;return a.eachChild(a=>{b=c?b&&em(a):b&&a instanceof bq}),!!b&&ei(a)&&ek(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function en(b,c){let g=b.length-1,d,h,e=0,f=g,a=0;for(;e<=f;)if(d=b[a=Math.floor((e+f)/2)],h=b[a+1],d<=c){if(a===g||c<h)return a;e=a+1}else{if(!(d>c))throw new d$("Input is not a number.");f=a-1}return 0}class bw{constructor(a,b,c){for(let[d,e]of(this.type=a,this.input=b,this.labels=[],this.outputs=[],c))this.labels.push(d),this.outputs.push(e)}static parse(b,a){if(b.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${b.length-1}.`);if((b.length-1)%2!=0)return a.error("Expected an even number of arguments.");let i=a.parse(b[1],1,d);if(!i)return null;let e=[],f=null;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);for(let c=1;c<b.length;c+=2){let g=1===c?-1/0:b[c],k=b[c+1],j=c,l=c+1;if("number"!=typeof g)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(e.length&&e[e.length-1][0]>=g)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);let h=a.parse(k,l,f);if(!h)return null;f=f||h.type,e.push([g,h])}return new bw(f,i,e)}evaluate(a){let b=this.labels,c=this.outputs;if(1===b.length)return c[0].evaluate(a);let d=this.input.evaluate(a);if(d<=b[0])return c[0].evaluate(a);let e=b.length;return d>=b[e-1]?c[e-1].evaluate(a):c[en(b,d)].evaluate(a)}eachChild(a){for(let b of(a(this.input),this.outputs))a(b)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let b=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&b.push(this.labels[a]),b.push(this.outputs[a].serialize());return b}}function ai(b,c,a){return b*(1-a)+c*a}var eo=Object.freeze({__proto__:null,number:ai,color:function(a,b,c){return new m(ai(a.r,b.r,c),ai(a.g,b.g,c),ai(a.b,b.b,c),ai(a.a,b.a,c))},array:function(a,b,c){return a.map((a,d)=>ai(a,b[d],c))}});let ep=4/29,aj=6/29,eq=3*aj*aj,er=Math.PI/180,es=180/Math.PI;function et(a){return a>.008856451679035631?Math.pow(a,1/3):a/eq+ep}function eu(a){return a>aj?a*a*a:eq*(a-ep)}function ev(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ew(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function bx(a){let b=ew(a.r),c=ew(a.g),d=ew(a.b),f=et((.4124564*b+.3575761*c+.1804375*d)/.95047),e=et((.2126729*b+.7151522*c+.072175*d)/1);return{l:116*e-16,a:500*(f-e),b:200*(e-et((.0193339*b+.119192*c+.9503041*d)/1.08883)),alpha:a.a}}function by(b){let a=(b.l+16)/116,c=isNaN(b.a)?a:a+b.a/500,d=isNaN(b.b)?a:a-b.b/200;return a=1*eu(a),c=.95047*eu(c),d=1.08883*eu(d),new m(ev(3.2404542*c-1.5371385*a-.4985314*d),ev(-0.969266*c+1.8760108*a+.041556*d),ev(.0556434*c-.2040259*a+1.0572252*d),b.alpha)}let bz={forward:bx,reverse:by,interpolate:function(a,b,c){return{l:ai(a.l,b.l,c),a:ai(a.a,b.a,c),b:ai(a.b,b.b,c),alpha:ai(a.alpha,b.alpha,c)}}},bA={forward:function(d){let{l:e,a:a,b:b}=bx(d),c=Math.atan2(b,a)*es;return{h:c<0?c+360:c,c:Math.sqrt(a*a+b*b),l:e,alpha:d.a}},reverse:function(a){let b=a.h*er,c=a.c;return by({l:a.l,a:Math.cos(b)*c,b:Math.sin(b)*c,alpha:a.alpha})},interpolate:function(a,b,c){return{h:function(b,c,d){let a=c-b;return b+d*(a>180||a< -180?a-360*Math.round(a/360):a)}(a.h,b.h,c),c:ai(a.c,b.c,c),l:ai(a.l,b.l,c),alpha:ai(a.alpha,b.alpha,c)}}};var ex=Object.freeze({__proto__:null,lab:bz,hcl:bA});class M{constructor(a,b,c,d,e){for(let[f,g]of(this.type=a,this.operator=b,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[],e))this.labels.push(f),this.outputs.push(g)}static interpolationFactor(a,d,e,f){let b=0;if("exponential"===a.name)b=ey(d,a.base,e,f);else if("linear"===a.name)b=ey(d,1,e,f);else if("cubic-bezier"===a.name){let c=a.controlPoints;b=new df(c[0],c[1],c[2],c[3]).solve(ey(d,1,e,f))}return b}static parse(g,a){let[h,b,i,...j]=g;if(!Array.isArray(b)||0===b.length)return a.error("Expected an interpolation type expression.",1);if("linear"===b[0])b={name:"linear"};else if("exponential"===b[0]){let n=b[1];if("number"!=typeof n)return a.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:n}}else{if("cubic-bezier"!==b[0])return a.error(`Unknown interpolation type ${String(b[0])}`,1,0);{let k=b.slice(1);if(4!==k.length||k.some(a=>"number"!=typeof a||a<0||a>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:k}}}if(g.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${g.length-1}.`);if((g.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(i=a.parse(i,2,d)))return null;let f=[],c=null;"interpolate-hcl"===h||"interpolate-lab"===h?c=r:a.expectedType&&"value"!==a.expectedType.kind&&(c=a.expectedType);for(let e=0;e<j.length;e+=2){let l=j[e],p=j[e+1],o=e+3,q=e+4;if("number"!=typeof l)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(f.length&&f[f.length-1][0]>=l)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',o);let m=a.parse(p,q,c);if(!m)return null;c=c||m.type,f.push([l,m])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new M(c,h,b,i,f):a.error(`Type ${dI(c)} is not interpolatable.`)}evaluate(b){let a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(b);let d=this.input.evaluate(b);if(d<=a[0])return c[0].evaluate(b);let i=a.length;if(d>=a[i-1])return c[i-1].evaluate(b);let e=en(a,d),f=M.interpolationFactor(this.interpolation,d,a[e],a[e+1]),g=c[e].evaluate(b),h=c[e+1].evaluate(b);return"interpolate"===this.operator?eo[this.type.kind.toLowerCase()](g,h,f):"interpolate-hcl"===this.operator?bA.reverse(bA.interpolate(bA.forward(g),bA.forward(h),f)):bz.reverse(bz.interpolate(bz.forward(g),bz.forward(h),f))}eachChild(a){for(let b of(a(this.input),this.outputs))a(b)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let b;b="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let c=[this.operator,b,this.input.serialize()];for(let a=0;a<this.labels.length;a++)c.push(this.labels[a],this.outputs[a].serialize());return c}}function ey(e,a,c,f){let b=f-c,d=e-c;return 0===b?0:1===a?d/b:(Math.pow(a,d)-1)/(Math.pow(a,b)-1)}class bB{constructor(a,b){this.type=a,this.args=b}static parse(f,d){if(f.length<2)return d.error("Expectected at least one argument.");let a=null,b=d.expectedType;b&&"value"!==b.kind&&(a=b);let c=[];for(let g of f.slice(1)){let e=d.parse(g,1+c.length,a,void 0,{typeAnnotation:"omit"});if(!e)return null;a=a||e.type,c.push(e)}let h=b&&c.some(a=>dK(b,a.type));return new bB(h?j:a,c)}evaluate(d){let b,a=null,c=0;for(let e of this.args)if(c++,(a=e.evaluate(d))&&a instanceof bp&&!a.available&&(b||(b=a.name),a=null,c===this.args.length&&(a=b)),null!==a)break;return a}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){let a=["coalesce"];return this.eachChild(b=>{a.push(b.serialize())}),a}}class bC{constructor(b,a){this.type=a.type,this.bindings=[].concat(b),this.result=a}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(let b of this.bindings)a(b[1]);a(this.result)}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);let e=[];for(let b=1;b<a.length-1;b+=2){let d=a[b];if("string"!=typeof d)return c.error(`Expected string, but found ${typeof d} instead.`,b);if(/[^a-zA-Z0-9_]/.test(d))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);let f=c.parse(a[b+1],b+1);if(!f)return null;e.push([d,f])}let g=c.parse(a[a.length-1],a.length-1,c.expectedType,e);return g?new bC(e,g):null}outputDefined(){return this.result.outputDefined()}serialize(){let a=["let"];for(let[b,c]of this.bindings)a.push(b,c.serialize());return a.push(this.result.serialize()),a}}class bD{constructor(a,b,c){this.type=a,this.index=b,this.input=c}static parse(a,b){if(3!==a.length)return b.error(`Expected 2 arguments, but found ${a.length-1} instead.`);let e=b.parse(a[1],1,d),c=b.parse(a[2],2,s(b.expectedType||j));return e&&c?new bD(c.type.itemType,e,c):null}evaluate(c){let a=this.index.evaluate(c),b=this.input.evaluate(c);if(a<0)throw new d$(`Array index out of bounds: ${a} < 0.`);if(a>=b.length)throw new d$(`Array index out of bounds: ${a} > ${b.length-1}.`);if(a!==Math.floor(a))throw new d$(`Array index must be an integer, but found ${a} instead.`);return b[a]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bE{constructor(a,b){this.type=g,this.needle=a,this.haystack=b}static parse(a,b){if(3!==a.length)return b.error(`Expected 2 arguments, but found ${a.length-1} instead.`);let c=b.parse(a[1],1,j),e=b.parse(a[2],2,j);return c&&e?dL(c.type,[g,h,d,bk,j])?new bE(c,e):b.error(`Expected first argument to be of type boolean, string, number or null, but found ${dI(c.type)} instead`):null}evaluate(c){let b=this.needle.evaluate(c),a=this.haystack.evaluate(c);if(!a)return!1;if(!dM(b,["boolean","string","number","null"]))throw new d$(`Expected first argument to be of type boolean, string, number or null, but found ${dI(dY(b))} instead.`);if(!dM(a,["string","array"]))throw new d$(`Expected second argument to be of type array or string, but found ${dI(dY(a))} instead.`);return a.indexOf(b)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class bF{constructor(a,b,c){this.type=d,this.needle=a,this.haystack=b,this.fromIndex=c}static parse(a,b){if(a.length<=2||a.length>=5)return b.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);let c=b.parse(a[1],1,j),e=b.parse(a[2],2,j);if(!c||!e)return null;if(!dL(c.type,[g,h,d,bk,j]))return b.error(`Expected first argument to be of type boolean, string, number or null, but found ${dI(c.type)} instead`);if(4===a.length){let f=b.parse(a[3],3,d);return f?new bF(c,e,f):null}return new bF(c,e)}evaluate(c){let a=this.needle.evaluate(c),b=this.haystack.evaluate(c);if(!dM(a,["boolean","string","number","null"]))throw new d$(`Expected first argument to be of type boolean, string, number or null, but found ${dI(dY(a))} instead.`);if(!dM(b,["string","array"]))throw new d$(`Expected second argument to be of type array or string, but found ${dI(dY(b))} instead.`);if(this.fromIndex){let d=this.fromIndex.evaluate(c);return b.indexOf(a,d)}return b.indexOf(a)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&& void 0!==this.fromIndex){let a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class bG{constructor(a,b,c,d,e,f){this.inputType=a,this.type=b,this.input=c,this.cases=d,this.outputs=e,this.otherwise=f}static parse(b,c){if(b.length<5)return c.error(`Expected at least 4 arguments, but found only ${b.length-1}.`);if(b.length%2!=1)return c.error("Expected an even number of arguments.");let g,d;c.expectedType&&"value"!==c.expectedType.kind&&(d=c.expectedType);let k={},l=[];for(let e=2;e<b.length-1;e+=2){let h=b[e],o=b[e+1];Array.isArray(h)||(h=[h]);let f=c.concat(e);if(0===h.length)return f.error("Expected at least one branch label.");for(let a of h){if("number"!=typeof a&&"string"!=typeof a)return f.error("Branch labels must be numbers or strings.");if("number"==typeof a&&Math.abs(a)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof a&&Math.floor(a)!==a)return f.error("Numeric branch labels must be integer values.");if(g){if(f.checkSubtype(g,dY(a)))return null}else g=dY(a);if(void 0!==k[String(a)])return f.error("Branch labels must be unique.");k[String(a)]=l.length}let m=c.parse(o,e,d);if(!m)return null;d=d||m.type,l.push(m)}let i=c.parse(b[1],1,j);if(!i)return null;let n=c.parse(b[b.length-1],b.length-1,d);return n?"value"!==i.type.kind&&c.concat(1).checkSubtype(g,i.type)?null:new bG(g,d,i,k,l,n):null}evaluate(a){let b=this.input.evaluate(a);return(dY(b)===this.inputType&&this.outputs[this.cases[b]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){let b=["match",this.input.serialize()],h=Object.keys(this.cases).sort(),c=[],e={};for(let a of h){let f=e[this.cases[a]];void 0===f?(e[this.cases[a]]=c.length,c.push([this.cases[a],[a]])):c[f][1].push(a)}let g=a=>"number"===this.inputType.kind?Number(a):a;for(let[i,d]of c)b.push(1===d.length?g(d[0]):d.map(g)),b.push(this.outputs[i].serialize());return b.push(this.otherwise.serialize()),b}}class bH{constructor(a,b,c){this.type=a,this.branches=b,this.otherwise=c}static parse(a,b){if(a.length<4)return b.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return b.error("Expected an odd number of arguments.");let c;b.expectedType&&"value"!==b.expectedType.kind&&(c=b.expectedType);let f=[];for(let d=1;d<a.length-1;d+=2){let h=b.parse(a[d],d,g);if(!h)return null;let e=b.parse(a[d+1],d+1,c);if(!e)return null;f.push([h,e]),c=c||e.type}let i=b.parse(a[a.length-1],a.length-1,c);return i?new bH(c,f,i):null}evaluate(a){for(let[b,c]of this.branches)if(b.evaluate(a))return c.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(let[b,c]of this.branches)a(b),a(c);a(this.otherwise)}outputDefined(){return this.branches.every(([b,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){let a=["case"];return this.eachChild(b=>{a.push(b.serialize())}),a}}class bI{constructor(a,b,c,d){this.type=a,this.input=b,this.beginIndex=c,this.endIndex=d}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);let b=c.parse(a[1],1,j),e=c.parse(a[2],2,d);if(!b||!e)return null;if(!dL(b.type,[s(j),h,j]))return c.error(`Expected first argument to be of type array or string, but found ${dI(b.type)} instead`);if(4===a.length){let f=c.parse(a[3],3,d);return f?new bI(b.type,b,e,f):null}return new bI(b.type,b,e)}evaluate(b){let a=this.input.evaluate(b),c=this.beginIndex.evaluate(b);if(!dM(a,["string","array"]))throw new d$(`Expected first argument to be of type array or string, but found ${dI(dY(a))} instead.`);if(this.endIndex){let d=this.endIndex.evaluate(b);return a.slice(c,d)}return a.slice(c)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&& void 0!==this.endIndex){let a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ez(b,a){return"=="===b||"!="===b?"boolean"===a.kind||"string"===a.kind||"number"===a.kind||"null"===a.kind||"value"===a.kind:"string"===a.kind||"number"===a.kind||"value"===a.kind}function bJ(d,a,b,c){return 0===c.compare(a,b)}function t(a,b,c){let d="=="!==a&&"!="!==a;return class e{constructor(a,b,c){this.type=g,this.lhs=a,this.rhs=b,this.collator=c,this.hasUntypedArgument="value"===a.type.kind||"value"===b.type.kind}static parse(f,c){if(3!==f.length&&4!==f.length)return c.error("Expected two or three arguments.");let g=f[0],a=c.parse(f[1],1,j);if(!a)return null;if(!ez(g,a.type))return c.concat(1).error(`"${g}" comparisons are not supported for type '${dI(a.type)}'.`);let b=c.parse(f[2],2,j);if(!b)return null;if(!ez(g,b.type))return c.concat(2).error(`"${g}" comparisons are not supported for type '${dI(b.type)}'.`);if(a.type.kind!==b.type.kind&&"value"!==a.type.kind&&"value"!==b.type.kind)return c.error(`Cannot compare types '${dI(a.type)}' and '${dI(b.type)}'.`);d&&("value"===a.type.kind&&"value"!==b.type.kind?a=new w(b.type,[a]):"value"!==a.type.kind&&"value"===b.type.kind&&(b=new w(a.type,[b])));let h=null;if(4===f.length){if("string"!==a.type.kind&&"string"!==b.type.kind&&"value"!==a.type.kind&&"value"!==b.type.kind)return c.error("Cannot use collator to compare non-string types.");if(!(h=c.parse(f[3],3,bl)))return null}return new e(a,b,h)}evaluate(e){let f=this.lhs.evaluate(e),g=this.rhs.evaluate(e);if(d&&this.hasUntypedArgument){let h=dY(f),i=dY(g);if(h.kind!==i.kind||"string"!==h.kind&&"number"!==h.kind)throw new d$(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${h.kind}, ${i.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){let j=dY(f),k=dY(g);if("string"!==j.kind||"string"!==k.kind)return b(e,f,g)}return this.collator?c(e,f,g,this.collator.evaluate(e)):b(e,f,g)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}serialize(){let b=[a];return this.eachChild(a=>{b.push(a.serialize())}),b}}}let bK=t("==",function(c,a,b){return a===b},bJ),bL=t("!=",function(c,a,b){return a!==b},function(d,a,b,c){return!bJ(0,a,b,c)}),bM=t("<",function(c,a,b){return a<b},function(d,a,b,c){return 0>c.compare(a,b)}),bN=t(">",function(c,a,b){return a>b},function(d,a,b,c){return c.compare(a,b)>0}),bO=t("<=",function(c,a,b){return a<=b},function(d,a,b,c){return 0>=c.compare(a,b)}),bP=t(">=",function(c,a,b){return a>=b},function(d,a,b,c){return c.compare(a,b)>=0});class bQ{constructor(a,b,c,d,e){this.type=h,this.number=a,this.locale=b,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=e}static parse(c,b){if(3!==c.length)return b.error("Expected two arguments.");let e=b.parse(c[1],1,d);if(!e)return null;let a=c[2];if("object"!=typeof a||Array.isArray(a))return b.error("NumberFormat options argument must be an object.");let f=null;if(a.locale&&!(f=b.parse(a.locale,1,h)))return null;let g=null;if(a.currency&&!(g=b.parse(a.currency,1,h)))return null;let i=null;if(a["min-fraction-digits"]&&!(i=b.parse(a["min-fraction-digits"],1,d)))return null;let j=null;return!a["max-fraction-digits"]||(j=b.parse(a["max-fraction-digits"],1,d))?new bQ(e,f,g,i,j):null}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class bR{constructor(a){this.type=d,this.input=a}static parse(b,c){if(2!==b.length)return c.error(`Expected 1 argument, but found ${b.length-1} instead.`);let a=c.parse(b[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?c.error(`Expected argument of type string or array, but found ${dI(a.type)} instead.`):new bR(a):null}evaluate(b){let a=this.input.evaluate(b);if("string"==typeof a||Array.isArray(a))return a.length;throw new d$(`Expected value to be of type string or array, but found ${dI(dY(a))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){let a=["length"];return this.eachChild(b=>{a.push(b.serialize())}),a}}let z={"==":bK,"!=":bL,">":bN,"<":bM,">=":bP,"<=":bO,array:w,at:bD,boolean:w,case:bH,coalesce:bB,collator:bt,format:br,image:bs,in:bE,"index-of":bF,interpolate:M,"interpolate-hcl":M,"interpolate-lab":M,length:bR,let:bC,literal:bq,match:bG,number:w,"number-format":bQ,object:w,slice:bI,step:bw,string:w,"to-boolean":y,"to-color":y,"to-number":y,"to-string":y,var:bv,within:bu};function ak(b,[c,d,e,f]){c=c.evaluate(b),d=d.evaluate(b),e=e.evaluate(b);let a=f?f.evaluate(b):1,g=dW(c,d,e,a);if(g)throw new d$(g);return new m(c/255*a,d/255*a,e/255*a,a)}function eA(b,c){let a=c[b];return void 0===a?null:a}function o(a){return{type:a}}function eB(a){return{result:"success",value:a}}function eC(a){return{result:"error",value:a}}function eD(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function eE(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")> -1}function eF(a){return!!a.expression&&a.expression.interpolated}function eG(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function eH(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function eI(a){return a}function eJ(a,e){let r="color"===e.type,g=a.stops&&"object"==typeof a.stops[0][0],s=g||!(g|| void 0!==a.property),b=a.type||(eF(e)?"exponential":"interval");if(r&&((a=dD({},a)).stops&&(a.stops=a.stops.map(a=>[a[0],m.parse(a[1])])),a.default=m.parse(a.default?a.default:e.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!ex[a.colorSpace])throw Error(`Unknown color space: ${a.colorSpace}`);let f,j,t;if("exponential"===b)f=eN;else if("interval"===b)f=eM;else if("categorical"===b){for(let k of(f=eL,j=Object.create(null),a.stops))j[k[0]]=k[1];t=typeof a.stops[0][0]}else{if("identity"!==b)throw Error(`Unknown function type "${b}"`);f=eO}if(g){let c={},l=[];for(let h=0;h<a.stops.length;h++){let i=a.stops[h],d=i[0].zoom;void 0===c[d]&&(c[d]={zoom:d,type:a.type,property:a.property,default:a.default,stops:[]},l.push(d)),c[d].stops.push([i[0].value,i[1]])}let n=[];for(let o of l)n.push([c[o].zoom,eJ(c[o],e)]);let p={name:"linear"};return{kind:"composite",interpolationType:p,interpolationFactor:M.interpolationFactor.bind(void 0,p),zoomStops:n.map(a=>a[0]),evaluate:({zoom:b},c)=>eN({stops:n,base:a.base},e,b).evaluate(b,c)}}if(s){let q="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:M.interpolationFactor.bind(void 0,q),zoomStops:a.stops.map(a=>a[0]),evaluate:({zoom:b})=>f(a,e,b,j,t)}}return{kind:"source",evaluate(d,b){let c=b&&b.properties?b.properties[a.property]:void 0;return void 0===c?eK(a.default,e.default):f(a,e,c,j,t)}}}function eK(a,b,c){return void 0!==a?a:void 0!==b?b:void 0!==c?c:void 0}function eL(b,c,a,d,e){return eK(typeof a===e?d[a]:void 0,b.default,c.default)}function eM(a,d,b){if("number"!==eG(b))return eK(a.default,d.default);let c=a.stops.length;if(1===c||b<=a.stops[0][0])return a.stops[0][1];if(b>=a.stops[c-1][0])return a.stops[c-1][1];let e=en(a.stops.map(a=>a[0]),b);return a.stops[e][1]}function eN(a,e,b){let h=void 0!==a.base?a.base:1;if("number"!==eG(b))return eK(a.default,e.default);let d=a.stops.length;if(1===d||b<=a.stops[0][0])return a.stops[0][1];if(b>=a.stops[d-1][0])return a.stops[d-1][1];let c=en(a.stops.map(a=>a[0]),b),i=function(e,a,c,f){let b=f-c,d=e-c;return 0===b?0:1===a?d/b:(Math.pow(a,d)-1)/(Math.pow(a,b)-1)}(b,h,a.stops[c][0],a.stops[c+1][0]),f=a.stops[c][1],j=a.stops[c+1][1],g=eo[e.type]||eI;if(a.colorSpace&&"rgb"!==a.colorSpace){let k=ex[a.colorSpace];g=(a,b)=>k.reverse(k.interpolate(k.forward(a),k.forward(b),i))}return"function"==typeof f.evaluate?{evaluate(...a){let b=f.evaluate.apply(void 0,a),c=j.evaluate.apply(void 0,a);if(void 0!==b&& void 0!==c)return g(b,c,i)}}:g(f,j,i)}function eO(c,b,a){return"color"===b.type?a=m.parse(a):"formatted"===b.type?a=dV.fromString(a.toString()):"resolvedImage"===b.type?a=bp.fromString(a.toString()):eG(a)===b.type||"enum"===b.type&&b.values[a]||(a=void 0),eK(a,c.default,b.default)}ah.register(z,{error:[{kind:"error"},[h],(a,[b])=>{throw new d$(b.evaluate(a))}],typeof:[h,[j],(a,[b])=>dI(dY(b.evaluate(a)))],"to-rgba":[s(d,4),[r],(a,[b])=>b.evaluate(a).toArray()],rgb:[r,[d,d,d],ak],rgba:[r,[d,d,d,d],ak],has:{type:g,overloads:[[[h],(a,[d])=>{var b,c;return b=d.evaluate(a),c=a.properties(),b in c}],[[h,v],(a,[c,d])=>{var b,e;return b=c.evaluate(a),b in(e=d.evaluate(a))}]]},get:{type:j,overloads:[[[h],(a,[b])=>eA(b.evaluate(a),a.properties())],[[h,v],(a,[b,c])=>eA(b.evaluate(a),c.evaluate(a))]]},"feature-state":[j,[h],(a,[b])=>eA(b.evaluate(a),a.featureState||{})],properties:[v,[],a=>a.properties()],"geometry-type":[h,[],a=>a.geometryType()],id:[j,[],a=>a.id()],zoom:[d,[],a=>a.globals.zoom],"heatmap-density":[d,[],a=>a.globals.heatmapDensity||0],"line-progress":[d,[],a=>a.globals.lineProgress||0],accumulated:[j,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[d,o(d),(b,c)=>{let a=0;for(let d of c)a+=d.evaluate(b);return a}],"*":[d,o(d),(b,c)=>{let a=1;for(let d of c)a*=d.evaluate(b);return a}],"-":{type:d,overloads:[[[d,d],(a,[b,c])=>b.evaluate(a)-c.evaluate(a)],[[d],(a,[b])=>-b.evaluate(a)]]},"/":[d,[d,d],(a,[b,c])=>b.evaluate(a)/c.evaluate(a)],"%":[d,[d,d],(a,[b,c])=>b.evaluate(a)%c.evaluate(a)],ln2:[d,[],()=>Math.LN2],pi:[d,[],()=>Math.PI],e:[d,[],()=>Math.E],"^":[d,[d,d],(a,[b,c])=>Math.pow(b.evaluate(a),c.evaluate(a))],sqrt:[d,[d],(a,[b])=>Math.sqrt(b.evaluate(a))],log10:[d,[d],(a,[b])=>Math.log(b.evaluate(a))/Math.LN10],ln:[d,[d],(a,[b])=>Math.log(b.evaluate(a))],log2:[d,[d],(a,[b])=>Math.log(b.evaluate(a))/Math.LN2],sin:[d,[d],(a,[b])=>Math.sin(b.evaluate(a))],cos:[d,[d],(a,[b])=>Math.cos(b.evaluate(a))],tan:[d,[d],(a,[b])=>Math.tan(b.evaluate(a))],asin:[d,[d],(a,[b])=>Math.asin(b.evaluate(a))],acos:[d,[d],(a,[b])=>Math.acos(b.evaluate(a))],atan:[d,[d],(a,[b])=>Math.atan(b.evaluate(a))],min:[d,o(d),(b,a)=>Math.min(...a.map(a=>a.evaluate(b)))],max:[d,o(d),(b,a)=>Math.max(...a.map(a=>a.evaluate(b)))],abs:[d,[d],(a,[b])=>Math.abs(b.evaluate(a))],round:[d,[d],(b,[c])=>{let a=c.evaluate(b);return a<0?-Math.round(-a):Math.round(a)}],floor:[d,[d],(a,[b])=>Math.floor(b.evaluate(a))],ceil:[d,[d],(a,[b])=>Math.ceil(b.evaluate(a))],"filter-==":[g,[h,j],(a,[b,c])=>a.properties()[b.value]===c.value],"filter-id-==":[g,[j],(a,[b])=>a.id()===b.value],"filter-type-==":[g,[h],(a,[b])=>a.geometryType()===b.value],"filter-<":[g,[h,j],(c,[d,e])=>{let a=c.properties()[d.value],b=e.value;return typeof a==typeof b&&a<b}],"filter-id-<":[g,[j],(c,[d])=>{let a=c.id(),b=d.value;return typeof a==typeof b&&a<b}],"filter->":[g,[h,j],(c,[d,e])=>{let a=c.properties()[d.value],b=e.value;return typeof a==typeof b&&a>b}],"filter-id->":[g,[j],(c,[d])=>{let a=c.id(),b=d.value;return typeof a==typeof b&&a>b}],"filter-<=":[g,[h,j],(c,[d,e])=>{let a=c.properties()[d.value],b=e.value;return typeof a==typeof b&&a<=b}],"filter-id-<=":[g,[j],(c,[d])=>{let a=c.id(),b=d.value;return typeof a==typeof b&&a<=b}],"filter->=":[g,[h,j],(c,[d,e])=>{let a=c.properties()[d.value],b=e.value;return typeof a==typeof b&&a>=b}],"filter-id->=":[g,[j],(c,[d])=>{let a=c.id(),b=d.value;return typeof a==typeof b&&a>=b}],"filter-has":[g,[j],(a,[b])=>b.value in a.properties()],"filter-has-id":[g,[],a=>null!==a.id()&& void 0!==a.id()],"filter-type-in":[g,[s(h)],(a,[b])=>b.value.indexOf(a.geometryType())>=0],"filter-id-in":[g,[s(j)],(a,[b])=>b.value.indexOf(a.id())>=0],"filter-in-small":[g,[h,s(j)],(a,[b,c])=>c.value.indexOf(a.properties()[b.value])>=0],"filter-in-large":[g,[h,s(j)],(b,[c,a])=>(function(d,e,b,c){for(;b<=c;){let a=b+c>>1;if(e[a]===d)return!0;e[a]>d?c=a-1:b=a+1}return!1})(b.properties()[c.value],a.value,0,a.value.length-1)],all:{type:g,overloads:[[[g,g],(a,[b,c])=>b.evaluate(a)&&c.evaluate(a)],[o(g),(a,b)=>{for(let c of b)if(!c.evaluate(a))return!1;return!0}]]},any:{type:g,overloads:[[[g,g],(a,[b,c])=>b.evaluate(a)||c.evaluate(a)],[o(g),(a,b)=>{for(let c of b)if(c.evaluate(a))return!0;return!1}]]},"!":[g,[g],(a,[b])=>!b.evaluate(a)],"is-supported-script":[g,[h],(a,[c])=>{let b=a.globals&&a.globals.isSupportedScript;return!b||b(c.evaluate(a))}],upcase:[h,[h],(a,[b])=>b.evaluate(a).toUpperCase()],downcase:[h,[h],(a,[b])=>b.evaluate(a).toLowerCase()],concat:[h,o(j),(b,a)=>a.map(a=>dZ(a.evaluate(b))).join("")],"resolved-locale":[h,[bl],(a,[b])=>b.evaluate(a).resolvedLocale()]});class bS{constructor(c,b){var a;this.expression=c,this._warningHistory={},this._evaluator=new d2,this._defaultValue=b?"color"===(a=b).type&&eH(a.default)?new m(0,0,0,0):"color"===a.type?m.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=b&&"enum"===b.type?b.values:null}evaluateWithoutErrorHandling(a,b,c,d,e,f){return this._evaluator.globals=a,this._evaluator.feature=b,this._evaluator.featureState=c,this._evaluator.canonical=d,this._evaluator.availableImages=e||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(c,d,e,f,g,h){this._evaluator.globals=c,this._evaluator.feature=d||null,this._evaluator.featureState=e||null,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=h||null;try{let a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new d$(`Expected value to be one of ${Object.keys(this._enumValues).map(a=>JSON.stringify(a)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,"undefined"!=typeof console&&console.warn(b.message)),this._defaultValue}}}function eP(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in z}function bT(e,a){let b=new el(z,[],a?function(a){let b={color:r,string:h,number:d,enum:h,boolean:g,formatted:bm,resolvedImage:bn};return"array"===a.type?s(b[a.value]||j,a.length):b[a.type]}(a):void 0),c=b.parse(e,void 0,void 0,void 0,a&&"string"===a.type?{typeAnnotation:"coerce"}:void 0);return c?eB(new bS(c,a)):eC(b.errors)}class bU{constructor(a,b){this.kind=a,this._styleExpression=b,this.isStateDependent="constant"!==a&&!ej(b.expression)}evaluateWithoutErrorHandling(a,b,c,d,e,f){return this._styleExpression.evaluateWithoutErrorHandling(a,b,c,d,e,f)}evaluate(a,b,c,d,e,f){return this._styleExpression.evaluate(a,b,c,d,e,f)}}class bV{constructor(a,b,c,d){this.kind=a,this.zoomStops=c,this._styleExpression=b,this.isStateDependent="camera"!==a&&!ej(b.expression),this.interpolationType=d}evaluateWithoutErrorHandling(a,b,c,d,e,f){return this._styleExpression.evaluateWithoutErrorHandling(a,b,c,d,e,f)}evaluate(a,b,c,d,e,f){return this._styleExpression.evaluate(a,b,c,d,e,f)}interpolationFactor(a,b,c){return this.interpolationType?M.interpolationFactor(this.interpolationType,a,b,c):0}}function eQ(g,c){let b=bT(g,c);if("error"===b.result)return b;let d=b.value.expression,e=ei(d);if(!e&&!eD(c))return eC([new dG("","data expressions not supported")]);let f=ek(d,["zoom"]);if(!f&&!eE(c))return eC([new dG("","zoom expressions not supported")]);let a=eR(d);return a||f?a instanceof dG?eC([a]):a instanceof M&&!eF(c)?eC([new dG("",'"interpolate" expressions cannot be used with this property')]):eB(a?new bV(e?"camera":"composite",b.value,a.labels,a instanceof M?a.interpolation:void 0):new bU(e?"constant":"source",b.value)):eC([new dG("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class bW{constructor(a,b){this._parameters=a,this._specification=b,dD(this,eJ(this._parameters,this._specification))}static deserialize(a){return new bW(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function eR(a){let b=null;if(a instanceof bC)b=eR(a.result);else if(a instanceof bB){for(let c of a.args)if(b=eR(c))break}else(a instanceof bw||a instanceof M)&&a.input instanceof ah&&"zoom"===a.input.name&&(b=a);return b instanceof dG||a.eachChild(c=>{let a=eR(c);a instanceof dG?b=a:!b&&a?b=new dG("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):b&&a&&b!==a&&(b=new dG("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),b}function bX(c){let d=c.key,a=c.value,b=c.valueSpec||{},f=c.objectElementValidators||{},l=c.style,m=c.styleSpec,g=[],k=eG(a);if("object"!==k)return[new bi(d,a,`object expected, ${k} found`)];for(let e in a){let j=e.split(".")[0],n=b[j]||b["*"],h;if(f[j])h=f[j];else if(b[j])h=e4;else if(f["*"])h=f["*"];else{if(!b["*"]){g.push(new bi(d,a[e],`unknown property "${e}"`));continue}h=e4}g=g.concat(h({key:(d?`${d}.`:d)+e,value:a[e],valueSpec:n,style:l,styleSpec:m,object:a,objectKey:e},a))}for(let i in b)f[i]||b[i].required&& void 0===b[i].default&& void 0===a[i]&&g.push(new bi(d,a,`missing required property "${i}"`));return g}function bY(c){let a=c.value,b=c.valueSpec,i=c.style,h=c.styleSpec,e=c.key,j=c.arrayElementValidator||e4;if("array"!==eG(a))return[new bi(e,a,`array expected, ${eG(a)} found`)];if(b.length&&a.length!==b.length)return[new bi(e,a,`array length ${b.length} expected, length ${a.length} found`)];if(b["min-length"]&&a.length<b["min-length"])return[new bi(e,a,`array length at least ${b["min-length"]} expected, length ${a.length} found`)];let f={type:b.value,values:b.values};h.$version<7&&(f.function=b.function),"object"===eG(b.value)&&(f=b.value);let g=[];for(let d=0;d<a.length;d++)g=g.concat(j({array:a,arrayIndex:d,value:a[d],valueSpec:f,style:i,styleSpec:h,key:`${e}[${d}]`}));return g}function bZ(d){let e=d.key,a=d.value,b=d.valueSpec,c=eG(a);return"number"===c&&a!=a&&(c="NaN"),"number"!==c?[new bi(e,a,`number expected, ${c} found`)]:"minimum"in b&&a<b.minimum?[new bi(e,a,`${a} is less than the minimum value ${b.minimum}`)]:"maximum"in b&&a>b.maximum?[new bi(e,a,`${a} is greater than the maximum value ${b.maximum}`)]:[]}function b$(a){let f=a.valueSpec,c=dE(a.value.type),g,h,i,j={},d="categorical"!==c&& void 0===a.value.property,e="array"===eG(a.value.stops)&&"array"===eG(a.value.stops[0])&&"object"===eG(a.value.stops[0][0]),b=bX({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(a){if("identity"===c)return[new bi(a.key,a.value,'identity function may not have a "stops" property')];let b=[],d=a.value;return b=b.concat(bY({key:a.key,value:d,valueSpec:a.valueSpec,style:a.style,styleSpec:a.styleSpec,arrayElementValidator:k})),"array"===eG(d)&&0===d.length&&b.push(new bi(a.key,d,"array must have at least one stop")),b},default:function(a){return e4({key:a.key,value:a.value,valueSpec:f,style:a.style,styleSpec:a.styleSpec})}}});return"identity"===c&&d&&b.push(new bi(a.key,a.value,'missing required property "property"')),"identity"===c||a.value.stops||b.push(new bi(a.key,a.value,'missing required property "stops"')),"exponential"===c&&a.valueSpec.expression&&!eF(a.valueSpec)&&b.push(new bi(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(d||eD(a.valueSpec)?d&&!eE(a.valueSpec)&&b.push(new bi(a.key,a.value,"zoom functions not supported")):b.push(new bi(a.key,a.value,"property functions not supported"))),("categorical"===c||e)&& void 0===a.value.property&&b.push(new bi(a.key,a.value,'"property" property is required')),b;function k(c){let d=[],a=c.value,b=c.key;if("array"!==eG(a))return[new bi(b,a,`array expected, ${eG(a)} found`)];if(2!==a.length)return[new bi(b,a,`array length 2 expected, length ${a.length} found`)];if(e){if("object"!==eG(a[0]))return[new bi(b,a,`object expected, ${eG(a[0])} found`)];if(void 0===a[0].zoom)return[new bi(b,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new bi(b,a,"object stop key must have value")];if(i&&i>dE(a[0].zoom))return[new bi(b,a[0].zoom,"stop zoom values must appear in ascending order")];dE(a[0].zoom)!==i&&(i=dE(a[0].zoom),h=void 0,j={}),d=d.concat(bX({key:`${b}[0]`,value:a[0],valueSpec:{zoom:{}},style:c.style,styleSpec:c.styleSpec,objectElementValidators:{zoom:bZ,value:l}}))}else d=d.concat(l({key:`${b}[0]`,value:a[0],valueSpec:{},style:c.style,styleSpec:c.styleSpec},a));return eP(dF(a[1]))?d.concat([new bi(`${b}[1]`,a[1],"expressions are not allowed in function stops.")]):d.concat(e4({key:`${b}[1]`,value:a[1],valueSpec:f,style:c.style,styleSpec:c.styleSpec}))}function l(a,k){let b=eG(a.value),d=dE(a.value),e=null!==a.value?a.value:k;if(g){if(b!==g)return[new bi(a.key,e,`${b} stop domain type must match previous stop domain type ${g}`)]}else g=b;if("number"!==b&&"string"!==b&&"boolean"!==b)return[new bi(a.key,e,"stop domain value must be a number, string, or boolean")];if("number"!==b&&"categorical"!==c){let i=`number expected, ${b} found`;return eD(f)&& void 0===c&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bi(a.key,e,i)]}return"categorical"!==c||"number"!==b||isFinite(d)&&Math.floor(d)===d?"categorical"!==c&&"number"===b&& void 0!==h&&d<h?[new bi(a.key,e,"stop domain values must appear in ascending order")]:(h=d,"categorical"===c&&d in j?[new bi(a.key,e,"stop domain values must be unique")]:(j[d]=!0,[])):[new bi(a.key,e,`integer expected, found ${d}`)]}}function eS(a){let c=("property"===a.expressionContext?eQ:bT)(dF(a.value),a.valueSpec);if("error"===c.result)return c.value.map(b=>new bi(`${a.key}${b.key}`,a.value,b.message));let b=c.value.expression||c.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!b.outputDefined())return[new bi(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ej(b))return[new bi(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!ej(b))return[new bi(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!ek(b,["zoom","feature-state"]))return[new bi(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!ei(b))return[new bi(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function b_(c){let e=c.key,a=c.value,b=c.valueSpec,d=[];return Array.isArray(b.values)?-1===b.values.indexOf(dE(a))&&d.push(new bi(e,a,`expected one of [${b.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(b.values).indexOf(dE(a))&&d.push(new bi(e,a,`expected one of [${Object.keys(b.values).join(", ")}], ${JSON.stringify(a)} found`)),d}function eT(a){if(!0===a|| !1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(let b of a.slice(1))if(!eT(b)&&"boolean"!=typeof b)return!1;return!0;default:return!0}}let eU={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function b0(a){if(null==a)return{filter:()=>!0,needGeometry:!1};eT(a)||(a=eX(a));let b=bT(a,eU);if("error"===b.result)throw Error(b.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,c,d)=>b.value.evaluate(a,c,{},d),needGeometry:eW(a)}}function eV(a,b){return a<b?-1:a>b?1:0}function eW(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let b=1;b<a.length;b++)if(eW(a[b]))return!0;return!1}function eX(a){var c;if(!a)return!0;let b=a[0];return a.length<=1?"any"!==b:"=="===b?eY(a[1],a[2],"=="):"!="===b?e_(eY(a[1],a[2],"==")):"<"===b||">"===b||"<="===b||">="===b?eY(a[1],a[2],b):"any"===b?["any"].concat(a.slice(1).map(eX)):"all"===b?["all"].concat(a.slice(1).map(eX)):"none"===b?["all"].concat(a.slice(1).map(eX).map(e_)):"in"===b?eZ(a[1],a.slice(2)):"!in"===b?e_(eZ(a[1],a.slice(2))):"has"===b?e$(a[1]):"!has"===b?e_(e$(a[1])):"within"!==b||a}function eY(c,a,b){switch(c){case"$type":return[`filter-type-${b}`,a];case"$id":return[`filter-id-${b}`,a];default:return[`filter-${b}`,c,a]}}function eZ(b,a){if(0===a.length)return!1;switch(b){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(b=>typeof b!=typeof a[0])?["filter-in-large",b,["literal",a.sort(eV)]]:["filter-in-small",b,["literal",a]]}}function e$(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function e_(a){return["!",a]}function al(a){return eT(dF(a.value))?eS(dD({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):e0(a)}function e0(e){let a=e.value,c=e.key;if("array"!==eG(a))return[new bi(c,a,`array expected, ${eG(a)} found`)];let h=e.styleSpec,d,b=[];if(a.length<1)return[new bi(c,a,"filter array must have at least 1 element")];switch(b=b.concat(b_({key:`${c}[0]`,value:a[0],valueSpec:h.filter_operator,style:e.style,styleSpec:e.styleSpec})),dE(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&"$type"===dE(a[1])&&b.push(new bi(c,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":3!==a.length&&b.push(new bi(c,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&"string"!==(d=eG(a[1]))&&b.push(new bi(`${c}[1]`,a[1],`string expected, ${d} found`));for(let f=2;f<a.length;f++)d=eG(a[f]),"$type"===dE(a[1])?b=b.concat(b_({key:`${c}[${f}]`,value:a[f],valueSpec:h.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&b.push(new bi(`${c}[${f}]`,a[f],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let g=1;g<a.length;g++)b=b.concat(e0({key:`${c}[${g}]`,value:a[g],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":d=eG(a[1]),2!==a.length?b.push(new bi(c,a,`filter array for "${a[0]}" operator must have 2 elements`)):"string"!==d&&b.push(new bi(`${c}[1]`,a[1],`string expected, ${d} found`));break;case"within":d=eG(a[1]),2!==a.length?b.push(new bi(c,a,`filter array for "${a[0]}" operator must have 2 elements`)):"object"!==d&&b.push(new bi(`${c}[1]`,a[1],`object expected, ${d} found`))}return b}function e1(b,i){let d=b.key,e=b.style,f=b.styleSpec,a=b.value,c=b.objectKey,g=f[`${i}_${b.layerType}`];if(!g)return[];let j=c.match(/^(.*)-transition$/);if("paint"===i&&j&&g[j[1]]&&g[j[1]].transition)return e4({key:d,value:a,valueSpec:f.transition,style:e,styleSpec:f});let h=b.valueSpec||g[c];if(!h)return[new bi(d,a,`unknown property "${c}"`)];let l;if("string"===eG(a)&&eD(h)&&!h.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new bi(d,a,`"${c}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(l[1])} }\`.`)];let k=[];return"symbol"===b.layerType&&("text-field"===c&&e&&!e.glyphs&&k.push(new bi(d,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===c&&eH(dF(a))&&"identity"===dE(a.type)&&k.push(new bi(d,a,'"text-font" does not support identity functions'))),k.concat(e4({key:b.key,value:a,valueSpec:h,style:e,styleSpec:f,expressionContext:"property",propertyType:i,propertyKey:c}))}function b1(a){return e1(a,"paint")}function b2(a){return e1(a,"layout")}function am(d){let b=[],a=d.value,c=d.key,g=d.style,l=d.styleSpec;a.type||a.ref||b.push(new bi(c,a,'either "type" or "ref" is required'));let e=dE(a.type),m=dE(a.ref);if(a.id){let n=dE(a.id);for(let i=0;i<d.arrayIndex;i++){let k=g.layers[i];dE(k.id)===n&&b.push(new bi(c,a.id,`duplicate layer id "${a.id}", previously used at line ${k.id.__line__}`))}}if("ref"in a){let j;["type","source","source-layer","filter","layout"].forEach(d=>{d in a&&b.push(new bi(c,a[d],`"${d}" is prohibited for ref layers`))}),g.layers.forEach(a=>{dE(a.id)===m&&(j=a)}),j?j.ref?b.push(new bi(c,a.ref,"ref cannot reference another ref layer")):e=dE(j.type):b.push(new bi(c,a.ref,`ref layer "${m}" not found`))}else if("background"!==e){if(a.source){let h=g.sources&&g.sources[a.source],f=h&&dE(h.type);h?"vector"===f&&"raster"===e?b.push(new bi(c,a.source,`layer "${a.id}" requires a raster source`)):"raster"===f&&"raster"!==e?b.push(new bi(c,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==f||a["source-layer"]?"raster-dem"===f&&"hillshade"!==e?b.push(new bi(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===e&&a.paint&&a.paint["line-gradient"]&&("geojson"!==f||!h.lineMetrics)&&b.push(new bi(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):b.push(new bi(c,a,`layer "${a.id}" must specify a "source-layer"`)):b.push(new bi(c,a.source,`source "${a.source}" not found`))}else b.push(new bi(c,a,'missing required property "source"'))}return b=b.concat(bX({key:c,value:a,valueSpec:l.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>e4({key:`${c}.type`,value:a.type,valueSpec:l.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:al,layout:b=>bX({layer:a,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":a=>b2(dD({layerType:e},a))}}),paint:b=>bX({layer:a,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":a=>b1(dD({layerType:e},a))}})}}))}function b3(a){let b=a.value,d=a.key,c=eG(b);return"string"!==c?[new bi(d,b,`string expected, ${c} found`)]:[]}let e2={promoteId:function({key:b,value:a}){if("string"===eG(a))return b3({key:b,value:a});{let c=[];for(let d in a)c.push(...b3({key:`${b}.${d}`,value:a[d]}));return c}}};function an(d){let a=d.value,b=d.key,c=d.styleSpec,e=d.style;if(!a.type)return[new bi(b,a,'"type" is required')];let i=dE(a.type),f;switch(i){case"vector":case"raster":case"raster-dem":return bX({key:b,value:a,valueSpec:c[`source_${i.replace("-","_")}`],style:d.style,styleSpec:c,objectElementValidators:e2});case"geojson":if(f=bX({key:b,value:a,valueSpec:c.source_geojson,style:e,styleSpec:c,objectElementValidators:e2}),a.cluster)for(let g in a.clusterProperties){let[h,j]=a.clusterProperties[g],k="string"==typeof h?[h,["accumulated"],["get",g]]:h;f.push(...eS({key:`${b}.${g}.map`,value:j,expressionContext:"cluster-map"})),f.push(...eS({key:`${b}.${g}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return f;case"video":return bX({key:b,value:a,valueSpec:c.source_video,style:e,styleSpec:c});case"image":return bX({key:b,value:a,valueSpec:c.source_image,style:e,styleSpec:c});case"canvas":return[new bi(b,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return b_({key:`${b}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:e,styleSpec:c})}}function ao(f){let b=f.value,d=f.styleSpec,e=d.light,h=f.style,c=[],i=eG(b);if(void 0===b)return c;if("object"!==i)return c.concat([new bi("light",b,`object expected, ${i} found`)]);for(let a in b){let g=a.match(/^(.*)-transition$/);c=c.concat(g&&e[g[1]]&&e[g[1]].transition?e4({key:a,value:b[a],valueSpec:d.transition,style:h,styleSpec:d}):e[a]?e4({key:a,value:b[a],valueSpec:e[a],style:h,styleSpec:d}):[new bi(a,b[a],`unknown property "${a}"`)])}return c}let e3={"*":()=>[],array:bY,boolean:function(a){let b=a.value,d=a.key,c=eG(b);return"boolean"!==c?[new bi(d,b,`boolean expected, ${c} found`)]:[]},number:bZ,color:function(b){let c=b.key,a=b.value,d=eG(a);return"string"!==d?[new bi(c,a,`color expected, ${d} found`)]:null===bo(a)?[new bi(c,a,`color expected, "${a}" found`)]:[]},constants:bj,enum:b_,filter:al,function:b$,layer:am,object:bX,source:an,light:ao,string:b3,formatted:function(a){return 0===b3(a).length?[]:eS(a)},resolvedImage:function(a){return 0===b3(a).length?[]:eS(a)}};function e4(b){let c=b.value,a=b.valueSpec,d=b.styleSpec;return a.expression&&eH(dE(c))?b$(b):a.expression&&eP(dF(c))?eS(b):a.type&&e3[a.type]?e3[a.type](b):bX(dD({},b,{valueSpec:a.type?d[a.type]:a}))}function e5(c){let a=c.value,d=c.key,b=b3(c);return b.length||(-1===a.indexOf("{fontstack}")&&b.push(new bi(d,a,'"glyphs" url must include a "{fontstack}" token')),-1===a.indexOf("{range}")&&b.push(new bi(d,a,'"glyphs" url must include a "{range}" token'))),b}function p(a,d=b){let c=[];return c=c.concat(e4({key:"",value:a,valueSpec:d.$root,styleSpec:d,style:a,objectElementValidators:{glyphs:e5,"*":()=>[]}})),a.constants&&(c=c.concat(bj({key:"constants",value:a.constants,style:a,styleSpec:d}))),e6(c)}function e6(a){return[].concat(a).sort((a,b)=>a.line-b.line)}function u(a){return function(...b){return e6(a.apply(this,b))}}p.source=u(an),p.light=u(ao),p.layer=u(am),p.filter=u(al),p.paintProperty=u(b1),p.layoutProperty=u(b2);let A=p,b4=A.light,e7=A.paintProperty,e8=A.layoutProperty;function b5(c,a){let b=!1;if(a&&a.length)for(let d of a)c.fire(new bh(Error(d.message))),b=!0;return b}class b6{constructor(b,c,d){let e=this.cells=[];if(b instanceof ArrayBuffer){this.arrayBuffer=b;let a=new Int32Array(this.arrayBuffer);b=a[0],this.d=(c=a[1])+2*(d=a[2]);for(let f=0;f<this.d*this.d;f++){let g=a[3+f],h=a[3+f+1];e.push(g===h?null:a.subarray(g,h))}let i=a[3+e.length+1];this.keys=a.subarray(a[3+e.length],i),this.bboxes=a.subarray(i),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let j=0;j<this.d*this.d;j++)e.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=b,this.padding=d,this.scale=c/b,this.uid=0;let k=d/c*b;this.min=-k,this.max=b+k}insert(e,a,b,c,d){this._forEachCell(a,b,c,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(a),this.bboxes.push(b),this.bboxes.push(c),this.bboxes.push(d)}_insertReadonly(){throw Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,d,e,f,a,b){this.cells[a].push(b)}query(a,b,c,d,e){let f=this.min,g=this.max;if(a<=f&&b<=f&&g<=c&&g<=d&&!e)return Array.prototype.slice.call(this.keys);{let h=[];return this._forEachCell(a,b,c,d,this._queryCell,h,{},e),h}}_queryCell(h,i,j,k,l,m,d,g){let e=this.cells[l];if(null!==e){let n=this.keys,a=this.bboxes;for(let f=0;f<e.length;f++){let c=e[f];if(void 0===d[c]){let b=4*c;(g?g(a[b+0],a[b+1],a[b+2],a[b+3]):h<=a[b+2]&&i<=a[b+3]&&j>=a[b+0]&&k>=a[b+1])?(d[c]=!0,m.push(n[c])):d[c]=!1}}}}_forEachCell(d,e,f,g,h,i,j,c){let k=this._convertToCellCoord(d),l=this._convertToCellCoord(e),m=this._convertToCellCoord(f),n=this._convertToCellCoord(g);for(let a=k;a<=m;a++)for(let b=l;b<=n;b++){let o=this.d*b+a;if((!c||c(this._convertFromCellCoord(a),this._convertFromCellCoord(b),this._convertFromCellCoord(a+1),this._convertFromCellCoord(b+1)))&&h.call(this,d,e,f,g,o,i,j,c))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let c=this.cells,f=3+this.cells.length+1+1,g=0;for(let e=0;e<this.cells.length;e++)g+=this.cells[e].length;let a=new Int32Array(f+g+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;let b=f;for(let d=0;d<c.length;d++){let h=c[d];a[3+d]=b,a.set(h,b),b+=h.length}return a[3+c.length]=b,a.set(this.keys,b),b+=this.keys.length,a[3+c.length+1]=b,a.set(this.bboxes,b),b+=this.bboxes.length,a.buffer}static serialize(c,a){let b=c.toArrayBuffer();return a&&a.push(b),{buffer:b}}static deserialize(a){return new b6(a.buffer)}}let e9={};function c(a,b,c={}){Object.defineProperty(b,"_classRegistryKey",{value:a,writeable:!1}),e9[a]={klass:b,omit:c.omit||[],shallow:c.shallow||[]}}for(let N in c("Object",Object),c("TransferableGridIndex",b6),c("Color",m),c("Error",Error),c("AJAXError",af),c("ResolvedImage",bp),c("StylePropertyFunction",bW),c("StyleExpression",bS,{omit:["_evaluator"]}),c("ZoomDependentExpression",bV),c("ZoomConstantExpression",bU),c("CompoundExpression",ah,{omit:["_evaluate"]}),z)z[N]._classRegistryKey||c(`Expression_${N}`,z[N]);function fa(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function fb(a,b){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(fa(a)||a7(a))return b&&b.push(a),a;if(ArrayBuffer.isView(a)){let g=a;return b&&b.push(g.buffer),g}if(a instanceof ImageData)return b&&b.push(a.data.buffer),a;if(Array.isArray(a)){let h=[];for(let j of a)h.push(fb(j,b));return h}if("object"==typeof a){let f=a.constructor,c=f._classRegistryKey;if(!c)throw Error("can't serialize object of unregistered class");let d=f.serialize?f.serialize(a,b):{};if(!f.serialize){for(let e in a){if(!a.hasOwnProperty(e)||e9[c].omit.indexOf(e)>=0)continue;let i=a[e];d[e]=e9[c].shallow.indexOf(e)>=0?i:fb(i,b)}a instanceof Error&&(d.message=a.message)}if(d.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(d.$name=c),d}throw Error("can't serialize object of type "+typeof a)}function fc(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||fa(a)||a7(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(fc);if("object"==typeof a){let b=a.$name||"Object";if(!e9[b])throw Error(`can't deserialize unregistered class ${b}`);let{klass:c}=e9[b];if(!c)throw Error(`can't deserialize unregistered class ${b}`);if(c.deserialize)return c.deserialize(a);let e=Object.create(c.prototype);for(let d of Object.keys(a)){if("$name"===d)continue;let f=a[d];e[d]=e9[b].shallow.indexOf(d)>=0?f:fc(f)}return e}throw Error("can't deserialize object of type "+typeof a)}class b7{constructor(){this.first=!0}update(b,c){let a=Math.floor(b);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=b,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=c),b!==this.lastZoom&&(this.lastZoom=b,this.lastFloorZoom=a,!0))}}let b8={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function fd(a){for(let b of a)if(fg(b.charCodeAt(0)))return!0;return!1}function fe(a){for(let b of a)if(!ff(b.charCodeAt(0)))return!1;return!0}function ff(a){return!(b8.Arabic(a)||b8["Arabic Supplement"](a)||b8["Arabic Extended-A"](a)||b8["Arabic Presentation Forms-A"](a)||b8["Arabic Presentation Forms-B"](a))}function fg(a){return!(746!==a&&747!==a&&(a<4352||!(b8["Bopomofo Extended"](a)||b8.Bopomofo(a)||b8["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||b8["CJK Compatibility Ideographs"](a)||b8["CJK Compatibility"](a)||b8["CJK Radicals Supplement"](a)||b8["CJK Strokes"](a)||!(!b8["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||b8["CJK Unified Ideographs Extension A"](a)||b8["CJK Unified Ideographs"](a)||b8["Enclosed CJK Letters and Months"](a)||b8["Hangul Compatibility Jamo"](a)||b8["Hangul Jamo Extended-A"](a)||b8["Hangul Jamo Extended-B"](a)||b8["Hangul Jamo"](a)||b8["Hangul Syllables"](a)||b8.Hiragana(a)||b8["Ideographic Description Characters"](a)||b8.Kanbun(a)||b8["Kangxi Radicals"](a)||b8["Katakana Phonetic Extensions"](a)||b8.Katakana(a)&&12540!==a||!(!b8["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!b8["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||b8["Unified Canadian Aboriginal Syllabics"](a)||b8["Unified Canadian Aboriginal Syllabics Extended"](a)||b8["Vertical Forms"](a)||b8["Yijing Hexagram Symbols"](a)||b8["Yi Syllables"](a)||b8["Yi Radicals"](a))))}function fh(b){var a;return!(fg(b)||(a=b,b8["Latin-1 Supplement"](a)&&(167===a||169===a||174===a||177===a||188===a||189===a||190===a||215===a||247===a)||b8["General Punctuation"](a)&&(8214===a||8224===a||8225===a||8240===a||8241===a||8251===a||8252===a||8258===a||8263===a||8264===a||8265===a||8273===a)||b8["Letterlike Symbols"](a)||b8["Number Forms"](a)||b8["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||9003===a||a>=9085&&a<=9114||a>=9150&&a<=9165||9167===a||a>=9169&&a<=9179||a>=9186&&a<=9215)||b8["Control Pictures"](a)&&9251!==a||b8["Optical Character Recognition"](a)||b8["Enclosed Alphanumerics"](a)||b8["Geometric Shapes"](a)||b8["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||b8["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||b8["CJK Symbols and Punctuation"](a)||b8.Katakana(a)||b8["Private Use Area"](a)||b8["CJK Compatibility Forms"](a)||b8["Small Form Variants"](a)||b8["Halfwidth and Fullwidth Forms"](a)||8734===a||8756===a||8757===a||a>=9984&&a<=10087||a>=10102&&a<=10131||65532===a||65533===a))}function fi(a){return a>=1424&&a<=2303||b8["Arabic Presentation Forms-A"](a)||b8["Arabic Presentation Forms-B"](a)}function fj(a,b){return!(!b&&fi(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||b8.Khmer(a))}function fk(a){for(let b of a)if(fi(b.charCodeAt(0)))return!0;return!1}let fl="deferred",fm="loading",fn="loaded",fo=null,fp="unavailable",fq=null,b9=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")> -1&&(fp="error"),fo&&fo(a)};function fr(){ca.fire(new ag("pluginStateChange",{pluginStatus:fp,pluginURL:fq}))}let ca=new L,cb=function(){return fp},fs=function(){if(fp!==fl||!fq)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fp=fm,fr(),fq&&bd({url:fq},a=>{a?b9(a):(fp=fn,fr())})},cc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fp===fn||null!=cc.applyArabicShaping,isLoading:()=>fp===fm,setState(a){fp=a.pluginStatus,fq=a.pluginURL},isParsed:()=>null!=cc.applyArabicShaping&&null!=cc.processBidirectionalText&&null!=cc.processStyledBidirectionalText,getPluginURL:()=>fq};class cd{constructor(b,a){this.zoom=b,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new b7,this.transition={})}isSupportedScript(a){return function(a,b){for(let c of a)if(!fj(c.charCodeAt(0),b))return!1;return!0}(a,cc.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let a=this.zoom,b=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:b+(1-b)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*b}}}class ft{constructor(a,b){this.property=a,this.value=b,this.expression=function(a,b){if(eH(a))return new bW(a,b);if(eP(a)){let c=eQ(a,b);if("error"===c.result)throw Error(c.value.map(a=>`${a.key}: ${a.message}`).join(", "));return c.value}{let d=a;return"string"==typeof a&&"color"===b.type&&(d=m.parse(a)),{kind:"constant",evaluate:()=>d}}}(void 0===b?a.specification.default:b,a.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(a,b,c){return this.property.possiblyEvaluate(this,a,b,c)}}class fu{constructor(a){this.property=a,this.value=new ft(a,void 0)}transitioned(a,b){return new fv(this.property,this.value,b,a$({},a.transition,this.transition),a.now)}untransitioned(){return new fv(this.property,this.value,null,{},0)}}class ce{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return a2(this._values[a].value.value)}setValue(a,b){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new fu(this._values[a].property)),this._values[a].value=new ft(this._values[a].property,null===b?void 0:a2(b))}getTransition(a){return a2(this._values[a].transition)}setTransition(a,b){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new fu(this._values[a].property)),this._values[a].transition=a2(b)||void 0}serialize(){let b={};for(let a of Object.keys(this._values)){let c=this.getValue(a);void 0!==c&&(b[a]=c);let d=this.getTransition(a);void 0!==d&&(b[`${a}-transition`]=d)}return b}transitioned(c,d){let b=new fw(this._properties);for(let a of Object.keys(this._values))b._values[a]=this._values[a].transitioned(c,d._values[a]);return b}untransitioned(){let a=new fw(this._properties);for(let b of Object.keys(this._values))a._values[b]=this._values[b].untransitioned();return a}}class fv{constructor(b,c,d,a,e){this.property=b,this.value=c,this.begin=e+a.delay||0,this.end=this.begin+a.duration||0,b.specification.transition&&(a.delay||a.duration)&&(this.prior=d)}possiblyEvaluate(a,b,c){let d=a.now||0,e=this.value.possiblyEvaluate(a,b,c),f=this.prior;if(f){if(d>this.end||this.value.isDataDriven())return this.prior=null,e;if(d<this.begin)return f.possiblyEvaluate(a,b,c);{let g=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(a,b,c),e,function(a){if(a<=0)return 0;if(a>=1)return 1;let b=a*a,c=b*a;return 4*(a<.5?c:3*(a-b)+c-.75)}(g))}}return e}}class fw{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(c,d,e){let a=new fy(this._properties);for(let b of Object.keys(this._values))a._values[b]=this._values[b].possiblyEvaluate(c,d,e);return a}hasTransition(){for(let a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class fx{constructor(a,b,c){this.property=a,this.value=b,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(a){return"constant"===this.value.kind?this.value.value:a}evaluate(a,b,c,d){return this.property.evaluate(this.value,this.parameters,a,b,c,d)}}class fy{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class e{constructor(a){this.specification=a}possiblyEvaluate(a,b){return a.expression.evaluate(b)}interpolate(a,c,d){let b=eo[this.specification.type];return b?b(a,c,d):a}}class f{constructor(a,b){this.specification=a,this.overrides=b}possiblyEvaluate(a,b,c,d){return new fx(this,"constant"===a.expression.kind||"camera"===a.expression.kind?{kind:"constant",value:a.expression.evaluate(b,null,{},c,d)}:a.expression,b)}interpolate(a,b,d){if("constant"!==a.value.kind||"constant"!==b.value.kind)return a;if(void 0===a.value.value|| void 0===b.value.value)return new fx(this,{kind:"constant",value:void 0},a.parameters);let c=eo[this.specification.type];return c?new fx(this,{kind:"constant",value:c(a.value.value,b.value.value,d)},a.parameters):a}evaluate(a,b,c,d,e,f){return"constant"===a.kind?a.value:a.evaluate(b,c,d,e,f)}}class B extends f{possiblyEvaluate(b,a,e,f){if(void 0===b.value)return new fx(this,{kind:"constant",value:void 0},a);if("constant"===b.expression.kind){let c=b.expression.evaluate(a,null,{},e,f),d="resolvedImage"===b.property.specification.type&&"string"!=typeof c?c.name:c,g=this._calculate(d,d,d,a);return new fx(this,{kind:"constant",value:g},a)}if("camera"===b.expression.kind){let h=this._calculate(b.expression.evaluate({zoom:a.zoom-1}),b.expression.evaluate({zoom:a.zoom}),b.expression.evaluate({zoom:a.zoom+1}),a);return new fx(this,{kind:"constant",value:h},a)}return new fx(this,b.expression,a)}evaluate(a,b,c,d,f,g){if("source"===a.kind){let e=a.evaluate(b,c,d,f,g);return this._calculate(e,e,e,b)}return"composite"===a.kind?this._calculate(a.evaluate({zoom:Math.floor(b.zoom)-1},c,d),a.evaluate({zoom:Math.floor(b.zoom)},c,d),a.evaluate({zoom:Math.floor(b.zoom)+1},c,d),b):a.value}_calculate(c,a,d,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:a}:{from:d,to:a}}interpolate(a){return a}}class O{constructor(a){this.specification=a}possiblyEvaluate(b,a,d,e){if(void 0!==b.value){if("constant"===b.expression.kind){let c=b.expression.evaluate(a,null,{},d,e);return this._calculate(c,c,c,a)}return this._calculate(b.expression.evaluate(new cd(Math.floor(a.zoom-1),a)),b.expression.evaluate(new cd(Math.floor(a.zoom),a)),b.expression.evaluate(new cd(Math.floor(a.zoom+1),a)),a)}}_calculate(c,a,d,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:a}:{from:d,to:a}}interpolate(a){return a}}class P{constructor(a){this.specification=a}possiblyEvaluate(a,b,c,d){return!!a.expression.evaluate(b,null,{},c,d)}interpolate(){return!1}}class l{constructor(b){for(let a in this.properties=b,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],b){let c=b[a];c.specification.overridable&&this.overridableProperties.push(a);let d=this.defaultPropertyValues[a]=new ft(c,void 0),e=this.defaultTransitionablePropertyValues[a]=new fu(c);this.defaultTransitioningPropertyValues[a]=e.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate({})}}}c("DataDrivenProperty",f),c("DataConstantProperty",e),c("CrossFadedDataDrivenProperty",B),c("CrossFadedProperty",O),c("ColorRampProperty",P);let fz="-transition";class ap extends L{constructor(a,b){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==a.type&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,"background"!==a.type&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),b.layout&&(this._unevaluatedLayout=new class{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}getValue(a){return a2(this._values[a].value)}setValue(a,b){this._values[a]=new ft(this._values[a].property,null===b?void 0:a2(b))}serialize(){let a={};for(let b of Object.keys(this._values)){let c=this.getValue(b);void 0!==c&&(a[b]=c)}return a}possiblyEvaluate(c,d,e){let a=new fy(this._properties);for(let b of Object.keys(this._values))a._values[b]=this._values[b].possiblyEvaluate(c,d,e);return a}}(b.layout)),b.paint)){for(let c in this._transitionablePaint=new ce(b.paint),a.paint)this.setPaintProperty(c,a.paint[c],{validate:!1});for(let d in a.layout)this.setLayoutProperty(d,a.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fy(b.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return"visibility"===a?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,b,c={}){null!=b&&this._validate(e8,`layers.${this.id}.layout.${a}`,a,b,c)||("visibility"!==a?this._unevaluatedLayout.setValue(a,b):this.visibility=b)}getPaintProperty(a){return a.endsWith(fz)?this._transitionablePaint.getTransition(a.slice(0,-fz.length)):this._transitionablePaint.getValue(a)}setPaintProperty(a,b,e={}){if(null!=b&&this._validate(e7,`layers.${this.id}.paint.${a}`,a,b,e))return!1;if(a.endsWith(fz))return this._transitionablePaint.setTransition(a.slice(0,-fz.length),b||void 0),!1;{let c=this._transitionablePaint._values[a],f="cross-faded-data-driven"===c.property.specification["property-type"],g=c.value.isDataDriven(),h=c.value;this._transitionablePaint.setValue(a,b),this._handleSpecialPaintPropertyUpdate(a);let d=this._transitionablePaint._values[a].value;return d.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(a,h,d)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,b,c){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||"none"===this.visibility}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,b){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,b)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,b)}serialize(){let a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),a1(a,(a,b)=>!(void 0===a||"layout"===b&&!Object.keys(a).length||"paint"===b&&!Object.keys(a).length))}_validate(c,d,e,f,a={}){return(!a|| !1!==a.validate)&&b5(this,c.call(A,{key:d,layerType:this.type,objectKey:e,value:f,styleSpec:b,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let b in this.paint._values){let a=this.paint.get(b);if(a instanceof fx&&eD(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}}let fA={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class C{constructor(a,b){this._structArray=a,this._pos1=b*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class i{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,b){return a._trim(),b&&(a.isTransferred=!0,b.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(b){let a=Object.create(this.prototype);return a.arrayBuffer=b.arrayBuffer,a.length=b.length,a.capacity=b.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let b=this.uint8;this._refreshViews(),b&&this.uint8.set(b)}}_refreshViews(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function k(b,a=1){let c=0,d=0;return{members:b.map(b=>{let e=fA[b.type].BYTES_PER_ELEMENT,g=c=fB(c,Math.max(a,e)),f=b.components||1;return d=Math.max(d,e),c+=e*f,{name:b.name,type:b.type,components:f,offset:g}}),size:fB(c,Math.max(d,a)),alignment:a}}function fB(b,a){return Math.ceil(b/a)*a}class aq extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c){let a=this.length;return this.resize(a+1),this.emplace(a,b,c)}emplace(a,c,d){let b=2*a;return this.int16[b+0]=c,this.int16[b+1]=d,a}}aq.prototype.bytesPerElement=4,c("StructArrayLayout2i4",aq);class ar extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c,d,e){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e)}emplace(b,c,d,e,f){let a=4*b;return this.int16[a+0]=c,this.int16[a+1]=d,this.int16[a+2]=e,this.int16[a+3]=f,b}}ar.prototype.bytesPerElement=8,c("StructArrayLayout4i8",ar);class as extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g)}emplace(b,c,d,e,f,g,h){let a=6*b;return this.int16[a+0]=c,this.int16[a+1]=d,this.int16[a+2]=e,this.int16[a+3]=f,this.int16[a+4]=g,this.int16[a+5]=h,b}}as.prototype.bytesPerElement=12,c("StructArrayLayout2i4i12",as);class at extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g)}emplace(b,d,e,f,g,h,i){let c=4*b,a=8*b;return this.int16[c+0]=d,this.int16[c+1]=e,this.uint8[a+4]=f,this.uint8[a+5]=g,this.uint8[a+6]=h,this.uint8[a+7]=i,b}}at.prototype.bytesPerElement=8,c("StructArrayLayout2i4ub8",at);class au extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b,c){let a=this.length;return this.resize(a+1),this.emplace(a,b,c)}emplace(a,c,d){let b=2*a;return this.float32[b+0]=c,this.float32[b+1]=d,a}}au.prototype.bytesPerElement=8,c("StructArrayLayout2f8",au);class Q extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g,h,i,j,k){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g,h,i,j,k)}emplace(b,c,d,e,f,g,h,i,j,k,l){let a=10*b;return this.uint16[a+0]=c,this.uint16[a+1]=d,this.uint16[a+2]=e,this.uint16[a+3]=f,this.uint16[a+4]=g,this.uint16[a+5]=h,this.uint16[a+6]=i,this.uint16[a+7]=j,this.uint16[a+8]=k,this.uint16[a+9]=l,b}}Q.prototype.bytesPerElement=20,c("StructArrayLayout10ui20",Q);class av extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g,h,i,j,k,l,m){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g,h,i,j,k,l,m)}emplace(b,c,d,e,f,g,h,i,j,k,l,m,n){let a=12*b;return this.int16[a+0]=c,this.int16[a+1]=d,this.int16[a+2]=e,this.int16[a+3]=f,this.uint16[a+4]=g,this.uint16[a+5]=h,this.uint16[a+6]=i,this.uint16[a+7]=j,this.int16[a+8]=k,this.int16[a+9]=l,this.int16[a+10]=m,this.int16[a+11]=n,b}}av.prototype.bytesPerElement=24,c("StructArrayLayout4i4ui4i24",av);class aw extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b,c,d){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d)}emplace(b,c,d,e){let a=3*b;return this.float32[a+0]=c,this.float32[a+1]=d,this.float32[a+2]=e,b}}aw.prototype.bytesPerElement=12,c("StructArrayLayout3f12",aw);class ax extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(b){let a=this.length;return this.resize(a+1),this.emplace(a,b)}emplace(a,b){return this.uint32[1*a+0]=b,a}}ax.prototype.bytesPerElement=4,c("StructArrayLayout1ul4",ax);class R extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g,h,i,j){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g,h,i,j)}emplace(b,c,d,e,f,g,h,i,j,k){let a=10*b,l=5*b;return this.int16[a+0]=c,this.int16[a+1]=d,this.int16[a+2]=e,this.int16[a+3]=f,this.int16[a+4]=g,this.int16[a+5]=h,this.uint32[l+3]=i,this.uint16[a+8]=j,this.uint16[a+9]=k,b}}R.prototype.bytesPerElement=20,c("StructArrayLayout6i1ul2ui20",R);class S extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g)}emplace(b,c,d,e,f,g,h){let a=6*b;return this.int16[a+0]=c,this.int16[a+1]=d,this.int16[a+2]=e,this.int16[a+3]=f,this.int16[a+4]=g,this.int16[a+5]=h,b}}S.prototype.bytesPerElement=12,c("StructArrayLayout2i2i2i12",S);class ay extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f)}emplace(a,d,e,f,g,h){let b=4*a,c=8*a;return this.float32[b+0]=d,this.float32[b+1]=e,this.float32[b+2]=f,this.int16[c+6]=g,this.int16[c+7]=h,a}}ay.prototype.bytesPerElement=16,c("StructArrayLayout2f1f2i16",ay);class az extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b,c,d,e){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e)}emplace(a,d,e,f,g){let b=12*a,c=3*a;return this.uint8[b+0]=d,this.uint8[b+1]=e,this.float32[c+1]=f,this.float32[c+2]=g,a}}az.prototype.bytesPerElement=12,c("StructArrayLayout2ub2f12",az);class T extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b,c,d){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d)}emplace(b,c,d,e){let a=3*b;return this.uint16[a+0]=c,this.uint16[a+1]=d,this.uint16[a+2]=e,b}}T.prototype.bytesPerElement=6,c("StructArrayLayout3ui6",T);class U extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}emplace(c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){let a=24*c,b=12*c,d=48*c;return this.int16[a+0]=e,this.int16[a+1]=f,this.uint16[a+2]=g,this.uint16[a+3]=h,this.uint32[b+2]=i,this.uint32[b+3]=j,this.uint32[b+4]=k,this.uint16[a+10]=l,this.uint16[a+11]=m,this.uint16[a+12]=n,this.float32[b+7]=o,this.float32[b+8]=p,this.uint8[d+36]=q,this.uint8[d+37]=r,this.uint8[d+38]=s,this.uint32[b+10]=t,this.int16[a+22]=u,c}}U.prototype.bytesPerElement=48,c("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",U);class V extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C)}emplace(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){let a=34*c,b=17*c;return this.int16[a+0]=d,this.int16[a+1]=e,this.int16[a+2]=f,this.int16[a+3]=g,this.int16[a+4]=h,this.int16[a+5]=i,this.int16[a+6]=j,this.int16[a+7]=k,this.uint16[a+8]=l,this.uint16[a+9]=m,this.uint16[a+10]=n,this.uint16[a+11]=o,this.uint16[a+12]=p,this.uint16[a+13]=q,this.uint16[a+14]=r,this.uint16[a+15]=s,this.uint16[a+16]=t,this.uint16[a+17]=u,this.uint16[a+18]=v,this.uint16[a+19]=w,this.uint16[a+20]=x,this.uint16[a+21]=y,this.uint16[a+22]=z,this.uint32[b+12]=A,this.float32[b+13]=B,this.float32[b+14]=C,this.float32[b+15]=D,this.float32[b+16]=E,c}}V.prototype.bytesPerElement=68,c("StructArrayLayout8i15ui1ul4f68",V);class W extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b){let a=this.length;return this.resize(a+1),this.emplace(a,b)}emplace(a,b){return this.float32[1*a+0]=b,a}}W.prototype.bytesPerElement=4,c("StructArrayLayout1f4",W);class X extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(b,c,d){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d)}emplace(b,c,d,e){let a=3*b;return this.int16[a+0]=c,this.int16[a+1]=d,this.int16[a+2]=e,b}}X.prototype.bytesPerElement=6,c("StructArrayLayout3i6",X);class Y extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b,c,d){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d)}emplace(a,c,d,e){let b=4*a;return this.uint32[2*a+0]=c,this.uint16[b+2]=d,this.uint16[b+3]=e,a}}Y.prototype.bytesPerElement=8,c("StructArrayLayout1ul2ui8",Y);class Z extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b,c){let a=this.length;return this.resize(a+1),this.emplace(a,b,c)}emplace(a,c,d){let b=2*a;return this.uint16[b+0]=c,this.uint16[b+1]=d,a}}Z.prototype.bytesPerElement=4,c("StructArrayLayout2ui4",Z);class aA extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(b){let a=this.length;return this.resize(a+1),this.emplace(a,b)}emplace(a,b){return this.uint16[1*a+0]=b,a}}aA.prototype.bytesPerElement=2,c("StructArrayLayout1ui2",aA);class aB extends i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(b,c,d,e){let a=this.length;return this.resize(a+1),this.emplace(a,b,c,d,e)}emplace(b,c,d,e,f){let a=4*b;return this.float32[a+0]=c,this.float32[a+1]=d,this.float32[a+2]=e,this.float32[a+3]=f,b}}aB.prototype.bytesPerElement=16,c("StructArrayLayout4f16",aB);class cf extends C{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new J(this.anchorPointX,this.anchorPointY)}}cf.prototype.size=20;class aC extends R{get(a){return new cf(this,a)}}c("CollisionBoxArray",aC);class cg extends C{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}cg.prototype.size=48;class ch extends U{get(a){return new cg(this,a)}}c("PlacedSymbolArray",ch);class ci extends C{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ci.prototype.size=68;class cj extends V{get(a){return new ci(this,a)}}c("SymbolInstanceArray",cj);class ck extends W{getoffsetX(a){return this.float32[1*a+0]}}c("GlyphOffsetArray",ck);class cl extends X{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}c("SymbolLineVertexArray",cl);class cm extends C{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}cm.prototype.size=8;class cn extends Y{get(a){return new cm(this,a)}}c("FeatureIndexArray",cn);class fC extends Q{}class fD extends S{}class co extends T{}class fE extends Z{}let cp=k([{name:"a_pos",components:2,type:"Int16"}],4),{members:fF}=cp;class ${constructor(a=[]){this.segments=a}prepareSegment(b,d,e,c){let a=this.segments[this.segments.length-1];return b>$.MAX_VERTEX_ARRAY_LENGTH&&a3(`Max vertices per segment is ${$.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${b}`),(!a||a.vertexLength+b>$.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==c)&&(a={vertexOffset:d.length,primitiveOffset:e.length,vertexLength:0,primitiveLength:0},void 0!==c&&(a.sortKey=c),this.segments.push(a)),a}get(){return this.segments}destroy(){for(let a of this.segments)for(let b in a.vaos)a.vaos[b].destroy()}static simpleSegment(a,b,c,d){return new $([{vertexOffset:a,primitiveOffset:b,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function fG(a,b){return 256*(a=aY(Math.floor(a),0,255))+aY(Math.floor(b),0,255)}$.MAX_VERTEX_ARRAY_LENGTH=65535,c("SegmentVector",$);let fH=k([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var D={exports:{}},aD={exports:{}};aD.exports=function(c,j){var g,h,a,i,e,f,b,d;for(h=c.length-(g=3&c.length),a=j,e=3432918353,f=461845907,d=0;d<h;)b=255&c.charCodeAt(d)|(255&c.charCodeAt(++d))<<8|(255&c.charCodeAt(++d))<<16|(255&c.charCodeAt(++d))<<24,++d,a=27492+(65535&(i=5*(65535&(a=(a^=b=(65535&(b=(b=(65535&b)*e+(((b>>>16)*e&65535)<<16)&4294967295)<<15|b>>>17))*f+(((b>>>16)*f&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16);switch(b=0,g){case 3:b^=(255&c.charCodeAt(d+2))<<16;case 2:b^=(255&c.charCodeAt(d+1))<<8;case 1:a^=b=(65535&(b=(b=(65535&(b^=255&c.charCodeAt(d)))*e+(((b>>>16)*e&65535)<<16)&4294967295)<<15|b>>>17))*f+(((b>>>16)*f&65535)<<16)&4294967295}return a^=c.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var aE={exports:{}};aE.exports=function(b,f){for(var d,e=b.length,a=f^e,c=0;e>=4;)d=1540483477*(65535&(d=255&b.charCodeAt(c)|(255&b.charCodeAt(++c))<<8|(255&b.charCodeAt(++c))<<16|(255&b.charCodeAt(++c))<<24))+((1540483477*(d>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),e-=4,++c;switch(e){case 3:a^=(255&b.charCodeAt(c+2))<<16;case 2:a^=(255&b.charCodeAt(c+1))<<8;case 1:a=1540483477*(65535&(a^=255&b.charCodeAt(c)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var aF=aD.exports,cq=aE.exports;D.exports=aF,D.exports.murmur3=aF,D.exports.murmur2=cq;var fI=D.exports;class cr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,b,c,d){this.ids.push(fJ(a)),this.positions.push(b,c,d)}getPositions(f){let d=fJ(f),a=0,b=this.ids.length-1;for(;a<b;){let c=a+b>>1;this.ids[c]>=d?b=c:a=c+1}let e=[];for(;this.ids[a]===d;)e.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return e}static serialize(c,d){let a=new Float64Array(c.ids),b=new Uint32Array(c.positions);return fK(a,b,0,a.length-1),d&&d.push(a.buffer,b.buffer),{ids:a,positions:b}}static deserialize(b){let a=new cr;return a.ids=b.ids,a.positions=b.positions,a.indexed=!0,a}}function fJ(b){let a=+b;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:fI(String(b))}function fK(c,f,d,e){for(;d<e;){let g=c[d+e>>1],b=d-1,a=e+1;for(;;){do b++;while(c[b]<g)do a--;while(c[a]>g)if(b>=a)break;fL(c,b,a),fL(f,3*b,3*a),fL(f,3*b+1,3*a+1),fL(f,3*b+2,3*a+2)}a-d<e-a?(fK(c,f,d,a),d=a+1):(fK(c,f,a+1,e),e=a)}}function fL(a,b,c){let d=a[b];a[b]=a[c],a[c]=d}c("FeaturePositionMap",cr);class _{constructor(a,b){this.gl=a.gl,this.location=b}}class cs extends _{constructor(a,b){super(a,b),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ct extends _{constructor(a,b){super(a,b),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class cu extends _{constructor(a,b){super(a,b),this.current=m.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}let fM=new Float32Array(16);function fN(a){return[fG(255*a.r,255*a.g),fG(255*a.b,255*a.a)]}class cv{constructor(a,b,c){this.value=a,this.uniformNames=b.map(a=>`u_${a}`),this.type=c}setUniform(a,c,b){a.set(b.constantOr(this.value))}getBinding(a,b,c){return"color"===this.type?new cu(a,b):new cs(a,b)}}class cw{constructor(b,a){this.uniformNames=a.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,b){this.pixelRatioFrom=b.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=b.tlbr,this.patternTo=a.tlbr}setUniform(c,d,e,a){let b="u_pattern_to"===a?this.patternTo:"u_pattern_from"===a?this.patternFrom:"u_pixel_ratio_to"===a?this.pixelRatioTo:"u_pixel_ratio_from"===a?this.pixelRatioFrom:null;b&&c.set(b)}getBinding(a,b,c){return"u_pattern"===c.substr(0,9)?new ct(a,b):new cs(a,b)}}class cx{constructor(a,b,c,d){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=b.map(a=>({name:`a_${a}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(a,b,g,c,d){let e=this.paintVertexArray.length,f=this.expression.evaluate(new cd(0),b,{},c,[],d);this.paintVertexArray.resize(a),this._setPaintValue(e,a,f)}updatePaintArray(a,b,c,d){let e=this.expression.evaluate({zoom:0},c,d);this._setPaintValue(a,b,e)}_setPaintValue(d,e,a){if("color"===this.type){let f=fN(a);for(let b=d;b<e;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let c=d;c<e;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cy{constructor(b,a,c,d,e,f){this.expression=b,this.uniformNames=a.map(a=>`u_${a}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=e,this.maxValue=0,this.paintVertexAttributes=a.map(a=>({name:`a_${a}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(a,b,h,c,d){let e=this.expression.evaluate(new cd(this.zoom),b,{},c,[],d),f=this.expression.evaluate(new cd(this.zoom+1),b,{},c,[],d),g=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(g,a,e,f)}updatePaintArray(c,d,a,b){let e=this.expression.evaluate({zoom:this.zoom},a,b),f=this.expression.evaluate({zoom:this.zoom+1},a,b);this._setPaintValue(c,d,e,f)}_setPaintValue(e,f,a,b){if("color"===this.type){let g=fN(a),h=fN(b);for(let c=e;c<f;c++)this.paintVertexArray.emplace(c,g[0],g[1],h[0],h[1])}else{for(let d=e;d<f;d++)this.paintVertexArray.emplace(d,a,b);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(b,a){let c=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,d=aY(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);b.set(d)}getBinding(a,b,c){return new cs(a,b)}}class cz{constructor(b,c,d,e,a,f){this.expression=b,this.type=c,this.useIntegerZoom=d,this.zoom=e,this.layerId=f,this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a}populatePaintArray(a,b,c){let d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(d,a,b.patterns&&b.patterns[this.layerId],c)}updatePaintArray(b,c,a,e,d){this._setPaintValues(b,c,a.patterns&&a.patterns[this.layerId],d)}_setPaintValues(g,h,f,d){if(!d||!f)return;let{min:i,mid:j,max:k}=f,b=d[i],a=d[j],c=d[k];if(b&&a&&c)for(let e=g;e<h;e++)this.zoomInPaintVertexArray.emplace(e,a.tl[0],a.tl[1],a.br[0],a.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],a.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(e,a.tl[0],a.tl[1],a.br[0],a.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],a.pixelRatio,c.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,fH.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,fH.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class cA{constructor(e,i,m){this.binders={},this._buffers=[];let f=[];for(let a in e.paint._values){if(!m(a))continue;let c=e.paint.get(a);if(!(c instanceof fx&&eD(c.property.specification)))continue;let g=fO(a,e.type),b=c.value,d=c.property.specification.type,j=c.property.useIntegerZoom,k=c.property.specification["property-type"],h="cross-faded"===k||"cross-faded-data-driven"===k;if("constant"===b.kind)this.binders[a]=h?new cw(b.value,g):new cv(b.value,g,d),f.push(`/u_${a}`);else if("source"===b.kind||h){let l=fP(a,d,"source");this.binders[a]=h?new cz(b,d,j,i,l,e.id):new cx(b,g,d,l),f.push(`/a_${a}`)}else{let n=fP(a,d,"composite");this.binders[a]=new cy(b,g,d,j,i,n),f.push(`/z_${a}`)}}this.cacheKey=f.sort().join("")}getMaxValue(b){let a=this.binders[b];return a instanceof cx||a instanceof cy?a.maxValue:0}populatePaintArrays(b,c,d,e,f){for(let g in this.binders){let a=this.binders[g];(a instanceof cx||a instanceof cy||a instanceof cz)&&a.populatePaintArray(b,c,d,e,f)}}setConstantPatternPositions(b,c){for(let d in this.binders){let a=this.binders[d];a instanceof cw&&a.setConstantPatternPositions(b,c)}}updatePaintArrays(c,g,h,i,j){let d=!1;for(let e in c){let k=g.getPositions(e);for(let b of k){let l=h.feature(b.index);for(let f in this.binders){let a=this.binders[f];if((a instanceof cx||a instanceof cy||a instanceof cz)&& !0===a.expression.isStateDependent){let m=i.paint.get(f);a.expression=m.value,a.updatePaintArray(b.start,b.end,l,c[e],j),d=!0}}}}return d}defines(){let b=[];for(let c in this.binders){let a=this.binders[c];(a instanceof cv||a instanceof cw)&&b.push(...a.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return b}getBinderAttributes(){let b=[];for(let e in this.binders){let a=this.binders[e];if(a instanceof cx||a instanceof cy)for(let c=0;c<a.paintVertexAttributes.length;c++)b.push(a.paintVertexAttributes[c].name);else if(a instanceof cz)for(let d=0;d<fH.members.length;d++)b.push(fH.members[d].name)}return b}getBinderUniforms(){let b=[];for(let c in this.binders){let a=this.binders[c];if(a instanceof cv||a instanceof cw||a instanceof cy)for(let d of a.uniformNames)b.push(d)}return b}getPaintVertexBuffers(){return this._buffers}getUniforms(f,c){let d=[];for(let e in this.binders){let a=this.binders[e];if(a instanceof cv||a instanceof cw||a instanceof cy){for(let b of a.uniformNames)if(c[b]){let g=a.getBinding(f,c[b],b);d.push({name:b,property:e,binding:g})}}}return d}setUniforms(g,b,c,d){for(let{name:e,property:a,binding:f}of b)this.binders[a].setUniform(f,d,c.get(a),e)}updatePaintBuffers(b){for(let d in this._buffers=[],this.binders){let a=this.binders[d];if(b&&a instanceof cz){let c=2===b.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof cx||a instanceof cy)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(b){for(let c in this.binders){let a=this.binders[c];(a instanceof cx||a instanceof cy||a instanceof cz)&&a.upload(b)}this.updatePaintBuffers()}destroy(){for(let b in this.binders){let a=this.binders[b];(a instanceof cx||a instanceof cy||a instanceof cz)&&a.destroy()}}}class cB{constructor(b,c,d=()=>!0){for(let a of(this.programConfigurations={},b))this.programConfigurations[a.id]=new cA(a,c,d);this.needsUpload=!1,this._featureMap=new cr,this._bufferOffset=0}populatePaintArrays(a,b,c,d,e,f){for(let g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(a,b,d,e,f);void 0!==b.id&&this._featureMap.add(b.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(b,c,d,e){for(let a of d)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(b,this._featureMap,c,a,e)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(let b in this.programConfigurations)this.programConfigurations[b].upload(a);this.needsUpload=!1}}destroy(){for(let a in this.programConfigurations)this.programConfigurations[a].destroy()}}function fO(a,b){return({"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]})[a]||[a.replace(`${b}-`,"").replace(/-/g,"_")]}function fP(c,d,a){var e;let b={"line-pattern":{source:fC,composite:fC},"fill-pattern":{source:fC,composite:fC},"fill-extrusion-pattern":{source:fC,composite:fC}}[e=c];return b&&b[a]||({color:{source:au,composite:aB},number:{source:W,composite:au}})[d][a]}c("ConstantBinder",cv),c("CrossFadedConstantBinder",cw),c("SourceExpressionBinder",cx),c("CrossFadedCompositeBinder",cz),c("CompositeExpressionBinder",cy),c("ProgramConfiguration",cA,{omit:["_buffers"]}),c("ProgramConfigurationSet",cB);let fQ=-16383-1;function fR(g){let h=8192/g.extent,b=g.loadGeometry();for(let c=0;c<b.length;c++){let i=b[c];for(let d=0;d<i.length;d++){let a=i[d],e=Math.round(a.x*h),f=Math.round(a.y*h);a.x=aY(e,fQ,16383),a.y=aY(f,fQ,16383),(e<a.x||e>a.x+1||f<a.y||f>a.y+1)&&a3("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return b}function cC(a,b){return{type:a.type,id:a.id,properties:a.properties,geometry:b?fR(a):[]}}function fS(a,b,c,d,e){a.emplaceBack(2*b+(d+1)/2,2*c+(e+1)/2)}class aG{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(a=>a.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new class extends aq{},this.indexArray=new co,this.segments=new $,this.programConfigurations=new cB(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(g,m,b){let h=this.layers[0],c=[],i=null,d=!1;for(let{feature:a,id:n,index:o,sourceLayerIndex:p}of("circle"===h.type&&(d=!(i=h.layout.get("circle-sort-key")).isConstant()),g)){let j=this.layers[0]._featureFilter.needGeometry,e=cC(a,j);if(!this.layers[0]._featureFilter.filter(new cd(this.zoom),e,b))continue;let q=d?i.evaluate(e,{},b):void 0,r={id:n,properties:a.properties,type:a.type,sourceLayerIndex:p,index:o,geometry:j?e.geometry:fR(a),patterns:{},sortKey:q};c.push(r)}for(let k of(d&&c.sort((a,b)=>a.sortKey-b.sortKey),c)){let{geometry:l,index:f,sourceLayerIndex:s}=k,t=g[f].feature;this.addFeature(k,l,f,b),m.featureIndex.insert(t,l,f,s,this.index)}}update(a,b,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,b,this.stateDependentLayers,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,fF),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,g,h,i){for(let j of g)for(let f of j){let a=f.x,b=f.y;if(a<0||a>=8192||b<0||b>=8192)continue;let d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),c=d.vertexLength;fS(this.layoutVertexArray,a,b,-1,-1),fS(this.layoutVertexArray,a,b,1,-1),fS(this.layoutVertexArray,a,b,1,1),fS(this.layoutVertexArray,a,b,-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),d.vertexLength+=4,d.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,{},i)}}function cD(a,b){for(let c=0;c<a.length;c++)if(f_(b,a[c]))return!0;for(let d=0;d<b.length;d++)if(f_(a,b[d]))return!0;return!!fW(a,b)}function fT(a,b,c){return!!f_(a,b)||!!fY(b,a,c)}function fU(a,b){if(1===a.length)return f$(b,a[0]);for(let c=0;c<b.length;c++){let g=b[c];for(let d=0;d<g.length;d++)if(f_(a,g[d]))return!0}for(let e=0;e<a.length;e++)if(f$(b,a[e]))return!0;for(let f=0;f<b.length;f++)if(fW(a,b[f]))return!0;return!1}function fV(a,b,e){if(a.length>1){if(fW(a,b))return!0;for(let c=0;c<b.length;c++)if(fY(b[c],a,e))return!0}for(let d=0;d<a.length;d++)if(fY(a[d],b,e))return!0;return!1}function fW(a,b){if(0===a.length||0===b.length)return!1;for(let c=0;c<a.length-1;c++){let e=a[c],f=a[c+1];for(let d=0;d<b.length-1;d++)if(fX(e,f,b[d],b[d+1]))return!0}return!1}function fX(a,b,c,d){return di(a,c,d)!==di(b,c,d)&&di(a,b,c)!==di(a,b,d)}function fY(c,a,d){let e=d*d;if(1===a.length)return c.distSqr(a[0])<e;for(let b=1;b<a.length;b++)if(fZ(c,a[b-1],a[b])<e)return!0;return!1}function fZ(c,a,b){let e=a.distSqr(b);if(0===e)return c.distSqr(a);let d=((c.x-a.x)*(b.x-a.x)+(c.y-a.y)*(b.y-a.y))/e;return c.distSqr(d<0?a:d>1?b:b.sub(a)._mult(d)._add(a))}function f$(h,c){let b,a,d,e=!1;for(let f=0;f<h.length;f++){b=h[f];for(let g=0,i=b.length-1;g<b.length;i=g++)a=b[g],d=b[i],a.y>c.y!=d.y>c.y&&c.x<(d.x-a.x)*(c.y-a.y)/(d.y-a.y)+a.x&&(e=!e)}return e}function f_(b,c){let d=!1;for(let e=0,g=b.length-1;e<b.length;g=e++){let a=b[e],f=b[g];a.y>c.y!=f.y>c.y&&c.x<(f.x-a.x)*(c.y-a.y)/(f.y-a.y)+a.x&&(d=!d)}return d}function f0(a,b,c){let d=c[0],e=c[2];if(a.x<d.x&&b.x<d.x||a.x>e.x&&b.x>e.x||a.y<d.y&&b.y<d.y||a.y>e.y&&b.y>e.y)return!1;let f=di(a,b,c[0]);return f!==di(a,b,c[1])||f!==di(a,b,c[2])||f!==di(a,b,c[3])}function f1(a,b,d){let c=b.paint.get(a).value;return"constant"===c.kind?c.value:d.programConfigurations.get(b.id).getMaxValue(a)}function f2(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function f3(a,b,f,g,h){if(!b[0]&&!b[1])return a;let d=J.convert(b)._mult(h);"viewport"===f&&d._rotate(-g);let e=[];for(let c=0;c<a.length;c++)e.push(a[c].sub(d));return e}c("CircleBucket",aG,{omit:["layers"]});let cE=new l({"circle-sort-key":new f(b.layout_circle["circle-sort-key"])});var f4={paint:new l({"circle-radius":new f(b.paint_circle["circle-radius"]),"circle-color":new f(b.paint_circle["circle-color"]),"circle-blur":new f(b.paint_circle["circle-blur"]),"circle-opacity":new f(b.paint_circle["circle-opacity"]),"circle-translate":new e(b.paint_circle["circle-translate"]),"circle-translate-anchor":new e(b.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new e(b.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new e(b.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new f(b.paint_circle["circle-stroke-width"]),"circle-stroke-color":new f(b.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new f(b.paint_circle["circle-stroke-opacity"])}),layout:cE},aa="undefined"!=typeof Float32Array?Float32Array:Array;function cF(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function aH(a,b,c){var h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],m=b[5],n=b[6],o=b[7],p=b[8],q=b[9],r=b[10],s=b[11],t=b[12],u=b[13],v=b[14],w=b[15],d=c[0],e=c[1],f=c[2],g=c[3];return a[0]=d*h+e*l+f*p+g*t,a[1]=d*i+e*m+f*q+g*u,a[2]=d*j+e*n+f*r+g*v,a[3]=d*k+e*o+f*s+g*w,a[4]=(d=c[4])*h+(e=c[5])*l+(f=c[6])*p+(g=c[7])*t,a[5]=d*i+e*m+f*q+g*u,a[6]=d*j+e*n+f*r+g*v,a[7]=d*k+e*o+f*s+g*w,a[8]=(d=c[8])*h+(e=c[9])*l+(f=c[10])*p+(g=c[11])*t,a[9]=d*i+e*m+f*q+g*u,a[10]=d*j+e*n+f*r+g*v,a[11]=d*k+e*o+f*s+g*w,a[12]=(d=c[12])*h+(e=c[13])*l+(f=c[14])*p+(g=c[15])*t,a[13]=d*i+e*m+f*q+g*u,a[14]=d*j+e*n+f*r+g*v,a[15]=d*k+e*o+f*s+g*w,a}function cG(b,c,a){var d=c[0],e=c[1],f=c[2],g=c[3];return b[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*g,b[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*g,b[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*g,b[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*g,b}function f5(b,c){let a=cG([],[b.x,b.y,0,1],c);return new J(a[0]/a[3],a[1]/a[3])}Math.hypot||(Math.hypot=function(){for(var b=0,a=arguments.length;a--;)b+=arguments[a]*arguments[a];return Math.sqrt(b)}),hb=new aa(4),aa!=Float32Array&&(hb[0]=0,hb[1]=0,hb[2]=0,hb[3]=0);class cH extends aG{}c("HeatmapBucket",cH,{omit:["layers"]});var f6={paint:new l({"heatmap-radius":new f(b.paint_heatmap["heatmap-radius"]),"heatmap-weight":new f(b.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new e(b.paint_heatmap["heatmap-intensity"]),"heatmap-color":new P(b.paint_heatmap["heatmap-color"]),"heatmap-opacity":new e(b.paint_heatmap["heatmap-opacity"])})};function f7(b,{width:c,height:d},e,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==c*d*e)throw RangeError(`mismatched image size. expected: ${a.length} but got: ${c*d*e}`)}else a=new Uint8Array(c*d*e);return b.width=c,b.height=d,b.data=a,b}function f8(a,{width:b,height:c},d){if(b===a.width&&c===a.height)return;let e=f7({},{width:b,height:c},d);f9(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,b),height:Math.min(a.height,c)},d),a.width=b,a.height=c,a.data=e.data}function f9(c,b,d,e,a,h){if(0===a.width||0===a.height)return b;if(a.width>c.width||a.height>c.height||d.x>c.width-a.width||d.y>c.height-a.height)throw RangeError("out of range source coordinates for image copy");if(a.width>b.width||a.height>b.height||e.x>b.width-a.width||e.y>b.height-a.height)throw RangeError("out of range destination coordinates for image copy");let i=c.data,j=b.data;for(let f=0;f<a.height;f++){let k=((d.y+f)*c.width+d.x)*h,l=((e.y+f)*b.width+e.x)*h;for(let g=0;g<a.width*h;g++)j[l+g]=i[k+g]}return b}class aI{constructor(a,b){f7(this,a,1,b)}resize(a){f8(this,a,1)}clone(){return new aI({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,b,c,d,e){f9(a,b,c,d,e,1)}}class aJ{constructor(a,b){f7(this,a,4,b)}resize(a){f8(this,a,4)}replace(a,b){b?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new aJ({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,b,c,d,e){f9(a,b,c,d,e,4)}}function cI(a){let o={},b=a.resolution||256,f=a.clips?a.clips.length:1,l=a.image||new aJ({width:b,height:f}),g=(c,d,e)=>{o[a.evaluationKey]=e;let b=a.expression.evaluate(o);l.data[c+d+0]=Math.floor(255*b.r/b.a),l.data[c+d+1]=Math.floor(255*b.g/b.a),l.data[c+d+2]=Math.floor(255*b.b/b.a),l.data[c+d+3]=Math.floor(255*b.a)};if(a.clips)for(let c=0,h=0;c<f;++c,h+=4*b)for(let d=0,i=0;d<b;d++,i+=4){let j=d/(b-1),{start:m,end:n}=a.clips[c];g(h,i,m*(1-j)+n*j)}else for(let e=0,k=0;e<b;e++,k+=4)g(0,k,e/(b-1));return l}c("AlphaImage",aI),c("RGBAImage",aJ);var ga={paint:new l({"hillshade-illumination-direction":new e(b.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new e(b.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new e(b.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new e(b.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new e(b.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new e(b.paint_hillshade["hillshade-accent-color"])})};let cJ=k([{name:"a_pos",components:2,type:"Int16"}],4),{members:gb}=cJ;var ab={exports:{}};function E(b,f,a){a=a||2;var d,e,g,h,i,j,k,n=f&&f.length,o=n?f[0]*a:b.length,c=gc(b,0,o,a,!0),m=[];if(!c||c.next===c.prev)return m;if(n&&(c=function(h,e,b,f){var a,g,c,d=[];for(a=0,g=e.length;a<g;a++)(c=gc(h,e[a]*f,a<g-1?e[a+1]*f:h.length,f,!1))===c.next&&(c.steiner=!0),d.push(gn(c));for(d.sort(gj),a=0;a<d.length;a++)b=gd(b=gk(d[a],b),b.next);return b}(b,f,c,a)),b.length>80*a){d=g=b[0],e=h=b[1];for(var l=a;l<o;l+=a)(i=b[l])<d&&(d=i),(j=b[l+1])<e&&(e=j),i>g&&(g=i),j>h&&(h=j);k=0!==(k=Math.max(g-d,h-e))?1/k:0}return ge(c,m,a,d,e,k),m}function gc(c,e,f,d,g){var a,b;if(g===gA(c,e,f,d)>0)for(a=e;a<f;a+=d)b=gx(a,c[a],c[a+1],b);else for(a=f-d;a>=e;a-=d)b=gx(a,c[a],c[a+1],b);return b&&gr(b,b.next)&&(gy(b),b=b.next),b}function gd(c,b){if(!c)return c;b||(b=c);var d,a=c;do if(d=!1,a.steiner|| !gr(a,a.next)&&0!==gq(a.prev,a,a.next))a=a.next;else{if(gy(a),(a=b=a.prev)===a.next)break;d=!0}while(d||a!==b)return b}function ge(a,b,c,e,f,d,h){if(a){!h&&d&&function(b,c,d,e){var a=b;do null===a.z&&(a.z=gm(a.x,a.y,c,d,e)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==b)a.prevZ.nextZ=null,a.prevZ=null,function(g){var h,b,a,c,d,i,e,f,j=1;do{for(b=g,g=null,d=null,i=0;b;){for(i++,a=b,e=0,h=0;h<j&&(e++,a=a.nextZ);h++);for(f=j;e>0||f>0&&a;)0!==e&&(0===f||!a||b.z<=a.z)?(c=b,b=b.nextZ,e--):(c=a,a=a.nextZ,f--),d?d.nextZ=c:g=c,c.prevZ=d,d=c;b=a}d.nextZ=null,j*=2}while(i>1)}(a)}(a,e,f,d);for(var i,g,j=a;a.prev!==a.next;)if(i=a.prev,g=a.next,d?gg(a,e,f,d):gf(a))b.push(i.i/c),b.push(a.i/c),b.push(g.i/c),gy(a),a=g.next,j=g.next;else if((a=g)===j){h?1===h?ge(a=gh(gd(a),b,c),b,c,e,f,d,2):2===h&&gi(a,b,c,e,f,d):ge(gd(a),b,c,e,f,d,1);break}}}function gf(b){var c=b.prev,d=b,e=b.next;if(gq(c,d,e)>=0)return!1;for(var a=b.next.next;a!==b.prev;){if(go(c.x,c.y,d.x,d.y,e.x,e.y,a.x,a.y)&&gq(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function gg(f,g,h,i){var d=f.prev,e=f,a=f.next;if(gq(d,e,a)>=0)return!1;for(var l=d.x>e.x?d.x>a.x?d.x:a.x:e.x>a.x?e.x:a.x,m=d.y>e.y?d.y>a.y?d.y:a.y:e.y>a.y?e.y:a.y,j=gm(d.x<e.x?d.x<a.x?d.x:a.x:e.x<a.x?e.x:a.x,d.y<e.y?d.y<a.y?d.y:a.y:e.y<a.y?e.y:a.y,g,h,i),k=gm(l,m,g,h,i),b=f.prevZ,c=f.nextZ;b&&b.z>=j&&c&&c.z<=k;){if(b!==f.prev&&b!==f.next&&go(d.x,d.y,e.x,e.y,a.x,a.y,b.x,b.y)&&gq(b.prev,b,b.next)>=0||(b=b.prevZ,c!==f.prev&&c!==f.next&&go(d.x,d.y,e.x,e.y,a.x,a.y,c.x,c.y)&&gq(c.prev,c,c.next)>=0))return!1;c=c.nextZ}for(;b&&b.z>=j;){if(b!==f.prev&&b!==f.next&&go(d.x,d.y,e.x,e.y,a.x,a.y,b.x,b.y)&&gq(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;c&&c.z<=k;){if(c!==f.prev&&c!==f.next&&go(d.x,d.y,e.x,e.y,a.x,a.y,c.x,c.y)&&gq(c.prev,c,c.next)>=0)return!1;c=c.nextZ}return!0}function gh(d,e,f){var a=d;do{var c=a.prev,b=a.next.next;!gr(c,b)&&gs(c,a,a.next,b)&&gv(c,b)&&gv(b,c)&&(e.push(c.i/f),e.push(a.i/f),e.push(b.i/f),gy(a),gy(a.next),a=d=b),a=a.next}while(a!==d)return gd(a)}function gi(d,e,f,g,h,i){var a=d;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&gp(a,b)){var c=gw(a,b);return a=gd(a,a.next),c=gd(c,c.next),ge(a,e,f,g,h,i),void ge(c,e,f,g,h,i)}b=b.next}a=a.next}while(a!==d)}function gj(a,b){return a.x-b.x}function gk(c,b){var a=function(h,k){var b,a=k,d=h.x,c=h.y,e=-1/0;do{if(c<=a.y&&c>=a.next.y&&a.next.y!==a.y){var f=a.x+(c-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(f<=d&&f>e){if(e=f,f===d){if(c===a.y)return a;if(c===a.next.y)return a.next}b=a.x<a.next.x?a:a.next}}a=a.next}while(a!==k)if(!b)return null;if(d===e)return b;var g,m=b,l=b.x,i=b.y,j=1/0;a=b;do d>=a.x&&a.x>=l&&d!==a.x&&go(c<i?d:e,c,l,i,c<i?e:d,c,a.x,a.y)&&(g=Math.abs(c-a.y)/(d-a.x),gv(a,h)&&(g<j||g===j&&(a.x>b.x||a.x===b.x&&gl(b,a)))&&(b=a,j=g)),a=a.next;while(a!==m)return b}(c,b);if(!a)return b;var d=gw(a,c),e=gd(a,a.next);return gd(d,d.next),b===a?e:b}function gl(a,b){return 0>gq(a.prev,a,b.prev)&&0>gq(b.next,a,a.next)}function gm(a,b,d,e,c){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-d)*c)|a<<8))|a<<4))|a<<2))|a<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=32767*(b-e)*c)|b<<8))|b<<4))|b<<2))|b<<1))<<1}function gn(c){var a=c,b=c;do(a.x<b.x||a.x===b.x&&a.y<b.y)&&(b=a),a=a.next;while(a!==c)return b}function go(c,d,e,f,g,h,a,b){return(g-a)*(d-b)-(c-a)*(h-b)>=0&&(c-a)*(f-b)-(e-a)*(d-b)>=0&&(e-a)*(h-b)-(g-a)*(f-b)>=0}function gp(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(b,c){var a=b;do{if(a.i!==b.i&&a.next.i!==b.i&&a.i!==c.i&&a.next.i!==c.i&&gs(a,a.next,b,c))return!0;a=a.next}while(a!==b)return!1}(a,b)&&(gv(a,b)&&gv(b,a)&&function(b,e){var a=b,c=!1,f=(b.x+e.x)/2,d=(b.y+e.y)/2;do a.y>d!=a.next.y>d&&a.next.y!==a.y&&f<(a.next.x-a.x)*(d-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==b)return c}(a,b)&&(gq(a.prev,a,b.prev)||gq(a,b.prev,b))||gr(a,b)&&gq(a.prev,a,a.next)>0&&gq(b.prev,b,b.next)>0)}function gq(b,a,c){return(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y)}function gr(a,b){return a.x===b.x&&a.y===b.y}function gs(a,b,c,d){var e=gu(gq(a,b,c)),f=gu(gq(a,b,d)),g=gu(gq(c,d,a)),h=gu(gq(c,d,b));return e!==f&&g!==h||!(0!==e||!gt(a,c,b))||!(0!==f||!gt(a,d,b))||!(0!==g||!gt(c,a,d))||!(0!==h||!gt(c,b,d))}function gt(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function gu(a){return a>0?1:a<0?-1:0}function gv(a,b){return 0>gq(a.prev,a,a.next)?gq(a,b,a.next)>=0&&gq(a,a.prev,b)>=0:0>gq(a,b,a.prev)||0>gq(a,a.next,b)}function gw(a,b){var d=new gz(a.i,a.x,a.y),c=new gz(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,d.next=e,e.prev=d,c.next=d,d.prev=c,f.next=c,c.prev=f,c}function gx(c,d,e,b){var a=new gz(c,d,e);return b?(a.next=b.next,a.prev=b,b.next.prev=a,b.next=a):(a.prev=a,a.next=a),a}function gy(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function gz(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gA(b,g,d,e){for(var f=0,a=g,c=d-e;a<d;a+=e)f+=(b[c]-b[a])*(b[a+1]+b[c+1]),c=a;return f}ab.exports=E,ab.exports.default=E,E.deviation=function(a,d,c,e){var i=d&&d.length,f=Math.abs(gA(a,0,i?d[0]*c:a.length,c));if(i)for(var b=0,j=d.length;b<j;b++)f-=Math.abs(gA(a,d[b]*c,b<j-1?d[b+1]*c:a.length,c));var h=0;for(b=0;b<e.length;b+=3){var g=e[b]*c,k=e[b+1]*c,l=e[b+2]*c;h+=Math.abs((a[g]-a[l])*(a[k+1]-a[g+1])-(a[g]-a[k])*(a[l+1]-a[g+1]))}return 0===f&&0===h?0:Math.abs((h-f)/f)},E.flatten=function(b){for(var f=b[0][0].length,c={vertices:[],holes:[],dimensions:f},g=0,a=0;a<b.length;a++){for(var d=0;d<b[a].length;d++)for(var e=0;e<f;e++)c.vertices.push(b[a][d][e]);a>0&&c.holes.push(g+=b[a-1].length)}return c};var gB=ab.exports;function gC(a,b,c,d,e){gD(a,b,c||0,d||a.length-1,e||gF)}function gD(a,e,b,d,g){for(;d>b;){if(d-b>600){var f=d-b+1,k=e-b+1,l=Math.log(f),i=.5*Math.exp(2*l/3),m=.5*Math.sqrt(l*i*(f-i)/f)*(k-f/2<0?-1:1);gD(a,e,Math.max(b,Math.floor(e-k*i/f+m)),Math.min(d,Math.floor(e+(f-k)*i/f+m)),g)}var j=a[e],h=b,c=d;for(gE(a,b,e),g(a[d],j)>0&&gE(a,b,d);h<c;){for(gE(a,h,c),h++,c--;0>g(a[h],j);)h++;for(;g(a[c],j)>0;)c--}0===g(a[b],j)?gE(a,b,c):gE(a,++c,d),c<=e&&(b=c+1),e<=c&&(d=c-1)}}function gE(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function gF(a,b){return a<b?-1:a>b?1:0}function gG(c,f){let i=c.length;if(i<=1)return[c];let a=[],d,h;for(let e=0;e<i;e++){let g=dj(c[e]);0!==g&&(c[e].area=Math.abs(g),void 0===h&&(h=g<0),h===g<0?(d&&a.push(d),d=[c[e]]):d.push(c[e]))}if(d&&a.push(d),f>1)for(let b=0;b<a.length;b++)a[b].length<=f||(gC(a[b],f,1,a[b].length-1,gH),a[b]=a[b].slice(0,f));return a}function gH(a,b){return b.area-a.area}function gI(e,f,g){let c=g.patternDependencies,a=!1;for(let h of f){let d=h.paint.get(`${e}-pattern`);d.isConstant()||(a=!0);let b=d.constantOr(null);b&&(a=!0,c[b.to]=!0,c[b.from]=!0)}return a}function gJ(j,k,d,g,e){let h=e.patternDependencies;for(let i of k){let f=i.paint.get(`${j}-pattern`).value;if("constant"!==f.kind){let a=f.evaluate({zoom:g-1},d,{},e.availableImages),b=f.evaluate({zoom:g},d,{},e.availableImages),c=f.evaluate({zoom:g+1},d,{},e.availableImages);a=a&&a.name?a.name:a,b=b&&b.name?b.name:b,c=c&&c.name?c.name:c,h[a]=!0,h[b]=!0,h[c]=!0,d.patterns[i.id]={min:a,mid:b,max:c}}}return d}class aK{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(a=>a.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new class extends aq{},this.indexArray=new co,this.indexArray2=new fE,this.programConfigurations=new cB(a.layers,a.zoom),this.segments=new $,this.segments2=new $,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(h,a,c){this.hasPattern=gI("fill",this.layers,a);let i=this.layers[0].layout.get("fill-sort-key"),j=!i.isConstant(),d=[];for(let{feature:b,id:m,index:n,sourceLayerIndex:o}of h){let k=this.layers[0]._featureFilter.needGeometry,e=cC(b,k);if(!this.layers[0]._featureFilter.filter(new cd(this.zoom),e,c))continue;let p=j?i.evaluate(e,{},c,a.availableImages):void 0,q={id:m,properties:b.properties,type:b.type,sourceLayerIndex:o,index:n,geometry:k?e.geometry:fR(b),patterns:{},sortKey:p};d.push(q)}for(let f of(j&&d.sort((a,b)=>a.sortKey-b.sortKey),d)){let{geometry:l,index:g,sourceLayerIndex:r}=f;if(this.hasPattern){let s=gJ("fill",this.layers,f,this.zoom,a);this.patternFeatures.push(s)}else this.addFeature(f,l,g,c,{});a.featureIndex.insert(h[g].feature,l,g,r,this.index)}}update(a,b,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,b,this.stateDependentLayers,c)}addFeatures(d,b,c){for(let a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,b,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,gb),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(m,n,o,p,q){for(let g of gG(n,500)){let h=0;for(let r of g)h+=r.length;let i=this.segments.prepareSegment(h,this.layoutVertexArray,this.indexArray),j=i.vertexLength,c=[],l=[];for(let a of g){if(0===a.length)continue;a!==g[0]&&l.push(c.length/2);let k=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),f=k.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(f+a.length-1,f),c.push(a[0].x),c.push(a[0].y);for(let b=1;b<a.length;b++)this.layoutVertexArray.emplaceBack(a[b].x,a[b].y),this.indexArray2.emplaceBack(f+b-1,f+b),c.push(a[b].x),c.push(a[b].y);k.vertexLength+=a.length,k.primitiveLength+=a.length}let d=gB(c,l);for(let e=0;e<d.length;e+=3)this.indexArray.emplaceBack(j+d[e],j+d[e+1],j+d[e+2]);i.vertexLength+=h,i.primitiveLength+=d.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,m,o,q,p)}}c("FillBucket",aK,{omit:["layers","patternFeatures"]});let cK=new l({"fill-sort-key":new f(b.layout_fill["fill-sort-key"])});var gK={paint:new l({"fill-antialias":new e(b.paint_fill["fill-antialias"]),"fill-opacity":new f(b.paint_fill["fill-opacity"]),"fill-color":new f(b.paint_fill["fill-color"]),"fill-outline-color":new f(b.paint_fill["fill-outline-color"]),"fill-translate":new e(b.paint_fill["fill-translate"]),"fill-translate-anchor":new e(b.paint_fill["fill-translate-anchor"]),"fill-pattern":new B(b.paint_fill["fill-pattern"])}),layout:cK};let cL=k([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:gL}=cL;var q={},gM=J,aL=F;function F(a,b,c,d,e){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=e,a.readFields(gN,this,b)}function gN(a,b,c){1==a?b.id=c.readVarint():2==a?function(a,b){for(var c=a.readVarint()+a.pos;a.pos<c;){var d=b._keys[a.readVarint()],e=b._values[a.readVarint()];b.properties[d]=e}}(c,b):3==a?b.type=c.readVarint():4==a&&(b._geometry=c.pos)}function gO(a){for(var c,d,e=0,b=0,f=a.length,g=f-1;b<f;g=b++)e+=((d=a[g]).x-(c=a[b]).x)*(c.y+d.y);return e}F.types=["Unknown","Point","LineString","Polygon"],F.prototype.loadGeometry=function(){var b=this._pbf;b.pos=this._geometry;for(var a,i=b.readVarint()+b.pos,c=1,d=0,f=0,g=0,e=[];b.pos<i;){if(d<=0){var h=b.readVarint();c=7&h,d=h>>3}if(d--,1===c||2===c)f+=b.readSVarint(),g+=b.readSVarint(),1===c&&(a&&e.push(a),a=[]),a.push(new gM(f,g));else{if(7!==c)throw Error("unknown command "+c);a&&a.push(a[0].clone())}}return a&&e.push(a),e},F.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var k=a.readVarint()+a.pos,b=1,e=0,c=0,d=0,f=1/0,g=-1/0,h=1/0,i=-1/0;a.pos<k;){if(e<=0){var j=a.readVarint();b=7&j,e=j>>3}if(e--,1===b||2===b)(c+=a.readSVarint())<f&&(f=c),c>g&&(g=c),(d+=a.readSVarint())<h&&(h=d),d>i&&(i=d);else if(7!==b)throw Error("unknown command "+b)}return[f,h,g,i]},F.prototype.toGeoJSON=function(h,i,j){var a,c,k=this.extent*Math.pow(2,j),l=this.extent*h,m=this.extent*i,b=this.loadGeometry(),d=F.types[this.type];function e(b){for(var a=0;a<b.length;a++){var c=b[a];b[a]=[360*(c.x+l)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(c.y+m)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(a=0;a<b.length;a++)f[a]=b[a][0];e(b=f);break;case 2:for(a=0;a<b.length;a++)e(b[a]);break;case 3:for(b=function(b){var g=b.length;if(g<=1)return[b];for(var a,d,e=[],c=0;c<g;c++){var f=gO(b[c]);0!==f&&(void 0===d&&(d=f<0),d===f<0?(a&&e.push(a),a=[b[c]]):a.push(b[c]))}return a&&e.push(a),e}(b),a=0;a<b.length;a++)for(c=0;c<b[a].length;c++)e(b[a][c])}1===b.length?b=b[0]:d="Multi"+d;var g={type:"Feature",geometry:{type:d,coordinates:b},properties:this.properties};return"id"in this&&(g.id=this.id),g};var gP=aL,aM=cM;function cM(a,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(gQ,this,b),this.length=this._features.length}function gQ(a,b,c){15===a?b.version=c.readVarint():1===a?b.name=c.readString():5===a?b.extent=c.readVarint():2===a?b._features.push(c.pos):3===a?b._keys.push(c.readString()):4===a&&b._values.push(function(a){for(var c=null,d=a.readVarint()+a.pos;a.pos<d;){var b=a.readVarint()>>3;c=1===b?a.readString():2===b?a.readFloat():3===b?a.readDouble():4===b?a.readVarint64():5===b?a.readVarint():6===b?a.readSVarint():7===b?a.readBoolean():null}return c}(c))}cM.prototype.feature=function(a){if(a<0||a>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[a];var b=this._pbf.readVarint()+this._pbf.pos;return new gP(this._pbf,b,this.extent,this._keys,this._values)};var gR=aM;function gS(c,d,a){if(3===c){var b=new gR(a,a.readVarint()+a.pos);b.length&&(d[b.name]=b)}}q.VectorTile=function(a,b){this.layers=a.readFields(gS,{},b)},q.VectorTileFeature=aL,q.VectorTileLayer=aM;let gT=q.VectorTileFeature.types;function gU(a,b,c,d,e,f,g,h){a.emplaceBack(b,c,2*Math.floor(8192*d)+g,16384*e,16384*f,Math.round(h))}class aN{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(a=>a.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new class extends as{},this.indexArray=new co,this.programConfigurations=new cB(a.layers,a.zoom),this.segments=new $,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,c,e){for(let{feature:a,id:j,index:d,sourceLayerIndex:f}of(this.features=[],this.hasPattern=gI("fill-extrusion",this.layers,c),i)){let g=this.layers[0]._featureFilter.needGeometry,h=cC(a,g);if(!this.layers[0]._featureFilter.filter(new cd(this.zoom),h,e))continue;let b={id:j,sourceLayerIndex:f,index:d,geometry:g?h.geometry:fR(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(gJ("fill-extrusion",this.layers,b,this.zoom,c)):this.addFeature(b,b.geometry,d,e,{}),c.featureIndex.insert(a,b.geometry,d,f,this.index,!0)}}addFeatures(e,b,c){for(let a of this.features){let{geometry:d}=a;this.addFeature(a,d,a.index,b,c)}}update(a,b,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,b,this.stateDependentLayers,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,gL),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,u,v,w,x){for(let k of gG(u,500)){let l=0;for(let y of k)l+=y.length;let a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let g of k){if(0===g.length||gW(g))continue;let c=0;for(let h=0;h<g.length;h++){let d=g[h];if(h>=1){let e=g[h-1];if(!gV(d,e)){a.vertexLength+4>$.MAX_VERTEX_ARRAY_LENGTH&&(a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let b=d.sub(e)._perp()._unit(),s=e.dist(d);c+s>32768&&(c=0),gU(this.layoutVertexArray,d.x,d.y,b.x,b.y,0,0,c),gU(this.layoutVertexArray,d.x,d.y,b.x,b.y,0,1,c),c+=s,gU(this.layoutVertexArray,e.x,e.y,b.x,b.y,0,0,c),gU(this.layoutVertexArray,e.x,e.y,b.x,b.y,0,1,c);let f=a.vertexLength;this.indexArray.emplaceBack(f,f+2,f+1),this.indexArray.emplaceBack(f+1,f+2,f+3),a.vertexLength+=4,a.primitiveLength+=2}}}}if(a.vertexLength+l>$.MAX_VERTEX_ARRAY_LENGTH&&(a=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),"Polygon"!==gT[r.type])continue;let m=[],t=[],p=a.vertexLength;for(let n of k)if(0!==n.length){n!==k[0]&&t.push(m.length/2);for(let q=0;q<n.length;q++){let o=n[q];gU(this.layoutVertexArray,o.x,o.y,0,0,1,1,0),m.push(o.x),m.push(o.y)}}let i=gB(m,t);for(let j=0;j<i.length;j+=3)this.indexArray.emplaceBack(p+i[j],p+i[j+2],p+i[j+1]);a.primitiveLength+=i.length/3,a.vertexLength+=l}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,v,x,w)}}function gV(a,b){return a.x===b.x&&(a.x<0||a.x>8192)||a.y===b.y&&(a.y<0||a.y>8192)}function gW(a){return a.every(a=>a.x<0)||a.every(a=>a.x>8192)||a.every(a=>a.y<0)||a.every(a=>a.y>8192)}c("FillExtrusionBucket",aN,{omit:["layers","features"]});var gX={paint:new l({"fill-extrusion-opacity":new e(b["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new f(b["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new e(b["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new e(b["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new B(b["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new f(b["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new f(b["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new e(b["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function gY(a,b){return a.x*b.x+a.y*b.y}function gZ(i,a){if(1===i.length){let b=0,c=a[b++],d;for(;!d||c.equals(d);)if(!(d=a[b++]))return 1/0;for(;b<a.length;b++){let j=a[b],t=i[0],e=d.sub(c),f=j.sub(c),k=t.sub(c),l=gY(e,e),g=gY(e,f),m=gY(f,f),n=gY(k,e),o=gY(k,f),p=l*m-g*g,q=(m*n-g*o)/p,r=(l*o-g*n)/p,s=c.z*(1-q-r)+d.z*q+j.z*r;if(isFinite(s))return s}return 1/0}{let h=1/0;for(let u of a)h=Math.min(h,u.z);return h}}let cN=k([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:g$}=cN,cO=k([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:g_}=cO,g0=q.VectorTileFeature.types,g1=Math.cos(Math.PI/180*37.5);class aO{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(a=>a.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new class extends at{},this.layoutVertexArray2=new class extends au{},this.indexArray=new co,this.programConfigurations=new cB(a.layers,a.zoom),this.segments=new $,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(h,b,c){this.hasPattern=gI("line",this.layers,b);let i=this.layers[0].layout.get("line-sort-key"),j=!i.isConstant(),d=[];for(let{feature:a,id:m,index:n,sourceLayerIndex:o}of h){let k=this.layers[0]._featureFilter.needGeometry,e=cC(a,k);if(!this.layers[0]._featureFilter.filter(new cd(this.zoom),e,c))continue;let p=j?i.evaluate(e,{},c):void 0,q={id:m,properties:a.properties,type:a.type,sourceLayerIndex:o,index:n,geometry:k?e.geometry:fR(a),patterns:{},sortKey:p};d.push(q)}for(let f of(j&&d.sort((a,b)=>a.sortKey-b.sortKey),d)){let{geometry:l,index:g,sourceLayerIndex:r}=f;if(this.hasPattern){let s=gJ("line",this.layers,f,this.zoom,b);this.patternFeatures.push(s)}else this.addFeature(f,l,g,c,{});b.featureIndex.insert(h[g].feature,l,g,r,this.index)}}update(a,b,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,b,this.stateDependentLayers,c)}addFeatures(d,b,c){for(let a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,b,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,g_)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,g$),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,c,d,e,f){let b=this.layers[0].layout,g=b.get("line-join").evaluate(a,{}),h=b.get("line-cap"),i=b.get("line-miter-limit"),j=b.get("line-round-limit");for(let k of(this.lineClips=this.lineFeatureClips(a),c))this.addLine(k,a,g,h,i,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,f,e)}addLine(e,K,z,L,u,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let r="Polygon"===g0[K.type],i=e.length;for(;i>=2&&e[i-1].equals(e[i-2]);)i--;let l=0;for(;l<i-1&&e[l].equals(e[l+1]);)l++;if(i<(r?3:2))return;"bevel"===z&&(u=1.05);let s=this.overscaling<=16?122880/(512*this.overscaling):0,f=this.segments.prepareSegment(10*i,this.layoutVertexArray,this.indexArray),a,h,j,c,b;this.e1=this.e2=-1,r&&(a=e[i-2],b=e[l].sub(a)._unit()._perp());for(let m=l;m<i;m++){if((j=m===i-1?r?e[l+1]:void 0:e[m+1])&&e[m].equals(j))continue;b&&(c=b),a&&(h=a),a=e[m],b=j?j.sub(a)._unit()._perp():c;let g=(c=c||b).add(b);0===g.x&&0===g.y||g._unit();let o=c.x*b.x+c.y*b.y,t=g.x*b.x+g.y*b.y,k=0!==t?1/t:1/0,N=2*Math.sqrt(2-2*t),A=t<g1&&h&&j,p=c.x*b.y-c.y*b.x>0;if(A&&m>l){let B=a.dist(h);if(B>2*s){let v=a.sub(a.sub(h)._mult(s/B)._round());this.updateDistance(h,v),this.addCurrentVertex(v,c,0,0,f),h=v}}let C=h&&j,d=C?z:r?"butt":L;if(C&&"round"===d&&(k<M?d="miter":k<=2&&(d="fakeround")),"miter"===d&&k>u&&(d="bevel"),"bevel"===d&&(k>2&&(d="flipbevel"),k<u&&(d="miter")),h&&this.updateDistance(h,a),"miter"===d)g._mult(k),this.addCurrentVertex(a,g,0,0,f);else if("flipbevel"===d){if(k>100)g=b.mult(-1);else{let O=k*c.add(b).mag()/c.sub(b).mag();g._perp()._mult(O*(p?-1:1))}this.addCurrentVertex(a,g,0,0,f),this.addCurrentVertex(a,g.mult(-1),0,0,f)}else if("bevel"===d||"fakeround"===d){let D=-Math.sqrt(k*k-1),E=p?D:0,F=p?0:D;if(h&&this.addCurrentVertex(a,c,E,F,f),"fakeround"===d){let G=Math.round(180*N/Math.PI/20);for(let w=1;w<G;w++){let n=w/G;if(.5!==n){let x=n-.5;n+=n*x*(n-1)*((1.0904+o*(o*(3.55645-1.43519*o)-3.2452))*x*x+(.848013+o*(.215638*o-1.06021)))}let H=b.sub(c)._mult(n)._add(c)._unit()._mult(p?-1:1);this.addHalfVertex(a,H.x,H.y,!1,p,0,f)}}j&&this.addCurrentVertex(a,b,-E,-F,f)}else if("butt"===d)this.addCurrentVertex(a,g,0,0,f);else if("square"===d){let I=h?1:-1;this.addCurrentVertex(a,g,I,I,f)}else"round"===d&&(h&&(this.addCurrentVertex(a,c,0,0,f),this.addCurrentVertex(a,c,1,1,f,!0)),j&&(this.addCurrentVertex(a,b,-1,-1,f,!0),this.addCurrentVertex(a,b,0,0,f)));if(A&&m<i-1){let J=a.dist(j);if(J>2*s){let y=a.add(j.sub(a)._mult(s/J)._round());this.updateDistance(a,y),this.addCurrentVertex(y,b,0,0,f),a=y}}}}addCurrentVertex(d,a,b,c,e,f=!1){let g=a.y*c-a.x,h=-a.y-a.x*c;this.addHalfVertex(d,a.x+a.y*b,a.y-a.x*b,f,!1,b,e),this.addHalfVertex(d,g,h,f,!0,-c,e),this.distance>16384&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(d,a,b,c,e,f))}addHalfVertex({x:f,y:g},h,i,j,b,c,d){let e=.5*(this.lineClips?32767*this.scaledDistance:this.scaledDistance);this.layoutVertexArray.emplaceBack((f<<1)+(j?1:0),(g<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*i)+128,1+(0===c?0:c<0?-1:1)|(63&e)<<2,e>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let a=d.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,a),d.primitiveLength++),b?this.e2=a:this.e1=a}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,b){this.distance+=a.dist(b),this.updateScaledDistance()}}c("LineBucket",aO,{omit:["layers","patternFeatures"]});let cP=new l({"line-cap":new e(b.layout_line["line-cap"]),"line-join":new f(b.layout_line["line-join"]),"line-miter-limit":new e(b.layout_line["line-miter-limit"]),"line-round-limit":new e(b.layout_line["line-round-limit"]),"line-sort-key":new f(b.layout_line["line-sort-key"])});var cQ={paint:new l({"line-opacity":new f(b.paint_line["line-opacity"]),"line-color":new f(b.paint_line["line-color"]),"line-translate":new e(b.paint_line["line-translate"]),"line-translate-anchor":new e(b.paint_line["line-translate-anchor"]),"line-width":new f(b.paint_line["line-width"]),"line-gap-width":new f(b.paint_line["line-gap-width"]),"line-offset":new f(b.paint_line["line-offset"]),"line-blur":new f(b.paint_line["line-blur"]),"line-dasharray":new O(b.paint_line["line-dasharray"]),"line-pattern":new B(b.paint_line["line-pattern"]),"line-gradient":new P(b.paint_line["line-gradient"])}),layout:cP};let cR=new class extends f{possiblyEvaluate(b,a){return a=new cd(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(b,a)}evaluate(b,a,c,d){return a=a$({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(b,a,c,d)}}(cQ.paint.properties["line-width"].specification);function g2(a,b){return b>0?b+2*a:a}cR.useIntegerZoom=!0;let g3=k([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),g4=k([{name:"a_projected_pos",components:3,type:"Float32"}],4);k([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let g5=k([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);k([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let g6=k([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cS=k([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function g7(a,b,c){return a.sections.forEach(a=>{a.text=function(a,c,d){let b=c.layout.get("text-transform").evaluate(d,{});return"uppercase"===b?a=a.toLocaleUpperCase():"lowercase"===b&&(a=a.toLocaleLowerCase()),cc.applyArabicShaping&&(a=cc.applyArabicShaping(a)),a}(a.text,b,c)}),a}k([{name:"triangle",components:3,type:"Uint16"}]),k([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),k([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),k([{type:"Float32",name:"offsetX"}]),k([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);let g8={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xa2":"\uFFE0","\xa3":"\uFFE1","\xa5":"\uFFE5","\xa6":"\uFFE4","\xac":"\uFFE2","\xaf":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var cT=24,cU=x,g9=function(g,h,j,e,k){var a,c,l=8*k-e-1,m=(1<<l)-1,n=m>>1,b=-7,d=j?k-1:0,i=j?-1:1,f=g[h+d];for(d+=i,a=f&(1<< -b)-1,f>>=-b,b+=l;b>0;a=256*a+g[h+d],d+=i,b-=8);for(c=a&(1<< -b)-1,a>>=-b,b+=e;b>0;c=256*c+g[h+d],d+=i,b-=8);if(0===a)a=1-n;else{if(a===m)return c?NaN:1/0*(f?-1:1);c+=Math.pow(2,e),a-=n}return(f?-1:1)*c*Math.pow(2,a-e)},ha=function(j,b,k,m,c,n){var a,d,e,h=8*n-c-1,i=(1<<h)-1,f=i>>1,o=23===c?5960464477539062e-23:0,g=m?0:n-1,l=m?1:-1,p=b<0||0===b&&1/b<0?1:0;for(isNaN(b=Math.abs(b))||b===1/0?(d=isNaN(b)?1:0,a=i):(a=Math.floor(Math.log(b)/Math.LN2),b*(e=Math.pow(2,-a))<1&&(a--,e*=2),(b+=a+f>=1?o/e:o*Math.pow(2,1-f))*e>=2&&(a++,e/=2),a+f>=i?(d=0,a=i):a+f>=1?(d=(b*e-1)*Math.pow(2,c),a+=f):(d=b*Math.pow(2,f-1)*Math.pow(2,c),a=0));c>=8;j[k+g]=255&d,g+=l,d/=256,c-=8);for(a=a<<c|d,h+=c;h>0;j[k+g]=255&a,g+=l,a/=256,h-=8);j[k+g-l]|=128*p};function x(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}x.Varint=0,x.Fixed64=1,x.Bytes=2,x.Fixed32=5;var hb,n,hc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function hd(a){return a.type===x.Bytes?a.readVarint()+a.pos:a.pos+1}function he(e,a,b){var d=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));b.realloc(d);for(var c=b.pos-1;c>=e;c--)b.buf[c+d]=b.buf[c]}function hf(b,c){for(var a=0;a<b.length;a++)c.writeVarint(b[a])}function hg(b,c){for(var a=0;a<b.length;a++)c.writeSVarint(b[a])}function hh(b,c){for(var a=0;a<b.length;a++)c.writeFloat(b[a])}function hi(b,c){for(var a=0;a<b.length;a++)c.writeDouble(b[a])}function hj(b,c){for(var a=0;a<b.length;a++)c.writeBoolean(b[a])}function hk(b,c){for(var a=0;a<b.length;a++)c.writeFixed32(b[a])}function hl(b,c){for(var a=0;a<b.length;a++)c.writeSFixed32(b[a])}function hm(b,c){for(var a=0;a<b.length;a++)c.writeFixed64(b[a])}function hn(b,c){for(var a=0;a<b.length;a++)c.writeSFixed64(b[a])}function ho(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16)+16777216*a[b+3]}function hp(a,b,c){a[c]=b,a[c+1]=b>>>8,a[c+2]=b>>>16,a[c+3]=b>>>24}function hq(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16)+(a[b+3]<<24)}function hr(a,b,c){1===a&&c.readMessage(hs,b)}function hs(c,d,e){if(3===c){let{id:f,bitmap:g,width:a,height:b,left:h,top:i,advance:j}=e.readMessage(ht,{});d.push({id:f,bitmap:new aI({width:a+6,height:b+6},g),metrics:{width:a,height:b,left:h,top:i,advance:j}})}}function ht(a,b,c){1===a?b.id=c.readVarint():2===a?b.bitmap=c.readBytes():3===a?b.width=c.readVarint():4===a?b.height=c.readVarint():5===a?b.left=c.readSVarint():6===a?b.top=c.readSVarint():7===a&&(b.advance=c.readVarint())}function cV(g){let h=0,i=0;for(let j of g)h+=j.w*j.h,i=Math.max(i,j.w);g.sort((a,b)=>b.h-a.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(h/.95)),i),h:1/0}],e=0,f=0;for(let a of g)for(let d=c.length-1;d>=0;d--){let b=c[d];if(!(a.w>b.w||a.h>b.h)){if(a.x=b.x,a.y=b.y,f=Math.max(f,a.y+a.h),e=Math.max(e,a.x+a.w),a.w===b.w&&a.h===b.h){let k=c.pop();d<c.length&&(c[d]=k)}else a.h===b.h?(b.x+=a.w,b.w-=a.w):a.w===b.w?(b.y+=a.h,b.h-=a.h):(c.push({x:b.x+a.w,y:b.y,w:b.w-a.w,h:a.h}),b.y+=a.h,b.h-=a.h);break}}return{w:e,h:f,fill:h/(e*f)||0}}x.prototype={destroy:function(){this.buf=null},readFields:function(d,c,a){for(a=a||this.length;this.pos<a;){var b=this.readVarint(),e=b>>3,f=this.pos;this.type=7&b,d(e,c,this),this.pos===f&&this.skip(b)}return c},readMessage:function(a,b){return this.readFields(a,b,this.readVarint()+this.pos)},readFixed32:function(){var a=ho(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=hq(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=ho(this.buf,this.pos)+4294967296*ho(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=ho(this.buf,this.pos)+4294967296*hq(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=g9(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=g9(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(d){var a,b,c=this.buf;return a=127&(b=c[this.pos++]),b<128?a:(a|=(127&(b=c[this.pos++]))<<7,b<128?a:(a|=(127&(b=c[this.pos++]))<<14,b<128?a:(a|=(127&(b=c[this.pos++]))<<21,b<128?a:function(h,i,b){var e,f,g,c,a,d=b.buf;if(c=(112&(a=d[b.pos++]))>>4,a<128||(c|=(127&(a=d[b.pos++]))<<3,a<128)||(c|=(127&(a=d[b.pos++]))<<10,a<128)||(c|=(127&(a=d[b.pos++]))<<17,a<128)||(c|=(127&(a=d[b.pos++]))<<24,a<128)||(c|=(1&(a=d[b.pos++]))<<31,a<128)){return e=h,f=c,g=i,g?4294967296*f+(e>>>0):4294967296*(f>>>0)+(e>>>0)}throw Error("Expected varint not more than 10 bytes")}(a|=(15&(b=c[this.pos]))<<28,d,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?-((a+1)/2):a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var c,d,e,a=this.readVarint()+this.pos,b=this.pos;return this.pos=a,a-b>=12&&hc?(c=this.buf,d=b,e=a,hc.decode(c.subarray(d,e))):function(d,k,j){for(var h="",b=k;b<j;){var f,g,i,c=d[b],a=null,e=c>239?4:c>223?3:c>191?2:1;if(b+e>j)break;1===e?c<128&&(a=c):2===e?128==(192&(f=d[b+1]))&&(a=(31&c)<<6|63&f)<=127&&(a=null):3===e?(g=d[b+2],128==(192&(f=d[b+1]))&&128==(192&g)&&((a=(15&c)<<12|(63&f)<<6|63&g)<=2047||a>=55296&&a<=57343)&&(a=null)):4===e&&(g=d[b+2],i=d[b+3],128==(192&(f=d[b+1]))&&128==(192&g)&&128==(192&i)&&((a=(15&c)<<18|(63&f)<<12|(63&g)<<6|63&i)<=65535||a>=1114112)&&(a=null)),null===a?(a=65533,e=1):a>65535&&(a-=65536,h+=String.fromCharCode(a>>>10&1023|55296),a=56320|1023&a),h+=String.fromCharCode(a),b+=e}return h}(this.buf,b,a)},readBytes:function(){var a=this.readVarint()+this.pos,b=this.buf.subarray(this.pos,a);return this.pos=a,b},readPackedVarint:function(a,b){if(this.type!==x.Bytes)return a.push(this.readVarint(b));var c=hd(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(b));return a},readPackedSVarint:function(a){if(this.type!==x.Bytes)return a.push(this.readSVarint());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==x.Bytes)return a.push(this.readBoolean());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==x.Bytes)return a.push(this.readFloat());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==x.Bytes)return a.push(this.readDouble());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==x.Bytes)return a.push(this.readFixed32());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==x.Bytes)return a.push(this.readSFixed32());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==x.Bytes)return a.push(this.readFixed64());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==x.Bytes)return a.push(this.readSFixed64());var b=hd(this);for(a=a||[];this.pos<b;)a.push(this.readSFixed64());return a},skip:function(b){var a=7&b;if(a===x.Varint)for(;this.buf[this.pos++]>127;);else if(a===x.Bytes)this.pos=this.readVarint()+this.pos;else if(a===x.Fixed32)this.pos+=4;else{if(a!==x.Fixed64)throw Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(a,b){this.writeVarint(a<<3|b)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var b=new Uint8Array(a);b.set(this.buf),this.buf=b,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),hp(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),hp(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),hp(this.buf,-1&a,this.pos),hp(this.buf,Math.floor(23283064365386963e-26*a),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),hp(this.buf,-1&a,this.pos),hp(this.buf,Math.floor(23283064365386963e-26*a),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(e,h){var f,g,d,j,c,a,b,i;if(e>=0?(f=e%4294967296|0,g=e/4294967296|0):(g=~(-e/4294967296),4294967295^(f=~(-e%4294967296))?f=f+1|0:(f=0,g=g+1|0)),e>=18446744073709552e3||e< -18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");h.realloc(10),d=f,(c=h).buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,d>>>=7,c.buf[c.pos++]=127&d|128,c.buf[c.pos]=127&(d>>>=7),a=g,b=h,i=(7&a)<<4,b.buf[b.pos++]|=i|((a>>>=3)?128:0),a&&(b.buf[b.pos++]=127&a|((a>>>=7)?128:0),a&&(b.buf[b.pos++]=127&a|((a>>>=7)?128:0),a&&(b.buf[b.pos++]=127&a|((a>>>=7)?128:0),a&&(b.buf[b.pos++]=127&a|((a>>>=7)?128:0),a&&(b.buf[b.pos++]=127&a)))))}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?-(2*a)-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var c=this.pos;this.pos=function(c,f,b){for(var a,d,e=0;e<f.length;e++){if((a=f.charCodeAt(e))>55295&&a<57344){if(!d){a>56319||e+1===f.length?(c[b++]=239,c[b++]=191,c[b++]=189):d=a;continue}if(a<56320){c[b++]=239,c[b++]=191,c[b++]=189,d=a;continue}a=d-55296<<10|a-56320|65536,d=null}else d&&(c[b++]=239,c[b++]=191,c[b++]=189,d=null);a<128?c[b++]=a:(a<2048?c[b++]=a>>6|192:(a<65536?c[b++]=a>>12|224:(c[b++]=a>>18|240,c[b++]=a>>12&63|128),c[b++]=a>>6&63|128),c[b++]=63&a|128)}return b}(this.buf,a,this.pos);var b=this.pos-c;b>=128&&he(c,b,this),this.pos=c-1,this.writeVarint(b),this.pos+=b},writeFloat:function(a){this.realloc(4),ha(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),ha(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var b=0;b<a;b++)this.buf[this.pos++]=c[b]},writeRawMessage:function(c,d){this.pos++;var b=this.pos;c(d,this);var a=this.pos-b;a>=128&&he(b,a,this),this.pos=b-1,this.writeVarint(a),this.pos+=a},writeMessage:function(a,b,c){this.writeTag(a,x.Bytes),this.writeRawMessage(b,c)},writePackedVarint:function(b,a){a.length&&this.writeMessage(b,hf,a)},writePackedSVarint:function(b,a){a.length&&this.writeMessage(b,hg,a)},writePackedBoolean:function(b,a){a.length&&this.writeMessage(b,hj,a)},writePackedFloat:function(b,a){a.length&&this.writeMessage(b,hh,a)},writePackedDouble:function(b,a){a.length&&this.writeMessage(b,hi,a)},writePackedFixed32:function(b,a){a.length&&this.writeMessage(b,hk,a)},writePackedSFixed32:function(b,a){a.length&&this.writeMessage(b,hl,a)},writePackedFixed64:function(b,a){a.length&&this.writeMessage(b,hm,a)},writePackedSFixed64:function(b,a){a.length&&this.writeMessage(b,hn,a)},writeBytesField:function(a,b){this.writeTag(a,x.Bytes),this.writeBytes(b)},writeFixed32Field:function(a,b){this.writeTag(a,x.Fixed32),this.writeFixed32(b)},writeSFixed32Field:function(a,b){this.writeTag(a,x.Fixed32),this.writeSFixed32(b)},writeFixed64Field:function(a,b){this.writeTag(a,x.Fixed64),this.writeFixed64(b)},writeSFixed64Field:function(a,b){this.writeTag(a,x.Fixed64),this.writeSFixed64(b)},writeVarintField:function(a,b){this.writeTag(a,x.Varint),this.writeVarint(b)},writeSVarintField:function(a,b){this.writeTag(a,x.Varint),this.writeSVarint(b)},writeStringField:function(a,b){this.writeTag(a,x.Bytes),this.writeString(b)},writeFloatField:function(a,b){this.writeTag(a,x.Fixed32),this.writeFloat(b)},writeDoubleField:function(a,b){this.writeTag(a,x.Fixed64),this.writeDouble(b)},writeBooleanField:function(a,b){this.writeVarintField(a,Boolean(b))}};class aP{constructor(a,{pixelRatio:b,version:c,stretchX:d,stretchY:e,content:f}){this.paddedRect=a,this.pixelRatio=b,this.stretchX=d,this.stretchY=e,this.content=f,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class aQ{constructor(g,h){let i={},j={};this.haveRenderCallbacks=[];let k=[];this.addImages(g,i,k),this.addImages(h,j,k);let{w:q,h:r}=cV(k),b=new aJ({width:q||1,height:r||1});for(let l in g){let m=g[l],n=i[l].paddedRect;aJ.copy(m.data,b,{x:0,y:0},{x:n.x+1,y:n.y+1},m.data)}for(let o in h){let a=h[o],p=j[o].paddedRect,c=p.x+1,d=p.y+1,e=a.data.width,f=a.data.height;aJ.copy(a.data,b,{x:0,y:0},{x:c,y:d},a.data),aJ.copy(a.data,b,{x:0,y:f-1},{x:c,y:d-1},{width:e,height:1}),aJ.copy(a.data,b,{x:0,y:0},{x:c,y:d+f},{width:e,height:1}),aJ.copy(a.data,b,{x:e-1,y:0},{x:c-1,y:d},{width:1,height:f}),aJ.copy(a.data,b,{x:0,y:0},{x:c+e,y:d},{width:1,height:f})}this.image=b,this.iconPositions=i,this.patternPositions=j}addImages(c,e,f){for(let b in c){let a=c[b],d={x:0,y:0,w:a.data.width+2,h:a.data.height+2};f.push(d),e[b]=new aP(d,a),a.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,c){for(let b in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[b],a.getImage(b),c),this.patchUpdatedImage(this.patternPositions[b],a.getImage(b),c)}patchUpdatedImage(a,b,c){if(!a||!b||a.version===b.version)return;a.version=b.version;let[d,e]=a.tl;c.update(b.data,void 0,{x:d,y:e})}}c("ImagePosition",aP),c("ImageAtlas",aQ),a.WritingMode=void 0,(n=a.WritingMode||(a.WritingMode={}))[n.none=0]="none",n[n.horizontal=1]="horizontal",n[n.vertical=2]="vertical",n[n.horizontalOnly=3]="horizontalOnly";class hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(b,c){let a=new hu;return a.scale=b||1,a.fontStack=c,a}static forImage(b){let a=new hu;return a.imageName=b,a}}class hv{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(d,e){let a=new hv;for(let b=0;b<d.sections.length;b++){let c=d.sections[b];c.image?a.addImageSection(c):a.addTextSection(c,e)}return a}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(b){let c="";for(let a=0;a<b.length;a++){let d=b.charCodeAt(a+1)||null,e=b.charCodeAt(a-1)||null;c+=d&&fh(d)&&!g8[b[a+1]]||e&&fh(e)&&!g8[b[a-1]]||!g8[b[a]]?b[a]:g8[b[a]]}return c}(this.text)}trim(){let a=0;for(let c=0;c<this.text.length&&hx[this.text.charCodeAt(c)];c++)a++;let d=this.text.length;for(let b=this.text.length-1;b>=0&&b>=a&&hx[this.text.charCodeAt(b)];b--)d--;this.text=this.text.substring(a,d),this.sectionIndex=this.sectionIndex.slice(a,d)}substring(b,c){let a=new hv;return a.text=this.text.substring(b,c),a.sectionIndex=this.sectionIndex.slice(b,c),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,b)=>Math.max(a,this.sections[b].scale),0)}addTextSection(a,c){this.text+=a.text,this.sections.push(hu.forText(a.scale,a.fontStack||c));let d=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(d)}addImageSection(a){let b=a.image?a.image.name:"";if(0===b.length)return void a3("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(hu.forImage(b)),this.sectionIndex.push(this.sections.length-1)):a3("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hw(u,d,v,e,w,j,x,y,z,f,g,k,A,l,m,B){let b=hv.fromFeature(u,w),c;k===a.WritingMode.vertical&&b.verticalizePunctuation();let{processBidirectionalText:n,processStyledBidirectionalText:o}=cc;if(n&&1===b.sections.length){c=[];let C=n(b.toString(),hE(b,f,j,d,e,l,m));for(let p of C){let h=new hv;h.text=p,h.sections=b.sections;for(let q=0;q<p.length;q++)h.sectionIndex.push(0);c.push(h)}}else if(o){c=[];let D=o(b.text,b.sectionIndex,hE(b,f,j,d,e,l,m));for(let r of D){let i=new hv;i.text=r[0],i.sectionIndex=r[1],i.sections=b.sections,c.push(i)}}else c=function(b,f){let c=[],d=b.text,a=0;for(let e of f)c.push(b.substring(a,e)),a=e;return a<d.length&&c.push(b.substring(a,d.length)),c}(b,hE(b,f,j,d,e,l,m));let s=[],t={positionedLines:s,text:b.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(c,P,Q,R,C,t,S,D,T,u,E,U){var h;let i=0,j=-17,k=0,v=0,F="right"===D?1:"left"===D?0:.5,w=0;for(let d of C){d.trim();let l=d.getMaxScale(),G=(l-1)*cT,x={positionedGlyphs:[],lineOffset:0};c.positionedLines[w]=x;let m=x.positionedGlyphs,n=0;if(!d.length()){j+=t,++w;continue}for(let o=0;o<d.length();o++){let b=d.getSection(o),H=d.getSectionIndex(o),e=d.getCharCode(o),q=0,f=null,r=null,y=null,I=cT,p=!(T===a.WritingMode.horizontal|| !E&&!fg(e)||E&&(hx[e]||(h=e,b8.Arabic(h)||b8["Arabic Supplement"](h)||b8["Arabic Extended-A"](h)||b8["Arabic Presentation Forms-A"](h)||b8["Arabic Presentation Forms-B"](h))));if(b.imageName){let z=R[b.imageName];if(!z)continue;y=b.imageName,c.iconsInText=c.iconsInText||!0,r=z.paddedRect;let g=z.displaySize;b.scale=b.scale*cT/U,f={width:g[0],height:g[1],left:1,top:-3,advance:p?g[1]:g[0]},q=G+(cT-g[1]*b.scale),I=f.advance;let A=p?g[0]*b.scale-cT*l:g[1]*b.scale-cT*l;A>0&&A>n&&(n=A)}else{let J=Q[b.fontStack],s=J&&J[e];if(s&&s.rect)r=s.rect,f=s.metrics;else{let K=P[b.fontStack],L=K&&K[e];if(!L)continue;f=L.metrics}q=(l-b.scale)*cT}p?(c.verticalizable=!0,m.push({glyph:e,imageName:y,x:i,y:j+q,vertical:p,scale:b.scale,fontStack:b.fontStack,sectionIndex:H,metrics:f,rect:r}),i+=I*b.scale+u):(m.push({glyph:e,imageName:y,x:i,y:j+q,vertical:p,scale:b.scale,fontStack:b.fontStack,sectionIndex:H,metrics:f,rect:r}),i+=f.advance*b.scale+u)}0!==m.length&&(k=Math.max(i-u,k),hF(m,0,m.length-1,F,n)),i=0;let M=t*l+n;x.lineOffset=Math.max(n,G),j+=M,v=Math.max(M,v),++w}let B=j- -17,{horizontalAlign:N,verticalAlign:O}=cW(S);(function(e,f,g,a,h,i,b,j,k){let l=(f-g)*h,c=0;for(let m of(c=i!==b?-j*a- -17:(-a*k+.5)*b,e))for(let d of m.positionedGlyphs)d.x+=l,d.y+=c})(c.positionedLines,F,N,O,k,v,t,B,C.length),c.top+=-O*B,c.bottom=c.top+B,c.left+=-N*k,c.right=c.left+k}(t,d,v,e,c,x,y,z,k,f,A,B),!function(a){for(let b of a)if(0!==b.positionedGlyphs.length)return!1;return!0}(s)&&t}let hx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hz(f,a,g,h,b,i){if(a.imageName){let c=h[a.imageName];return c?c.displaySize[0]*a.scale*cT/i+b:0}{let d=g[a.fontStack],e=d&&d[f];return e?e.metrics.advance*a.scale+b:0}}function hA(b,c,d,e){let a=Math.pow(b-c,2);return e?b<c?a/2:2*a:a+Math.abs(d)*d}function hB(b,c,d){let a=0;return 10===b&&(a-=1e4),d&&(a+=150),40!==b&&65288!==b||(a+=50),41!==c&&65289!==c||(a+=50),a}function hC(i,a,d,j,e,f){let g=null,b=hA(a,d,e,f);for(let c of j){let h=hA(a-c.x,d,e,f)+c.badness;h<=b&&(g=c,b=h)}return{index:i,x:a,priorBreak:g,badness:b}}function hD(a){return a?hD(a.priorBreak).concat(a.index):[]}function hE(b,g,n,h,i,o,j){var a;if("point"!==o||!b)return[];let e=[],k=function(b,d,e,f,g,h){let c=0;for(let a=0;a<b.length();a++){let i=b.getSection(a);c+=hz(b.getCharCode(a),i,f,g,d,h)}return c/Math.max(1,Math.ceil(c/e))}(b,g,n,h,i,j),p=b.text.indexOf("\u200B")>=0,f=0;for(let c=0;c<b.length();c++){let l=b.getSection(c),d=b.getCharCode(c);if(hx[d]||(f+=hz(d,l,h,i,g,j)),c<b.length()-1){let m=!((a=d)<11904||!(b8["Bopomofo Extended"](a)||b8.Bopomofo(a)||b8["CJK Compatibility Forms"](a)||b8["CJK Compatibility Ideographs"](a)||b8["CJK Compatibility"](a)||b8["CJK Radicals Supplement"](a)||b8["CJK Strokes"](a)||b8["CJK Symbols and Punctuation"](a)||b8["CJK Unified Ideographs Extension A"](a)||b8["CJK Unified Ideographs"](a)||b8["Enclosed CJK Letters and Months"](a)||b8["Halfwidth and Fullwidth Forms"](a)||b8.Hiragana(a)||b8["Ideographic Description Characters"](a)||b8["Kangxi Radicals"](a)||b8["Katakana Phonetic Extensions"](a)||b8.Katakana(a)||b8["Vertical Forms"](a)||b8["Yi Radicals"](a)||b8["Yi Syllables"](a)));(hy[d]||m||l.imageName)&&e.push(hC(c+1,f,k,e,hB(d,b.getCharCode(c+1),m&&p),!1))}}return hD(hC(b.length(),f,k,e,0,!0))}function cW(c){let a=.5,b=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":b=1;break;case"top":case"top-right":case"top-left":b=0}return{horizontalAlign:a,verticalAlign:b}}function hF(a,g,c,d,e){if(!d&&!e)return;let f=a[c],h=(a[c].x+f.metrics.advance*f.scale)*d;for(let b=g;b<=c;b++)a[b].x-=h,a[b].y+=e}function hG(a,b,e){let{horizontalAlign:f,verticalAlign:g}=cW(e),c=b[0]-a.displaySize[0]*f,d=b[1]-a.displaySize[1]*g;return{image:a,top:d,bottom:d+a.displaySize[1],left:c,right:c+a.displaySize[0]}}function hH(r,c,d,e,b,f){let a=r.image,m;if(a.content){let g=a.content,h=a.pixelRatio||1;m=[g[0]/h,g[1]/h,a.displaySize[0]-g[2]/h,a.displaySize[1]-g[3]/h]}let n=c.left*f,o=c.right*f,i,j,k,l;"width"===d||"both"===d?(l=b[0]+n-e[3],j=b[0]+o+e[1]):j=(l=b[0]+(n+o-a.displaySize[0])/2)+a.displaySize[0];let p=c.top*f,q=c.bottom*f;return"height"===d||"both"===d?(i=b[1]+p-e[0],k=b[1]+q+e[2]):k=(i=b[1]+(p+q-a.displaySize[1])/2)+a.displaySize[1],{image:a,top:i,right:j,bottom:k,left:l,collisionPadding:m}}function hI(e,i){let{expression:a}=i;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new cd(e+1))};if("source"===a.kind)return{kind:"source"};{let{zoomStops:b,interpolationType:h}=a,c=0;for(;c<b.length&&b[c]<=e;)c++;let d=c=Math.max(0,c-1);for(;d<b.length&&b[d]<e+1;)d++;d=Math.min(b.length-1,d);let f=b[c],g=b[d];return"composite"===a.kind?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:h}:{kind:"camera",minZoom:f,maxZoom:g,minSize:a.evaluate(new cd(f)),maxSize:a.evaluate(new cd(g)),interpolationType:h}}}class cX extends J{constructor(b,c,d,a){super(b,c),this.angle=d,void 0!==a&&(this.segment=a)}clone(){return new cX(this.x,this.y,this.angle,this.segment)}}function hJ(b,e,j,l,m){if(void 0===e.segment)return!0;let k=e,a=e.segment+1,c=0;for(;c> -j/2;){if(--a<0)return!1;c-=b[a].dist(k),k=b[a]}c+=b[a].dist(b[a+1]),a++;let f=[],g=0;for(;c<j/2;){let h=b[a],i=b[a+1];if(!i)return!1;let d=b[a-1].angleTo(h)-h.angleTo(i);for(d=Math.abs((d+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:c,angleDelta:d}),g+=d;c-f[0].distance>l;)g-=f.shift().angleDelta;if(g>m)return!1;a++,c+=h.dist(i)}return!0}function hK(b){let c=0;for(let a=0;a<b.length-1;a++)c+=b[a].dist(b[a+1]);return c}function hL(a,b,c){return a?.6*b*c:0}function hM(a,b){return Math.max(a?a.right-a.left:0,b?b.right-b.left:0)}function hN(a,m,h,n,o,i){let j=hL(h,o,i),p=hM(h,n)*i,e=0,k=hK(a)/2;for(let b=0;b<a.length-1;b++){let c=a[b],d=a[b+1],f=c.dist(d);if(e+f>k){let l=(k-e)/f,q=ai(c.x,d.x,l),r=ai(c.y,d.y,l),g=new cX(q,r,d.angleTo(c),b);return g._round(),!j||hJ(a,g,p,j,m)?g:void 0}e+=f}}function hO(b,a,k,f,l,g,c,h,d){let m=hL(f,g,c),i=hM(f,l),e=i*c,j=0===b[0].x||b[0].x===d||0===b[0].y||b[0].y===d;return a-e<a/4&&(a=e+a/4),hP(b,j?a/2*h%a:(i/2+2*g)*c*h%a,a,m,k,e,j,!1,d)}function hP(a,t,d,i,p,j,q,u,k){let r=j/2,v=hK(a),e=0,b=t-d,f=[];for(let c=0;c<a.length-1;c++){let g=a[c],h=a[c+1],l=g.dist(h),w=h.angleTo(g);for(;b+d<e+l;){b+=d;let s=(b-e)/l,m=ai(g.x,h.x,s),n=ai(g.y,h.y,s);if(m>=0&&m<k&&n>=0&&n<k&&b-r>=0&&b+r<=v){let o=new cX(m,n,w,c);o._round(),i&&!hJ(a,o,j,i,p)||f.push(o)}}e+=l}return u||f.length||q||(f=hP(a,e/2,d,i,p,j,q,!0,k)),f}function cY(k,c,d,e,f){let l=[];for(let i=0;i<k.length;i++){let j=k[i],g;for(let h=0;h<j.length-1;h++){let a=j[h],b=j[h+1];a.x<c&&b.x<c||(a.x<c?a=new J(c,a.y+(c-a.x)/(b.x-a.x)*(b.y-a.y))._round():b.x<c&&(b=new J(c,a.y+(c-a.x)/(b.x-a.x)*(b.y-a.y))._round()),a.y<d&&b.y<d||(a.y<d?a=new J(a.x+(d-a.y)/(b.y-a.y)*(b.x-a.x),d)._round():b.y<d&&(b=new J(a.x+(d-a.y)/(b.y-a.y)*(b.x-a.x),d)._round()),a.x>=e&&b.x>=e||(a.x>=e?a=new J(e,a.y+(e-a.x)/(b.x-a.x)*(b.y-a.y))._round():b.x>=e&&(b=new J(e,a.y+(e-a.x)/(b.x-a.x)*(b.y-a.y))._round()),a.y>=f&&b.y>=f||(a.y>=f?a=new J(a.x+(f-a.y)/(b.y-a.y)*(b.x-a.x),f)._round():b.y>=f&&(b=new J(a.x+(f-a.y)/(b.y-a.y)*(b.x-a.x),f)._round()),g&&a.equals(g[g.length-1])||(g=[a],l.push(g)),g.push(b)))))}}return l}function hQ(c,D,E,o){let h=[],b=c.image,F=b.pixelRatio,i=b.paddedRect.w-2,j=b.paddedRect.h-2,G=c.right-c.left,H=c.bottom-c.top,d=b.stretchX||[[0,i]],e=b.stretchY||[[0,j]],p=(b,a)=>b+a[1]-a[0],k=d.reduce(p,0),l=e.reduce(p,0),q=i-k,r=j-l,s=0,t=k,u=0,v=l,x=0,y=q,z=0,A=r;if(b.content&&o){let a=b.content;s=hR(d,0,a[0]),u=hR(e,0,a[1]),t=hR(d,a[0],a[2]),v=hR(e,a[1],a[3]),x=a[0]-s,z=a[1]-u,y=a[2]-a[0]-t,A=a[3]-a[1]-v}let w=(a,d,e,f)=>{var i,j,m,n,o,p,q,r,w,B,C,I,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab;let ac=(i=a.stretch-s,j=t,m=G,n=c.left,i/j*m+n),ao=(o=a.fixed-x,p=y,q=a.stretch,r=k,o-p*q/r),ad=(w=d.stretch-u,B=v,C=H,I=c.top,w/B*C+I),ap=(K=d.fixed-z,L=A,M=d.stretch,N=l,K-L*M/N),ae=(O=e.stretch-s,P=t,Q=G,R=c.left,O/P*Q+R),aq=(S=e.fixed-x,T=y,U=e.stretch,V=k,S-T*U/V),af=(W=f.stretch-u,X=v,Y=H,Z=c.top,W/X*Y+Z),ar=($=f.fixed-z,_=A,aa=f.stretch,ab=l,$-_*aa/ab),ag=new J(ac,ad),ah=new J(ae,ad),ai=new J(ae,af),aj=new J(ac,af),as=new J(ao/F,ap/F),at=new J(aq/F,ar/F),h=D*Math.PI/180;if(h){let ak=Math.sin(h),al=Math.cos(h),g=[al,-ak,ak,al];ag._matMult(g),ah._matMult(g),aj._matMult(g),ai._matMult(g)}let am=a.stretch+a.fixed,an=d.stretch+d.fixed;return{tl:ag,tr:ah,bl:aj,br:ai,tex:{x:b.paddedRect.x+1+am,y:b.paddedRect.y+1+an,w:e.stretch+e.fixed-am,h:f.stretch+f.fixed-an},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:as,pixelOffsetBR:at,minFontScaleX:y/F/G,minFontScaleY:A/F/H,isSDF:E}};if(o&&(b.stretchX||b.stretchY)){let m=hS(d,q,k),n=hS(e,r,l);for(let f=0;f<m.length-1;f++){let B=m[f],C=m[f+1];for(let g=0;g<n.length-1;g++)h.push(w(B,n[g],C,n[g+1]))}}else h.push(w({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:i+1},{fixed:0,stretch:j+1}));return h}function hR(e,a,b){let c=0;for(let d of e)c+=Math.max(a,Math.min(b,d[1]))-Math.max(a,Math.min(b,d[0]));return c}function hS(d,e,f){let a=[{fixed:-1,stretch:0}];for(let[c,g]of d){let b=a[a.length-1];a.push({fixed:c-b.stretch,stretch:b.stretch}),a.push({fixed:c-b.stretch,stretch:b.stretch+(g-c)})}return a.push({fixed:e+1,stretch:f}),a}c("Anchor",cX);class hT{constructor(o,q,u,v,w,a,b,l,x,r){if(this.boxStartIndex=o.length,x){let s=a.top,t=a.bottom,p=a.collisionPadding;p&&(s-=p[1],t+=p[3]);let m=t-s;m>0&&(m=Math.max(10,m),this.circleDiameter=m)}else{let c=a.top*b-l,d=a.bottom*b+l,e=a.left*b-l,f=a.right*b+l,g=a.collisionPadding;if(g&&(e-=g[0]*b,c-=g[1]*b,f+=g[2]*b,d+=g[3]*b),r){let h=new J(e,c),i=new J(f,c),j=new J(e,d),k=new J(f,d),n=r*Math.PI/180;h._rotate(n),i._rotate(n),j._rotate(n),k._rotate(n),e=Math.min(h.x,i.x,j.x,k.x),f=Math.max(h.x,i.x,j.x,k.x),c=Math.min(h.y,i.y,j.y,k.y),d=Math.max(h.y,i.y,j.y,k.y)}o.emplaceBack(q.x,q.y,e,c,f,d,u,v,w)}this.boxEndIndex=o.length}}class hU{constructor(b=[],c=function(a,b){return a<b?-1:a>b?1:0}){if(this.data=b,this.length=this.data.length,this.compare=c,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let a=this.data[0],b=this.data.pop();return this.length--,this.length>0&&(this.data[0]=b,this._down(0)),a}peek(){return this.data[0]}_up(a){let{data:b,compare:f}=this,c=b[a];for(;a>0;){let d=a-1>>1,e=b[d];if(f(c,e)>=0)break;b[a]=e,a=d}b[a]=c}_down(a){let{data:b,compare:f}=this,h=this.length>>1,g=b[a];for(;a<h;){let c=1+(a<<1),d=b[c],e=c+1;if(e<this.length&&0>f(b[e],d)&&(c=e,d=b[e]),f(d,g)>=0)break;b[a]=d,a=c}b[a]=g}}function hV(e,r=1,p=!1){let h=1/0,i=1/0,j=-1/0,k=-1/0,q=e[0];for(let f=0;f<q.length;f++){let c=q[f];(!f||c.x<h)&&(h=c.x),(!f||c.y<i)&&(i=c.y),(!f||c.x>j)&&(j=c.x),(!f||c.y>k)&&(k=c.y)}let l=Math.min(j-h,k-i),a=l/2,d=new hU([],hW);if(0===l)return new J(h,i);for(let m=h;m<j;m+=l)for(let n=i;n<k;n+=l)d.push(new hX(m+a,n+a,a,e));let g=function(g){let c=0,h=0,i=0,d=g[0];for(let e=0,j=d.length,k=j-1;e<j;k=e++){let a=d[e],b=d[k],f=a.x*b.y-b.x*a.y;h+=(a.x+b.x)*f,i+=(a.y+b.y)*f,c+=3*f}return new hX(h/c,i/c,0,g)}(e),o=d.length;for(;d.length;){let b=d.pop();(b.d>g.d||!g.d)&&(g=b,p&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,o)),b.max-g.d<=r||(a=b.h/2,d.push(new hX(b.p.x-a,b.p.y-a,a,e)),d.push(new hX(b.p.x+a,b.p.y-a,a,e)),d.push(new hX(b.p.x-a,b.p.y+a,a,e)),d.push(new hX(b.p.x+a,b.p.y+a,a,e)),o+=4)}return p&&(console.log(`num probes: ${o}`),console.log(`best distance: ${g.d}`)),g.p}function hW(a,b){return b.max-a.max}function hX(a,b,c,d){this.p=new J(a,b),this.h=c,this.d=function(b,i){let d=!1,e=1/0;for(let f=0;f<i.length;f++){let g=i[f];for(let h=0,j=g.length,k=j-1;h<j;k=h++){let a=g[h],c=g[k];a.y>b.y!=c.y>b.y&&b.x<(c.x-a.x)*(b.y-a.y)/(c.y-a.y)+a.x&&(d=!d),e=Math.min(e,fZ(b,a,c))}}return(d?1:-1)*Math.sqrt(e)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}let hY=Number.POSITIVE_INFINITY;function cZ(b,a){return a[1]!==hY?function(e,a,b){let c=0,d=0;switch(a=Math.abs(a),b=Math.abs(b),e){case"top-right":case"top-left":case"top":d=b-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-b}switch(e){case"top-right":case"bottom-right":case"right":c=-a;break;case"top-left":case"bottom-left":case"left":c=a}return[c,d]}(b,a[0],a[1]):function(e,a){let b=0,c=0;a<0&&(a=0);let d=a/Math.sqrt(2);switch(e){case"top-right":case"top-left":c=d-7;break;case"bottom-right":case"bottom-left":c=7-d;break;case"bottom":c=7-a;break;case"top":c=a-7}switch(e){case"top-right":case"bottom-right":b=-d;break;case"top-left":case"bottom-left":b=d;break;case"left":b=a;break;case"right":b=-a}return[b,c]}(b,a[0])}function c$(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hZ(c,d,f,e,I,A,o,B,J,K,C){let i=A.textMaxSize.evaluate(d,{});void 0===i&&(i=o);let b=c.layers[0].layout,p=b.get("icon-offset").evaluate(d,{},C),g=h0(f.horizontal),j=o/24,L=c.tilePixelRatio*j,q=c.tilePixelRatio*i/24,M=c.tilePixelRatio*B,r=c.tilePixelRatio*b.get("symbol-spacing"),N=b.get("text-padding")*c.tilePixelRatio,O=b.get("icon-padding")*c.tilePixelRatio,s=b.get("text-max-angle")/180*Math.PI,P="viewport"!==b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement"),Q="map"===b.get("icon-rotation-alignment")&&"point"!==b.get("symbol-placement"),t=b.get("symbol-placement"),D=r/2,k=b.get("icon-text-fit"),E;e&&"none"!==k&&(c.allowVerticalPlacement&&f.vertical&&(E=hH(e,f.vertical,k,b.get("icon-text-fit-padding"),p,j)),g&&(e=hH(e,g,k,b.get("icon-text-fit-padding"),p,j)));let h=(g,b)=>{b.x<0||b.x>=8192||b.y<0||b.y>=8192||function(b,d,aa,i,y,H,r,f,s,o,t,u,z,I,p,J,K,L,M,N,c,v,O,g,ab){let k=b.addToLineVertexArray(d,aa),j,l,m,n,P=0,Q=0,R=0,S=0,A=-1,B=-1,h={},T=fI(""),C=0,D=0;if(void 0===f._unevaluatedLayout.getValue("text-radial-offset")?[C,D]=f.layout.get("text-offset").evaluate(c,{},g).map(a=>a*cT):(C=f.layout.get("text-radial-offset").evaluate(c,{},g)*cT,D=hY),b.allowVerticalPlacement&&i.vertical){let U=f.layout.get("text-rotate").evaluate(c,{},g)+90;m=new hT(s,d,o,t,u,i.vertical,z,I,p,U),r&&(n=new hT(s,d,o,t,u,r,K,L,p,U))}if(y){let E=f.layout.get("icon-rotate").evaluate(c,{}),V="none"!==f.layout.get("icon-text-fit"),W=hQ(y,E,O,V),F=r?hQ(r,E,O,V):void 0;l=new hT(s,d,o,t,u,y,K,L,!1,E),P=4*W.length;let X=b.iconSizeData,q=null;"source"===X.kind?(q=[128*f.layout.get("icon-size").evaluate(c,{})])[0]>h$&&a3(`${b.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===X.kind&&((q=[128*v.compositeIconSizes[0].evaluate(c,{},g),128*v.compositeIconSizes[1].evaluate(c,{},g)])[0]>h$||q[1]>h$)&&a3(`${b.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),b.addSymbols(b.icon,W,q,N,M,c,a.WritingMode.none,d,k.lineStartIndex,k.lineLength,-1,g),A=b.icon.placedSymbolArray.length-1,F&&(Q=4*F.length,b.addSymbols(b.icon,F,q,N,M,c,a.WritingMode.vertical,d,k.lineStartIndex,k.lineLength,-1,g),B=b.icon.placedSymbolArray.length-1)}let Y=Object.keys(i.horizontal);for(let Z of Y){let w=i.horizontal[Z];if(!j){T=fI(w.text);let ac=f.layout.get("text-rotate").evaluate(c,{},g);j=new hT(s,d,o,t,u,w,z,I,p,ac)}let $=1===w.positionedLines.length;if(R+=h_(b,d,w,H,f,p,c,J,k,i.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,$?Y:[Z],h,A,v,g),$)break}i.vertical&&(S+=h_(b,d,i.vertical,H,f,p,c,J,k,a.WritingMode.vertical,["vertical"],h,B,v,g));let ad=j?j.boxStartIndex:b.collisionBoxArray.length,ae=j?j.boxEndIndex:b.collisionBoxArray.length,af=m?m.boxStartIndex:b.collisionBoxArray.length,ag=m?m.boxEndIndex:b.collisionBoxArray.length,ah=l?l.boxStartIndex:b.collisionBoxArray.length,ai=l?l.boxEndIndex:b.collisionBoxArray.length,aj=n?n.boxStartIndex:b.collisionBoxArray.length,ak=n?n.boxEndIndex:b.collisionBoxArray.length,e=-1,x=(a,b)=>a&&a.circleDiameter?Math.max(a.circleDiameter,b):b;e=x(j,e),e=x(m,e),e=x(l,e),e=x(n,e);let _=e> -1?1:0;_&&(e*=ab/cT),b.glyphOffsetArray.length>=G.MAX_GLYPHS&&a3("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==c.sortKey&&b.addToSortKeyRanges(b.symbolInstances.length,c.sortKey),b.symbolInstances.emplaceBack(d.x,d.y,h.right>=0?h.right:-1,h.center>=0?h.center:-1,h.left>=0?h.left:-1,h.vertical|| -1,A,B,T,ad,ae,af,ag,ah,ai,aj,ak,o,R,S,P,Q,_,0,z,C,D,e)}(c,b,g,f,e,I,E,c.layers[0],c.collisionBoxArray,d.index,d.sourceLayerIndex,c.index,L,N,P,J,M,O,Q,p,d,A,K,C,o)};if("line"===t)for(let u of cY(d.geometry,0,0,8192,8192)){let F=hO(u,r,s,f.vertical||g,e,24,q,c.overscaling,8192);for(let v of F){let w=g;w&&h1(c,w.text,D,v)||h(u,v)}}else if("line-center"===t){for(let l of d.geometry)if(l.length>1){let x=hN(l,s,f.vertical||g,e,24,q);x&&h(l,x)}}else if("Polygon"===d.type)for(let y of gG(d.geometry,0)){let z=hV(y,16);h(y[0],new cX(z.x,z.y,0))}else if("LineString"===d.type)for(let m of d.geometry)h(m,new cX(m[0].x,m[0].y,0));else if("Point"===d.type)for(let H of d.geometry)for(let n of H)h([n],new cX(n.x,n.y,0))}let h$=32640;function h_(a,l,m,n,e,f,b,g,h,o,p,q,r,i,d){let j=function(R,j,u,I,k,K,L,v){let l=I.layout.get("text-rotate").evaluate(K,{})*Math.PI/180,w=[];for(let x of j.positionedLines)for(let a of x.positionedGlyphs){if(!a.rect)continue;let m=a.rect||{},n=4,y=!0,c=1,z=0,A=(k||v)&&a.vertical,b=a.metrics.advance*a.scale/2;if(v&&j.verticalizable){let M=(a.scale-1)*cT,N=(cT-a.metrics.width*a.scale)/2;z=x.lineOffset/2-(a.imageName?-N:M)}if(a.imageName){let B=L[a.imageName];y=B.sdf,c=B.pixelRatio,n=1/c}let O=k?[a.x+b,a.y]:[0,0],d=k?[0,0]:[a.x+b+u[0],a.y+u[1]-z],C=[0,0];A&&(C=d,d=[0,0]);let o=(a.metrics.left-n)*a.scale-b+d[0],p=(-a.metrics.top-n)*a.scale+d[1],D=o+m.w*a.scale/c,E=p+m.h*a.scale/c,q=new J(o,p),r=new J(D,p),s=new J(o,E),t=new J(D,E);if(A){let e=new J(-b,b- -17),f=-Math.PI/2,F=12-b,g=new J(22-F,-(a.imageName?F:0)),h=new J(...C);q._rotateAround(f,e)._add(g)._add(h),r._rotateAround(f,e)._add(g)._add(h),s._rotateAround(f,e)._add(g)._add(h),t._rotateAround(f,e)._add(g)._add(h)}if(l){let G=Math.sin(l),H=Math.cos(l),i=[H,-G,G,H];q._matMult(i),r._matMult(i),s._matMult(i),t._matMult(i)}let P=new J(0,0),Q=new J(0,0);w.push({tl:q,tr:r,bl:s,br:t,tex:m,writingMode:j.writingMode,glyphOffset:O,sectionIndex:a.sectionIndex,isSDF:y,pixelOffsetTL:P,pixelOffsetBR:Q,minFontScaleX:0,minFontScaleY:0})}return w}(0,m,g,e,f,b,n,a.allowVerticalPlacement),k=a.textSizeData,c=null;for(let s of("source"===k.kind?(c=[128*e.layout.get("text-size").evaluate(b,{})])[0]>h$&&a3(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===k.kind&&((c=[128*i.compositeTextSizes[0].evaluate(b,{},d),128*i.compositeTextSizes[1].evaluate(b,{},d)])[0]>h$||c[1]>h$)&&a3(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),a.addSymbols(a.text,j,c,g,f,b,o,l,h.lineStartIndex,h.lineLength,r,d),p))q[s]=a.text.placedSymbolArray.length-1;return 4*j.length}function h0(a){for(let b in a)return a[b];return null}function h1(f,a,g,d){let b=f.compareText;if(a in b){let e=b[a];for(let c=e.length-1;c>=0;c--)if(d.dist(e[c])<g)return!0}else b[a]=[];return b[a].push(d),!1}let h2=q.VectorTileFeature.types,h3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function h4(b,c,d,e,f,g,h,a,i,j,k,l,m){let n=a?Math.min(h$,Math.round(a[0])):0,o=a?Math.min(h$,Math.round(a[1])):0;b.emplaceBack(c,d,Math.round(32*e),Math.round(32*f),g,h,(n<<1)+(i?1:0),o,16*j,16*k,256*l,256*m)}function aR(b,a,c){b.emplaceBack(a.x,a.y,c),b.emplaceBack(a.x,a.y,c),b.emplaceBack(a.x,a.y,c),b.emplaceBack(a.x,a.y,c)}function h5(a){for(let b of a.sections)if(fk(b.text))return!0;return!1}class c_{constructor(a){this.layoutVertexArray=new class extends av{},this.indexArray=new co,this.programConfigurations=a,this.segments=new $,this.dynamicLayoutVertexArray=new class extends aw{},this.opacityVertexArray=new class extends ax{},this.placedSymbolArray=new ch}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(a,c,b,d){this.isEmpty()||(b&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,g3.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,g4.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,h3,!0),this.opacityVertexBuffer.itemSize=1),(b||d)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}c("SymbolBuffers",c_);class c0{constructor(a,b,c){this.layoutVertexArray=new a,this.layoutAttributes=b,this.indexArray=new c,this.segments=new $,this.collisionVertexArray=new class extends az{}}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,g5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}c("CollisionBuffers",c0);class G{constructor(b){this.collisionBoxArray=b.collisionBoxArray,this.zoom=b.zoom,this.overscaling=b.overscaling,this.layers=b.layers,this.layerIds=this.layers.map(a=>a.id),this.index=b.index,this.pixelRatio=b.pixelRatio,this.sourceLayerIndex=b.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cF([]),this.placementViewportMatrix=cF([]);let e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hI(this.zoom,e["text-size"]),this.iconSizeData=hI(this.zoom,e["icon-size"]);let c=this.layers[0].layout,f=c.get("symbol-sort-key"),d=c.get("symbol-z-order");this.canOverlap="never"!==c4(c,"text-overlap","text-allow-overlap")||"never"!==c4(c,"icon-overlap","icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==d&&!f.isConstant(),this.sortFeaturesByY=("viewport-y"===d||"auto"===d&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===c.get("symbol-placement")&&(this.writingModes=c.get("text-writing-mode").map(b=>a.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.sourceID=b.sourceID}createArrays(){this.text=new c_(new cB(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new c_(new cB(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new ck,this.lineVertexArray=new cl,this.symbolInstances=new cj}calculateGlyphDependencies(b,c,e,f,g){for(let a=0;a<b.length;a++)if(c[b.charCodeAt(a)]=!0,(e||f)&&g){let d=g8[b.charAt(a)];d&&(c[d.charCodeAt(0)]=!0)}}populate(w,k,f){let d=this.layers[0],c=d.layout,l=c.get("text-font"),h=c.get("text-field"),m=c.get("icon-image"),o=("constant"!==h.value.kind||h.value.value instanceof dV&&!h.value.value.isEmpty()||h.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),p="constant"!==m.value.kind||!!m.value.value||Object.keys(m.parameters).length>0,x=c.get("symbol-sort-key");if(this.features=[],!o&&!p)return;let q=k.iconDependencies,r=k.glyphDependencies,s=k.availableImages,y=new cd(this.zoom);for(let{feature:i,id:z,index:A,sourceLayerIndex:B}of w){let t=d._featureFilter.needGeometry,b=cC(i,t);if(!d._featureFilter.filter(y,b,f))continue;let e,g;if(t||(b.geometry=fR(i)),o){let C=d.getValueAndResolveTokens("text-field",b,f,s),u=dV.factory(C);h5(u)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===cb()||this.hasRTLText&&cc.isParsed())&&(e=g7(u,d,b))}if(p){let n=d.getValueAndResolveTokens("icon-image",b,f,s);g=n instanceof bp?n:bp.fromString(n)}if(!e&&!g)continue;let D=this.sortFeaturesByKey?x.evaluate(b,{},f):void 0;if(this.features.push({id:z,text:e,icon:g,index:A,sourceLayerIndex:B,geometry:b.geometry,properties:i.properties,type:h2[i.type],sortKey:D}),g&&(q[g.name]=!0),e){let E=l.evaluate(b,{},f).join(","),F="viewport"!==c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement");for(let j of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0,e.sections))if(j.image)q[j.image.name]=!0;else{let G=fd(e.toString()),v=j.fontStack||E,H=r[v]=r[v]||{};this.calculateGlyphDependencies(j.text,H,F,this.allowVerticalPlacement,G)}}}"line"===c.get("symbol-placement")&&(this.features=function(k){let d={},c={},g=[],l=0;function m(a){g.push(k[a]),l++}function n(b,d,e){let a=c[b];return delete c[b],c[d]=a,g[a].geometry[0].pop(),g[a].geometry[0]=g[a].geometry[0].concat(e[0]),a}function o(c,b,e){let a=d[b];return delete d[b],d[c]=a,g[a].geometry[0].shift(),g[a].geometry[0]=e[0].concat(g[a].geometry[0]),a}function i(c,a,d){let b=d?a[0][a[0].length-1]:a[0][0];return`${c}:${b.x}:${b.y}`}for(let e=0;e<k.length;e++){let j=k[e],f=j.geometry,h=j.text?j.text.toString():null;if(!h){m(e);continue}let a=i(h,f),b=i(h,f,!0);if(a in c&&b in d&&c[a]!==d[b]){let p=o(a,b,f),q=n(a,b,g[p].geometry);delete d[a],delete c[b],c[i(h,g[q].geometry,!0)]=q,g[p].geometry=null}else a in c?n(a,b,f):b in d?o(a,b,f):(m(e),d[a]=l-1,c[b]=l-1)}return g.filter(a=>a.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((a,b)=>a.sortKey-b.sortKey)}update(a,b,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,b,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,b,this.layers,c))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(d,a){let h=this.lineVertexArray.length;if(void 0!==d.segment){let i=d.dist(a[d.segment+1]),j=d.dist(a[d.segment]),e={};for(let b=d.segment+1;b<a.length;b++)e[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:i},b<a.length-1&&(i+=a[b+1].dist(a[b]));for(let c=d.segment||0;c>=0;c--)e[c]={x:a[c].x,y:a[c].y,tileUnitDistanceFromAnchor:j},c>0&&(j+=a[c-1].dist(a[c]));for(let f=0;f<a.length;f++){let g=e[f];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(e,h,d,s,I,i,t,b,C,D,E,F){let r=e.indexArray,f=e.layoutVertexArray,k=e.segments.prepareSegment(4*h.length,f,r,this.canOverlap?i.sortKey:void 0),u=this.glyphOffsetArray.length,G=k.vertexLength,H=this.allowVerticalPlacement&&t===a.WritingMode.vertical?Math.PI/2:0,v=i.text&&i.text.sections;for(let j=0;j<h.length;j++){let{tl:w,tr:x,bl:y,br:z,tex:c,pixelOffsetTL:l,pixelOffsetBR:m,minFontScaleX:n,minFontScaleY:o,glyphOffset:A,isSDF:p,sectionIndex:B}=h[j],g=k.vertexLength,q=A[1];h4(f,b.x,b.y,w.x,q+w.y,c.x,c.y,d,p,l.x,l.y,n,o),h4(f,b.x,b.y,x.x,q+x.y,c.x+c.w,c.y,d,p,m.x,l.y,n,o),h4(f,b.x,b.y,y.x,q+y.y,c.x,c.y+c.h,d,p,l.x,m.y,n,o),h4(f,b.x,b.y,z.x,q+z.y,c.x+c.w,c.y+c.h,d,p,m.x,m.y,n,o),aR(e.dynamicLayoutVertexArray,b,H),r.emplaceBack(g,g+1,g+2),r.emplaceBack(g+1,g+2,g+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),j!==h.length-1&&B===h[j+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,i,i.index,{},F,v&&v[B])}e.placedSymbolArray.emplaceBack(b.x,b.y,u,this.glyphOffsetArray.length-u,G,C,D,b.segment,d?d[0]:0,d?d[1]:0,s[0],s[1],t,0,!1,0,E)}_addCollisionDebugVertex(c,d,a,e,f,b){return d.emplaceBack(0,0),c.emplaceBack(a.x,a.y,e,f,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(j,k,l,m,b,c,n){let i=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),a=i.vertexLength,d=b.layoutVertexArray,e=b.collisionVertexArray,f=n.anchorX,g=n.anchorY;this._addCollisionDebugVertex(d,e,c,f,g,new J(j,k)),this._addCollisionDebugVertex(d,e,c,f,g,new J(l,k)),this._addCollisionDebugVertex(d,e,c,f,g,new J(l,m)),this._addCollisionDebugVertex(d,e,c,f,g,new J(j,m)),i.vertexLength+=4;let h=b.indexArray;h.emplaceBack(a,a+1),h.emplaceBack(a+1,a+2),h.emplaceBack(a+2,a+3),h.emplaceBack(a+3,a),i.primitiveLength+=4}addDebugCollisionBoxes(c,d,e,f){for(let b=c;b<d;b++){let a=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,f?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,e)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new c0(fD,g6.members,fE),this.iconCollisionBox=new c0(fD,g6.members,fE);for(let b=0;b<this.symbolInstances.length;b++){let a=this.symbolInstances.get(b);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(f,k,l,m,n,o,p,q,r){let a={};for(let g=k;g<l;g++){let b=f.get(g);a.textBox={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2,anchorPointX:b.anchorPointX,anchorPointY:b.anchorPointY},a.textFeatureIndex=b.featureIndex;break}for(let h=m;h<n;h++){let c=f.get(h);a.verticalTextBox={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,anchorPointX:c.anchorPointX,anchorPointY:c.anchorPointY},a.verticalTextFeatureIndex=c.featureIndex;break}for(let i=o;i<p;i++){let d=f.get(i);a.iconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},a.iconFeatureIndex=d.featureIndex;break}for(let j=q;j<r;j++){let e=f.get(j);a.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},a.verticalIconFeatureIndex=e.featureIndex;break}return a}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let b=0;b<this.symbolInstances.length;b++){let a=this.symbolInstances.get(b);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(b,d){let c=b.placedSymbolArray.get(d),e=c.vertexStartIndex+4*c.numGlyphs;for(let a=c.vertexStartIndex;a<e;a+=4)b.indexArray.emplaceBack(a,a+1,a+2),b.indexArray.emplaceBack(a+1,a+2,a+3)}getSortedSymbolIndexes(b){if(this.sortedAngle===b&& void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let e=Math.sin(b),f=Math.cos(b),g=[],h=[],c=[];for(let a=0;a<this.symbolInstances.length;++a){c.push(a);let d=this.symbolInstances.get(a);g.push(0|Math.round(e*d.anchorX+f*d.anchorY)),h.push(d.featureIndex)}return c.sort((a,b)=>g[a]-g[b]||h[b]-h[a]),c}addToSortKeyRanges(a,c){let b=this.sortKeyRanges[this.sortKeyRanges.length-1];b&&b.sortKey===c?b.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(b){if(this.sortFeaturesByY&&this.sortedAngle!==b&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let c of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(b),this.sortedAngle=b,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let a=this.symbolInstances.get(c);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((a,b,c)=>{a>=0&&c.indexOf(a)===b&&this.addIndicesForPlacedSymbol(this.text,a)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}c("SymbolBucket",G,{omit:["layers","collisionBoxArray","features","compareText"]}),G.MAX_GLYPHS=65535,G.addDynamicAttributes=aR;let c1=new l({"symbol-placement":new e(b.layout_symbol["symbol-placement"]),"symbol-spacing":new e(b.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new e(b.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new f(b.layout_symbol["symbol-sort-key"]),"symbol-z-order":new e(b.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new e(b.layout_symbol["icon-allow-overlap"]),"icon-overlap":new e(b.layout_symbol["icon-overlap"]),"icon-ignore-placement":new e(b.layout_symbol["icon-ignore-placement"]),"icon-optional":new e(b.layout_symbol["icon-optional"]),"icon-rotation-alignment":new e(b.layout_symbol["icon-rotation-alignment"]),"icon-size":new f(b.layout_symbol["icon-size"]),"icon-text-fit":new e(b.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new e(b.layout_symbol["icon-text-fit-padding"]),"icon-image":new f(b.layout_symbol["icon-image"]),"icon-rotate":new f(b.layout_symbol["icon-rotate"]),"icon-padding":new e(b.layout_symbol["icon-padding"]),"icon-keep-upright":new e(b.layout_symbol["icon-keep-upright"]),"icon-offset":new f(b.layout_symbol["icon-offset"]),"icon-anchor":new f(b.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new e(b.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new e(b.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new e(b.layout_symbol["text-rotation-alignment"]),"text-field":new f(b.layout_symbol["text-field"]),"text-font":new f(b.layout_symbol["text-font"]),"text-size":new f(b.layout_symbol["text-size"]),"text-max-width":new f(b.layout_symbol["text-max-width"]),"text-line-height":new e(b.layout_symbol["text-line-height"]),"text-letter-spacing":new f(b.layout_symbol["text-letter-spacing"]),"text-justify":new f(b.layout_symbol["text-justify"]),"text-radial-offset":new f(b.layout_symbol["text-radial-offset"]),"text-variable-anchor":new e(b.layout_symbol["text-variable-anchor"]),"text-anchor":new f(b.layout_symbol["text-anchor"]),"text-max-angle":new e(b.layout_symbol["text-max-angle"]),"text-writing-mode":new e(b.layout_symbol["text-writing-mode"]),"text-rotate":new f(b.layout_symbol["text-rotate"]),"text-padding":new e(b.layout_symbol["text-padding"]),"text-keep-upright":new e(b.layout_symbol["text-keep-upright"]),"text-transform":new f(b.layout_symbol["text-transform"]),"text-offset":new f(b.layout_symbol["text-offset"]),"text-allow-overlap":new e(b.layout_symbol["text-allow-overlap"]),"text-overlap":new e(b.layout_symbol["text-overlap"]),"text-ignore-placement":new e(b.layout_symbol["text-ignore-placement"]),"text-optional":new e(b.layout_symbol["text-optional"])});var h6={paint:new l({"icon-opacity":new f(b.paint_symbol["icon-opacity"]),"icon-color":new f(b.paint_symbol["icon-color"]),"icon-halo-color":new f(b.paint_symbol["icon-halo-color"]),"icon-halo-width":new f(b.paint_symbol["icon-halo-width"]),"icon-halo-blur":new f(b.paint_symbol["icon-halo-blur"]),"icon-translate":new e(b.paint_symbol["icon-translate"]),"icon-translate-anchor":new e(b.paint_symbol["icon-translate-anchor"]),"text-opacity":new f(b.paint_symbol["text-opacity"]),"text-color":new f(b.paint_symbol["text-color"],{runtimeType:r,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new f(b.paint_symbol["text-halo-color"]),"text-halo-width":new f(b.paint_symbol["text-halo-width"]),"text-halo-blur":new f(b.paint_symbol["text-halo-blur"]),"text-translate":new e(b.paint_symbol["text-translate"]),"text-translate-anchor":new e(b.paint_symbol["text-translate-anchor"])}),layout:c1};class c2{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:bk,this.defaultValue=a}evaluate(a){if(a.formattedSection){let b=this.defaultValue.property.overrides;if(b&&b.hasOverride(a.formattedSection))return b.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}c("FormatSectionOverride",c2,{omit:["defaultValue"]});class c3 extends ap{constructor(a){super(a,h6)}recalculate(d,e){if(super.recalculate(d,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){let b=this.layout.get("text-writing-mode");if(b){let a=[];for(let c of b)0>a.indexOf(c)&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(b,c,e,f){var g,h;let a=this.layout.get(b).evaluate(c,{},e,f),d=this._unevaluatedLayout._values[b];return d.isDataDriven()||eP(d.value)||!a?a:(g=c.properties,(h=a).replace(/{([^{}]+)}/g,(b,a)=>a in g?String(g[a]):""))}createBucket(a){return new G(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let b of h6.paint.overridableProperties){if(!c3.hasPaintOverride(this.layout,b))continue;let a=this.paint.get(b),e=new c2(a),c=new bS(e,a.property.specification),d=null;d="constant"===a.value.kind||"source"===a.value.kind?new bU("source",c):new bV("composite",c,a.value.zoomStops,a.value._interpolationType),this.paint._values[b]=new fx(a.property,d,a.parameters)}}_handleOverridablePaintPropertyUpdate(a,b,c){return!(!this.layout||b.isDataDriven()||c.isDataDriven())&&c3.hasPaintOverride(this.layout,a)}static hasPaintOverride(c,d){let a=c.get("text-field"),h=h6.paint.properties[d],e=!1,f=a=>{for(let b of a)if(h.overrides&&h.overrides.hasOverride(b))return void(e=!0)};if("constant"===a.value.kind&&a.value.value instanceof dV)f(a.value.value.sections);else if("source"===a.value.kind){let g=a=>{e||(a instanceof bq&&dY(a.value)===bm?f(a.value.sections):a instanceof br?f(a.sections):a.eachChild(g))},b=a.value;b._styleExpression&&g(b._styleExpression.expression)}return e}}function c4(b,d,e){let a="never",c=b.get(d);return c?a=c:b.get(e)&&(a="always"),a}var h7={paint:new l({"background-color":new e(b.paint_background["background-color"]),"background-pattern":new O(b.paint_background["background-pattern"]),"background-opacity":new e(b.paint_background["background-opacity"])})},h8={paint:new l({"raster-opacity":new e(b.paint_raster["raster-opacity"]),"raster-hue-rotate":new e(b.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new e(b.paint_raster["raster-brightness-min"]),"raster-brightness-max":new e(b.paint_raster["raster-brightness-max"]),"raster-saturation":new e(b.paint_raster["raster-saturation"]),"raster-contrast":new e(b.paint_raster["raster-contrast"]),"raster-resampling":new e(b.paint_raster["raster-resampling"]),"raster-fade-duration":new e(b.paint_raster["raster-fade-duration"])})};class h9 extends ap{constructor(a){super(a,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=a}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}let ia={circle:class extends ap{constructor(a){super(a,f4)}createBucket(a){return new aG(a)}queryRadius(b){let a=b;return f1("circle-radius",this,a)+f1("circle-stroke-width",this,a)+f2(this.paint.get("circle-translate"))}queryIntersectsFeature(m,f,g,n,t,b,h,c){var i,o;let j=f3(m,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,h),k=this.paint.get("circle-radius").evaluate(f,g)+this.paint.get("circle-stroke-width").evaluate(f,g),d="map"===this.paint.get("circle-pitch-alignment"),p=d?j:(i=j,o=c,i.map(a=>f5(a,o))),q=d?k*h:k;for(let r of n)for(let a of r){let s=d?a:f5(a,c),e=q,l=cG([],[a.x,a.y,0,1],c);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?e*=l[3]/b.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(e*=b.cameraToCenterDistance/l[3]),fT(p,s,e))return!0}return!1}},heatmap:class extends ap{constructor(a){super(a,f6),this._updateColorRamp()}createBucket(a){return new cH(a)}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cI({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends ap{constructor(a){super(a,ga)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends ap{constructor(a){super(a,gK)}recalculate(b,c){super.recalculate(b,c);let a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&& void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new aK(a)}queryRadius(){return f2(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,f,b,g,c,d){return fU(f3(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,d),b)}isTileClipped(){return!0}},"fill-extrusion":class extends ap{constructor(a){super(a,gX)}createBucket(a){return new aN(a)}queryRadius(){return f2(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,a,b,f,m,g,h,c){let i=f3(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,h),j=this.paint.get("fill-extrusion-height").evaluate(a,b),k=this.paint.get("fill-extrusion-base").evaluate(a,b),l=function(d,e,f,g){let b=[];for(let c of d){let a=[c.x,c.y,0,1];cG(a,a,e),b.push(new J(a[0]/a[3],a[1]/a[3]))}return b}(i,c),d=function(s,b,c,a){let h=[],i=[],t=a[8]*b,u=a[9]*b,v=a[10]*b,w=a[11]*b,x=a[8]*c,y=a[9]*c,z=a[10]*c,A=a[11]*c;for(let B of s){let j=[],k=[];for(let l of B){let d=l.x,e=l.y,m=a[0]*d+a[4]*e+a[12],n=a[1]*d+a[5]*e+a[13],o=a[2]*d+a[6]*e+a[14],p=a[3]*d+a[7]*e+a[15],C=o+v,f=p+w,D=m+x,E=n+y,F=o+z,g=p+A,q=new J((m+t)/f,(n+u)/f);q.z=C/f,j.push(q);let r=new J(D/g,E/g);r.z=F/g,k.push(r)}h.push(j),i.push(k)}return[h,i]}(f,k,j,c);return function(j,c,d){let b=1/0;fU(d,c)&&(b=gZ(d,c[0]));for(let e=0;e<c.length;e++){let f=c[e],g=j[e];for(let a=0;a<f.length-1;a++){let h=f[a],i=[h,f[a+1],g[a+1],g[a],h];cD(d,i)&&(b=Math.min(b,gZ(d,i)))}}return b!==1/0&&b}(d[0],d[1],l)}},line:class extends ap{constructor(a){super(a,cQ),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){"line-gradient"===a&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof bw,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,b){super.recalculate(a,b),this.paint._values["line-floorwidth"]=cR.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new aO(a)}queryRadius(b){let a=b,c=g2(f1("line-width",this,a),f1("line-gap-width",this,a)),d=f1("line-offset",this,a);return c/2+Math.abs(d)+f2(this.paint.get("line-translate"))}queryIntersectsFeature(f,a,b,c,j,g,d){let h=f3(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,d),i=d/2*g2(this.paint.get("line-width").evaluate(a,b),this.paint.get("line-gap-width").evaluate(a,b)),e=this.paint.get("line-offset").evaluate(a,b);return e&&(c=function(g,k){let h=[];for(let d=0;d<g.length;d++){let b=g[d],i=[];for(let a=0;a<b.length;a++){let l=b[a-1],e=b[a],m=b[a+1],n=0===a?new J(0,0):e.sub(l)._unit()._perp(),f=a===b.length-1?new J(0,0):m.sub(e)._unit()._perp(),c=n._add(f)._unit(),j=c.x*f.x+c.y*f.y;0!==j&&c._mult(1/j),i.push(c._mult(k)._add(e))}h.push(i)}return h}(c,e*d)),function(a,e,f){for(let b=0;b<e.length;b++){let c=e[b];if(a.length>=3){for(let d=0;d<c.length;d++)if(f_(a,c[d]))return!0}if(fV(a,c,f))return!0}return!1}(h,c,i)}isTileClipped(){return!0}},symbol:c3,background:class extends ap{constructor(a){super(a,h7)}},raster:class extends ap{constructor(a){super(a,h8)}}};class c5{constructor(a,b){if(isNaN(a)||isNaN(b))throw Error(`Invalid LngLat object: (${a}, ${b})`);if(this.lng=+a,this.lat=+b,this.lat>90||this.lat< -90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c5(aZ(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(b){let a=Math.PI/180,c=this.lat*a,d=b.lat*a,e=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((b.lng-this.lng)*a);return 6371008.8*Math.acos(Math.min(e,1))}toBounds(c=0){let a=360*c/40075017,b=a/Math.cos(Math.PI/180*this.lat);return new c6(new c5(this.lng-b,this.lat-a),new c5(this.lng+b,this.lat+a))}static convert(a){if(a instanceof c5)return a;if(Array.isArray(a)&&(2===a.length||3===a.length))return new c5(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&"object"==typeof a&&null!==a)return new c5(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class c6{constructor(a,b){a&&(b?this.setSouthWest(a).setNorthEast(b):4===a.length?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof c5?new c5(a.lng,a.lat):c5.convert(a),this}setSouthWest(a){return this._sw=a instanceof c5?new c5(a.lng,a.lat):c5.convert(a),this}extend(a){let d=this._sw,e=this._ne,b,c;if(a instanceof c5)b=a,c=a;else{if(!(a instanceof c6))return Array.isArray(a)?4===a.length||a.every(Array.isArray)?this.extend(c6.convert(a)):this.extend(c5.convert(a)):this;if(b=a._sw,c=a._ne,!b||!c)return this}return d||e?(d.lng=Math.min(b.lng,d.lng),d.lat=Math.min(b.lat,d.lat),e.lng=Math.max(c.lng,e.lng),e.lat=Math.max(c.lat,e.lat)):(this._sw=new c5(b.lng,b.lat),this._ne=new c5(c.lng,c.lat)),this}getCenter(){return new c5((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c5(this.getWest(),this.getNorth())}getSouthEast(){return new c5(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(d){let{lng:a,lat:b}=c5.convert(d),c=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=b&&b<=this._ne.lat&&c}static convert(a){return a instanceof c6?a:a?new c6(a):a}}let ib=2*Math.PI*6371008.8;function ic(a){return ib*Math.cos(a*Math.PI/180)}function c7(a){return(180+a)/360}function c8(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function c9(a,b){return a/ic(b)}function id(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class da{constructor(a,b,c=0){this.x=+a,this.y=+b,this.z=+c}static fromLngLat(b,c=0){let a=c5.convert(b);return new da(c7(a.lng),c8(a.lat),c9(c,a.lat))}toLngLat(){return new c5(360*this.x-180,id(this.y))}toAltitude(){return this.z*ic(id(this.y))}meterInMercatorCoordinateUnits(){var a;return 1/ib*(1/Math.cos(id(this.y)*Math.PI/180))}}function ie(b,c,d){var a=2*Math.PI*6378137/256/Math.pow(2,d);return[b*a-2*Math.PI*6378137/2,c*a-2*Math.PI*6378137/2]}class aS{constructor(a,b,c){this.z=a,this.x=b,this.y=c,this.key=ig(0,a,a,b,c)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(e,g,h){var f,a,b,c,d;let i=(a=this.y,b=this.z,c=ie(256*(f=this.x),256*(a=Math.pow(2,b)-a-1),b),d=ie(256*(f+1),256*(a+1),b),c[0]+","+c[1]+","+d[0]+","+d[1]),j=function(d,e,f){let b,c="";for(let a=d;a>0;a--)c+=(e&(b=1<<a-1)?1:0)+(f&b?2:0);return c}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,g>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,i)}getTilePoint(a){let b=Math.pow(2,this.z);return new J((a.x*b-this.x)*8192,(a.y*b-this.y)*8192)}toString(){return`${this.z}/${this.x}/${this.y}`}}class db{constructor(b,a){this.wrap=b,this.canonical=a,this.key=ig(b,a.z,a.z,a.x,a.y)}}class aT{constructor(a,b,c,d,e){this.overscaledZ=a,this.wrap=b,this.canonical=new aS(c,+d,+e),this.key=ig(b,a,c,d,e)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){let b=this.canonical.z-a;return a>this.canonical.z?new aT(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new aT(a,this.wrap,a,this.canonical.x>>b,this.canonical.y>>b)}calculateScaledKey(a,b){let c=this.canonical.z-a;return a>this.canonical.z?ig(this.wrap*+b,a,this.canonical.z,this.canonical.x,this.canonical.y):ig(this.wrap*+b,a,a,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(a){if(a.wrap!==this.wrap)return!1;let b=this.canonical.z-a.canonical.z;return 0===a.overscaledZ||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>b&&a.canonical.y===this.canonical.y>>b}children(d){if(this.overscaledZ>=d)return[new aT(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let a=this.canonical.z+1,b=2*this.canonical.x,c=2*this.canonical.y;return[new aT(a,this.wrap,a,b,c),new aT(a,this.wrap,a,b+1,c),new aT(a,this.wrap,a,b,c+1),new aT(a,this.wrap,a,b+1,c+1)]}isLessThan(a){return this.wrap<a.wrap|| !(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ|| !(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x|| !(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new aT(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new aT(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new db(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new da(a.x-this.wrap,a.y))}}function ig(a,d,c,e,f){(a*=2)<0&&(a=-1*a-1);let b=1<<c;return(b*b*a+b*f+e).toString(36)+c.toString(36)+d.toString(36)}c("CanonicalTileID",aS),c("OverscaledTileID",aT,{omit:["posMatrix"]});class aU{constructor(e,c,d){if(this.uid=e,c.height!==c.width)throw RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return void a3(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;let a=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=d||"mapbox";for(let b=0;b<a;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(a,b)]=this.data[this._idx(a-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,a)]=this.data[this._idx(b,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)]}get(c,d){let a=new Uint8Array(this.data.buffer),b=4*this._idx(c,d);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(a[b],a[b+1],a[b+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(a,b){if(a< -1||a>=this.dim+1||b< -1||b>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(b+1)*this.stride+(a+1)}_unpackMapbox(a,b,c){return(256*a*256+256*b+c)/10-1e4}_unpackTerrarium(a,b,c){return 256*a+b+c/256-32768}getPixels(){return new aJ({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,a,b){if(this.dim!==i.dim)throw Error("dem dimension mismatch");let e=a*this.dim,f=a*this.dim+this.dim,g=b*this.dim,h=b*this.dim+this.dim;switch(a){case -1:e=f-1;break;case 1:f=e+1}switch(b){case -1:g=h-1;break;case 1:h=g+1}let j=-a*this.dim,k=-b*this.dim;for(let c=g;c<h;c++)for(let d=e;d<f;d++)this.data[this._idx(d,c)]=i.data[this._idx(d+j,c+k)]}}c("DEMData",aU);class dc{constructor(b){this._stringToNumber={},this._numberToString=[];for(let a=0;a<b.length;a++){let c=b[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class dd{constructor(a,b,c,d,e){this.type="Feature",this._vectorTileFeature=a,a._z=b,a._x=c,a._y=d,this.properties=a.properties,this.id=e}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){let b={geometry:this.geometry};for(let a in this)"_geometry"!==a&&"_vectorTileFeature"!==a&&(b[a]=this[a]);return b}}class aV{constructor(a,b){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new b6(8192,16,0),this.grid3D=new b6(8192,16,0),this.featureIndexArray=new cn,this.promoteId=b}insert(m,e,g,h,i,j){let k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,h,i);let l=j?this.grid3D:this.grid;for(let c=0;c<e.length;c++){let f=e[c],a=[1/0,1/0,-1/0,-1/0];for(let d=0;d<f.length;d++){let b=f[d];a[0]=Math.min(a[0],b.x),a[1]=Math.min(a[1],b.y),a[2]=Math.max(a[2],b.x),a[3]=Math.max(a[3],b.y)}a[0]<8192&&a[1]<8192&&a[2]>=0&&a[3]>=0&&l.insert(k,a[0],a[1],a[2],a[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new q.VectorTile(new cU(this.rawTileData)).layers,this.sourceLayerCoder=new dc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(b,l,m,n){this.loadVTLayers();let f=b.params||{},o=8192/b.tileSize/b.scale,p=b0(f.filter),q=b.queryGeometry,a=b.queryPadding*o,c=ii(q),d=this.grid.query(c.minX-a,c.minY-a,c.maxX+a,c.maxY+a),e=ii(b.cameraQueryGeometry),r=this.grid3D.query(e.minX-a,e.minY-a,e.maxX+a,e.maxY+a,(c,d,e,f)=>(function(a,d,e,f,g){for(let b of a)if(d<=b.x&&e<=b.y&&f>=b.x&&g>=b.y)return!0;let h=[new J(d,e),new J(d,g),new J(f,g),new J(f,e)];if(a.length>2){for(let i of h)if(f_(a,i))return!0}for(let c=0;c<a.length-1;c++)if(f0(a[c],a[c+1],h))return!0;return!1})(b.cameraQueryGeometry,c-a,d-a,e+a,f+a));for(let s of r)d.push(s);d.sort(ij);let j={},k;for(let g=0;g<d.length;g++){let h=d[g];if(h===k)continue;k=h;let i=this.featureIndexArray.get(h),t=null;this.loadMatchingFeature(j,i.bucketIndex,i.sourceLayerIndex,i.featureIndex,p,f.layers,f.availableImages,l,m,n,(a,c,d)=>(t||(t=fR(a)),c.queryIntersectsFeature(q,a,d,t,this.z,b.transform,o,b.pixelPosMatrix)))}return j}loadMatchingFeature(l,t,u,m,g,e,n,v,w,o,p){let h=this.bucketLayerIDs[t];if(e&&!function(b,c){for(let a=0;a<b.length;a++)if(c.indexOf(b[a])>=0)return!0;return!1}(e,h))return;let q=this.sourceLayerCoder.decode(u),a=this.vtLayers[q].feature(m);if(g.needGeometry){let x=cC(a,!0);if(!g.filter(new cd(this.tileID.overscaledZ),x,this.tileID.canonical))return}else if(!g.filter(new cd(this.tileID.overscaledZ),a))return;let i=this.getId(a,q);for(let j=0;j<h.length;j++){let b=h[j];if(e&&0>e.indexOf(b))continue;let c=v[b];if(!c)continue;let f={};i&&o&&(f=o.getState(c.sourceLayer||"_geojsonTileLayer",i));let d=a$({},w[b]);d.paint=ih(d.paint,c.paint,a,f,n),d.layout=ih(d.layout,c.layout,a,f,n);let r=!p||p(a,c,f);if(!r)continue;let s=new dd(a,this.z,this.x,this.y,i);s.layer=d;let k=l[b];void 0===k&&(k=l[b]=[]),k.push({featureIndex:m,feature:s,intersectionZ:r})}}lookupSymbolFeatures(b,c,d,e,f,g,h,i){let a={};this.loadVTLayers();let j=b0(f);for(let k of b)this.loadMatchingFeature(a,d,e,k,j,g,h,i,c);return a}hasLayer(a){for(let b of this.bucketLayerIDs)for(let c of b)if(a===c)return!0;return!1}getId(b,c){let a=b.id;return this.promoteId&&"boolean"==typeof(a=b.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[c]])&&(a=Number(a)),a}}function ih(a,b,c,d,e){return a0(a,(g,f)=>{let a=b instanceof fy?b.get(f):null;return a&&a.evaluate?a.evaluate(c,d,e):a})}function ii(f){let b=1/0,c=1/0,d=-1/0,e=-1/0;for(let a of f)b=Math.min(b,a.x),c=Math.min(c,a.y),d=Math.max(d,a.x),e=Math.max(e,a.y);return{minX:b,minY:c,maxX:d,maxY:e}}function ij(a,b){return b-a}c("FeatureIndex",aV,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(H=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",H.load="load",H.fullLoad="fullLoad";let ik=null,il=[],im=1e3/30,de={mark(a){performance.mark(a)},frame(b){let a=b;null!=ik&&il.push(a-ik),ik=a},clearMetrics(){for(let b in ik=null,il=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime"),a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[b])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);let d=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,b=il.length,f=1/(il.reduce((a,b)=>a+b,0)/b/1e3),c=il.filter(a=>a>im).reduce((a,b)=>a+(b-im)/im,0);return{loadTime:d,fullLoadTime:e,fps:f,percentDroppedFrames:c/(b+c)*100}}};a.AJAXError=af,a.ARRAY_TYPE=aa,a.Actor=class{constructor(a,b,c){this.target=a,this.parent=b,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},a_(["receive","process"],this),this.invoker=new class{constructor(a){this._callback=a,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=a4()?a:window}send(d,e,a,f,g=!1){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[b]=a);let c=a6(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:d,hasCallback:!!a,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:fb(e,c)},c),{cancel:()=>{a&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(d){let a=d.data,b=a.id;if(b&&(!a.targetMapId||this.mapId===a.targetMapId)){if("<cancel>"===a.type){delete this.tasks[b];let c=this.cancelCallbacks[b];delete this.cancelCallbacks[b],c&&c()}else a4()||a.mustQueue?(this.tasks[b]=a,this.taskQueue.push(b),this.invoker.trigger()):this.processTask(b,a)}}process(){if(!this.taskQueue.length)return;let a=this.taskQueue.shift(),b=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),b&&this.processTask(a,b)}processTask(c,a){if("<response>"===a.type){let d=this.callbacks[c];delete this.callbacks[c],d&&(a.error?d(fc(a.error)):d(null,fc(a.data)))}else{let h=!1,i=a6(this.globalScope)?void 0:[],e=a.hasCallback?(a,b)=>{h=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:a?fb(a):null,data:fb(b,i)},i)}:a=>{h=!0},b=null,f=fc(a.data);if(this.parent[a.type])b=this.parent[a.type](a.sourceMapId,f,e);else if(this.parent.getWorkerSource){let g=a.type.split(".");b=this.parent.getWorkerSource(a.sourceMapId,g[0],f.source)[g[1]](f,e)}else e(Error(`Could not find function ${a.type}`));!h&&b&&b.cancel&&(this.cancelCallbacks[c]=b.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=aI,a.CanonicalTileID=aS,a.CollisionBoxArray=aC,a.CollisionCircleLayoutArray=class extends ay{},a.Color=m,a.DEMData=aU,a.DataConstantProperty=e,a.DictionaryCoder=dc,a.EXTENT=8192,a.ErrorEvent=bh,a.EvaluationParameters=cd,a.Event=ag,a.Evented=L,a.FeatureIndex=aV,a.FillBucket=aK,a.FillExtrusionBucket=aN,a.GeoJSONFeature=dd,a.ImageAtlas=aQ,a.ImagePosition=aP,a.LineBucket=aO,a.LineStripIndexArray=class extends aA{},a.LngLat=c5,a.LngLatBounds=c6,a.MercatorCoordinate=da,a.ONE_EM=cT,a.OverscaledTileID=aT,a.PerformanceUtils=de,a.PosArray=class extends aq{},a.Properties=l,a.QuadTriangleArray=class extends T{},a.RGBAImage=aJ,a.RasterBoundsArray=class extends ar{},a.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return 0===a.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},a.ResourceType=ae,a.SegmentVector=$,a.SymbolBucket=G,a.Transitionable=ce,a.TriangleIndexArray=co,a.Uniform1f=cs,a.Uniform1i=class extends _{constructor(a,b){super(a,b),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},a.Uniform2f=class extends _{constructor(a,b){super(a,b),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},a.Uniform3f=class extends _{constructor(a,b){super(a,b),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},a.Uniform4f=ct,a.UniformColor=cu,a.UniformMatrix4f=class extends _{constructor(a,b){super(a,b),this.current=fM}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let b=1;b<16;b++)if(a[b]!==this.current[b]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},a.UnwrappedTileID=db,a.ValidationError=bi,a.ZoomHistory=b7,a.addDynamicAttributes=aR,a.asyncAll=function(a,c,b){if(!a.length)return b(null,[]);let d=a.length,e=Array(a.length),f=null;a.forEach((a,g)=>{c(a,(a,c)=>{a&&(f=a),e[g]=c,0== --d&&b(f,e)})})},a.bezier=ac,a.bindAll=a_,a.cacheEntryPossiblyAdded=function(a){++dt>dr&&(a.getActor().send("enforceCacheSizeLimit",dq),dt=0)},a.clamp=aY,a.clearTileCache=function(a){let b=caches.delete(dm);a&&b.catch(a).then(()=>a())},a.clipLine=cY,a.clone=function(b){var a=new aa(16);return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},a.clone$1=a2,a.collisionCircleLayout=cS,a.config=a9,a.create=function(){var a=new aa(16);return aa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},a.createExpression=bT,a.createFilter=b0,a.createLayout=k,a.createStyleLayer=function(a){return"custom"===a.type?new h9(a):new ia[a.type](a)},a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},a.ease=aX,a.emitValidationErrors=b5,a.enforceCacheSizeLimit=function(a){ds(),dn&&dn.then(b=>{b.keys().then(d=>{for(let c=0;c<d.length-a;c++)b.delete(d[c])})})},a.evaluateSizeForFeature=function(a,{uSize:c,uSizeT:d},{lowerSize:b,upperSize:e}){return"source"===a.kind?b/128:"composite"===a.kind?ai(b/128,e/128,d):c},a.evaluateSizeForZoom=function(a,f){let c=0,b=0;if("constant"===a.kind)b=a.layoutSize;else if("source"!==a.kind){let{interpolationType:d,minZoom:g,maxZoom:h}=a,e=d?aY(M.interpolationFactor(d,f,g,h),0,1):0;"camera"===a.kind?b=ai(a.minSize,a.maxSize,e):c=e}return{uSizeT:c,uSize:b}},a.evaluateVariableOffset=cZ,a.evented=ca,a.exported=a8,a.exported$1=ba,a.extend=a$,a.filterObject=a1,a.getAnchorAlignment=cW,a.getAnchorJustification=c$,a.getArrayBuffer=bd,a.getImage=bg,a.getJSON=function(a,b){return bc(a$(a,{type:"json"}),b)},a.getOverlapMode=c4,a.getRTLTextPluginStatus=cb,a.getReferrer=bb,a.getVideo=function(c,e){let a=window.document.createElement("video");a.muted=!0,a.onloadstart=function(){e(null,a)};for(let b=0;b<c.length;b++){let d=window.document.createElement("source");dz(c[b])||(a.crossOrigin="Anonymous"),d.src=c[b],a.appendChild(d)}return{cancel(){}}},a.identity=cF,a.invert=function(b,c){var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15],t=d*i-e*h,u=d*j-f*h,v=d*k-g*h,w=e*j-f*i,x=e*k-g*i,y=f*k-g*j,z=l*q-m*p,A=l*r-n*p,B=l*s-o*p,C=m*r-n*q,D=m*s-o*q,E=n*s-o*r,a=t*E-u*D+v*C+w*B-x*A+y*z;return a?(b[0]=(i*E-j*D+k*C)*(a=1/a),b[1]=(f*D-e*E-g*C)*a,b[2]=(q*y-r*x+s*w)*a,b[3]=(n*x-m*y-o*w)*a,b[4]=(j*B-h*E-k*A)*a,b[5]=(d*E-f*B+g*A)*a,b[6]=(r*v-p*y-s*u)*a,b[7]=(l*y-n*v+o*u)*a,b[8]=(h*D-i*B+k*z)*a,b[9]=(e*B-d*D-g*z)*a,b[10]=(p*x-q*v+s*t)*a,b[11]=(m*v-l*x-o*t)*a,b[12]=(i*A-h*C-j*z)*a,b[13]=(d*C-e*A+f*z)*a,b[14]=(q*u-p*w-r*t)*a,b[15]=(l*w-m*u+n*t)*a,b):null},a.isImageBitmap=a7,a.isSafari=a6,a.keysDifference=function(c,d){let a=[];for(let b in c)b in d||a.push(b);return a},a.lazyLoadRTLTextPlugin=function(){cc.isLoading()||cc.isLoaded()||"deferred"!==cb()||fs()},a.makeRequest=bc,a.mapObject=a0,a.mercatorXfromLng=c7,a.mercatorYfromLat=c8,a.mercatorZfromAltitude=c9,a.mul=aH,a.multiply=aH,a.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},a.number=ai,a.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},a.parseCacheControl=a5,a.parseGlyphPBF=function(a){return new cU(a).readFields(hr,[])},a.pbf=cU,a.performSymbolLayout=function(b,r,s,F,l,M,c){b.createArrays(),b.tilePixelRatio=8192/(512*b.overscaling),b.compareText={},b.iconsNeedLinear=!1;let e=b.layers[0].layout,g=b.layers[0]._unevaluatedLayout._values,i={layoutIconSize:g["icon-size"].possiblyEvaluate(new cd(b.zoom+1),c),layoutTextSize:g["text-size"].possiblyEvaluate(new cd(b.zoom+1),c),textMaxSize:g["text-size"].possiblyEvaluate(new cd(18))};if("composite"===b.textSizeData.kind){let{minZoom:N,maxZoom:O}=b.textSizeData;i.compositeTextSizes=[g["text-size"].possiblyEvaluate(new cd(N),c),g["text-size"].possiblyEvaluate(new cd(O),c)]}if("composite"===b.iconSizeData.kind){let{minZoom:P,maxZoom:Q}=b.iconSizeData;i.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new cd(P),c),g["icon-size"].possiblyEvaluate(new cd(Q),c)]}let t=e.get("text-line-height")*cT,u="viewport"!==e.get("text-rotation-alignment")&&"point"!==e.get("symbol-placement"),R=e.get("text-keep-upright"),S=e.get("text-size");for(let d of b.features){let v=e.get("text-font").evaluate(d,{},c).join(","),w=S.evaluate(d,{},c),m=i.layoutTextSize.evaluate(d,{},c),T=i.layoutIconSize.evaluate(d,{},c),f={horizontal:{},vertical:void 0},j=d.text,x,k=[0,0];if(j){let G=j.toString(),U=e.get("text-letter-spacing").evaluate(d,{},c)*cT,y=fe(G)?U:0,n=e.get("text-anchor").evaluate(d,{},c),z=e.get("text-variable-anchor");if(!z){let H=e.get("text-radial-offset").evaluate(d,{},c);k=H?cZ(n,[H*cT,hY]):e.get("text-offset").evaluate(d,{},c).map(a=>a*cT)}let h=u?"center":e.get("text-justify").evaluate(d,{},c),o=e.get("symbol-placement"),A="point"===o?e.get("text-max-width").evaluate(d,{},c)*cT:0,I=()=>{b.allowVerticalPlacement&&fd(G)&&(f.vertical=hw(j,r,s,l,v,A,t,n,"left",y,k,a.WritingMode.vertical,!0,o,m,w))};if(!u&&z){let J="auto"===h?z.map(a=>c$(a)):[h],K=!1;for(let B=0;B<J.length;B++){let p=J[B];if(!f.horizontal[p]){if(K)f.horizontal[p]=f.horizontal[0];else{let C=hw(j,r,s,l,v,A,t,"center",p,y,k,a.WritingMode.horizontal,!1,o,m,w);C&&(f.horizontal[p]=C,K=1===C.positionedLines.length)}}}I()}else{"auto"===h&&(h=c$(n));let L=hw(j,r,s,l,v,A,t,n,h,y,k,a.WritingMode.horizontal,!1,o,m,w);L&&(f.horizontal[h]=L),I(),fd(G)&&u&&R&&(f.vertical=hw(j,r,s,l,v,A,t,n,h,y,k,a.WritingMode.vertical,!1,o,m,w))}}let q=!1;if(d.icon&&d.icon.name){let D=F[d.icon.name];D&&(x=hG(l[d.icon.name],e.get("icon-offset").evaluate(d,{},c),e.get("icon-anchor").evaluate(d,{},c)),q=!!D.sdf,void 0===b.sdfIcons?b.sdfIcons=q:b.sdfIcons!==q&&a3("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(D.pixelRatio!==b.pixelRatio||0!==e.get("icon-rotate").constantOr(1))&&(b.iconsNeedLinear=!0))}let E=h0(f.horizontal)||f.vertical;b.iconsInText=!!E&&E.iconsInText,(E||x)&&hZ(b,d,f,x,F,i,m,T,k,q,c)}M&&b.generateCollisionDebugBuffers()},a.perspective=function(a,f,g,c,b){var d,e=1/Math.tan(f/2);return a[0]=e/g,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=b&&b!==1/0?(a[10]=(b+c)*(d=1/(c-b)),a[14]=2*b*c*d):(a[10]=-1,a[14]=-2*c),a},a.pick=function(c,d){let e={};for(let a=0;a<d.length;a++){let b=d[a];b in c&&(e[b]=c[b])}return e},a.plugin=cc,a.pointGeometry=J,a.polygonIntersectsPolygon=cD,a.potpack=cV,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=c,a.registerForPluginStateChange=function(a){return a({pluginStatus:fp,pluginURL:fq}),ca.on("pluginStateChange",a),a},a.renderColorRamp=cI,a.rotateX=function(a,b,e){var c=Math.sin(e),d=Math.cos(e),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*d+j*c,a[5]=g*d+k*c,a[6]=h*d+l*c,a[7]=i*d+m*c,a[8]=j*d-f*c,a[9]=k*d-g*c,a[10]=l*d-h*c,a[11]=m*d-i*c,a},a.rotateZ=function(a,b,e){var c=Math.sin(e),d=Math.cos(e),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*d+j*c,a[1]=g*d+k*c,a[2]=h*d+l*c,a[3]=i*d+m*c,a[4]=j*d-f*c,a[5]=k*d-g*c,a[6]=l*d-h*c,a[7]=m*d-i*c,a},a.scale=function(a,b,f){var c=f[0],d=f[1],e=f[2];return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*d,a[5]=b[5]*d,a[6]=b[6]*d,a[7]=b[7]*d,a[8]=b[8]*e,a[9]=b[9]*e,a[10]=b[10]*e,a[11]=b[11]*e,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},a.scale$1=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},a.setCacheLimits=function(a,b){dq=a,dr=b},a.setRTLTextPlugin=function(a,b,c=!1){if(fp===fl||fp===fm||fp===fn)throw Error("setRTLTextPlugin cannot be called multiple times.");fq=a8.resolveURL(a),fp=fl,fo=b,fr(),c||fs()},a.spec=b,a.sphericalToCartesian=function([c,a,b]){return a+=90,a*=Math.PI/180,b*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(b),y:c*Math.sin(a)*Math.sin(b),z:c*Math.cos(b)}},a.toEvaluationFeature=cC,a.transformMat4=cG,a.translate=function(b,a,f){var r,g,h,i,j,k,l,m,n,o,p,q,c=f[0],d=f[1],e=f[2];return a===b?(b[12]=a[0]*c+a[4]*d+a[8]*e+a[12],b[13]=a[1]*c+a[5]*d+a[9]*e+a[13],b[14]=a[2]*c+a[6]*d+a[10]*e+a[14],b[15]=a[3]*c+a[7]*d+a[11]*e+a[15]):(g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],l=a[6],m=a[7],n=a[8],o=a[9],p=a[10],q=a[11],b[0]=r=a[0],b[1]=g,b[2]=h,b[3]=i,b[4]=j,b[5]=k,b[6]=l,b[7]=m,b[8]=n,b[9]=o,b[10]=p,b[11]=q,b[12]=r*c+j*d+n*e+a[12],b[13]=g*c+k*d+o*e+a[13],b[14]=h*c+l*d+p*e+a[14],b[15]=i*c+m*d+q*e+a[15]),b},a.triggerPluginCompletionEvent=b9,a.unicodeBlockLookup=b8,a.uniqueId=function(){return dg++},a.validateCustomStyleLayer=function(a){let b=[],c=a.id;return void 0===c&&b.push({message:`layers.${c}: missing required property "id"`}),void 0===a.render&&b.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&b.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),b},a.validateLight=b4,a.validateStyle=A,a.vectorTile=q,a.warnOnce=a3,a.wrap=aZ}),a(["./shared"],function(a){function l(a){let c=typeof a;if("number"===c||"boolean"===c||"string"===c||null==a)return JSON.stringify(a);if(Array.isArray(a)){let e="[";for(let g of a)e+=`${l(g)},`;return`${e}]`}let d=Object.keys(a).sort(),f="{";for(let b=0;b<d.length;b++)f+=`${JSON.stringify(d[b])}:${l(a[d[b]])},`;return`${f}}`}function m(c){let b="";for(let d of a.refProperties)b+=`/${l(c[d])}`;return b}class n{constructor(a){this.keyCache={},a&&this.replace(a)}replace(a){this._layerConfigs={},this._layers={},this.update(a,[])}update(k,l){for(let b of k){this._layerConfigs[b.id]=b;let g=this._layers[b.id]=a.createStyleLayer(b);g._featureFilter=a.createFilter(g.filter),this.keyCache[b.id]&&delete this.keyCache[b.id]}for(let d of l)delete this.keyCache[d],delete this._layerConfigs[d],delete this._layers[d];this.familiesBySource={};let n=function(b,c){let d={};for(let a=0;a<b.length;a++){let e=c&&c[b[a].id]||m(b[a]);c&&(c[b[a].id]=e);let f=d[e];f||(f=d[e]=[]),f.push(b[a])}let g=[];for(let h in d)g.push(d[h]);return g}(Object.values(this._layerConfigs),this.keyCache);for(let o of n){let h=o.map(a=>this._layers[a.id]),e=h[0];if("none"===e.visibility)continue;let i=e.source||"",c=this.familiesBySource[i];c||(c=this.familiesBySource[i]={});let j=e.sourceLayer||"_geojsonTileLayer",f=c[j];f||(f=c[j]=[]),f.push(h)}}}class h{constructor(d){let e={},f=[];for(let g in d){let h=d[g],p=e[g]={};for(let i in h){let b=h[+i];if(!b||0===b.bitmap.width||0===b.bitmap.height)continue;let j={x:0,y:0,w:b.bitmap.width+2,h:b.bitmap.height+2};f.push(j),p[i]={rect:j,metrics:b.metrics}}}let{w:q,h:r}=a.potpack(f),k=new a.AlphaImage({width:q||1,height:r||1});for(let l in d){let m=d[l];for(let n in m){let c=m[+n];if(!c||0===c.bitmap.width||0===c.bitmap.height)continue;let o=e[l][n].rect;a.AlphaImage.copy(c.bitmap,k,{x:0,y:0},{x:o.x+1,y:o.y+1},c.bitmap)}}this.image=k,this.positions=e}}a.register("GlyphAtlas",h);class o{constructor(b){this.tileID=new a.OverscaledTileID(b.tileID.overscaledZ,b.tileID.wrap,b.tileID.canonical.z,b.tileID.canonical.x,b.tileID.canonical.y),this.uid=b.uid,this.zoom=b.zoom,this.pixelRatio=b.pixelRatio,this.tileSize=b.tileSize,this.source=b.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=b.showCollisionBoxes,this.collectResourceTiming=!!b.collectResourceTiming,this.returnDependencies=!!b.returnDependencies,this.promoteId=b.promoteId}parse(j,u,l,k,C){this.status="parsing",this.data=j,this.collisionBoxArray=new a.CollisionBoxArray;let v=new a.DictionaryCoder(Object.keys(j.layers).sort()),c=new a.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];let w={},e={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:l},m=u.familiesBySource[this.source];for(let d in m){let f=j.layers[d];if(!f)continue;1===f.version&&a.warnOnce(`Vector tile source "${this.source}" layer "${d}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let n=v.encode(d),o=[];for(let g=0;g<f.length;g++){let q=f.feature(g),x=c.getId(q,d);o.push({feature:q,id:x,index:g,sourceLayerIndex:n})}for(let i of m[d]){let b=i[0];b.minzoom&&this.zoom<Math.floor(b.minzoom)||b.maxzoom&&this.zoom>=b.maxzoom||"none"!==b.visibility&&(p(i,this.zoom,l),(w[b.id]=b.createBucket({index:c.bucketLayerIDs.length,layers:i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:n,sourceID:this.source})).populate(o,e,this.tileID.canonical),c.bucketLayerIDs.push(i.map(a=>a.id)))}}let D,y,z,A,r=a.mapObject(e.glyphDependencies,a=>Object.keys(a).map(Number));Object.keys(r).length?k.send("getGlyphs",{uid:this.uid,stacks:r},(a,b)=>{D||(D=a,y=b,B.call(this))}):y={};let s=Object.keys(e.iconDependencies);s.length?k.send("getImages",{icons:s,source:this.source,tileID:this.tileID,type:"icons"},(a,b)=>{D||(D=a,z=b,B.call(this))}):z={};let t=Object.keys(e.patternDependencies);function B(){if(D)return C(D);if(y&&z&&A){let d=new h(y),f=new a.ImageAtlas(z,A);for(let g in w){let b=w[g];b instanceof a.SymbolBucket?(p(b.layers,this.zoom,l),a.performSymbolLayout(b,y,d.positions,z,f.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):b.hasPattern&&(b instanceof a.LineBucket||b instanceof a.FillBucket||b instanceof a.FillExtrusionBucket)&&(p(b.layers,this.zoom,l),b.addFeatures(e,this.tileID.canonical,f.patternPositions))}this.status="done",C(null,{buckets:Object.values(w).filter(a=>!a.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:d.image,imageAtlas:f,glyphMap:this.returnDependencies?y:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?d.positions:null})}}t.length?k.send("getImages",{icons:t,source:this.source,tileID:this.tileID,type:"patterns"},(a,b)=>{D||(D=a,A=b,B.call(this))}):A={},B.call(this)}}function p(b,c,d){let e=new a.EvaluationParameters(c);for(let f of b)f.recalculate(e,d)}class q{constructor(b,c,d,e){this.actor=b,this.layerIndex=c,this.availableImages=d,this.loadVectorData=e||function(b,c){let d=a.getArrayBuffer(b.request,(d,b,e,f)=>{d?c(d):b&&c(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(b)),rawData:b,cacheControl:e,expires:f})});return()=>{d.cancel(),c()}},this.loading={},this.loaded={}}loadTile(b,e){let c=b.uid;this.loading||(this.loading={});let f=!!(b&&b.request&&b.request.collectResourceTiming)&&new a.RequestPerformance(b.request),d=this.loading[c]=new o(b);d.abort=this.loadVectorData(b,(g,b)=>{if(delete this.loading[c],g||!b)return d.status="done",this.loaded[c]=d,e(g);let k=b.rawData,h={};b.expires&&(h.expires=b.expires),b.cacheControl&&(h.cacheControl=b.cacheControl);let j={};if(f){let i=f.finish();i&&(j.resourceTiming=JSON.parse(JSON.stringify(i)))}d.vectorTile=b.vectorTile,d.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(b,c)=>{if(b||!c)return e(b);e(null,a.extend({rawTileData:k.slice(0)},c,h,j))}),this.loaded=this.loaded||{},this.loaded[c]=d})}reloadTile(d,f){let b=this.loaded,e=d.uid,g=this;if(b&&b[e]){let a=b[e];a.showCollisionBoxes=d.showCollisionBoxes;let c=(c,d)=>{let b=a.reloadCallback;b&&(delete a.reloadCallback,a.parse(a.vectorTile,g.layerIndex,this.availableImages,g.actor,b)),f(c,d)};"parsing"===a.status?a.reloadCallback=c:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,c):c())}}abortTile(c,d){let a=this.loading,b=c.uid;a&&a[b]&&a[b].abort&&(a[b].abort(),delete a[b]),d()}removeTile(c,d){let a=this.loaded,b=c.uid;a&&a[b]&&delete a[b],d()}}class r{constructor(){this.loaded={}}loadTile(e,f){let{uid:c,encoding:g,rawImageData:b}=e,h=a.isImageBitmap(b)?this.getImageData(b):b,d=new a.DEMData(c,h,g);this.loaded=this.loaded||{},this.loaded[c]=d,f(null,d)}getImageData(b){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(b.width,b.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=b.width,this.offscreenCanvas.height=b.height,this.offscreenCanvasContext.drawImage(b,0,0,b.width,b.height);let c=this.offscreenCanvasContext.getImageData(-1,-1,b.width+2,b.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:c.width,height:c.height},c.data)}removeTile(c){let a=this.loaded,b=c.uid;a&&a[b]&&delete a[b]}}var i,s=function e(b,c){var a,d=b&&b.type;if("FeatureCollection"===d)for(a=0;a<b.features.length;a++)e(b.features[a],c);else if("GeometryCollection"===d)for(a=0;a<b.geometries.length;a++)e(b.geometries[a],c);else if("Feature"===d)e(b.geometry,c);else if("Polygon"===d)t(b.coordinates,c);else if("MultiPolygon"===d)for(a=0;a<b.coordinates.length;a++)t(b.coordinates[a],c);return b};function t(a,c){if(0!==a.length){u(a[0],c);for(var b=1;b<a.length;b++)u(a[b],!c)}}function u(a,i){for(var b=0,g=0,c=0,h=a.length,e=h-1;c<h;e=c++){var d=(a[c][0]-a[e][0])*(a[e][1]+a[c][1]),f=b+d;g+=Math.abs(b)>=Math.abs(d)?b-f+d:d-f+b,b=f}b+g>=0!= !!i&&a.reverse()}let v=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class w{constructor(b){this._feature=b,this.extent=a.EXTENT,this.type=b.type,this.properties=b.tags,"id"in b&&!isNaN(b.id)&&(this.id=parseInt(b.id,10))}loadGeometry(){if(1===this._feature.type){let b=[];for(let c of this._feature.geometry)b.push([new a.pointGeometry(c[0],c[1])]);return b}{let d=[];for(let g of this._feature.geometry){let e=[];for(let f of g)e.push(new a.pointGeometry(f[0],f[1]));d.push(e)}return d}}toGeoJSON(a,b,c){return v.call(this,a,b,c)}}class x{constructor(b){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=b.length,this._features=b}feature(a){return new w(this._features[a])}}var b={exports:{}},y=a.pointGeometry,j=a.vectorTile.VectorTileFeature;function e(a,b){this.options=b||{},this.features=a,this.length=a.length}function c(a,b){this.id="number"==typeof a.id?a.id:void 0,this.type=a.type,this.rawGeometry=1===a.type?[a.geometry]:a.geometry,this.properties=a.tags,this.extent=b||4096}e.prototype.feature=function(a){return new c(this.features[a],this.options.extent)},c.prototype.loadGeometry=function(){var d=this.rawGeometry;this.geometry=[];for(var b=0;b<d.length;b++){for(var c=d[b],e=[],a=0;a<c.length;a++)e.push(new y(c[a][0],c[a][1]));this.geometry.push(e)}return this.geometry},c.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var h=this.geometry,b=1/0,c=-1/0,d=1/0,e=-1/0,f=0;f<h.length;f++)for(var i=h[f],g=0;g<i.length;g++){var a=i[g];b=Math.min(b,a.x),c=Math.max(c,a.x),d=Math.min(d,a.y),e=Math.max(e,a.y)}return[b,d,c,e]},c.prototype.toGeoJSON=j.prototype.toGeoJSON;var z=a.pbf,k=e;function f(b){var a=new z;return function(a,b){for(var c in a.layers)b.writeMessage(3,A,a.layers[c])}(b,a),a.finish()}function A(c,b){b.writeVarintField(15,c.version||1),b.writeStringField(1,c.name||""),b.writeVarintField(5,c.extent||4096);var a,d={keys:[],values:[],keycache:{},valuecache:{}};for(a=0;a<c.length;a++)d.feature=c.feature(a),b.writeMessage(2,B,d);var e=d.keys;for(a=0;a<e.length;a++)b.writeStringField(3,e[a]);var f=d.values;for(a=0;a<f.length;a++)b.writeMessage(4,G,f[a])}function B(c,a){var b=c.feature;void 0!==b.id&&a.writeVarintField(1,b.id),a.writeMessage(2,C,c),a.writeVarintField(3,b.type),a.writeMessage(4,F,b)}function C(b,g){var h=b.feature,i=b.keys,j=b.values,k=b.keycache,l=b.valuecache;for(var c in h.properties){var a=h.properties[c],e=k[c];if(null!==a){void 0===e&&(i.push(c),k[c]=e=i.length-1),g.writeVarint(e);var d=typeof a;"string"!==d&&"boolean"!==d&&"number"!==d&&(a=JSON.stringify(a));var m=d+":"+a,f=l[m];void 0===f&&(j.push(a),l[m]=f=j.length-1),g.writeVarint(f)}}}function D(a,b){return(b<<3)+(7&a)}function E(a){return a<<1^a>>31}function F(f,a){for(var g=f.loadGeometry(),d=f.type,h=0,i=0,n=g.length,e=0;e<n;e++){var b=g[e],j=1;1===d&&(j=b.length),a.writeVarint(D(1,j));for(var k=3===d?b.length-1:b.length,c=0;c<k;c++){1===c&&1!==d&&a.writeVarint(D(2,k-1));var l=b[c].x-h,m=b[c].y-i;a.writeVarint(E(l)),a.writeVarint(E(m)),h+=l,i+=m}3===d&&a.writeVarint(D(7,1))}}function G(a,b){var c=typeof a;"string"===c?b.writeStringField(1,a):"boolean"===c?b.writeBooleanField(7,a):"number"===c&&(a%1!=0?b.writeDoubleField(3,a):a<0?b.writeSVarintField(6,a):b.writeVarintField(5,a))}b.exports=f,b.exports.fromVectorTileJs=f,b.exports.fromGeojsonVt=function(d,b){b=b||{};var c={};for(var a in d)c[a]=new k(d[a].features,b),c[a].name=a,c[a].version=b.version,c[a].extent=b.extent;return f({layers:c})},b.exports.GeoJSONWrapper=k;var H=b.exports;function I(c,d,e,a,b,f){if(b-a<=e)return;let g=a+b>>1;J(c,d,g,a,b,f%2),I(c,d,e,a,g-1,f+1),I(c,d,e,g+1,b,f+1)}function J(g,a,e,b,d,h){for(;d>b;){if(d-b>600){let f=d-b+1,l=e-b+1,m=Math.log(f),j=.5*Math.exp(2*m/3),n=.5*Math.sqrt(m*j*(f-j)/f)*(l-f/2<0?-1:1);J(g,a,e,Math.max(b,Math.floor(e-l*j/f+n)),Math.min(d,Math.floor(e+(f-l)*j/f+n)),h)}let k=a[2*e+h],i=b,c=d;for(K(g,a,b,e),a[2*d+h]>k&&K(g,a,b,d);i<c;){for(K(g,a,i,c),i++,c--;a[2*i+h]<k;)i++;for(;a[2*c+h]>k;)c--}a[2*b+h]===k?K(g,a,b,c):K(g,a,++c,d),c<=e&&(b=c+1),e<=c&&(d=c-1)}}function K(d,c,a,b){L(d,a,b),L(c,2*a,2*b),L(c,2*a+1,2*b+1)}function L(a,b,c){let d=a[b];a[b]=a[c],a[c]=d}function M(c,d,e,f){let a=c-e,b=d-f;return a*a+b*b}class N{constructor(b,f=a=>a[0],g=a=>a[1],e=64,h=Float64Array){this.nodeSize=e,this.points=b;let i=b.length<65536?Uint16Array:Uint32Array,c=this.ids=new i(b.length),d=this.coords=new h(2*b.length);for(let a=0;a<b.length;a++)c[a]=a,d[2*a]=f(b[a]),d[2*a+1]=g(b[a]);I(c,d,e,0,c.length-1,0)}range(a,b,c,d){return function(i,f,j,k,l,m,q){let a=[0,i.length-1,0],n=[],b,c;for(;a.length;){let o=a.pop(),g=a.pop(),h=a.pop();if(g-h<=q){for(let d=h;d<=g;d++)b=f[2*d],c=f[2*d+1],b>=j&&b<=l&&c>=k&&c<=m&&n.push(i[d]);continue}let e=Math.floor((h+g)/2);b=f[2*e],c=f[2*e+1],b>=j&&b<=l&&c>=k&&c<=m&&n.push(i[e]);let p=(o+1)%2;(0===o?j<=b:k<=c)&&(a.push(h),a.push(e-1),a.push(p)),(0===o?l>=b:m>=c)&&(a.push(e+1),a.push(g),a.push(p))}return n}(this.ids,this.coords,a,b,c,d,this.nodeSize)}within(a,b,c){return function(j,e,f,g,b,q){let a=[0,j.length-1,0],k=[],o=b*b;for(;a.length;){let l=a.pop(),h=a.pop(),i=a.pop();if(h-i<=q){for(let c=i;c<=h;c++)M(e[2*c],e[2*c+1],f,g)<=o&&k.push(j[c]);continue}let d=Math.floor((i+h)/2),m=e[2*d],n=e[2*d+1];M(m,n,f,g)<=o&&k.push(j[d]);let p=(l+1)%2;(0===l?f-b<=m:g-b<=n)&&(a.push(i),a.push(d-1),a.push(p)),(0===l?f+b>=m:g+b>=n)&&(a.push(d+1),a.push(h),a.push(p))}return k}(this.ids,this.coords,a,b,c,this.nodeSize)}}let O=Math.fround||(i=new Float32Array(1),a=>(i[0]=+a,i[0]));class P{constructor(a){this.options=X(Object.create({minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:a=>a}),a),this.trees=Array(this.options.maxZoom+1)}load(b){let{log:c,minZoom:i,maxZoom:f,nodeSize:g}=this.options;c&&console.time("total time");let h=`prepare ${b.length} points`;c&&console.time(h),this.points=b;let a=[];for(let d=0;d<b.length;d++)b[d].geometry&&a.push(R(b[d],d));this.trees[f+1]=new N(a,Y,Z,g,Float32Array),c&&console.timeEnd(h);for(let e=f;e>=i;e--){let j=+Date.now();a=this._cluster(a,e),this.trees[e]=new N(a,Y,Z,g,Float32Array),c&&console.log("z%d: %d clusters in %dms",e,a.length,+Date.now()-j)}return c&&console.timeEnd("total time"),this}getClusters(a,d){let b=((a[0]+180)%360+360)%360-180,e=Math.max(-90,Math.min(90,a[1])),c=180===a[2]?180:((a[2]+180)%360+360)%360-180,f=Math.max(-90,Math.min(90,a[3]));if(a[2]-a[0]>=360)b=-180,c=180;else if(b>c){let j=this.getClusters([b,e,180,f],d),k=this.getClusters([-180,e,c,f],d);return j.concat(k)}let h=this.trees[this._limitZoom(d)],l=h.range(U(b),V(f),U(c),V(e)),i=[];for(let m of l){let g=h.points[m];i.push(g.numPoints?S(g):this.points[g.index])}return i}getChildren(c){let h=this._getOriginId(c),g=this._getOriginZoom(c),d="No cluster with the specified id.",a=this.trees[g];if(!a)throw Error(d);let e=a.points[h];if(!e)throw Error(d);let i=this.options.radius/(this.options.extent*Math.pow(2,g-1)),j=a.within(e.x,e.y,i),f=[];for(let k of j){let b=a.points[k];b.parentId===c&&f.push(b.numPoints?S(b):this.points[b.index])}if(0===f.length)throw Error(d);return f}getLeaves(d,a,b){let c=[];return this._appendLeaves(c,d,a=a||10,b=b||0,0),c}getTile(i,d,e){let b=this.trees[this._limitZoom(i)],a=Math.pow(2,i),{extent:j,radius:k}=this.options,c=k/j,g=(e-c)/a,h=(e+1+c)/a,f={features:[]};return this._addTileFeatures(b.range((d-c)/a,g,(d+1+c)/a,h),b.points,d,e,a,f),0===d&&this._addTileFeatures(b.range(1-c/a,g,1,h),b.points,a,e,a,f),d===a-1&&this._addTileFeatures(b.range(0,g,c/a,h),b.points,-1,e,a,f),f.features.length?f:null}getClusterExpansionZoom(a){let b=this._getOriginZoom(a)-1;for(;b<=this.options.maxZoom;){let c=this.getChildren(a);if(b++,1!==c.length)break;a=c[0].properties.cluster_id}return b}_appendLeaves(c,g,e,d,a){let h=this.getChildren(g);for(let f of h){let b=f.properties;if(b&&b.cluster?a+b.point_count<=d?a+=b.point_count:a=this._appendLeaves(c,b.cluster_id,e,d,a):a<d?a++:c.push(f),c.length===e)break}return a}_addTileFeatures(j,k,l,m,g,n){for(let o of j){let a=k[o],h=a.numPoints,c,d,e;if(h)c=T(a),d=a.x,e=a.y;else{let f=this.points[a.index];c=f.properties,d=U(f.geometry.coordinates[0]),e=V(f.geometry.coordinates[1])}let i={type:1,geometry:[[Math.round(this.options.extent*(d*g-l)),Math.round(this.options.extent*(e*g-m))]],tags:c},b;h?b=a.id:this.options.generateId?b=a.index:this.points[a.index].id&&(b=this.points[a.index].id),void 0!==b&&(i.id=b),n.features.push(i)}}_limitZoom(a){return Math.max(this.options.minZoom,Math.min(+a,this.options.maxZoom+1))}_cluster(n,b){let f=[],{radius:s,extent:t,reduce:j,minPoints:u}=this.options,v=s/(t*Math.pow(2,b));for(let g=0;g<n.length;g++){let a=n[g];if(a.zoom<=b)continue;a.zoom=b;let h=this.trees[b+1],k=h.within(a.x,a.y,v),e=a.numPoints||1,c=e;for(let w of k){let o=h.points[w];o.zoom>b&&(c+=o.numPoints||1)}if(c>e&&c>=u){let p=a.x*e,q=a.y*e,i=j&&e>1?this._map(a,!0):null,l=(g<<5)+(b+1)+this.points.length;for(let x of k){let d=h.points[x];if(d.zoom<=b)continue;d.zoom=b;let r=d.numPoints||1;p+=d.x*r,q+=d.y*r,d.parentId=l,j&&(i||(i=this._map(a,!0)),j(i,this._map(d)))}a.parentId=l,f.push(Q(p/c,q/c,l,c,i))}else if(f.push(a),c>1)for(let y of k){let m=h.points[y];m.zoom<=b||(m.zoom=b,f.push(m))}}return f}_getOriginId(a){return a-this.points.length>>5}_getOriginZoom(a){return(a-this.points.length)%32}_map(a,c){if(a.numPoints)return c?X({},a.properties):a.properties;let d=this.points[a.index].properties,b=this.options.map(d);return c&&b===d?X({},b):b}}function Q(a,b,c,d,e){return{x:O(a),y:O(b),zoom:1/0,id:c,parentId:-1,numPoints:d,properties:e}}function R(a,b){let[c,d]=a.geometry.coordinates;return{x:O(U(c)),y:O(V(d)),zoom:1/0,index:b,parentId:-1}}function S(a){var b;return{type:"Feature",id:a.id,properties:T(a),geometry:{type:"Point",coordinates:[360*(a.x-.5),W(a.y)]}}}function T(b){let a=b.numPoints,c=a>=1e4?`${Math.round(a/1e3)}k`:a>=1e3?Math.round(a/100)/10+"k":a;return X(X({},b.properties),{cluster:!0,cluster_id:b.id,point_count:a,point_count_abbreviated:c})}function U(a){return a/360+.5}function V(c){let b=Math.sin(c*Math.PI/180),a=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return a<0?0:a>1?1:a}function W(a){return 360*Math.atan(Math.exp((180-360*a)*Math.PI/180))/Math.PI-90}function X(a,b){for(let c in b)a[c]=b[c];return a}function Y(a){return a.x}function Z(a){return a.y}function $(a,b,c,g){for(var d,f=g,k=c-b>>1,i=c-b,l=a[b],m=a[b+1],n=a[c],o=a[c+1],e=b+3;e<c;e+=3){var h=_(a[e],a[e+1],l,m,n,o);if(h>f)d=e,f=h;else if(h===f){var j=Math.abs(e-k);j<i&&(d=e,i=j)}}f>g&&(d-b>3&&$(a,b,d,g),a[d+2]=f,c-d>3&&$(a,d,c,g))}function _(f,g,c,d,h,i){var a=h-c,b=i-d;if(0!==a||0!==b){var e=((f-c)*a+(g-d)*b)/(a*a+b*b);e>1?(c=h,d=i):e>0&&(c+=a*e,d+=b*e)}return(a=f-c)*a+(b=g-d)*b}function aa(a,c,d,e){var b={id:void 0===a?null:a,type:c,geometry:d,tags:e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(d){var b=d.geometry,c=d.type;if("Point"===c||"MultiPoint"===c||"LineString"===c)ab(d,b);else if("Polygon"===c||"MultiLineString"===c)for(var a=0;a<b.length;a++)ab(d,b[a]);else if("MultiPolygon"===c)for(a=0;a<b.length;a++)for(var e=0;e<b[a].length;e++)ab(d,b[a][e])}(b),b}function ab(a,c){for(var b=0;b<c.length;b+=3)a.minX=Math.min(a.minX,c[b]),a.minY=Math.min(a.minY,c[b+1]),a.maxX=Math.max(a.maxX,c[b]),a.maxY=Math.max(a.maxY,c[b+1])}function ac(i,b,e,j){if(b.geometry){var c=b.geometry.coordinates,f=b.geometry.type,g=Math.pow(e.tolerance/((1<<e.maxZoom)*e.extent),2),d=[],h=b.id;if(e.promoteId?h=b.properties[e.promoteId]:e.generateId&&(h=j||0),"Point"===f)ad(c,d);else if("MultiPoint"===f)for(var a=0;a<c.length;a++)ad(c[a],d);else if("LineString"===f)ae(c,d,g,!1);else if("MultiLineString"===f){if(e.lineMetrics){for(a=0;a<c.length;a++)ae(c[a],d=[],g,!1),i.push(aa(h,"LineString",d,b.properties));return}af(c,d,g,!1)}else if("Polygon"===f)af(c,d,g,!0);else{if("MultiPolygon"!==f){if("GeometryCollection"===f){for(a=0;a<b.geometry.geometries.length;a++)ac(i,{id:h,geometry:b.geometry.geometries[a],properties:b.properties},e,j);return}throw Error("Input data is not a valid GeoJSON object.")}for(a=0;a<c.length;a++){var k=[];af(c[a],k,g,!0),d.push(k)}}i.push(aa(h,f,d,b.properties))}}function ad(b,a){a.push(ag(b[0])),a.push(ah(b[1])),a.push(0)}function ae(e,a,j,k){for(var f,g,h=0,b=0;b<e.length;b++){var c=ag(e[b][0]),d=ah(e[b][1]);a.push(c),a.push(d),a.push(0),b>0&&(h+=k?(f*d-c*g)/2:Math.sqrt(Math.pow(c-f,2)+Math.pow(d-g,2))),f=c,g=d}var i=a.length-3;a[2]=1,$(a,0,i,j),a[i+2]=1,a.size=Math.abs(h),a.start=0,a.end=a.size}function af(b,d,e,f){for(var a=0;a<b.length;a++){var c=[];ae(b[a],c,e,f),d.push(c)}}function ag(a){return a/360+.5}function ah(c){var b=Math.sin(c*Math.PI/180),a=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return a<0?0:a>1?1:a}function ai(j,m,e,d,f,n,o,p){if(d/=m,n>=(e/=m)&&o<d)return j;if(o<e||n>=d)return null;for(var i=[],k=0;k<j.length;k++){var c=j[k],h=c.geometry,a=c.type,q=0===f?c.minX:c.minY,r=0===f?c.maxX:c.maxY;if(q>=e&&r<d)i.push(c);else if(!(r<e||q>=d)){var b=[];if("Point"===a||"MultiPoint"===a)aj(h,b,e,d,f);else if("LineString"===a)ak(h,b,e,d,f,!1,p.lineMetrics);else if("MultiLineString"===a)am(h,b,e,d,f,!1);else if("Polygon"===a)am(h,b,e,d,f,!0);else if("MultiPolygon"===a)for(var g=0;g<h.length;g++){var l=[];am(h[g],l,e,d,f,!0),l.length&&b.push(l)}if(b.length){if(p.lineMetrics&&"LineString"===a){for(g=0;g<b.length;g++)i.push(aa(c.id,a,b[g],c.tags));continue}"LineString"!==a&&"MultiLineString"!==a||(1===b.length?(a="LineString",b=b[0]):a="MultiLineString"),"Point"!==a&&"MultiPoint"!==a||(a=3===b.length?"Point":"MultiPoint"),i.push(aa(c.id,a,b,c.tags))}}}return i.length?i:null}function aj(b,c,e,f,g){for(var a=0;a<b.length;a+=3){var d=b[a+g];d>=e&&d<=f&&(c.push(b[a]),c.push(b[a+1]),c.push(b[a+2]))}}function ak(b,u,e,f,o,v,m){for(var n,g,a=al(b),p=0===o?ao:ap,q=b.start,h=0;h<b.length-3;h+=3){var c=b[h],d=b[h+1],s=b[h+2],j=b[h+3],k=b[h+4],l=0===o?c:d,r=0===o?j:k,t=!1;m&&(n=Math.sqrt(Math.pow(c-j,2)+Math.pow(d-k,2))),l<e?r>e&&(g=p(a,c,d,j,k,e),m&&(a.start=q+n*g)):l>f?r<f&&(g=p(a,c,d,j,k,f),m&&(a.start=q+n*g)):an(a,c,d,s),r<e&&l>=e&&(g=p(a,c,d,j,k,e),t=!0),r>f&&l<=f&&(g=p(a,c,d,j,k,f),t=!0),!v&&t&&(m&&(a.end=q+n*g),u.push(a),a=al(b)),m&&(q+=n)}var i=b.length-3;c=b[i],d=b[i+1],s=b[i+2],(l=0===o?c:d)>=e&&l<=f&&an(a,c,d,s),i=a.length-3,v&&i>=3&&(a[i]!==a[0]||a[i+1]!==a[1])&&an(a,a[0],a[1],a[2]),a.length&&u.push(a)}function al(b){var a=[];return a.size=b.size,a.start=b.start,a.end=b.end,a}function am(b,c,d,e,f,g){for(var a=0;a<b.length;a++)ak(b[a],c,d,e,f,g,!1)}function an(a,b,c,d){a.push(b),a.push(c),a.push(d)}function ao(a,b,c,f,g,d){var e=(d-b)/(f-b);return a.push(d),a.push(c+(g-c)*e),a.push(1),e}function ap(a,b,c,f,g,d){var e=(d-c)/(g-c);return a.push(b+(f-b)*e),a.push(d),a.push(1),e}function aq(h,e){for(var i=[],f=0;f<h.length;f++){var d,a=h[f],c=a.type;if("Point"===c||"MultiPoint"===c||"LineString"===c)d=ar(a.geometry,e);else if("MultiLineString"===c||"Polygon"===c){d=[];for(var b=0;b<a.geometry.length;b++)d.push(ar(a.geometry[b],e))}else if("MultiPolygon"===c)for(d=[],b=0;b<a.geometry.length;b++){for(var j=[],g=0;g<a.geometry[b].length;g++)j.push(ar(a.geometry[b][g],e));d.push(j)}i.push(aa(a.id,c,d,a.tags))}return i}function ar(a,d){var b=[];b.size=a.size,void 0!==a.start&&(b.start=a.start,b.end=a.end);for(var c=0;c<a.length;c+=3)b.push(a[c]+d,a[c+1],a[c+2]);return b}function as(b,g){if(b.transformed)return b;var f,a,d,h=1<<b.z,i=b.x,j=b.y;for(f=0;f<b.features.length;f++){var e=b.features[f],c=e.geometry,l=e.type;if(e.geometry=[],1===l)for(a=0;a<c.length;a+=2)e.geometry.push(at(c[a],c[a+1],g,h,i,j));else for(a=0;a<c.length;a++){var k=[];for(d=0;d<c[a].length;d+=2)k.push(at(c[a][d],c[a][d+1],g,h,i,j));e.geometry.push(k)}}return b.transformed=!0,b}function at(c,d,a,b,e,f){return[Math.round(a*(c*b-e)),Math.round(a*(d*b-f))]}function au(c,e,j,k,d){for(var l=e===d.maxZoom?0:d.tolerance/((1<<e)*d.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:k,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},b=0;b<c.length;b++){a.numFeatures++,av(a,c[b],l,d);var f=c[b].minX,g=c[b].minY,h=c[b].maxX,i=c[b].maxY;f<a.minX&&(a.minX=f),g<a.minY&&(a.minY=g),h>a.maxX&&(a.maxX=h),i>a.maxY&&(a.maxY=i)}return a}function av(f,d,h,m){var b=d.geometry,c=d.type,e=[];if("Point"===c||"MultiPoint"===c)for(var a=0;a<b.length;a+=3)e.push(b[a]),e.push(b[a+1]),f.numPoints++,f.numSimplified++;else if("LineString"===c)aw(e,b,f,h,!1,!1);else if("MultiLineString"===c||"Polygon"===c)for(a=0;a<b.length;a++)aw(e,b[a],f,h,"Polygon"===c,0===a);else if("MultiPolygon"===c)for(var i=0;i<b.length;i++){var j=b[i];for(a=0;a<j.length;a++)aw(e,j[a],f,h,!0,0===a)}if(e.length){var g=d.tags||null;if("LineString"===c&&m.lineMetrics){for(var k in g={},d.tags)g[k]=d.tags[k];g.mapbox_clip_start=b.start/b.size,g.mapbox_clip_end=b.end/b.size}var l={geometry:e,type:"Polygon"===c||"MultiPolygon"===c?3:"LineString"===c||"MultiLineString"===c?2:1,tags:g};null!==d.id&&(l.id=d.id),f.features.push(l)}}function aw(h,a,e,b,f,i){var g=b*b;if(b>0&&a.size<(f?g:b))e.numPoints+=a.length/3;else{for(var d=[],c=0;c<a.length;c+=3)(0===b||a[c+2]>g)&&(e.numSimplified++,d.push(a[c]),d.push(a[c+1])),e.numPoints++;f&&function(b,f){for(var e=0,a=0,c=b.length,d=c-2;a<c;d=a,a+=2)e+=(b[a]-b[d])*(b[a+1]+b[d+1]);if(e>0===f)for(a=0,c=b.length;a<c/2;a+=2){var g=b[a],h=b[a+1];b[a]=b[c-2-a],b[a+1]=b[c-1-a],b[c-2-a]=g,b[c-1-a]=h}}(d,i),h.push(d)}}function d(j,a){var i=(a=this.options=function(a,b){for(var c in b)a[c]=b[c];return a}(Object.create(this.options),a)).debug;if(i&&console.time("preprocess data"),a.maxZoom<0||a.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(a.promoteId&&a.generateId)throw Error("promoteId and generateId cannot be used together.");var d,e,b,c,f,g,h=function(a,d){var c=[];if("FeatureCollection"===a.type)for(var b=0;b<a.features.length;b++)ac(c,a.features[b],d,b);else ac(c,"Feature"===a.type?a:{geometry:a},d);return c}(j,a);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",a.indexMaxZoom,a.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(h=(d=h,b=(e=a).buffer/e.extent,c=d,f=ai(d,1,-1-b,b,0,-1,2,e),g=ai(d,1,1-b,2+b,0,-1,2,e),(f||g)&&(c=ai(d,1,-b,1+b,0,-1,2,e)||[],f&&(c=aq(f,1).concat(c)),g&&(c=c.concat(aq(g,-1)))),c)).length&&this.splitTile(h,0,0,0),i&&(h.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ax(a,b,c){return 32*((1<<a)*c+b)+a}d.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},d.prototype.splitTile=function(g,c,d,b,m,x,y){for(var f=[g,c,d,b],e=this.options,j=e.debug;f.length;){b=f.pop(),d=f.pop(),c=f.pop(),g=f.pop();var h=1<<c,u=ax(c,d,b),a=this.tiles[u];if(!a&&(j>1&&console.time("creation"),a=this.tiles[u]=au(g,c,d,b,e),this.tileCoords.push({z:c,x:d,y:b}),j)){j>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",c,d,b,a.numFeatures,a.numPoints,a.numSimplified),console.timeEnd("creation"));var v="z"+c;this.stats[v]=(this.stats[v]||0)+1,this.total++}if(a.source=g,m){if(c===e.maxZoom||c===m)continue;var w=1<<m-c;if(d!==Math.floor(x/w)||b!==Math.floor(y/w))continue}else if(c===e.indexMaxZoom||a.numPoints<=e.indexMaxPoints)continue;if(a.source=null,0!==g.length){j>1&&console.time("clipping");var n,o,p,q,k,l,i=.5*e.buffer/e.extent,r=.5-i,s=.5+i,t=1+i;n=o=p=q=null,k=ai(g,h,d-i,d+s,0,a.minX,a.maxX,e),l=ai(g,h,d+r,d+t,0,a.minX,a.maxX,e),g=null,k&&(n=ai(k,h,b-i,b+s,1,a.minY,a.maxY,e),o=ai(k,h,b+r,b+t,1,a.minY,a.maxY,e),k=null),l&&(p=ai(l,h,b-i,b+s,1,a.minY,a.maxY,e),q=ai(l,h,b+r,b+t,1,a.minY,a.maxY,e),l=null),j>1&&console.timeEnd("clipping"),f.push(n||[],c+1,2*d,2*b),f.push(o||[],c+1,2*d,2*b+1),f.push(p||[],c+1,2*d+1,2*b),f.push(q||[],c+1,2*d+1,2*b+1)}}},d.prototype.getTile=function(a,b,g){var k=this.options,l=k.extent,h=k.debug;if(a<0||a>24)return null;var j=1<<a,i=ax(a,b=(b%j+j)%j,g);if(this.tiles[i])return as(this.tiles[i],l);h>1&&console.log("drilling down to z%d-%d-%d",a,b,g);for(var c,d=a,e=b,f=g;!c&&d>0;)d--,e=Math.floor(e/2),f=Math.floor(f/2),c=this.tiles[ax(d,e,f)];return c&&c.source?(h>1&&console.log("found parent tile z%d-%d-%d",d,e,f),h>1&&console.time("drilling down"),this.splitTile(c.source,d,e,f,a,b,g),h>1&&console.timeEnd("drilling down"),this.tiles[i]?as(this.tiles[i],l):null):null};class g{constructor(b){this.self=b,this.actor=new a.Actor(b,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:q,geojson:class extends q{constructor(b,c,d,a){super(b,c,d,function(f,b){let c=f.tileID.canonical;if(!this._geoJSONIndex)return b(null,null);let d=this._geoJSONIndex.getTile(c.z,c.x,c.y);if(!d)return b(null,null);let e=new x(d.features),a=H(e);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),b(null,{vectorTile:e,rawData:a.buffer})}),a&&(this.loadGeoJSON=a)}loadData(a,b){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=b,this._pendingLoadDataParams=a,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;let c=this._pendingCallback,b=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;let e=!!(b&&b.request&&b.request.collectResourceTiming)&&new a.RequestPerformance(b.request);this.loadGeoJSON(b,(h,f)=>{if(h||!f)return c(h);if("object"!=typeof f)return c(Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));{s(f,!0);try{var i,j;if(b.filter){let k=a.createExpression(b.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===k.result)throw Error(k.value.map(a=>`${a.key}: ${a.message}`).join(", "));let m=f.features.filter(a=>k.value.evaluate({zoom:0},a));f={type:"FeatureCollection",features:m}}this._geoJSONIndex=b.cluster?new P(function({superclusterOptions:b,clusterProperties:d}){if(!d||!b)return b;let f={},g={},l={accumulated:null,zoom:0},m={properties:null},h=Object.keys(d);for(let c of h){let[e,i]=d[c],j=a.createExpression(i),k=a.createExpression("string"==typeof e?[e,["accumulated"],["get",c]]:e);f[c]=j.value,g[c]=k.value}return b.map=c=>{m.properties=c;let a={};for(let b of h)a[b]=f[b].evaluate(l,m);return a},b.reduce=(b,c)=>{for(let a of(m.properties=c,h))l.accumulated=b[a],b[a]=g[a].evaluate(l,m)},b}(b)).load(f.features):(i=f,j=b.geojsonVtOptions,new d(i,j))}catch(n){return c(n)}this.loaded={};let g={};if(e){let l=e.finish();l&&(g.resourceTiming={},g.resourceTiming[b.source]=JSON.parse(JSON.stringify(l)))}c(null,g)}})}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(a,b){let c=this.loaded;return c&&c[a.uid]?super.reloadTile(a,b):this.loadTile(a,b)}loadGeoJSON(b,c){if(b.request)a.getJSON(b.request,c);else{if("string"!=typeof b.data)return c(Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`));try{return c(null,JSON.parse(b.data))}catch(d){return c(Error(`Input data given to '${b.source}' is not a valid GeoJSON object.`))}}}removeSource(b,a){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),a()}getClusterExpansionZoom(b,a){try{a(null,this._geoJSONIndex.getClusterExpansionZoom(b.clusterId))}catch(c){a(c)}}getClusterChildren(b,a){try{a(null,this._geoJSONIndex.getChildren(b.clusterId))}catch(c){a(c)}}getClusterLeaves(a,b){try{b(null,this._geoJSONIndex.getLeaves(a.clusterId,a.limit,a.offset))}catch(c){b(c)}}}},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(a,b)=>{if(this.workerSourceTypes[a])throw Error(`Worker source with name "${a}" already registered.`);this.workerSourceTypes[a]=b},this.self.registerRTLTextPlugin=b=>{if(a.plugin.isParsed())throw Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=b.applyArabicShaping,a.plugin.processBidirectionalText=b.processBidirectionalText,a.plugin.processStyledBidirectionalText=b.processStyledBidirectionalText}}setReferrer(b,a){this.referrer=a}setImages(a,b,d){for(let e in this.availableImages[a]=b,this.workerSources[a]){let c=this.workerSources[a][e];for(let f in c)c[f].availableImages=b}d()}setLayers(a,b,c){this.getLayerIndex(a).replace(b),c()}updateLayers(b,a,c){this.getLayerIndex(b).update(a.layers,a.removedIds),c()}loadTile(b,a,c){this.getWorkerSource(b,a.type,a.source).loadTile(a,c)}loadDEMTile(b,a,c){this.getDEMWorkerSource(b,a.source).loadTile(a,c)}reloadTile(b,a,c){this.getWorkerSource(b,a.type,a.source).reloadTile(a,c)}abortTile(b,a,c){this.getWorkerSource(b,a.type,a.source).abortTile(a,c)}removeTile(b,a,c){this.getWorkerSource(b,a.type,a.source).removeTile(a,c)}removeDEMTile(b,a){this.getDEMWorkerSource(b,a.source).removeTile(a)}removeSource(b,a,c){if(!this.workerSources[b]||!this.workerSources[b][a.type]||!this.workerSources[b][a.type][a.source])return;let d=this.workerSources[b][a.type][a.source];delete this.workerSources[b][a.type][a.source],void 0!==d.removeSource?d.removeSource(a,c):c()}loadWorkerSource(d,b,a){try{this.self.importScripts(b.url),a()}catch(c){a(c.toString())}}syncRTLPluginState(g,e,c){try{a.plugin.setState(e);let b=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&null!=b){this.self.importScripts(b);let d=a.plugin.isParsed();c(d?void 0:Error(`RTL Text Plugin failed to import scripts from ${b}`),d)}}catch(f){c(f.toString())}}getAvailableImages(b){let a=this.availableImages[b];return a||(a=[]),a}getLayerIndex(b){let a=this.layerIndexes[b];return a||(a=this.layerIndexes[b]=new n),a}getWorkerSource(a,b,c){if(this.workerSources[a]||(this.workerSources[a]={}),this.workerSources[a][b]||(this.workerSources[a][b]={}),!this.workerSources[a][b][c]){let d={send:(b,c,d)=>{this.actor.send(b,c,d,a)}};this.workerSources[a][b][c]=new this.workerSourceTypes[b](d,this.getLayerIndex(a),this.getAvailableImages(a))}return this.workerSources[a][b][c]}getDEMWorkerSource(a,b){return this.demWorkerSources[a]||(this.demWorkerSources[a]={}),this.demWorkerSources[a][b]||(this.demWorkerSources[a][b]=new r),this.demWorkerSources[a][b]}enforceCacheSizeLimit(c,b){a.enforceCacheSizeLimit(b)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new g(self)),g}),a(["./shared"],function(a){var y=z;function z(c){var b,a;return b=c,"undefined"!=typeof window&&"undefined"!=typeof document&& !!Array.prototype&&!!Array.prototype.every&&!!Array.prototype.filter&&!!Array.prototype.forEach&&!!Array.prototype.indexOf&&!!Array.prototype.lastIndexOf&&!!Array.prototype.map&&!!Array.prototype.some&&!!Array.prototype.reduce&&!!Array.prototype.reduceRight&&!!Array.isArray&& !!Function.prototype&&!!Function.prototype.bind&& !!Object.keys&&!!Object.create&&!!Object.getPrototypeOf&&!!Object.getOwnPropertyNames&&!!Object.isSealed&&!!Object.isFrozen&&!!Object.isExtensible&&!!Object.getOwnPropertyDescriptor&&!!Object.defineProperty&&!!Object.defineProperties&&!!Object.seal&&!!Object.freeze&&!!Object.preventExtensions&& !!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)&& !!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,b,d=new Blob([""],{type:"text/javascript"}),c=URL.createObjectURL(d);try{b=new Worker(c),a=!0}catch(e){a=!1}return b&&b.terminate(),URL.revokeObjectURL(c),a}()&&"Uint8ClampedArray"in window&& !!ArrayBuffer.isView&& !!function(){var a=document.createElement("canvas");a.width=a.height=1;var b=a.getContext("2d");if(!b)return!1;var c=b.getImageData(0,0,1,1);return c&&c.width===a.width}()&&(void 0===H[a=b&&b.failIfMajorPerformanceCaveat]&&(H[a]=function(f){var e,c,d,b,a=(e=f,c=document.createElement("canvas"),(d=Object.create(z.webGLContextAttributes)).failIfMajorPerformanceCaveat=e,c.getContext("webgl",d)||c.getContext("experimental-webgl",d));if(!a)return!1;try{b=a.createShader(a.VERTEX_SHADER)}catch(g){return!1}return!(!b||a.isContextLost())&&(a.shaderSource(b,"void main() {}"),a.compileShader(b),!0===a.getShaderParameter(b,a.COMPILE_STATUS))}(a)),!!H[a]&&!document.documentMode)}var H={};function I(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!I(a[c],b[c]))return!1;return!0}if("object"==typeof a&&null!==a&&null!==b){if("object"!=typeof b||Object.keys(a).length!==Object.keys(b).length)return!1;for(let d in a)if(!I(a[d],b[d]))return!1;return!0}return a===b}z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class c{static testProp(a){if(!c.docStyle)return a[0];for(let b=0;b<a.length;b++)if(a[b]in c.docStyle)return a[b];return a[0]}static create(d,b,c){let a=window.document.createElement(d);return void 0!==b&&(a.className=b),c&&c.appendChild(a),a}static createNS(a,b){return window.document.createElementNS(a,b)}static disableDrag(){c.docStyle&&c.selectProp&&(c.userSelect=c.docStyle[c.selectProp],c.docStyle[c.selectProp]="none")}static enableDrag(){c.docStyle&&c.selectProp&&(c.docStyle[c.selectProp]=c.userSelect)}static setTransform(a,b){a.style[c.transformProp]=b}static addEventListener(b,c,d,a={}){b.addEventListener(c,d,"passive"in a?a:a.capture)}static removeEventListener(b,c,d,a={}){b.removeEventListener(c,d,"passive"in a?a:a.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",c.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",c.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",c.suppressClickInternal,!0)},0)}static mousePos(b,c){let d=b.getBoundingClientRect();return new a.pointGeometry(c.clientX-d.left-b.clientLeft,c.clientY-d.top-b.clientTop)}static touchPos(c,d){let e=c.getBoundingClientRect(),f=[];for(let b=0;b<d.length;b++)f.push(new a.pointGeometry(d[b].clientX-e.left-c.clientLeft,d[b].clientY-e.top-c.clientTop));return f}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}c.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,c.selectProp=c.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),c.transformProp=c.testProp(["transform","WebkitTransform"]);let J=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(c){var b=new a.ARRAY_TYPE(3);return b[0]=c[0],b[1]=c[1],b[2]=c[2],b}var e,L=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a};e=new a.ARRAY_TYPE(3),a.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0);var j,M=function(a){var b=a[0],c=a[1];return b*b+c*c};j=new a.ARRAY_TYPE(2),a.ARRAY_TYPE!=Float32Array&&(j[0]=0,j[1]=0);class N{constructor(a,b,c,d){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(b,d)}update(c,d,h){let{width:e,height:f}=c,k=!(this.size&&this.size[0]===e&&this.size[1]===f||h),{context:g}=this,{gl:b}=g;if(this.useMipmap=Boolean(d&&d.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!d|| !1!==d.premultiply)),k)this.size=[e,f],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||a.isImageBitmap(c)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,c):b.texImage2D(b.TEXTURE_2D,0,this.format,e,f,0,this.format,b.UNSIGNED_BYTE,c.data);else{let{x:i,y:j}=h||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||a.isImageBitmap(c)?b.texSubImage2D(b.TEXTURE_2D,0,i,j,b.RGBA,b.UNSIGNED_BYTE,c):b.texSubImage2D(b.TEXTURE_2D,0,i,j,e,f,b.RGBA,b.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(b,c,d){let{context:e}=this,{gl:a}=e;a.bindTexture(a.TEXTURE_2D,this.texture),d!==a.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=a.LINEAR),b!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d||b),this.filter=b),c!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function O(b){let{userImage:a}=b;return!!(a&&a.render&&a.render())&&(b.data.replace(new Uint8Array(a.data.buffer)),!0)}class P extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(let{ids:b,callback:c}of this.requestors)this._notify(b,c);this.requestors=[]}}getImage(a){return this.images[a]}addImage(a,b){this._validate(a,b)&&(this.images[a]=b)}_validate(d,b){let c=!0;return this._validateStretch(b.stretchX,b.data&&b.data.width)||(this.fire(new a.ErrorEvent(Error(`Image "${d}" has invalid "stretchX" value`))),c=!1),this._validateStretch(b.stretchY,b.data&&b.data.height)||(this.fire(new a.ErrorEvent(Error(`Image "${d}" has invalid "stretchY" value`))),c=!1),this._validateContent(b.content,b)||(this.fire(new a.ErrorEvent(Error(`Image "${d}" has invalid "content" value`))),c=!1),c}_validateStretch(b,d){if(!b)return!0;let c=0;for(let a of b){if(a[0]<c||a[1]<a[0]||d<a[1])return!1;c=a[1]}return!0}_validateContent(a,b){return!(a&&(4!==a.length||a[0]<0||b.data.width<a[0]||a[1]<0||b.data.height<a[1]||a[2]<0||b.data.width<a[2]||a[3]<0||b.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,b){b.version=this.images[a].version+1,this.images[a]=b,this.updatedImages[a]=!0}removeImage(a){let b=this.images[a];delete this.images[a],delete this.patterns[a],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,b){let c=!0;if(!this.isLoaded())for(let d of a)this.images[d]||(c=!1);this.isLoaded()||c?this._notify(a,b):this.requestors.push({ids:a,callback:b})}_notify(e,f){let d={};for(let c of e){this.images[c]||this.fire(new a.Event("styleimagemissing",{id:c}));let b=this.images[c];b?d[c]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:a.warnOnce(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,d)}getPixelSize(){let{width:a,height:b}=this.atlasImage;return{width:a,height:b}}getPattern(d){let c=this.patterns[d],b=this.getImage(d);if(!b)return null;if(c&&c.position.version===b.version)return c.position;if(c)c.position.version=b.version;else{let e={w:b.data.width+2,h:b.data.height+2,x:0,y:0},f=new a.ImagePosition(e,b);this.patterns[d]={bin:e,position:f}}return this._updatePatternAtlas(),this.patterns[d].position}bind(b){let a=b.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new N(b,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){let h=[];for(let k in this.patterns)h.push(this.patterns[k].bin);let{w:l,h:m}=a.potpack(h),c=this.atlasImage;for(let i in c.resize({width:l||1,height:m||1}),this.patterns){let{bin:j}=this.patterns[i],d=j.x+1,e=j.y+1,b=this.images[i].data,f=b.width,g=b.height;a.RGBAImage.copy(b,c,{x:0,y:0},{x:d,y:e},{width:f,height:g}),a.RGBAImage.copy(b,c,{x:0,y:g-1},{x:d,y:e-1},{width:f,height:1}),a.RGBAImage.copy(b,c,{x:0,y:0},{x:d,y:e+g},{width:f,height:1}),a.RGBAImage.copy(b,c,{x:f-1,y:0},{x:d-1,y:e},{width:1,height:g}),a.RGBAImage.copy(b,c,{x:0,y:0},{x:d+f,y:e},{width:1,height:g})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(let a of c){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;let b=this.images[a];O(b)&&this.updateImage(a,b)}}}function Q(f,a,b,g,h,c,i,j,k){for(let d=a;d<a+g;d++)R(f,b*c+d,c,h,i,j,k);for(let e=b;e<b+h;e++)R(f,e*c+a,1,g,i,j,k)}function R(h,i,l,m,d,f,b){f[0]=0,b[0]=-1e20,b[1]=1e20,d[0]=h[i];for(let a=1,c=0,j=0;a<m;a++){d[a]=h[i+a*l];let p=a*a;do{let g=f[c];j=(d[a]-d[g]+p-g*g)/(a-g)/2}while(j<=b[c]&& --c> -1)f[++c]=a,b[c]=j,b[c+1]=1e20}for(let e=0,k=0;e<m;e++){for(;b[k+1]<e;)k++;let n=f[k],o=e-n;h[i+e*l]=d[n]+o*o}}class o{constructor(a,b){this.requestManager=a,this.localIdeographFontFamily=b,this.entries={}}setURL(a){this.url=a}getGlyphs(b,f){let c=[];for(let d in b)for(let e of b[d])c.push({stack:d,id:e});a.asyncAll(c,({stack:b,id:c},f)=>{let a=this.entries[b];a||(a=this.entries[b]={glyphs:{},requests:{},ranges:{}});let d=a.glyphs[c];if(void 0!==d)return void f(null,{stack:b,id:c,glyph:d});if(d=this._tinySDF(a,b,c))return a.glyphs[c]=d,void f(null,{stack:b,id:c,glyph:d});let e=Math.floor(c/256);if(256*e>65535)return void f(Error("glyphs > 65535 not supported"));if(a.ranges[e])return void f(null,{stack:b,id:c,glyph:d});let g=a.requests[e];g||(g=a.requests[e]=[],o.loadGlyphRange(b,e,this.url,this.requestManager,(d,b)=>{if(b){for(let c in b)this._doesCharSupportLocalGlyph(+c)||(a.glyphs[+c]=b[+c]);a.ranges[e]=!0}for(let f of g)f(d,b);delete a.requests[e]})),g.push((a,d)=>{a?f(a):d&&f(null,{stack:b,id:c,glyph:d[c]||null})})},(c,d)=>{if(c)f(c);else if(d){let b={};for(let{stack:e,id:g,glyph:a}of d)(b[e]||(b[e]={}))[g]=a&&{id:a.id,bitmap:a.bitmap.clone(),metrics:a.metrics};f(null,b)}})}_doesCharSupportLocalGlyph(b){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](b)||a.unicodeBlockLookup["Hangul Syllables"](b)||a.unicodeBlockLookup.Hiragana(b)||a.unicodeBlockLookup.Katakana(b))}_tinySDF(g,d,e){let h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(e))return;let f=g.tinySDF;if(!f){let c="400";/bold/i.test(d)?c="900":/medium/i.test(d)?c="500":/light/i.test(d)&&(c="200"),f=g.tinySDF=new o.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:h,fontWeight:c})}let b=f.draw(String.fromCharCode(e));return{id:e,bitmap:new a.AlphaImage({width:b.width||30,height:b.height||30},b.data),metrics:{width:b.glyphWidth||24,height:b.glyphHeight||24,left:b.glyphLeft||0,top:b.glyphTop-27|| -8,advance:b.glyphAdvance||24}}}}o.loadGlyphRange=function(c,d,e,f,h){let b=256*d,g=f.transformRequest(e.replace("{fontstack}",c).replace("{range}",`${b}-${b+255}`),a.ResourceType.Glyphs);a.getArrayBuffer(g,(b,c)=>{if(b)h(b);else if(c){let d={};for(let e of a.parseGlyphPBF(c))d[e.id]=e;h(null,d)}})},o.TinySDF=class{constructor({fontSize:c=24,buffer:d=3,radius:e=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:h="normal",fontStyle:i="normal"}={}){this.buffer=d,this.cutoff=f,this.radius=e;let a=this.size=c+4*d,j=this._createCanvas(a),b=this.ctx=j.getContext("2d",{willReadFrequently:!0});b.font=`${i} ${h} ${c}px ${g}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(b){let a=document.createElement("canvas");return a.width=a.height=b,a}draw(q){let{width:t,actualBoundingBoxAscent:u,actualBoundingBoxDescent:v,actualBoundingBoxLeft:w,actualBoundingBoxRight:x}=this.ctx.measureText(q),m=Math.ceil(u),b=Math.min(this.size-this.buffer,Math.ceil(x-w)),c=Math.min(this.size-this.buffer,m+Math.ceil(v)),d=b+2*this.buffer,n=c+2*this.buffer,i=Math.max(d*n,0),r=new Uint8ClampedArray(i),s={data:r,width:d,height:n,glyphWidth:b,glyphHeight:c,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(0===b||0===c)return s;let{ctx:o,buffer:a,gridInner:f,gridOuter:g}=this;o.clearRect(a,a,b,c),o.fillText(q,a,a+m);let y=o.getImageData(a,a,b,c);g.fill(1e20,0,i),f.fill(0,0,i);for(let j=0;j<c;j++)for(let k=0;k<b;k++){let p=y.data[4*(j*b+k)+3]/255;if(0===p)continue;let l=(j+a)*d+k+a;if(1===p)g[l]=0,f[l]=1e20;else{let e=.5-p;g[l]=e>0?e*e:0,f[l]=e<0?e*e:0}}Q(g,0,0,d,n,d,this.f,this.v,this.z),Q(f,a,a,b,c,d,this.f,this.v,this.z);for(let h=0;h<i;h++){let z=Math.sqrt(g[h])-Math.sqrt(f[h]);r[h]=Math.round(255-255*(z/this.radius+this.cutoff))}return s}};let S=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(b,c){return a.sphericalToCartesian(b.expression.evaluate(c))}interpolate(b,c,d){return{x:a.number(b.x,c.x,d),y:a.number(b.y,c.y,d),z:a.number(b.z,c.z,d)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),T="-transition";class U extends a.Evented{constructor(b){super(),this._transitionable=new a.Transitionable(S),this.setLight(b),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,e={}){if(!this._validate(a.validateLight,c,e))for(let b in c){let d=c[b];b.endsWith(T)?this._transitionable.setTransition(b.slice(0,-T.length),d):this._transitionable.setValue(b,d)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(c,d,b){return(!b|| !1!==b.validate)&&a.emitValidationErrors(this,c.call(a.validateStyle,a.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class A{constructor(e,f){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a.uniqueId();let c=this.workerPool.acquire(this.id);for(let b=0;b<c.length;b++){let d=new A.Actor(c[b],f,this.id);d.name=`Worker ${b}`,this.actors.push(d)}}broadcast(c,d,b){a.asyncAll(this.actors,(a,b)=>{a.send(c,d,b)},b=b||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function V(b,c,e){let d=function(f,c){if(f)return e(f);if(c){let d=a.pick(a.extend(c,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);c.vector_layers&&(d.vectorLayers=c.vector_layers,d.vectorLayerIds=d.vectorLayers.map(a=>a.id)),e(null,d)}};return b.url?a.getJSON(c.transformRequest(b.url,a.ResourceType.Source),d):a.exported.frame(()=>d(null,b))}A.Actor=a.Actor;class W{constructor(b,c,d){this.bounds=a.LngLatBounds.convert(this.validateBounds(b)),this.minzoom=c||0,this.maxzoom=d||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(b){let c=Math.pow(2,b.z),d=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*c),e=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*c),f=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*c),g=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*c);return b.x>=d&&b.x<f&&b.y>=e&&b.y<g}}class p extends a.Evented{constructor(c,b,d,e){if(super(),this.id=c,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(b,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},b),this._collectResourceTiming=b.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(e)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=V(this._options,this.map._requestManager,(c,b)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),c?this.fire(new a.ErrorEvent(c)):b&&(a.extend(this,b),b.bounds&&(this.tileBounds=new W(b.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(b,e){let f=b.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(f,a.ResourceType.Tile),uid:b.uid,tileID:b.tileID,zoom:b.tileID.overscaledZ,tileSize:this.tileSize*b.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(d,c){return delete b.request,b.aborted?e(null):d&&404!==d.status?e(d):(c&&c.resourceTiming&&(b.resourceTiming=c.resourceTiming),this.map._refreshExpiredTiles&&c&&b.setExpiryData(c),b.loadVectorData(c,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),e(null),void(b.reloadCallback&&(this.loadTile(b,b.reloadCallback),b.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,b.actor&&"expired"!==b.state?"loading"===b.state?b.reloadCallback=e:b.request=b.actor.send("reloadTile",c,d.bind(this)):(b.actor=this.dispatcher.getActor(),b.request=b.actor.send("loadTile",c,d.bind(this)))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class k extends a.Evented{constructor(c,b,d,e){super(),this.id=c,this.dispatcher=d,this.setEventedParent(e),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},b),a.extend(this,a.pick(b,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=V(this._options,this.map._requestManager,(c,b)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new a.ErrorEvent(c)):b&&(a.extend(this,b),b.bounds&&(this.tileBounds=new W(b.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(b,d){let c=b.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);b.request=a.getImage(this.map._requestManager.transformRequest(c,a.ResourceType.Tile),(g,f,h)=>{if(delete b.request,b.aborted)b.state="unloaded",d(null);else if(g)b.state="errored",d(g);else if(f){this.map._refreshExpiredTiles&&b.setExpiryData(h);let e=this.map.painter.context,c=e.gl;b.texture=this.map.painter.getTileTexture(f.width),b.texture?b.texture.update(f,{useMipmap:!0}):(b.texture=new N(e,f,c.RGBA,{useMipmap:!0}),b.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE,c.LINEAR_MIPMAP_NEAREST),e.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax)),b.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(a,b){a.request&&(a.request.cancel(),delete a.request),b()}unloadTile(a,b){a.texture&&this.map.painter.saveTileTexture(a.texture),b()}hasTransition(){return!1}}let X;class q extends k{constructor(c,b,d,e){super(c,b,d,e),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},b),this.encoding=b.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(b,d){let c=b.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function e(a,c){a&&(b.state="errored",d(a)),c&&(b.dem=c,b.needsHillshadePrepare=!0,b.state="loaded",d(null))}b.request=a.getImage(this.map._requestManager.transformRequest(c,a.ResourceType.Tile),(function(f,c){if(delete b.request,b.aborted)b.state="unloaded",d(null);else if(f)b.state="errored",d(f);else if(c){this.map._refreshExpiredTiles&&b.setExpiryData(c),delete c.cacheControl,delete c.expires;let g=a.isImageBitmap(c)&&(null==X&&(X="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),X)?c:a.exported.getImageData(c,1),h={uid:b.uid,coord:b.tileID,source:this.id,rawImageData:g,encoding:this.encoding};b.actor&&"expired"!==b.state||(b.actor=this.dispatcher.getActor(),b.actor.send("loadDEMTile",h,e.bind(this)))}}).bind(this)),b.neighboringTiles=this._getNeighboringTiles(b.tileID)}_getNeighboringTiles(c){let b=c.canonical,e=Math.pow(2,b.z),f=(b.x-1+e)%e,g=0===b.x?c.wrap-1:c.wrap,h=(b.x+1+e)%e,i=b.x+1===e?c.wrap+1:c.wrap,d={};return d[new a.OverscaledTileID(c.overscaledZ,g,b.z,f,b.y).key]={backfilled:!1},d[new a.OverscaledTileID(c.overscaledZ,i,b.z,h,b.y).key]={backfilled:!1},b.y>0&&(d[new a.OverscaledTileID(c.overscaledZ,g,b.z,f,b.y-1).key]={backfilled:!1},d[new a.OverscaledTileID(c.overscaledZ,c.wrap,b.z,b.x,b.y-1).key]={backfilled:!1},d[new a.OverscaledTileID(c.overscaledZ,i,b.z,h,b.y-1).key]={backfilled:!1}),b.y+1<e&&(d[new a.OverscaledTileID(c.overscaledZ,g,b.z,f,b.y+1).key]={backfilled:!1},d[new a.OverscaledTileID(c.overscaledZ,c.wrap,b.z,b.x,b.y+1).key]={backfilled:!1},d[new a.OverscaledTileID(c.overscaledZ,i,b.z,h,b.y+1).key]={backfilled:!1}),d}unloadTile(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})}}class r extends a.Evented{constructor(d,b,e,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=e.getActor(),this.setEventedParent(f),this._data=b.data,this._options=a.extend({},b),this._collectResourceTiming=b.collectResourceTiming,void 0!==b.maxzoom&&(this.maxzoom=b.maxzoom),b.type&&(this.type=b.type),b.attribution&&(this.attribution=b.attribution),this.promoteId=b.promoteId;let c=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:b.cluster||!1,geojsonVtOptions:{buffer:(void 0!==b.buffer?b.buffer:128)*c,tolerance:(void 0!==b.tolerance?b.tolerance:.375)*c,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:b.lineMetrics||!1,generateId:b.generateId||!1},superclusterOptions:{maxZoom:void 0!==b.clusterMaxZoom?b.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,b.clusterMinPoints||2),extent:a.EXTENT,radius:(b.clusterRadius||50)*c,log:!1,generateId:b.generateId||!1},clusterProperties:b.clusterProperties,filter:b.filter},b.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData("content"),this}getClusterExpansionZoom(a,b){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},b),this}getClusterChildren(a,b){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},b),this}getClusterLeaves(a,b,c,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:b,offset:c},d),this}_updateWorkerData(d){let b=a.extend({},this.workerOptions),c=this._data;"string"==typeof c?(b.request=this.map._requestManager.transformRequest(a.exported.resolveURL(c),a.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(c),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,b,(f,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return;let e=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(e=c.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:b.source},null),f)return void this.fire(new a.ErrorEvent(f));let g={dataType:"source",sourceDataType:d};this._collectResourceTiming&&e&&e.length>0&&a.extend(g,{resourceTiming:e}),this.fire(new a.Event("data",g))})}loaded(){return 0===this._pendingLoads}loadTile(a,d){let b=a.actor?"reloadTile":"loadTile";a.actor=this.actor;let c={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request=this.actor.send(b,c,(c,e)=>(delete a.request,a.unloadVectorData(),a.aborted?d(null):c?d(c):(a.loadVectorData(e,this.map.painter,"reloadTile"===b),d(null))))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0}unloadTile(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Y=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class f extends a.Evented{constructor(b,a,c,d){super(),this.id=b,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a}load(b,c){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(d,e)=>{this._loaded=!0,d?this.fire(new a.ErrorEvent(d)):e&&(this.image=e,b&&(this.coordinates=b),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url&&(this.options.url=a.url,this.load(a.coordinates,()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}setCoordinates(c){this.coordinates=c;let d=c.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(i){let b=1/0,c=1/0,d=-1/0,e=-1/0;for(let f of i)b=Math.min(b,f.x),c=Math.min(c,f.y),d=Math.max(d,f.x),e=Math.max(e,f.y);let j=Math.max(d-b,e-c),g=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),h=Math.pow(2,g);return new a.CanonicalTileID(g,Math.floor((b+d)/2*h),Math.floor((c+e)/2*h))}(d),this.minzoom=this.maxzoom=this.tileID.z;let b=d.map(a=>this.tileID.getTilePoint(a)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;let b=this.map.painter.context,c=b.gl;for(let e in this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new N(b,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this.tiles){let d=this.tiles[e];"loaded"!==d.state&&(d.state="loaded",d.texture=this.texture)}}loadTile(a,b){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},b(null)):(a.state="errored",b(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class s extends f{constructor(b,a,c,d){super(b,a,c,d),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;let b=this.options;for(let c of(this.urls=[],b.urls))this.urls.push(this.map._requestManager.transformRequest(c,a.ResourceType.Source).url);a.getVideo(this.urls,(b,c)=>{this._loaded=!0,b?this.fire(new a.ErrorEvent(b)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){let b=this.video.seekable;c<b.start(0)||c>b.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${b.start(0)} and ${b.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let c=this.map.painter.context,b=c.gl;for(let e in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.texSubImage2D(b.TEXTURE_2D,0,0,0,b.RGBA,b.UNSIGNED_BYTE,this.video)):(this.texture=new N(c,this.video,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE)),this.tiles){let d=this.tiles[e];"loaded"!==d.state&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class t extends f{constructor(c,b,d,e){super(c,b,d,e),b.coordinates?Array.isArray(b.coordinates)&&4===b.coordinates.length&&!b.coordinates.some(a=>!Array.isArray(a)||2!==a.length||a.some(a=>"number"!=typeof a))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),b.animate&&"boolean"!=typeof b.animate&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),b.canvas?"string"==typeof b.canvas||b.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=b,this.animate=void 0===b.animate||b.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let c=this.map.painter.context,e=c.gl;for(let f in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(b||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new N(c,this.canvas,e.RGBA,{premultiply:!0}),this.tiles){let d=this.tiles[f];"loaded"!==d.state&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}let Z={vector:p,raster:k,"raster-dem":q,geojson:r,video:s,image:f,canvas:t};function $(c,d){let b=a.create();return a.translate(b,b,[1,1,0]),a.scale(b,b,[.5*c.width,.5*c.height,1]),a.multiply(b,b,c.calculatePosMatrix(d.toUnwrapped()))}function _(b,e,j,k,c,f){let l=function(c,a,d){if(c)for(let f of c){let b=a[f];if(b&&b.source===d&&"fill-extrusion"===b.type)return!0}else for(let g in a){let e=a[g];if(e.source===d&&"fill-extrusion"===e.type)return!0}return!1}(c&&c.layers,e,b.id),g=f.maxPitchScaleFactor(),h=b.tilesIn(k,g,l);h.sort(aa);let i=[];for(let a of h)i.push({wrappedTileID:a.tileID.wrapped().key,queryResults:a.tile.queryRenderedFeatures(e,j,b._state,a.queryGeometry,a.cameraQueryGeometry,a.scale,c,f,g,$(b.transform,a.tileID))});let d=function(j){let b={},d={};for(let e of j){let f=e.queryResults,g=e.wrappedTileID,h=d[g]=d[g]||{};for(let a in f){let k=f[a],i=h[a]=h[a]||{},l=b[a]=b[a]||[];for(let c of k)i[c.featureIndex]||(i[c.featureIndex]=!0,l.push(c))}}return b}(i);for(let m in d)d[m].forEach(c=>{let a=c.feature,d=b.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=d});return d}function aa(c,d){let a=c.tileID,b=d.tileID;return a.overscaledZ-b.overscaledZ||a.canonical.y-b.canonical.y||a.wrap-b.wrap||a.canonical.x-b.canonical.x}class ab{constructor(b,c){this.tileID=b,this.uid=a.uniqueId(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){let b=c+this.timeAdded;b<a.exported.now()||this.fadeEndTime&&b<this.fadeEndTime||(this.fadeEndTime=b)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(b,c,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",b){for(let h in b.featureIndex&&(this.latestFeatureIndex=b.featureIndex,b.rawTileData?(this.latestRawTileData=b.rawTileData,this.latestFeatureIndex.rawTileData=b.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=b.collisionBoxArray,this.buckets=function(d,e){let b={};if(!e)return b;for(let a of d){let c=a.layerIds.map(a=>e.getLayer(a)).filter(Boolean);if(0!==c.length)for(let f of(a.layers=c,a.stateDependentLayerIds&&(a.stateDependentLayers=a.stateDependentLayerIds.map(a=>c.filter(b=>b.id===a)[0])),c))b[f.id]=a}return b}(b.buckets,c.style),this.hasSymbolBuckets=!1,this.buckets){let d=this.buckets[h];if(d instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!g)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let i in this.buckets){let e=this.buckets[i];if(e instanceof a.SymbolBucket&&e.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}for(let f in this.queryPadding=0,this.buckets){let j=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(f).queryRadius(j))}b.imageAtlas&&(this.imageAtlas=b.imageAtlas),b.glyphAtlasImage&&(this.glyphAtlasImage=b.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(let d in this.buckets){let b=this.buckets[d];b.uploadPending()&&b.upload(a)}let c=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new N(a,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new N(a,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,b,c,d,e,f,g,h,i,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:e,scale:f,tileSize:this.tileSize,pixelPosMatrix:j,transform:h,params:g,queryPadding:this.queryPadding*i},a,b,c):{}}querySourceFeatures(n,b){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let h=c.loadVTLayers(),i=b?b.sourceLayer:"",e=h._geojsonTileLayer||h[i];if(!e)return;let f=a.createFilter(b&&b.filter),{z:j,x:k,y:l}=this.tileID.canonical,o={z:j,x:k,y:l};for(let g=0;g<e.length;g++){let d=e.feature(g);if(f.needGeometry){let p=a.toEvaluationFeature(d,!0);if(!f.filter(new a.EvaluationParameters(this.tileID.overscaledZ),p,this.tileID.canonical))continue}else if(!f.filter(new a.EvaluationParameters(this.tileID.overscaledZ),d))continue;let q=c.getId(d,i),m=new a.GeoJSONFeature(d,j,k,l,q);m.tile=o,n.push(m)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){let d=this.expirationTime;if(c.cacheControl){let e=a.parseCacheControl(c.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){let f=Date.now(),b=!1;if(this.expirationTime>f)b=!1;else if(d){if(this.expirationTime<d)b=!0;else{let g=this.expirationTime-d;g?this.expirationTime=f+Math.max(g,3e4):b=!0}}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),2147483647)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;let i=this.latestFeatureIndex.loadVTLayers();for(let b in this.buckets){if(!a.style.hasLayer(b))continue;let c=this.buckets[b],f=c.layers[0].sourceLayer||"_geojsonTileLayer",g=i[f],d=e[f];if(!g||!d||0===Object.keys(d).length)continue;c.update(d,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});let h=a&&a.style&&a.style.getLayer(b);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(c)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(b){this.symbolFadeHoldUntil=a.exported.now()+b}setDependencies(b,c){let a={};for(let d of c)a[d]=!0;this.dependencies[b]=a}hasDependency(b,c){for(let d of b){let a=this.dependencies[d];if(a){for(let e of c)if(a[e])return!0}}return!1}}class u extends a.Evented{constructor(b,d,c){super(),this.id=b,this.dispatcher=c,this.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(c,d,e,f){let b=new Z[d.type](c,d,e,f);if(b.id!==c)throw Error(`Expected Source id to be ${c} instead of ${b.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],b),b}(b,d,c,this),this._tiles={},this._cache=new class{constructor(a,b){this.max=a,this.onRemove=b,this.reset()}reset(){for(let b in this.data)for(let a of this.data[b])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,f,b){let a=e.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);let c={value:f,timeout:void 0};if(void 0!==b&&(c.timeout=setTimeout(()=>{this.remove(e,c)},b)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){let d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){let b=this.data[a].shift();return b.timeout&&clearTimeout(b.timeout),0===this.data[a].length&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),b.value}getByKey(b){let a=this.data[b];return a?a[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(c,d){if(!this.has(c))return this;let a=c.wrapped().key,e=void 0===d?0:this.data[a].indexOf(d),b=this.data[a][e];return this.data[a].splice(e,1),b.timeout&&clearTimeout(b.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(b.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(b){for(this.max=b;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(d){let a=[];for(let e in this.data)for(let b of this.data[e])d(b.value)||a.push(b);for(let c of a)this.remove(c.value.tileID,c)}}(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new class{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(b,h,d){let c=String(h);if(this.stateChanges[b]=this.stateChanges[b]||{},this.stateChanges[b][c]=this.stateChanges[b][c]||{},a.extend(this.stateChanges[b][c],d),null===this.deletedStates[b])for(let e in this.deletedStates[b]={},this.state[b])e!==c&&(this.deletedStates[b][e]=null);else if(this.deletedStates[b]&&null===this.deletedStates[b][c])for(let f in this.deletedStates[b][c]={},this.state[b][c])d[f]||(this.deletedStates[b][c][f]=null);else for(let g in d)this.deletedStates[b]&&this.deletedStates[b][c]&&null===this.deletedStates[b][c][g]&&delete this.deletedStates[b][c][g]}removeFeatureState(a,d,c){if(null===this.deletedStates[a])return;let b=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},c&& void 0!==d)null!==this.deletedStates[a][b]&&(this.deletedStates[a][b]=this.deletedStates[a][b]||{},this.deletedStates[a][b][c]=null);else if(void 0!==d){if(this.stateChanges[a]&&this.stateChanges[a][b])for(c in this.deletedStates[a][b]={},this.stateChanges[a][b])this.deletedStates[a][b][c]=null;else this.deletedStates[a][b]=null}else this.deletedStates[a]=null}getState(b,c){let d=String(c),e=a.extend({},(this.state[b]||{})[d],(this.stateChanges[b]||{})[d]);if(null===this.deletedStates[b])return{};if(this.deletedStates[b]){let f=this.deletedStates[b][c];if(null===f)return{};for(let g in f)delete e[g]}return e}initializeTileState(a,b){a.setFeatureState(this.state,b)}coalesceChanges(h,k){let d={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let i={};for(let e in this.stateChanges[c])this.state[c][e]||(this.state[c][e]={}),a.extend(this.state[c][e],this.stateChanges[c][e]),i[e]=this.state[c][e];d[c]=i}for(let b in this.deletedStates){this.state[b]=this.state[b]||{};let g={};if(null===this.deletedStates[b])for(let j in this.state[b])g[j]={},this.state[b][j]={};else for(let f in this.deletedStates[b]){if(null===this.deletedStates[b][f])this.state[b][f]={};else for(let l of Object.keys(this.deletedStates[b][f]))delete this.state[b][f][l];g[f]=this.state[b][f]}d[b]=d[b]||{},a.extend(d[b],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(let m in h)h[m].setFeatureState(d,k)}}}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let b in this._tiles){let a=this._tiles[b];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,b){return this._source.loadTile(a,b)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(b){this._source.abortTile&&this._source.abortTile(b,()=>{}),this._source.fire(new a.Event("dataabort",{tile:b,coord:b.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(b){for(let c in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let a=this._tiles[c];a.upload(b),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(ac).map(a=>a.key)}getRenderableIds(c){let b=[];for(let d in this._tiles)this._isIdRenderable(d,c)&&b.push(this._tiles[d]);return c?b.sort((f,g)=>{let b=f.tileID,c=g.tileID,d=new a.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),e=new a.pointGeometry(c.canonical.x,c.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-c.overscaledZ||e.y-d.y||e.x-d.x}).map(a=>a.tileID.key):b.map(a=>a.tileID).sort(ac).map(a=>a.key)}hasRenderableParent(b){let a=this.findLoadedParent(b,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(a,b){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(b||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else for(let a in this._cache.reset(),this._tiles)"errored"!==this._tiles[a].state&&this._reloadTile(a,"reloading")}_reloadTile(b,c){let a=this._tiles[b];a&&("loading"!==a.state&&(a.state=c),this._loadTile(a,this._tileLoaded.bind(this,a,b,c)))}_tileLoaded(b,d,e,c){if(c)return b.state="errored",void(404!==c.status?this._source.fire(new a.ErrorEvent(c,{tile:b})):this.update(this.transform));b.timeAdded=a.exported.now(),"expired"===e&&(b.refreshedUponExpiration=!0),this._setTileReloadTimer(d,b),"raster-dem"===this.getSource().type&&b.dem&&this._backfillDEM(b),this._state.initializeTileState(b,this.map?this.map.painter:null),b.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:b,coord:b.tileID}))}_backfillDEM(a){let c=this.getRenderableIds();for(let b=0;b<c.length;b++){let d=c[b];if(a.neighboringTiles&&a.neighboringTiles[d]){let e=this.getTileByID(d);f(a,e),f(e,a)}}function f(a,c){a.needsHillshadePrepare=!0;let b=c.tileID.canonical.x-a.tileID.canonical.x,e=c.tileID.canonical.y-a.tileID.canonical.y,d=Math.pow(2,a.tileID.canonical.z),f=c.tileID.key;0===b&&0===e||Math.abs(e)>1||(Math.abs(b)>1&&(1===Math.abs(b+d)?b+=d:1===Math.abs(b-d)&&(b-=d)),c.dem&&a.dem&&(a.dem.backfillBorder(c.dem,b,e),a.neighboringTiles&&a.neighboringTiles[f]&&(a.neighboringTiles[f].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(h,d,i,e){for(let f in this._tiles){let a=this._tiles[f];if(e[f]||!a.hasData()||a.tileID.overscaledZ<=d||a.tileID.overscaledZ>i)continue;let b=a.tileID;for(;a&&a.tileID.overscaledZ>d+1;){let g=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[g.key])&&a.hasData()&&(b=g)}let c=b;for(;c.overscaledZ>d;)if(h[(c=c.scaledTo(c.overscaledZ-1)).key]){e[b.key]=b;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){let b=this._loadedParentTiles[a.key];return b&&b.tileID.overscaledZ>=d?b:null}for(let c=a.overscaledZ-1;c>=d;c--){let f=a.scaledTo(c),e=this._getLoadedTile(f);if(e)return e}}_getLoadedTile(b){let a=this._tiles[b.key];return a&&a.hasData()?a:this._cache.getByKey(b.wrapped().key)}updateCacheSize(a){let c=Math.ceil(a.width/this._source.tileSize)+1,d=Math.ceil(a.height/this._source.tileSize)+1,b=Math.floor(c*d*5),e="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(e)}handleWrapJump(b){let c=Math.round((b-(void 0===this._prevLng?b:this._prevLng))/360);if(this._prevLng=b,c){let d={};for(let g in this._tiles){let a=this._tiles[g];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+c),d[a.tileID.key]=a}for(let e in this._tiles=d,this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(let f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(d){if(this.transform=d,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(d),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?c=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new a.OverscaledTileID(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(c=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(c=c.filter(a=>this._source.hasTile(a)))):c=[];let f=d.coveringZoomLevel(this._source),o=Math.max(f-u.maxOverzooming,this._source.minzoom),p=Math.max(f+u.maxUnderzooming,this._source.minzoom),b=this._updateRetainedTiles(c,f);if(ad(this._source.type)){let i={},l={},q=Object.keys(b);for(let j of q){let m=b[j],k=this._tiles[j];if(!k||k.fadeEndTime&&k.fadeEndTime<=a.exported.now())continue;let g=this.findLoadedParent(m,o);g&&(this._addTile(g.tileID),i[g.tileID.key]=g.tileID),l[j]=m}for(let h in this._retainLoadedChildren(l,f,p,b),i)b[h]||(this._coveredTiles[h]=!0,b[h]=i[h])}for(let r in b)this._tiles[r].clearFadeHold();let s=a.keysDifference(this._tiles,b);for(let n of s){let e=this._tiles[n];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(n)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(j,d){let a={},k={},o=Math.max(d-u.maxOverzooming,this._source.minzoom),p=Math.max(d+u.maxUnderzooming,this._source.minzoom),l={};for(let e of j){let q=this._addTile(e);a[e.key]=e,q.hasData()||d<this._source.maxzoom&&(l[e.key]=e)}for(let f of(this._retainLoadedChildren(l,d,p,a),j)){let b=this._tiles[f.key];if(b.hasData())continue;if(d+1>this._source.maxzoom){let h=f.children(this._source.maxzoom)[0],m=this.getTile(h);if(m&&m.hasData()){a[h.key]=h;continue}}else{let g=f.children(this._source.maxzoom);if(a[g[0].key]&&a[g[1].key]&&a[g[2].key]&&a[g[3].key])continue}let n=b.wasRequested();for(let i=f.overscaledZ-1;i>=o;--i){let c=f.scaledTo(i);if(k[c.key]||(k[c.key]=!0,(b=this.getTile(c))||!n||(b=this._addTile(c)),b&&(a[c.key]=c,n=b.wasRequested(),b.hasData())))break}}return a}_updateLoadedParentTileCache(){for(let e in this._loadedParentTiles={},this._tiles){let c=[],b,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){b=this._loadedParentTiles[a.key];break}c.push(a.key);let d=a.scaledTo(a.overscaledZ-1);if(b=this._getLoadedTile(d))break;a=d}for(let f of c)this._loadedParentTiles[f]=b}}_addTile(c){let b=this._tiles[c.key];if(b)return b;(b=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,b),b.tileID=c,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,b)));let d=b;return b||(b=new ab(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,c.key,b.state))),b.uses++,this._tiles[c.key]=b,d||this._source.fire(new a.Event("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b}_setTileReloadTimer(a,c){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);let b=c.getExpiryTimeout();b&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},b))}_removeTile(b){let a=this._tiles[b];a&&(a.uses--,delete this._tiles[b],this._timers[b]&&(clearTimeout(this._timers[b]),delete this._timers[b]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){for(let a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(f,r,s){let g=[],h=this.transform;if(!h)return g;let t=s?h.getCameraQueryGeometry(f):f,u=f.map(a=>h.pointCoordinate(a)),o=t.map(a=>h.pointCoordinate(a)),p=this.getIds(),i=1/0,j=1/0,k=-1/0,l=-1/0;for(let c of o)i=Math.min(i,c.x),j=Math.min(j,c.y),k=Math.max(k,c.x),l=Math.max(l,c.y);for(let m=0;m<p.length;m++){let b=this._tiles[p[m]];if(b.holdingForFade())continue;let n=b.tileID,q=Math.pow(2,h.zoom-b.tileID.overscaledZ),d=r*b.queryPadding*a.EXTENT/b.tileSize/q,e=[n.getTilePoint(new a.MercatorCoordinate(i,j)),n.getTilePoint(new a.MercatorCoordinate(k,l))];if(e[0].x-d<a.EXTENT&&e[0].y-d<a.EXTENT&&e[1].x+d>=0&&e[1].y+d>=0){let v=u.map(a=>n.getTilePoint(a)),w=o.map(a=>n.getTilePoint(a));g.push({tile:b,tileID:n,queryGeometry:v,cameraQueryGeometry:w,scale:q})}}return g}getVisibleCoordinates(c){let a=this.getRenderableIds(c).map(a=>this._tiles[a].tileID);for(let b of a)b.posMatrix=this.transform.calculatePosMatrix(b.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(ad(this._source.type))for(let c in this._tiles){let b=this._tiles[c];if(void 0!==b.fadeEndTime&&b.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(a,b,c){this._state.updateState(a=a||"_geojsonTileLayer",b,c)}removeFeatureState(a,b,c){this._state.removeFeatureState(a=a||"_geojsonTileLayer",b,c)}getFeatureState(a,b){return this._state.getState(a=a||"_geojsonTileLayer",b)}setDependencies(b,c,d){let a=this._tiles[b];a&&a.setDependencies(c,d)}reloadTilesForDependencies(b,c){for(let a in this._tiles)this._tiles[a].hasDependency(b,c)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(b,c))}}function ac(a,b){let c=Math.abs(2*a.wrap)- +(a.wrap<0),d=Math.abs(2*b.wrap)- +(b.wrap<0);return a.overscaledZ-b.overscaledZ||d-c||b.canonical.y-a.canonical.y||b.canonical.x-a.canonical.x}function ad(a){return"raster"===a||"image"===a||"video"===a}u.maxOverzooming=10,u.maxUnderzooming=3;let ae="mapboxgl_preloaded_worker_pool";class l{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<l.workerCount;)this.workers.push(new Worker(x.workerUrl));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ae]}numActive(){return Object.keys(this.active).length}}let B=Math.floor(a.exported.hardwareConcurrency/2),af;function ag(){return af||(af=new l),af}function ah(c,e){let d={};for(let b in c)"ref"!==b&&(d[b]=c[b]);return a.refProperties.forEach(a=>{a in e&&(d[a]=e[a])}),d}function ai(a){a=a.slice();let d=Object.create(null);for(let c=0;c<a.length;c++)d[a[c].id]=a[c];for(let b=0;b<a.length;b++)"ref"in a[b]&&(a[b]=ah(a[b],d[a[b].ref]));return a}l.workerCount=Math.max(Math.min(B,6),1);let v={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function aj(a,b,c){c.push({command:v.addSource,args:[a,b[a]]})}function ak(a,b,c){b.push({command:v.removeSource,args:[a]}),c[a]=!0}function al(a,c,b,d){ak(a,b,d),aj(a,c,b)}function am(c,d,b){let a;for(a in c[b])if(Object.prototype.hasOwnProperty.call(c[b],a)&&"data"!==a&&!I(c[b][a],d[b][a]))return!1;for(a in d[b])if(Object.prototype.hasOwnProperty.call(d[b],a)&&"data"!==a&&!I(c[b][a],d[b][a]))return!1;return!0}function an(c,b,d,e,f,g){let a;for(a in b=b||{},c=c||{})Object.prototype.hasOwnProperty.call(c,a)&&(I(c[a],b[a])||d.push({command:g,args:[e,a,b[a],f]}));for(a in b)Object.prototype.hasOwnProperty.call(b,a)&&!Object.prototype.hasOwnProperty.call(c,a)&&(I(c[a],b[a])||d.push({command:g,args:[e,a,b[a],f]}))}function ao(a){return a.id}function ap(a,b){return a[b.id]=b,a}class aq{constructor(a,b){this.reset(a,b)}reset(b,c){this.points=b||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=a.clamp(c,0,1);let b=1,d=this._distances[b],e=c*this.paddedLength+this.padding;for(;d<e&&b<this._distances.length;)d=this._distances[++b];let f=b-1,g=this._distances[f],h=d-g,i=h>0?(e-g)/h:0;return this.points[f].mult(1-i).add(this.points[b].mult(i))}}function ar(a,c){let b=!0;return"always"===a||"never"!==a&&"never"!==c||(b=!1),b}class as{constructor(a,b,c){let e=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(a/c),this.yCellCount=Math.ceil(b/c);for(let d=0;d<this.xCellCount*this.yCellCount;d++)e.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=b,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/b,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,b,c,d){this._forEachCell(a,b,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(b),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(d,b,c,a){this._forEachCell(b-a,c-a,b+a,c+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(d),this.circles.push(b),this.circles.push(c),this.circles.push(a)}_insertBoxCell(c,d,e,f,a,b){this.boxCells[a].push(b)}_insertCircleCell(c,d,e,f,a,b){this.circleCells[a].push(b)}_query(c,d,e,f,i,l,m){if(e<0||c>this.width||f<0||d>this.height)return[];let g=[];if(c<=0&&d<=0&&this.width<=e&&this.height<=f){if(i)return[{key:null,x1:c,y1:d,x2:e,y2:f}];for(let a=0;a<this.boxKeys.length;a++)g.push({key:this.boxKeys[a],x1:this.bboxes[4*a],y1:this.bboxes[4*a+1],x2:this.bboxes[4*a+2],y2:this.bboxes[4*a+3]});for(let b=0;b<this.circleKeys.length;b++){let j=this.circles[3*b],k=this.circles[3*b+1],h=this.circles[3*b+2];g.push({key:this.circleKeys[b],x1:j-h,y1:k-h,x2:j+h,y2:k+h})}}else this._forEachCell(c,d,e,f,this._queryCell,g,{hitTest:i,overlapMode:l,seenUids:{box:{},circle:{}}},m);return g}query(a,b,c,d){return this._query(a,b,c,d,!1,null)}hitTest(a,b,c,d,e,f){return this._query(a,b,c,d,!0,e,f).length>0}hitTestCircle(b,c,a,i,j){let d=b-a,e=b+a,f=c-a,g=c+a;if(e<0||d>this.width||g<0||f>this.height)return!1;let h=[];return this._forEachCell(d,f,e,g,this._queryCellCircle,h,{hitTest:!0,overlapMode:i,circle:{x:b,y:c,radius:a},seenUids:{box:{},circle:{}}},j),h.length>0}_queryCell(m,n,o,p,q,r,x,e){let{seenUids:f,hitTest:g,overlapMode:s}=x,t=this.boxCells[q];if(null!==t){let a=this.bboxes;for(let h of t)if(!f.box[h]){f.box[h]=!0;let b=4*h,k=this.boxKeys[h];if(m<=a[b+2]&&n<=a[b+3]&&o>=a[b+0]&&p>=a[b+1]&&(!e||e(k))&&(!g||!ar(s,k.overlapMode))&&(r.push({key:k,x1:a[b],y1:a[b+1],x2:a[b+2],y2:a[b+3]}),g))return!0}}let u=this.circleCells[q];if(null!==u){let c=this.circles;for(let i of u)if(!f.circle[i]){f.circle[i]=!0;let d=3*i,l=this.circleKeys[i];if(this._circleAndRectCollide(c[d],c[d+1],c[d+2],m,n,o,p)&&(!e||e(l))&&(!g||!ar(s,l.overlapMode))){let v=c[d],w=c[d+1],j=c[d+2];if(r.push({key:l,x1:v-j,y1:w-j,x2:v+j,y2:w+j}),g)return!0}}}return!1}_queryCellCircle(r,s,t,u,j,k,q,b){let{circle:a,seenUids:c,overlapMode:l}=q,m=this.boxCells[j];if(null!==m){let d=this.bboxes;for(let e of m)if(!c.box[e]){c.box[e]=!0;let f=4*e,n=this.boxKeys[e];if(this._circleAndRectCollide(a.x,a.y,a.radius,d[f+0],d[f+1],d[f+2],d[f+3])&&(!b||b(n))&&!ar(l,n.overlapMode))return k.push(!0),!0}}let o=this.circleCells[j];if(null!==o){let h=this.circles;for(let g of o)if(!c.circle[g]){c.circle[g]=!0;let i=3*g,p=this.circleKeys[g];if(this._circlesCollide(h[i],h[i+1],h[i+2],a.x,a.y,a.radius)&&(!b||b(p))&&!ar(l,p.overlapMode))return k.push(!0),!0}}}_forEachCell(c,d,e,f,g,h,i,j){let k=this._convertToXCellCoord(c),l=this._convertToYCellCoord(d),m=this._convertToXCellCoord(e),n=this._convertToYCellCoord(f);for(let a=k;a<=m;a++)for(let b=l;b<=n;b++)if(g.call(this,c,d,e,f,this.xCellCount*b+a,h,i,j))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(d,e,f,g,h,i){let a=g-d,b=h-e,c=f+i;return c*c>a*a+b*b}_circleAndRectCollide(j,k,a,f,g,l,m){let b=(l-f)/2,d=Math.abs(j-(f+b));if(d>b+a)return!1;let c=(m-g)/2,e=Math.abs(k-(g+c));if(e>c+a)return!1;if(d<=b||e<=c)return!0;let h=d-b,i=e-c;return h*h+i*i<=a*a}}function at(e,f,g,c,d){let b=a.create();return f?(a.scale(b,b,[1/d,1/d,1]),g||a.rotateZ(b,b,c.angle)):a.multiply(b,c.labelPlaneMatrix,e),b}function au(e,f,g,c,d){if(f){let b=a.clone(e);return a.scale(b,b,[d,d,1]),g||a.rotateZ(b,b,-c.angle),b}return c.glCoordMatrix}function av(d,e){let b=[d.x,d.y,0,1];aG(b,b,e);let c=b[3];return{point:new a.pointGeometry(b[0]/c,b[1]/c),signedDistanceFromCamera:c}}function aw(a,b){return .5+a/b*.5}function ax(a,b){let c=a[0]/a[3],d=a[1]/a[3];return c>= -b[0]&&c<=b[0]&&d>= -b[1]&&d<=b[1]}function ay(c,i,e,f,j,n,z,o,p){let q=f?c.textSizeData:c.iconSizeData,A=a.evaluateSizeForZoom(q,e.transform.zoom),B=[256/e.width*2+1,256/e.height*2+1],d=f?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;d.clear();let r=c.lineVertexArray,s=f?c.text.placedSymbolArray:c.icon.placedSymbolArray,t=e.transform.width/e.transform.height,g=!1;for(let k=0;k<s.length;k++){let b=s.get(k);if(b.hidden||b.writingMode===a.WritingMode.vertical&&!g){aF(b.numGlyphs,d);continue}g=!1;let h=[b.anchorX,b.anchorY,0,1];if(a.transformMat4(h,h,i),!ax(h,B)){aF(b.numGlyphs,d);continue}let u=aw(e.transform.cameraToCenterDistance,h[3]),v=a.evaluateSizeForFeature(q,A,b),w=z?v/u:v*u,l=new a.pointGeometry(b.anchorX,b.anchorY),x=av(l,j).point,y={},m=aB(b,w,!1,o,i,j,n,c.glyphOffsetArray,r,d,x,l,y,t,p);g=m.useVertical,(m.notEnoughRoom||g||m.needsFlipping&&aB(b,w,!0,o,i,j,n,c.glyphOffsetArray,r,d,x,l,y,t,p).notEnoughRoom)&&aF(b.numGlyphs,d)}f?c.text.dynamicLayoutVertexBuffer.updateData(d):c.icon.dynamicLayoutVertexBuffer.updateData(d)}function az(b,c,d,e,f,g,h,a,i,j,k,l){let q=a.glyphStartIndex+a.numGlyphs,m=a.lineStartIndex,n=a.lineStartIndex+a.lineLength,r=c.getoffsetX(a.glyphStartIndex),s=c.getoffsetX(q-1),o=aD(b*r,d,e,f,g,h,a.segment,m,n,i,j,k,l);if(!o)return null;let p=aD(b*s,d,e,f,g,h,a.segment,m,n,i,j,k,l);return p?{first:o,last:p}:null}function aA(d,b,c,e){return d===a.WritingMode.horizontal&&Math.abs(c.y-b.y)>Math.abs(c.x-b.x)*e?{useVertical:!0}:(d===a.WritingMode.vertical?b.y<c.y:b.x>c.x)?{needsFlipping:!0}:null}function aB(b,C,c,r,i,j,s,k,d,D,l,e,m,t,n){let f=C/24,o=b.lineOffsetX*f,p=b.lineOffsetY*f,g;if(b.numGlyphs>1){let E=b.glyphStartIndex+b.numGlyphs,F=b.lineStartIndex,G=b.lineStartIndex+b.lineLength,h=az(f,k,o,p,c,l,e,b,d,j,m,n);if(!h)return{notEnoughRoom:!0};let H=av(h.first.point,s).point,I=av(h.last.point,s).point;if(r&&!c){let u=aA(b.writingMode,H,I,t);if(u)return u}g=[h.first];for(let q=b.glyphStartIndex+1;q<E-1;q++)g.push(aD(f*k.getoffsetX(q),o,p,c,l,e,b.segment,F,G,d,j,m,n));g.push(h.last)}else{if(r&&!c){let v=av(e,i).point,w=b.lineStartIndex+b.segment+1,x=new a.pointGeometry(d.getx(w),d.gety(w)),y=av(x,i),J=y.signedDistanceFromCamera>0?y.point:aC(e,x,v,1,i),z=aA(b.writingMode,v,J,t);if(z)return z}let A=aD(f*k.getoffsetX(b.glyphStartIndex),o,p,c,l,e,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,d,j,m,n);if(!A)return{notEnoughRoom:!0};g=[A]}for(let B of g)a.addDynamicAttributes(D,B.point,B.angle);return{}}function aC(a,d,b,e,f){let g=av(a.add(a.sub(d)._unit()),f).point,c=b.sub(g);return b.add(c._mult(e/c.mag()))}function aD(n,o,z,p,q,A,r,i,B,g,s,t,C){let u=p?n-o:n+o,e=u>0?1:-1,j=0;p&&(e*=-1,j=Math.PI),e<0&&(j+=Math.PI);let c=e>0?i+r:i+r+1,b=q,d=q,f=0,h=0,k=Math.abs(u),l=[];for(;f+h<=k;){if((c+=e)<i||c>=B)return null;if(d=b,l.push(b),void 0===(b=t[c])){let v=new a.pointGeometry(g.getx(c),g.gety(c)),w=av(v,s);if(w.signedDistanceFromCamera>0)b=t[c]=w.point;else{let x=c-e;b=aC(0===f?A:new a.pointGeometry(g.getx(x),g.gety(x)),v,d,k-f+1,s)}}f+=h,h=d.dist(b)}let D=(k-f)/h,y=b.sub(d),m=y.mult(D)._add(d);m._add(y._unit()._perp()._mult(z*e));let E=j+Math.atan2(b.y-d.y,b.x-d.x);return l.push(m),{point:m,angle:C?E:0,path:l}}let aE=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function aF(d,a){for(let b=0;b<d;b++){let c=a.length;a.resize(c+4),a.float32.set(aE,3*c)}}function aG(b,e,a){let c=e[0],d=e[1];return b[0]=a[0]*c+a[4]*d+a[12],b[1]=a[1]*c+a[5]*d+a[13],b[3]=a[3]*c+a[7]*d+a[15],b}function aH(b,c,d){return c*(a.EXTENT/(b.tileSize*Math.pow(2,d-b.tileID.overscaledZ)))}class aI{constructor(a,b,c,d){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?b:-b))):d&&c?1:0,this.placed=c}isHidden(){return 0===this.opacity&&!this.placed}}class aJ{constructor(a,b,d,e,c){this.text=new aI(a?a.text:null,b,d,c),this.icon=new aI(a?a.icon:null,b,e,c)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class aK{constructor(a,b,c){this.text=a,this.icon=b,this.skipFade=c}}class aL{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class aM{constructor(a,b,c,d,e){this.bucketInstanceId=a,this.featureIndex=b,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=e}}function aN(b,e,f,g,c){let{horizontalAlign:h,verticalAlign:i}=a.getAnchorAlignment(b),d=a.evaluateVariableOffset(b,g);return new a.pointGeometry(-(h-.5)*e+d[0]*c,-(i-.5)*f+d[1]*c)}function aO(d,e,f,g,h,c){let{x1:i,x2:j,y1:k,y2:l,anchorPointX:m,anchorPointY:n}=d,b=new a.pointGeometry(e,f);return g&&b._rotate(h?c:-c),{x1:i+b.x,y1:k+b.y,x2:j+b.x,y2:l+b.y,anchorPointX:m,anchorPointY:n}}function aP(a,b,c,d,e){a.emplaceBack(b?1:0,c?1:0,d||0,e||0),a.emplaceBack(b?1:0,c?1:0,d||0,e||0),a.emplaceBack(b?1:0,c?1:0,d||0,e||0),a.emplaceBack(b?1:0,c?1:0,d||0,e||0)}function aQ(a){if(0===a.opacity&&!a.placed)return 0;if(1===a.opacity&&a.placed)return 4294967295;let b=a.placed?1:0,c=Math.floor(127*a.opacity);return 33554432*c+16777216*b+131072*c+65536*b+512*c+256*b+2*c+b}class aR{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(b,c,e,f,d){let a=this._bucketParts;for(;this._currentTileIndex<b.length;)if(c.getBucketParts(a,f,b[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((a,b)=>a.sortKey-b.sortKey));this._currentPartIndex<a.length;)if(c.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,e),this._currentPartIndex++,d())return!0;return!1}}class aS{constructor(b,c,d,e,f,g,h){this.placement=new class{constructor(c,d,e,b){this.transform=c.clone(),this.collisionIndex=new class{constructor(a,b=new as(a.width+200,a.height+200,25),c=new as(a.width+200,a.height+200,25)){this.transform=a,this.grid=b,this.ignoredGrid=c,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+100,this.screenBottomBoundary=a.height+100,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200}placeCollisionBox(a,h,i,j,k){let b=this.projectAndGetPerspectiveRatio(j,a.anchorPointX,a.anchorPointY),c=i*b.perspectiveRatio,d=a.x1*c+b.point.x,e=a.y1*c+b.point.y,f=a.x2*c+b.point.x,g=a.y2*c+b.point.y;return!this.isInsideGrid(d,e,f,g)||"always"!==h&&this.grid.hitTest(d,e,f,g,h,k)?{box:[],offscreen:!1}:{box:[d,e,f,g],offscreen:this.isOffscreen(d,e,f,g)}}placeCollisionCircles(x,i,L,M,y,N,z,O,A,P,Q,R,S){let B=[],n=new a.pointGeometry(i.anchorX,i.anchorY),T=av(n,N),o=aw(this.transform.cameraToCenterDistance,T.signedDistanceFromCamera),p=(P?y/o:y*o)/a.ONE_EM,U=av(n,z).point,q=az(p,M,i.lineOffsetX*p,i.lineOffsetY*p,!1,U,n,i,L,z,{},!1),j=!1,r=!1,s=!0;if(q){let c=.5*R*o+S,f=new a.pointGeometry(-100,-100),g=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),k=new aq,C=q.first,D=q.last,b=[];for(let t=C.path.length-1;t>=1;t--)b.push(C.path[t]);for(let u=1;u<D.path.length;u++)b.push(D.path[u]);let V=2.5*c;if(O){let E=b.map(a=>av(a,O));b=E.some(a=>a.signedDistanceFromCamera<=0)?[]:E.map(a=>a.point)}let F=[];if(b.length>0){let d=b[0].clone(),e=b[0].clone();for(let h=1;h<b.length;h++)d.x=Math.min(d.x,b[h].x),d.y=Math.min(d.y,b[h].y),e.x=Math.max(e.x,b[h].x),e.y=Math.max(e.y,b[h].y);F=d.x>=f.x&&e.x<=g.x&&d.y>=f.y&&e.y<=g.y?[b]:e.x<f.x||d.x>g.x||e.y<f.y||d.y>g.y?[]:a.clipLine([b],f.x,f.y,g.x,g.y)}for(let W of F){k.reset(W,.25*c);let v=0;v=k.length<=.5*c?1:Math.ceil(k.paddedLength/V)+1;for(let w=0;w<v;w++){let X=w/Math.max(v-1,1),G=k.lerp(X),l=G.x+100,m=G.y+100;B.push(l,m,c,0);let H=l-c,I=m-c,J=l+c,K=m+c;if(s=s&&this.isOffscreen(H,I,J,K),r=r||this.isInsideGrid(H,I,J,K),"always"!==x&&this.grid.hitTestCircle(l,m,c,x,Q)&&(j=!0,!A))return{circles:[],offscreen:!1,collisionDetected:j}}}}return{circles:(A||!j)&&r?B:[],offscreen:s,collisionDetected:j}}queryRenderedSymbols(k){if(0===k.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let l=[],e=1/0,f=1/0,g=-1/0,h=-1/0;for(let m of k){let d=new a.pointGeometry(m.x+100,m.y+100);e=Math.min(e,d.x),f=Math.min(f,d.y),g=Math.max(g,d.x),h=Math.max(h,d.y),l.push(d)}let n=this.grid.query(e,f,g,h).concat(this.ignoredGrid.query(e,f,g,h)),i={},j={};for(let c of n){let b=c.key;if(void 0===i[b.bucketInstanceId]&&(i[b.bucketInstanceId]={}),i[b.bucketInstanceId][b.featureIndex])continue;let o=[new a.pointGeometry(c.x1,c.y1),new a.pointGeometry(c.x2,c.y1),new a.pointGeometry(c.x2,c.y2),new a.pointGeometry(c.x1,c.y2)];a.polygonIntersectsPolygon(l,o)&&(i[b.bucketInstanceId][b.featureIndex]=!0,void 0===j[b.bucketInstanceId]&&(j[b.bucketInstanceId]=[]),j[b.bucketInstanceId].push(b.featureIndex))}return j}insertCollisionBox(a,b,c,d,e,f){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:e,collisionGroupID:f,overlapMode:b},a[0],a[1],a[2],a[3])}insertCollisionCircles(b,c,d,e,f,g){let h=d?this.ignoredGrid:this.grid,i={bucketInstanceId:e,featureIndex:f,collisionGroupID:g,overlapMode:c};for(let a=0;a<b.length;a+=4)h.insertCircle(i,b[a],b[a+1],b[a+2])}projectAndGetPerspectiveRatio(c,d,e){let b=[d,e,0,1];return aG(b,b,c),{point:new a.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+100,(-b[1]/b[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(a,b,c,d){return c<100||a>=this.screenRightBoundary||d<100||b>this.screenBottomBoundary}isInsideGrid(a,b,c,d){return c>=0&&a<this.gridRightBoundary&&d>=0&&b<this.gridBottomBoundary}getViewportMatrix(){let b=a.identity([]);return a.translate(b,b,[-100,-100,0]),b}}(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new class{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){let b=++this.maxGroupID;this.collisionGroups[a]={ID:b,predicate:a=>a.collisionGroupID===b}}return this.collisionGroups[a]}}(e),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(g,h,c,n){let b=c.getBucket(h),i=c.latestFeatureIndex;if(!b||!i||h.id!==b.layerIds[0])return;let o=c.collisionBoxArray,d=b.layers[0].layout,p=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),q=c.tileSize/a.EXTENT,e=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),f="map"===d.get("text-pitch-alignment"),j="map"===d.get("text-rotation-alignment"),k=aH(c,1,this.transform.zoom),r=at(e,f,j,this.transform,k),l=null;if(f){let s=au(e,f,j,this.transform,k);l=a.multiply([],this.transform.labelPlaneMatrix,s)}this.retainedQueryData[b.bucketInstanceId]=new aM(b.bucketInstanceId,i,b.sourceLayerIndex,b.index,c.tileID);let m={bucket:b,layout:d,posMatrix:e,textLabelPlaneMatrix:r,labelToScreenMatrix:l,scale:p,textPixelRatio:q,holdingForFade:c.holdingForFade(),collisionBoxArray:o,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(n)for(let t of b.sortKeyRanges){let{sortKey:u,symbolInstanceStart:v,symbolInstanceEnd:w}=t;g.push({sortKey:u,symbolInstanceStart:v,symbolInstanceEnd:w,parameters:m})}else g.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:m})}attemptAnchorPlacement(c,s,f,g,h,i,j,k,l,m,n,a,d,e,o){let p=[a.textOffset0,a.textOffset1],b=aN(c,f,g,p,h),q=this.collisionIndex.placeCollisionBox(aO(s,b.x,b.y,i,j,this.transform.angle),n,k,l,m.predicate);if((!o||0!==this.collisionIndex.placeCollisionBox(aO(o,b.x,b.y,i,j,this.transform.angle),n,k,l,m.predicate).box.length)&&q.box.length>0){let r;return this.prevPlacement&&this.prevPlacement.variableOffsets[a.crossTileID]&&this.prevPlacement.placements[a.crossTileID]&&this.prevPlacement.placements[a.crossTileID].text&&(r=this.prevPlacement.variableOffsets[a.crossTileID].anchor),this.variableOffsets[a.crossTileID]={textOffset:p,width:f,height:g,anchor:c,textBoxScale:h,prevAnchor:r},this.markUsedJustification(d,c,a,e),d.allowVerticalPlacement&&(this.markUsedOrientation(d,e,a),this.placedOrientations[a.crossTileID]=e),{shift:b,placedGlyphBoxes:q}}}placeLayerBucketPart(e,u,n){let{bucket:b,layout:c,posMatrix:o,textLabelPlaneMatrix:v,labelToScreenMatrix:w,textPixelRatio:x,holdingForFade:y,collisionBoxArray:g,partiallyEvaluatedTextSize:z,collisionGroup:A}=e.parameters,p=c.get("text-optional"),q=c.get("icon-optional"),r=a.getOverlapMode(c,"text-overlap","text-allow-overlap"),h="always"===r,s=a.getOverlapMode(c,"icon-overlap","icon-allow-overlap"),i="always"===s,B="map"===c.get("text-rotation-alignment"),C="map"===c.get("text-pitch-alignment"),D="none"!==c.get("icon-text-fit"),t="viewport-y"===c.get("symbol-z-order"),E=h&&(i||!b.hasIconData()||q),F=i&&(h||!b.hasTextData()||p);!b.collisionArrays&&g&&b.deserializeCollisionBoxes(g);let j=(d,f)=>{if(u[d.crossTileID])return;if(y)return void(this.placements[d.crossTileID]=new aK(!1,!1,!1));let e=!1,j=!1,l=!0,Z=null,i={box:null,offscreen:null},t={box:null,offscreen:null},k=null,g=null,G=null,I=0,J=0,M=0;f.textFeatureIndex?I=f.textFeatureIndex:d.useRuntimeCollisionCircles&&(I=d.featureIndex),f.verticalTextFeatureIndex&&(J=f.verticalTextFeatureIndex);let V=f.textBox;if(V){let N=f=>{let c=a.WritingMode.horizontal;if(b.allowVerticalPlacement&&!f&&this.prevPlacement){let e=this.prevPlacement.placedOrientations[d.crossTileID];e&&(this.placedOrientations[d.crossTileID]=e,c=e,this.markUsedOrientation(b,c,d))}return c},O=(c,e)=>{if(b.allowVerticalPlacement&&d.numVerticalGlyphVertices>0&&f.verticalTextBox){for(let g of b.writingModes)if(g===a.WritingMode.vertical?t=i=e():i=c(),i&&i.box&&i.box.length)break}else i=c()};if(c.get("text-variable-anchor")){let K=c.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]){let P=this.prevPlacement.variableOffsets[d.crossTileID];K.indexOf(P.anchor)>0&&(K=K.filter(a=>a!==P.anchor)).unshift(P.anchor)}let $=(a,h,i)=>{let j=a.x2-a.x1,k=a.y2-a.y1,l=d.textBoxScale,m=D&&"never"===s?h:null,c={box:[],offscreen:!1},n="never"!==r?2*K.length:K.length;for(let f=0;f<n;++f){let g=this.attemptAnchorPlacement(K[f%K.length],a,j,k,l,B,C,x,o,A,f>=K.length?r:"never",d,b,i,m);if(g&&(c=g.placedGlyphBoxes)&&c.box&&c.box.length){e=!0,Z=g.shift;break}}return c};O(()=>$(V,f.iconBox,a.WritingMode.horizontal),()=>{let c=f.verticalTextBox;return b.allowVerticalPlacement&&!(i&&i.box&&i.box.length)&&d.numVerticalGlyphVertices>0&&c?$(c,f.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),i&&(e=i.box,l=i.offscreen);let W=N(i&&i.box);if(!e&&this.prevPlacement){let L=this.prevPlacement.variableOffsets[d.crossTileID];L&&(this.variableOffsets[d.crossTileID]=L,this.markUsedJustification(b,L.anchor,d,W))}}else{let _=(e,c)=>{let a=this.collisionIndex.placeCollisionBox(e,r,x,o,A.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(b,c,d),this.placedOrientations[d.crossTileID]=c),a};O(()=>_(V,a.WritingMode.horizontal),()=>{let c=f.verticalTextBox;return b.allowVerticalPlacement&&d.numVerticalGlyphVertices>0&&c?_(c,a.WritingMode.vertical):{box:null,offscreen:null}}),N(i&&i.box&&i.box.length)}}if(e=(k=i)&&k.box&&k.box.length>0,l=k&&k.offscreen,d.useRuntimeCollisionCircles){let Q=b.text.placedSymbolArray.get(d.centerJustifiedTextSymbolIndex),X=a.evaluateSizeForFeature(b.textSizeData,z,Q),Y=c.get("text-padding");g=this.collisionIndex.placeCollisionCircles(r,Q,b.lineVertexArray,b.glyphOffsetArray,X,o,v,w,n,C,A.predicate,d.collisionCircleDiameter,Y),e=h||g.circles.length>0&&!g.collisionDetected,l=l&&g.offscreen}if(f.iconFeatureIndex&&(M=f.iconFeatureIndex),f.iconBox){let R=a=>{let b=D&&Z?aO(a,Z.x,Z.y,B,C,this.transform.angle):a;return this.collisionIndex.placeCollisionBox(b,s,x,o,A.predicate)};j=t&&t.box&&t.box.length&&f.verticalIconBox?(G=R(f.verticalIconBox)).box.length>0:(G=R(f.iconBox)).box.length>0,l=l&&G.offscreen}let S=p||0===d.numHorizontalGlyphVertices&&0===d.numVerticalGlyphVertices,T=q||0===d.numIconVertices;if(S||T?T?S||(j=j&&e):e=j&&e:j=e=j&&e,e&&k&&k.box&&this.collisionIndex.insertCollisionBox(k.box,r,c.get("text-ignore-placement"),b.bucketInstanceId,t&&t.box&&J?J:I,A.ID),j&&G&&this.collisionIndex.insertCollisionBox(G.box,s,c.get("icon-ignore-placement"),b.bucketInstanceId,M,A.ID),g&&(e&&this.collisionIndex.insertCollisionCircles(g.circles,r,c.get("text-ignore-placement"),b.bucketInstanceId,I,A.ID),n)){let U=b.bucketInstanceId,m=this.collisionCircleArrays[U];void 0===m&&(m=this.collisionCircleArrays[U]=new aL);for(let H=0;H<g.circles.length;H+=4)m.circles.push(g.circles[H+0]),m.circles.push(g.circles[H+1]),m.circles.push(g.circles[H+2]),m.circles.push(g.collisionDetected?1:0)}this.placements[d.crossTileID]=new aK(e||E,j||F,l||b.justReloaded),u[d.crossTileID]=!0};if(t){let k=b.getSortedSymbolIndexes(this.transform.angle);for(let f=k.length-1;f>=0;--f){let l=k[f];j(b.symbolInstances.get(l),b.collisionArrays[l])}}else for(let d=e.symbolInstanceStart;d<e.symbolInstanceEnd;d++)j(b.symbolInstances.get(d),b.collisionArrays[d]);if(n&&b.bucketInstanceId in this.collisionCircleArrays){let m=this.collisionCircleArrays[b.bucketInstanceId];a.invert(m.invProjMatrix,o),m.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(e,f,b,g){let c;c=g===a.WritingMode.vertical?b.verticalPlacedTextSymbolIndex:({left:b.leftJustifiedTextSymbolIndex,center:b.centerJustifiedTextSymbolIndex,right:b.rightJustifiedTextSymbolIndex})[a.getAnchorJustification(f)];let h=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex,b.verticalPlacedTextSymbolIndex];for(let d of h)d>=0&&(e.text.placedSymbolArray.get(d).crossTileID=c>=0&&d!==c?0:b.crossTileID)}markUsedOrientation(d,b,c){let e=b===a.WritingMode.horizontal||b===a.WritingMode.horizontalOnly?b:0,f=b===a.WritingMode.vertical?b:0,g=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(let h of g)d.text.placedSymbolArray.get(h).placedOrientation=e;c.verticalPlacedTextSymbolIndex&&(d.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let i=a?a.symbolFadeChange(f):1,j=a?a.opacities:{},m=a?a.variableOffsets:{},n=a?a.placedOrientations:{};for(let g in this.placements){let b=this.placements[g],h=j[g];h?(this.opacities[g]=new aJ(h,i,b.text,b.icon),c=c||b.text!==h.text.placed||b.icon!==h.icon.placed):(this.opacities[g]=new aJ(null,i,b.text,b.icon,b.skipFade),c=c||b.text||b.icon)}for(let k in j){let l=j[k];if(!this.opacities[k]){let o=new aJ(l,i,!1,!1);o.isHidden()||(this.opacities[k]=o,c=c||l.text.placed||l.icon.placed)}}for(let d in m)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=m[d]);for(let e in n)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=n[e]);c?this.lastPlacementChangeTime=f:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:f)}updateLayerOpacities(c,d){let e={};for(let a of d){let b=a.getBucket(c);b&&a.latestFeatureIndex&&c.id===b.layerIds[0]&&this.updateBucketOpacities(b,e,a.collisionBoxArray)}}updateBucketOpacities(b,s,t){b.hasTextData()&&b.text.opacityVertexArray.clear(),b.hasIconData()&&b.icon.opacityVertexArray.clear(),b.hasIconCollisionBoxData()&&b.iconCollisionBox.collisionVertexArray.clear(),b.hasTextCollisionBoxData()&&b.textCollisionBox.collisionVertexArray.clear();let f=b.layers[0].layout,D=new aJ(null,0,!1,!1,!0),u=f.get("text-allow-overlap"),v=f.get("icon-allow-overlap"),E=f.get("text-variable-anchor"),F="map"===f.get("text-rotation-alignment"),G="map"===f.get("text-pitch-alignment"),i="none"!==f.get("icon-text-fit"),H=new aJ(null,0,u&&(v||!b.hasIconData()||f.get("icon-optional")),v&&(u||!b.hasTextData()||f.get("text-optional")),!0);!b.collisionArrays&&t&&(b.hasIconCollisionBoxData()||b.hasTextCollisionBoxData())&&b.deserializeCollisionBoxes(t);let k=(b,c,d)=>{for(let a=0;a<c/4;a++)b.opacityVertexArray.emplaceBack(d)};for(let l=0;l<b.symbolInstances.length;l++){let c=b.symbolInstances.get(l),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:x,crossTileID:j}=c,d=this.opacities[j];s[j]?d=D:d||(d=H,this.opacities[j]=d),s[j]=!0;let I=c.numIconVertices>0,m=this.placedOrientations[c.crossTileID],o=m===a.WritingMode.vertical,n=m===a.WritingMode.horizontal||m===a.WritingMode.horizontalOnly;if(w>0||x>0){let y=aQ(d.text);k(b.text,w,o?0:y),k(b.text,x,n?0:y);let J=d.text.isHidden();[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach(a=>{a>=0&&(b.text.placedSymbolArray.get(a).hidden=J||o?1:0)}),c.verticalPlacedTextSymbolIndex>=0&&(b.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).hidden=J||n?1:0);let z=this.variableOffsets[c.crossTileID];z&&this.markUsedJustification(b,z.anchor,c,m);let p=this.placedOrientations[c.crossTileID];p&&(this.markUsedJustification(b,"left",c,p),this.markUsedOrientation(b,p,c))}if(I){let A=aQ(d.icon),B=!(i&&c.verticalPlacedIconSymbolIndex&&o);c.placedIconSymbolIndex>=0&&(k(b.icon,c.numIconVertices,B?A:0),b.icon.placedSymbolArray.get(c.placedIconSymbolIndex).hidden=d.icon.isHidden()),c.verticalPlacedIconSymbolIndex>=0&&(k(b.icon,c.numVerticalIconVertices,B?0:A),b.icon.placedSymbolArray.get(c.verticalPlacedIconSymbolIndex).hidden=d.icon.isHidden())}if(b.hasIconCollisionBoxData()||b.hasTextCollisionBoxData()){let g=b.collisionArrays[l];if(g){let e=new a.pointGeometry(0,0);if(g.textBox||g.verticalTextBox){let q=!0;if(E){let h=this.variableOffsets[j];h?(e=aN(h.anchor,h.width,h.height,h.textOffset,h.textBoxScale),F&&e._rotate(G?this.transform.angle:-this.transform.angle)):q=!1}g.textBox&&aP(b.textCollisionBox.collisionVertexArray,d.text.placed,!q||o,e.x,e.y),g.verticalTextBox&&aP(b.textCollisionBox.collisionVertexArray,d.text.placed,!q||n,e.x,e.y)}let C=Boolean(!n&&g.verticalIconBox);g.iconBox&&aP(b.iconCollisionBox.collisionVertexArray,d.icon.placed,C,i?e.x:0,i?e.y:0),g.verticalIconBox&&aP(b.iconCollisionBox.collisionVertexArray,d.icon.placed,!C,i?e.x:0,i?e.y:0)}}}if(b.sortFeatures(this.transform.angle),this.retainedQueryData[b.bucketInstanceId]&&(this.retainedQueryData[b.bucketInstanceId].featureSortOrder=b.featureSortOrder),b.hasTextData()&&b.text.opacityVertexBuffer&&b.text.opacityVertexBuffer.updateData(b.text.opacityVertexArray),b.hasIconData()&&b.icon.opacityVertexBuffer&&b.icon.opacityVertexBuffer.updateData(b.icon.opacityVertexArray),b.hasIconCollisionBoxData()&&b.iconCollisionBox.collisionVertexBuffer&&b.iconCollisionBox.collisionVertexBuffer.updateData(b.iconCollisionBox.collisionVertexArray),b.hasTextCollisionBoxData()&&b.textCollisionBox.collisionVertexBuffer&&b.textCollisionBox.collisionVertexBuffer.updateData(b.textCollisionBox.collisionVertexArray),b.bucketInstanceId in this.collisionCircleArrays){let r=this.collisionCircleArrays[b.bucketInstanceId];b.placementInvProjMatrix=r.invProjMatrix,b.placementViewportMatrix=r.viewportMatrix,b.collisionCircleArray=r.circles,delete this.collisionCircleArrays[b.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(b,a){let c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>b}setStale(){this.stale=!0}}(b,f,g,h),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=e,this._done=!1}isDone(){return this._done}continuePlacement(d,e,f){let h=a.exported.now(),g=()=>{let b=a.exported.now()-h;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){let b=e[d[this._currentPlacementIndex]],c=this.placement.collisionIndex.transform.zoom;if("symbol"===b.type&&(!b.minzoom||b.minzoom<=c)&&(!b.maxzoom||b.maxzoom>c)){if(this._inProgressLayer||(this._inProgressLayer=new aR(b)),this._inProgressLayer.continuePlacement(f[b.source],this.placement,this._showCollisionBoxes,b,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}let aT=512/a.EXTENT/2;class aU{constructor(d,e,f){this.tileID=d,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let a=0;a<e.length;a++){let b=e.get(a),c=b.key;this.indexedSymbolInstances[c]||(this.indexedSymbolInstances[c]=[]),this.indexedSymbolInstances[c].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,d)})}}getScaledCoordinates(c,b){let d=aT/Math.pow(2,b.canonical.z-this.tileID.canonical.z);return{x:Math.floor((b.canonical.x*a.EXTENT+c.anchorX)*d),y:Math.floor((b.canonical.y*a.EXTENT+c.anchorY)*d)}}findMatches(e,c,f){let g=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let d=0;d<e.length;d++){let b=e.get(d);if(b.crossTileID)continue;let h=this.indexedSymbolInstances[b.key];if(!h)continue;let i=this.getScaledCoordinates(b,c);for(let a of h)if(Math.abs(a.coord.x-i.x)<=g&&Math.abs(a.coord.y-i.y)<=g&&!f[a.crossTileID]){f[a.crossTileID]=!0,b.crossTileID=a.crossTileID;break}}}}class aV{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(b){let c=Math.round((b-this.lng)/360);if(0!==c)for(let d in this.indexes){let e=this.indexes[d],f={};for(let g in e){let a=e[g];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+c),f[a.tileID.key]=a}this.indexes[d]=f}this.lng=b}addBucket(a,b,k){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===b.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let c=0;c<b.symbolInstances.length;c++)b.symbolInstances.get(c).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});let d=this.usedCrossTileIDs[a.overscaledZ];for(let e in this.indexes){let f=this.indexes[e];if(Number(e)>a.overscaledZ)for(let l in f){let i=f[l];i.tileID.isChildOf(a)&&i.findMatches(b.symbolInstances,a,d)}else{let j=f[a.scaledTo(Number(e)).key];j&&j.findMatches(b.symbolInstances,a,d)}}for(let g=0;g<b.symbolInstances.length;g++){let h=b.symbolInstances.get(g);h.crossTileID||(h.crossTileID=k.generate(),d[h.crossTileID]=!0)}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new aU(a,b.symbolInstances,b.bucketInstanceId),!0}removeBucketCrossTileIDs(b,a){for(let c in a.indexedSymbolInstances)for(let d of a.indexedSymbolInstances[c])delete this.usedCrossTileIDs[b][d.crossTileID]}removeStaleBuckets(e){let c=!1;for(let d in this.indexes){let a=this.indexes[d];for(let b in a)e[a[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,a[b]),delete a[b],c=!0)}return c}}class aW{constructor(){this.layerIndexes={},this.crossTileIDs=new class{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}},this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,g,h){let b=this.layerIndexes[c.id];void 0===b&&(b=this.layerIndexes[c.id]=new aV);let d=!1,e={};for(let f of(b.handleWrapJump(h),g)){let a=f.getBucket(c);a&&c.id===a.layerIds[0]&&(a.bucketInstanceId||(a.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(f.tileID,a,this.crossTileIDs)&&(d=!0),e[a.bucketInstanceId]=!0)}return b.removeStaleBuckets(e)&&(d=!0),d}pruneUnusedLayers(b){let c={};for(let a in b.forEach(a=>{c[a]=!0}),this.layerIndexes)c[a]||delete this.layerIndexes[a]}}let aX=(c,b)=>a.emitValidationErrors(c,b&&b.filter(a=>"source.canvas"!==a.identifier)),aY=a.pick(v,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),aZ=a.pick(v,["setCenter","setZoom","setBearing","setPitch"]),a$=function(){let c={},f=a.spec.$version;for(let b in a.spec.$root){let d=a.spec.$root[b];if(d.required){let e=null;null!=(e="version"===b?f:"array"===d.type?[]:{})&&(c[b]=e)}}return c}();class g extends a.Evented{constructor(b,c={}){super(),this.map=b,this.dispatcher=new A(ag(),this),this.imageManager=new P,this.imageManager.setEventedParent(this),this.glyphManager=new o(b._requestManager,c.localIdeographFontFamily),this.lineAtlas=new class{constructor(a,b){this.width=a,this.height=b,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(b,c){let a=b.join(",")+String(c);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(b,c)),this.dashEntry[a]}getDashRanges(a,j,b){let d=[],e=a.length%2==1?-a[a.length-1]*b:0,f=a[0]*b,c=!0;d.push({left:e,right:f,isDash:c,zeroLength:0===a[0]});let g=a[0];for(let h=1;h<a.length;h++){c=!c;let i=a[h];e=g*b,g+=i,f=g*b,d.push({left:e,right:f,isDash:c,zeroLength:0===i})}return d}addRoundDash(i,l,c){let f=l/2;for(let d=-c;d<=c;d++){let m=this.width*(this.nextRow+c+d),j=0,b=i[j];for(let a=0;a<this.width;a++){a/b.right>1&&(b=i[++j]);let n=Math.abs(a-b.left),o=Math.abs(a-b.right),e=Math.min(n,o),g,h=d/c*(f+1);if(b.isDash){let k=f-Math.abs(h);g=Math.sqrt(e*e+k*k)}else g=f-Math.sqrt(e*e+h*h);this.data[m+a]=Math.max(0,Math.min(255,g+128))}}}addRegularDash(a){for(let b=a.length-1;b>=0;--b){let e=a[b],f=a[b+1];e.zeroLength?a.splice(b,1):f&&f.isDash===e.isDash&&(f.left=e.left,a.splice(b,1))}let g=a[0],h=a[a.length-1];g.isDash===h.isDash&&(g.left=h.left-this.width,h.right=g.right+this.width);let k=this.width*this.nextRow,i=0,d=a[i];for(let c=0;c<this.width;c++){c/d.right>1&&(d=a[++i]);let l=Math.abs(c-d.left),m=Math.abs(c-d.right),j=Math.min(l,m);this.data[k+c]=Math.max(0,Math.min(255,(d.isDash?j:-j)+128))}}addDash(d,f){let b=f?7:0,g=2*b+1;if(this.nextRow+g>this.height)return a.warnOnce("LineAtlas out of space"),null;let c=0;for(let e=0;e<d.length;e++)c+=d[e];if(0!==c){let h=this.width/c,i=this.getDashRanges(d,this.width,h);f?this.addRoundDash(i,h,b):this.addRegularDash(i)}let j={y:(this.nextRow+b+.5)/this.height,height:2*b/this.height,width:c};return this.nextRow+=g,this.dirty=!0,j}bind(b){let a=b.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}(256,512),this.crossTileSymbolIndex=new aW,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());let d=this;this._rtlTextPluginCallback=g.registerForPluginStateChange(b=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(c,b)=>{if(a.triggerPluginCompletionEvent(c),b&&b.every(a=>a))for(let e in d.sourceCaches)d.sourceCaches[e].reload()})}),this.on("data",a=>{if("source"!==a.dataType||"metadata"!==a.sourceDataType)return;let c=this.sourceCaches[a.sourceId];if(!c)return;let b=c.getSource();if(b&&b.vectorLayerIds)for(let e in this._layers){let d=this._layers[e];d.source===b.id&&this._validateLayer(d)}})}loadURL(c,b={}){this.fire(new a.Event("dataloading",{dataType:"style"}));let e="boolean"!=typeof b.validate||b.validate,d=this.map._requestManager.transformRequest(c,a.ResourceType.Style);this._request=a.getJSON(d,(b,c)=>{this._request=null,b?this.fire(new a.ErrorEvent(b)):c&&this._load(c,e)})}loadJSON(b,c={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(b,!1!==c.validate)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(a$,!1)}_load(b,f){if(f&&aX(this,a.validateStyle(b)))return;for(let d in this._loaded=!0,this.stylesheet=b,b.sources)this.addSource(d,b.sources[d],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs);let e=ai(this.stylesheet.layers);for(let c of(this._order=e.map(a=>a.id),this._layers={},this._serializedLayers={},e))(c=a.createStyleLayer(c)).setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=c,this._serializedLayers[c.id]=c.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new U(this.stylesheet.light),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(b){this._spriteRequest=function(c,b,e,f){let g,h,i,d=e>1?"@2x":"",j=a.getJSON(b.transformRequest(b.normalizeSpriteURL(c,d,".json"),a.ResourceType.SpriteJSON),(a,b)=>{j=null,i||(i=a,g=b,l())}),k=a.getImage(b.transformRequest(b.normalizeSpriteURL(c,d,".png"),a.ResourceType.SpriteImage),(a,b)=>{k=null,i||(i=a,h=b,l())});function l(){if(i)f(i);else if(g&&h){let k=a.exported.getImageData(h),b={};for(let c in g){let{width:d,height:e,x:l,y:m,sdf:n,pixelRatio:o,stretchX:p,stretchY:q,content:r}=g[c],j=new a.RGBAImage({width:d,height:e});a.RGBAImage.copy(k,j,{x:l,y:m},{x:0,y:0},{width:d,height:e}),b[c]={data:j,pixelRatio:o,sdf:n,stretchX:p,stretchY:q,content:r}}f(null,b)}}return{cancel(){j&&(j.cancel(),j=null),k&&(k.cancel(),k=null)}}}(b,this.map._requestManager,this.map.getPixelRatio(),(c,b)=>{if(this._spriteRequest=null,c)this.fire(new a.ErrorEvent(c));else if(b)for(let d in b)this.imageManager.addImage(d,b[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(c){let e=this.sourceCaches[c.source];if(!e)return;let d=c.sourceLayer;if(!d)return;let b=e.getSource();("geojson"===b.type||b.vectorLayerIds&& -1===b.vectorLayerIds.indexOf(d))&&this.fire(new a.ErrorEvent(Error(`Source layer "${d}" does not exist on source "${b.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){let a=[];for(let d of c){let b=this._layers[d];"custom"!==b.type&&a.push(b.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(let b in this._layers)if(this._layers[b].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading.")}update(b){if(!this._loaded)return;let m=this._changed;if(this._changed){let g=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);for(let d in(g.length||h.length)&&this._updateWorkerLayers(g,h),this._updatedSources){let i=this._updatedSources[d];"reload"===i?this._reloadSource(d):"clear"===i&&this._clearSource(d)}for(let n in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[n].updateTransitions(b);this.light.updateTransitions(b),this._resetUpdates()}let e={};for(let j in this.sourceCaches){let k=this.sourceCaches[j];e[j]=k.used,k.used=!1}for(let o of this._order){let c=this._layers[o];c.recalculate(b,this._availableImages),!c.isHidden(b.zoom)&&c.source&&(this.sourceCaches[c.source].used=!0)}for(let f in e){let l=this.sourceCaches[f];e[f]!==l.used&&l.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(b),this.z=b.zoom,m&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let a=Object.keys(this._changedImages);if(a.length){for(let b in this.sourceCaches)this.sourceCaches[b].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,b){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:b})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(b){if(this._checkLoaded(),aX(this,a.validateStyle(b)))return!1;(b=a.clone$1(b)).layers=ai(b.layers);let c=(function(b,a){if(!b)return[{command:v.setStyle,args:[a]}];let c=[];try{if(!I(b.version,a.version))return[{command:v.setStyle,args:[a]}];I(b.center,a.center)||c.push({command:v.setCenter,args:[a.center]}),I(b.zoom,a.zoom)||c.push({command:v.setZoom,args:[a.zoom]}),I(b.bearing,a.bearing)||c.push({command:v.setBearing,args:[a.bearing]}),I(b.pitch,a.pitch)||c.push({command:v.setPitch,args:[a.pitch]}),I(b.sprite,a.sprite)||c.push({command:v.setSprite,args:[a.sprite]}),I(b.glyphs,a.glyphs)||c.push({command:v.setGlyphs,args:[a.glyphs]}),I(b.transition,a.transition)||c.push({command:v.setTransition,args:[a.transition]}),I(b.light,a.light)||c.push({command:v.setLight,args:[a.light]});let e={},d=[];!function(c,b,d,e){let a;for(a in b=b||{},c=c||{})Object.prototype.hasOwnProperty.call(c,a)&&(Object.prototype.hasOwnProperty.call(b,a)||ak(a,d,e));for(a in b)Object.prototype.hasOwnProperty.call(b,a)&&(Object.prototype.hasOwnProperty.call(c,a)?I(c[a],b[a])||("geojson"===c[a].type&&"geojson"===b[a].type&&am(c,b,a)?d.push({command:v.setGeoJSONSourceData,args:[a,b[a].data]}):al(a,b,d,e)):aj(a,b,d))}(b.sources,a.sources,d,e);let f=[];b.layers&&b.layers.forEach(a=>{e[a.source]?c.push({command:v.removeLayer,args:[a.id]}):f.push(a)}),c=c.concat(d),function(l,j,f){j=j||[];let m=(l=l||[]).map(ao),i=j.map(ao),o=l.reduce(ap,{}),n=j.reduce(ap,{}),g=m.slice(),p=Object.create(null),e,h,b,d,c,k,a;for(e=0,h=0;e<m.length;e++)b=m[e],Object.prototype.hasOwnProperty.call(n,b)?h++:(f.push({command:v.removeLayer,args:[b]}),g.splice(g.indexOf(b,h),1));for(e=0,h=0;e<i.length;e++)b=i[i.length-1-e],g[g.length-1-e]!==b&&(Object.prototype.hasOwnProperty.call(o,b)?(f.push({command:v.removeLayer,args:[b]}),g.splice(g.lastIndexOf(b,g.length-h),1)):h++,k=g[g.length-e],f.push({command:v.addLayer,args:[n[b],k]}),g.splice(g.length-e,0,b),p[b]=!0);for(e=0;e<i.length;e++)if(d=o[b=i[e]],c=n[b],!p[b]&&!I(d,c)){if(I(d.source,c.source)&&I(d["source-layer"],c["source-layer"])&&I(d.type,c.type)){for(a in an(d.layout,c.layout,f,b,null,v.setLayoutProperty),an(d.paint,c.paint,f,b,null,v.setPaintProperty),I(d.filter,c.filter)||f.push({command:v.setFilter,args:[b,c.filter]}),I(d.minzoom,c.minzoom)&&I(d.maxzoom,c.maxzoom)||f.push({command:v.setLayerZoomRange,args:[b,c.minzoom,c.maxzoom]}),d)Object.prototype.hasOwnProperty.call(d,a)&&"layout"!==a&&"paint"!==a&&"filter"!==a&&"metadata"!==a&&"minzoom"!==a&&"maxzoom"!==a&&(0===a.indexOf("paint.")?an(d[a],c[a],f,b,a.slice(6),v.setPaintProperty):I(d[a],c[a])||f.push({command:v.setLayerProperty,args:[b,a,c[a]]}));for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&!Object.prototype.hasOwnProperty.call(d,a)&&"layout"!==a&&"paint"!==a&&"filter"!==a&&"metadata"!==a&&"minzoom"!==a&&"maxzoom"!==a&&(0===a.indexOf("paint.")?an(d[a],c[a],f,b,a.slice(6),v.setPaintProperty):I(d[a],c[a])||f.push({command:v.setLayerProperty,args:[b,a,c[a]]}))}else f.push({command:v.removeLayer,args:[b]}),k=g[g.lastIndexOf(b)+1],f.push({command:v.addLayer,args:[c,k]})}}(f,a.layers,c)}catch(g){console.warn("Unable to compute style diff:",g),c=[{command:v.setStyle,args:[a]}]}return c})(this.serialize(),b).filter(a=>!(a.command in aZ));if(0===c.length)return!1;let d=c.filter(a=>!(a.command in aY));if(d.length>0)throw Error(`Unimplemented: ${d.map(a=>a.command).join(", ")}.`);return c.forEach(a=>{"setTransition"!==a.command&&this[a.command].apply(this,a.args)}),this.stylesheet=b,!0}addImage(b,c){if(this.getImage(b))return this.fire(new a.ErrorEvent(Error(`An image named "${b}" already exists.`)));this.imageManager.addImage(b,c),this._afterImageUpdated(b)}updateImage(a,b){this.imageManager.updateImage(a,b)}getImage(a){return this.imageManager.getImage(a)}removeImage(b){if(!this.getImage(b))return this.fire(new a.ErrorEvent(Error(`An image named "${b}" does not exist.`)));this.imageManager.removeImage(b),this._afterImageUpdated(b)}_afterImageUpdated(b){this._availableImages=this.imageManager.listImages(),this._changedImages[b]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,b,e={}){if(this._checkLoaded(),void 0!==this.sourceCaches[c])throw Error(`Source "${c}" already exists.`);if(!b.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(b).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(b.type)>=0&&this._validate(a.validateStyle.source,`sources.${c}`,b,null,e))return;this.map&&this.map._collectResourceTiming&&(b.collectResourceTiming=!0);let d=this.sourceCaches[c]=new u(c,b,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:d.serialize(),sourceId:c})),d.onAdd(this.map),this._changed=!0}removeSource(b){if(this._checkLoaded(),void 0===this.sourceCaches[b])throw Error("There is no source with this ID");for(let d in this._layers)if(this._layers[d].source===b)return this.fire(new a.ErrorEvent(Error(`Source "${b}" cannot be removed while layer "${d}" is using it.`)));let c=this.sourceCaches[b];delete this.sourceCaches[b],delete this._updatedSources[b],c.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,b){this._checkLoaded(),this.sourceCaches[a].getSource().setData(b),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(c,e,g={}){this._checkLoaded();let d=c.id;if(this.getLayer(d))return void this.fire(new a.ErrorEvent(Error(`Layer "${d}" already exists on this map.`)));let b;if("custom"===c.type){if(aX(this,a.validateCustomStyleLayer(c)))return;b=a.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(d,c.source),c=a.clone$1(c),c=a.extend(c,{source:d})),this._validate(a.validateStyle.layer,`layers.${d}`,c,{arrayIndex:-1},g))return;b=a.createStyleLayer(c),this._validateLayer(b),b.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[b.id]=b.serialize()}let f=e?this._order.indexOf(e):this._order.length;if(e&& -1===f)this.fire(new a.ErrorEvent(Error(`Cannot add layer "${d}" before non-existing layer "${e}".`)));else{if(this._order.splice(f,0,d),this._layerOrderChanged=!0,this._layers[d]=b,this._removedLayers[d]&&b.source&&"custom"!==b.type){let h=this._removedLayers[d];delete this._removedLayers[d],h.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(b,c){if(this._checkLoaded(),this._changed=!0,!this._layers[b])return void this.fire(new a.ErrorEvent(Error(`The layer '${b}' does not exist in the map's style and cannot be moved.`)));if(b===c)return;let e=this._order.indexOf(b);this._order.splice(e,1);let d=c?this._order.indexOf(c):this._order.length;c&& -1===d?this.fire(new a.ErrorEvent(Error(`Cannot move layer "${b}" before non-existing layer "${c}".`))):(this._order.splice(d,0,b),this._layerOrderChanged=!0)}removeLayer(b){this._checkLoaded();let c=this._layers[b];if(!c)return void this.fire(new a.ErrorEvent(Error(`Cannot remove non-existing layer "${b}".`)));c.setEventedParent(null);let d=this._order.indexOf(b);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[b]=c,delete this._layers[b],delete this._serializedLayers[b],delete this._updatedLayers[b],delete this._updatedPaintProps[b],c.onRemove&&c.onRemove(this.map)}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}setLayerZoomRange(e,c,d){this._checkLoaded();let b=this.getLayer(e);b?b.minzoom===c&&b.maxzoom===d||(null!=c&&(b.minzoom=c),null!=d&&(b.maxzoom=d),this._updateLayer(b)):this.fire(new a.ErrorEvent(Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(d,c,e={}){this._checkLoaded();let b=this.getLayer(d);if(b){if(!I(b.filter,c))return null==c?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(a.validateStyle.filter,`layers.${b.id}.filter`,c,null,e)||(b.filter=a.clone$1(c),this._updateLayer(b)))}else this.fire(new a.ErrorEvent(Error(`Cannot filter non-existing layer "${d}".`)))}getFilter(b){return a.clone$1(this.getLayer(b).filter)}setLayoutProperty(c,d,e,f={}){this._checkLoaded();let b=this.getLayer(c);b?I(b.getLayoutProperty(d),e)||(b.setLayoutProperty(d,e,f),this._updateLayer(b)):this.fire(new a.ErrorEvent(Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(b,d){let c=this.getLayer(b);if(c)return c.getLayoutProperty(d);this.fire(new a.ErrorEvent(Error(`Cannot get style of non-existing layer "${b}".`)))}setPaintProperty(c,d,e,f={}){this._checkLoaded();let b=this.getLayer(c);b?I(b.getPaintProperty(d),e)||(b.setPaintProperty(d,e,f)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new a.ErrorEvent(Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(a,b){return this.getLayer(a).getPaintProperty(b)}setFeatureState(b,g){this._checkLoaded();let e=b.source,c=b.sourceLayer,d=this.sourceCaches[e];if(void 0===d)return void this.fire(new a.ErrorEvent(Error(`The source '${e}' does not exist in the map's style.`)));let f=d.getSource().type;"geojson"===f&&c?this.fire(new a.ErrorEvent(Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==f||c?(void 0===b.id&&this.fire(new a.ErrorEvent(Error("The feature id parameter must be provided."))),d.setFeatureState(c,b.id,g)):this.fire(new a.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(b,d){this._checkLoaded();let e=b.source,c=this.sourceCaches[e];if(void 0===c)return void this.fire(new a.ErrorEvent(Error(`The source '${e}' does not exist in the map's style.`)));let f=c.getSource().type,g="vector"===f?b.sourceLayer:void 0;"vector"!==f||g?d&&"string"!=typeof b.id&&"number"!=typeof b.id?this.fire(new a.ErrorEvent(Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(g,b.id,d):this.fire(new a.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(b){this._checkLoaded();let d=b.source,e=b.sourceLayer,c=this.sourceCaches[d];if(void 0!==c)return"vector"!==c.getSource().type||e?(void 0===b.id&&this.fire(new a.ErrorEvent(Error("The feature id parameter must be provided."))),c.getFeatureState(e,b.id)):void this.fire(new a.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,a=>a.serialize()),layers:this._serializeLayers(this._order)},a=>void 0!==a)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&"raster"!==this.sourceCaches[a.source].getSource().type&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(g){var h,i;let j={},a=[];for(let b=this._order.length-1;b>=0;b--){let d=this._order[b];if(h=d,"fill-extrusion"===this._layers[h].type)for(let o of(j[d]=b,g)){let k=o[d];if(k)for(let p of k)a.push(p)}}a.sort((a,b)=>b.intersectionZ-a.intersectionZ);let e=[];for(let c=this._order.length-1;c>=0;c--){let l=this._order[c];if(i=l,"fill-extrusion"===this._layers[i].type)for(let f=a.length-1;f>=0;f--){let m=a[f].feature;if(j[m.layer.id]<c)break;e.push(m),a.pop()}else for(let q of g){let n=q[l];if(n)for(let r of n)e.push(r.feature)}}return e}queryRenderedFeatures(d,b,i){b&&b.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",b.filter,null,b);let e={};if(b&&b.layers){if(!Array.isArray(b.layers))return this.fire(new a.ErrorEvent(Error("parameters.layers must be an Array."))),[];for(let f of b.layers){let g=this._layers[f];if(!g)return this.fire(new a.ErrorEvent(Error(`The layer '${f}' does not exist in the map's style and cannot be queried for features.`))),[];e[g.source]=!0}}let c=[];for(let h in b.availableImages=this._availableImages,this.sourceCaches)b.layers&&!e[h]||c.push(_(this.sourceCaches[h],this._layers,this._serializedLayers,d,b,i));return this.placement&&c.push(function(i,j,r,k,c,l,m){let a={},f=l.queryRenderedSymbols(k),d=[];for(let n of Object.keys(f).map(Number))d.push(m[n]);for(let b of(d.sort(aa),d)){let g=b.featureIndex.lookupSymbolFeatures(f[b.bucketInstanceId],j,b.bucketIndex,b.sourceLayerIndex,c.filter,c.layers,c.availableImages,i);for(let e in g){let o=a[e]=a[e]||[],h=g[e];for(let p of(h.sort((c,d)=>{let a=b.featureSortOrder;if(a){let e=a.indexOf(c.featureIndex);return a.indexOf(d.featureIndex)-e}return d.featureIndex-c.featureIndex}),h))o.push(p)}}for(let q in a)a[q].forEach(b=>{let a=b.feature,c=r[i[q].source].getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c});return a}(this._layers,this._serializedLayers,this.sourceCaches,d,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}querySourceFeatures(d,b){b&&b.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",b.filter,null,b);let c=this.sourceCaches[d];return c?function(g,h){let b=g.getRenderableIds().map(a=>g.getTileByID(a)),c=[],d={};for(let a=0;a<b.length;a++){let e=b[a],f=e.tileID.canonical.key;d[f]||(d[f]=!0,e.querySourceFeatures(c,h))}return c}(c,b):[]}addSourceType(a,b,c){return g.getSourceType(a)?c(Error(`A source type called "${a}" already exists.`)):(g.setSourceType(a,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:b.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(b,e={}){this._checkLoaded();let f=this.light.getLight(),c=!1;for(let d in b)if(!I(b[d],f[d])){c=!0;break}if(!c)return;let g={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(b,e),this.light.updateTransitions(g)}_validate(c,d,e,f,b={}){return(!b|| !1!==b.validate)&&aX(this,c.call(a.validateStyle,a.extend({key:d,style:this.serialize(),value:e,styleSpec:a.spec},f)))}_remove(){for(let c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(let d in this.sourceCaches){let b=this.sourceCaches[d];b.setEventedParent(null),b.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(let b in this.sourceCaches)this.sourceCaches[b].update(a)}_generateCollisionBoxes(){for(let a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(e,j,h,k,f=!1){let d=!1,i=!1,c={};for(let l of this._order){let b=this._layers[l];if("symbol"!==b.type)continue;if(!c[b.source]){let m=this.sourceCaches[b.source];c[b.source]=m.getRenderableIds(!0).map(a=>m.getTileByID(a)).sort((a,b)=>b.tileID.overscaledZ-a.tileID.overscaledZ||(a.tileID.isLessThan(b.tileID)?-1:1))}let n=this.crossTileSymbolIndex.addLayer(b,c[b.source],e.center.lng);d=d||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||0===h)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),e.zoom))&&(this.pauseablePlacement=new aS(e,this._order,f,j,h,k,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),i=!0),d&&this.pauseablePlacement.placement.setStale()),i||d)for(let o of this._order){let g=this._layers[o];"symbol"===g.type&&this.placement.updateLayerOpacities(g,c[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(let a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(d,a,c){this.imageManager.getImages(a.icons,c),this._updateTilesForChangedImages();let b=this.sourceCaches[a.source];b&&b.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(c,a,b){this.glyphManager.getGlyphs(a.stacks,b)}getResource(d,b,c){return a.makeRequest(b,c)}}g.getSourceType=function(a){return Z[a]},g.setSourceType=function(a,b){Z[a]=b},g.registerForPluginStateChange=a.registerForPluginStateChange;var a_=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),a0={prelude:a1("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),background:a1("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:a1("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:a1("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:a1("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:a1("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:a1("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:a1("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:a1("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:a1("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:a1("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:a1("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:a1("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:a1("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:a1("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:a1("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:a1("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:a1("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:a1("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),lineGradient:a1("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),linePattern:a1("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:a1("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:a1("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:a1("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),symbolSDF:a1("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:a1("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}")};function a1(b,a){let c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=a.match(/attribute ([\w]+) ([\w]+)/g),d=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),e=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e?e.concat(d):d,h={};return{fragmentSource:b=b.replace(c,(e,d,b,c,a)=>(h[a]=!0,"define"===d?`
#ifndef HAS_UNIFORM_u_${a}
varying ${b} ${c} ${a};
#else
uniform ${b} ${c} u_${a};
#endif
`:`
#ifdef HAS_UNIFORM_u_${a}
    ${b} ${c} ${a} = u_${a};
#endif
`)),vertexSource:a=a.replace(c,(g,f,b,c,a)=>{let e="float"===c?"vec2":"vec4",d=a.match(/color/)?"color":e;return h[a]?"define"===f?`
#ifndef HAS_UNIFORM_u_${a}
uniform lowp float u_${a}_t;
attribute ${b} ${e} a_${a};
varying ${b} ${c} ${a};
#else
uniform ${b} ${c} u_${a};
#endif
`:"vec4"===d?`
#ifndef HAS_UNIFORM_u_${a}
    ${a} = a_${a};
#else
    ${b} ${c} ${a} = u_${a};
#endif
`:`
#ifndef HAS_UNIFORM_u_${a}
    ${a} = unpack_mix_${d}(a_${a}, u_${a}_t);
#else
    ${b} ${c} ${a} = u_${a};
#endif
`:"define"===f?`
#ifndef HAS_UNIFORM_u_${a}
uniform lowp float u_${a}_t;
attribute ${b} ${e} a_${a};
#else
uniform ${b} ${c} u_${a};
#endif
`:"vec4"===d?`
#ifndef HAS_UNIFORM_u_${a}
    ${b} ${c} ${a} = a_${a};
#else
    ${b} ${c} ${a} = u_${a};
#endif
`:`
#ifndef HAS_UNIFORM_u_${a}
    ${b} ${c} ${a} = unpack_mix_${d}(a_${a}, u_${a}_t);
#else
    ${b} ${c} ${a} = u_${a};
#endif
`}),staticAttributes:f,staticUniforms:g}}class a2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(f,h,i,b,a,j,c,d){this.context=f;let g=this.boundPaintVertexBuffers.length!==b.length;for(let e=0;!g&&e<b.length;e++)this.boundPaintVertexBuffers[e]!==b[e]&&(g=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===i&&!g&&this.boundIndexBuffer===a&&this.boundVertexOffset===j&&this.boundDynamicVertexBuffer===c&&this.boundDynamicVertexBuffer2===d?(f.bindVertexArrayOES.set(this.vao),c&&c.bind(),a&&a.dynamicDraw&&a.bind(),d&&d.bind()):this.freshBind(h,i,b,a,j,c,d)}freshBind(a,g,h,i,f,c,d){let j,l=a.numAttributes,e=this.context,b=e.gl;if(e.extVertexArrayObject)this.vao&&this.destroy(),this.vao=e.extVertexArrayObject.createVertexArrayOES(),e.bindVertexArrayOES.set(this.vao),j=0,this.boundProgram=a,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=i,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=c,this.boundDynamicVertexBuffer2=d;else{j=e.currentNumAttributes||0;for(let k=l;k<j;k++)b.disableVertexAttribArray(k)}for(let n of(g.enableAttributes(b,a),h))n.enableAttributes(b,a);for(let m of(c&&c.enableAttributes(b,a),d&&d.enableAttributes(b,a),g.bind(),g.setVertexAttribPointers(b,a,f),h))m.bind(),m.setVertexAttribPointers(b,a,f);c&&(c.bind(),c.setVertexAttribPointers(b,a,f)),i&&i.bind(),d&&(d.bind(),d.setVertexAttribPointers(b,a,f)),e.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function a3(b){let c=[];for(let a=0;a<b.length;a++){if(null===b[a])continue;let d=b[a].split(" ");c.push(d.pop())}return c}class a4{constructor(k,y,d,b,p,q){let a=k.gl;this.program=a.createProgram();let r=a3(d.staticAttributes),s=b?b.getBinderAttributes():[],e=r.concat(s),t=d.staticUniforms?a3(d.staticUniforms):[],u=b?b.getBinderUniforms():[],v=t.concat(u),f=[];for(let n of v)0>f.indexOf(n)&&f.push(n);let l=b?b.defines():[];q&&l.push("#define OVERDRAW_INSPECTOR;");let w=l.concat(a0.prelude.fragmentSource,d.fragmentSource).join("\n"),x=l.concat(a0.prelude.vertexSource,d.vertexSource).join("\n"),g=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(g,w),a.compileShader(g),a.attachShader(this.program,g);let h=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(h,x),a.compileShader(h),a.attachShader(this.program,h),this.attributes={};let i={};this.numAttributes=e.length;for(let c=0;c<this.numAttributes;c++)e[c]&&(a.bindAttribLocation(this.program,c,e[c]),this.attributes[e[c]]=c);a.linkProgram(this.program),a.deleteShader(h),a.deleteShader(g);for(let m=0;m<f.length;m++){let j=f[m];if(j&&!i[j]){let o=a.getUniformLocation(this.program,j);o&&(i[j]=o)}}this.fixedUniforms=p(k,i),this.binderUniforms=b?b.getUniforms(k,i):[]}draw(a,e,j,k,l,m,n,f,o,p,q,r,s,d,t,u){let b=a.gl;if(this.failedToCreate)return;for(let g in a.program.set(this.program),a.setDepthMode(j),a.setStencilMode(k),a.setColorMode(l),a.setCullFace(m),this.fixedUniforms)this.fixedUniforms[g].set(n[g]);d&&d.setUniforms(a,this.binderUniforms,r,{zoom:s});let h={[b.LINES]:2,[b.TRIANGLES]:3,[b.LINE_STRIP]:1}[e];for(let c of q.get()){let i=c.vaos||(c.vaos={});(i[f]||(i[f]=new a2)).bind(a,this,o,d?d.getPaintVertexBuffers():[],p,c.vertexOffset,t,u),b.drawElements(e,c.primitiveLength*h,b.UNSIGNED_SHORT,c.primitiveOffset*h*2)}}}function a5(b,c,a){let h=1/aH(a,1,c.transform.tileZoom),d=Math.pow(2,a.tileID.overscaledZ),e=a.tileSize*Math.pow(2,c.transform.tileZoom)/d,f=e*(a.tileID.canonical.x+a.tileID.wrap*d),g=e*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[f>>16,g>>16],u_pixel_coord_lower:[65535&f,65535&g]}}let a6=(s,p,t,u)=>{var b,c,q,k,l,e,f,d,g,h,i;let j=p.style.light,m=j.properties.get("position"),n=[m.x,m.y,m.z],r=(b=new a.ARRAY_TYPE(9),a.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b);"viewport"===j.properties.get("anchor")&&(c=r,k=Math.sin(q=-p.transform.angle),l=Math.cos(q),c[0]=l,c[1]=k,c[2]=0,c[3]=-k,c[4]=l,c[5]=0,c[6]=0,c[7]=0,c[8]=1),e=n,f=n,d=r,g=f[0],h=f[1],i=f[2],e[0]=g*d[0]+h*d[3]+i*d[6],e[1]=g*d[1]+h*d[4]+i*d[7],e[2]=g*d[2]+h*d[5]+i*d[8];let o=j.properties.get("color");return{u_matrix:s,u_lightpos:n,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[o.r,o.g,o.b],u_vertical_gradient:+t,u_opacity:u}},a7=(d,b,e,f,g,h,c)=>a.extend(a6(d,b,e,f),a5(h,b,c),{u_height_factor:-Math.pow(2,g.overscaledZ)/c.tileSize/8}),a8=a=>({u_matrix:a}),a9=(b,c,d,e)=>a.extend(a8(b),a5(d,c,e)),ba=(a,b)=>({u_matrix:a,u_world:b}),bb=(b,c,d,e,f)=>a.extend(a9(b,c,d,e),{u_world:f}),bc=(b,h,f,a)=>{let c=b.transform,d,e;if("map"===a.paint.get("circle-pitch-alignment")){let g=aH(f,1,c.zoom);d=!0,e=[g,g]}else d=!1,e=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+("map"===a.paint.get("circle-pitch-scale")),u_matrix:b.translatePosMatrix(h.posMatrix,f,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:e}},bd=(e,a,b)=>{let c=aH(b,1,a.zoom),d=Math.pow(2,a.zoom-b.tileID.overscaledZ),f=b.tileID.overscaleFactor();return{u_matrix:e,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[a.pixelsToGLUnits[0]/(c*d),a.pixelsToGLUnits[1]/(c*d)],u_overscale_factor:f}},be=(a,b,c=1)=>({u_matrix:a,u_color:b,u_overlay:0,u_overlay_scale:c}),bf=a=>({u_matrix:a}),bg=(a,b,c,d)=>({u_matrix:a,u_extrude_scale:aH(b,1,c),u_intensity:d}),bh=(a,c,d)=>{let b=a.transform;return{u_matrix:bm(a,c,d),u_ratio:1/aH(c,1,b.zoom),u_device_pixel_ratio:a.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},bi=(b,c,d,e)=>a.extend(bh(b,c,d),{u_image:0,u_image_height:e}),bj=(c,a,e,d)=>{let b=c.transform,f=bl(a,b);return{u_matrix:bm(c,a,e),u_texsize:a.imageAtlasTexture.size,u_ratio:1/aH(a,1,b.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[f,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},bk=(b,g,h,i,c)=>{let d=b.lineAtlas,j=bl(g,b.transform),k="round"===h.layout.get("line-cap"),e=d.getDash(i.from,k),f=d.getDash(i.to,k),l=e.width*c.fromScale,m=f.width*c.toScale;return a.extend(bh(b,g,h),{u_patternscale_a:[j/l,-e.height/2],u_patternscale_b:[j/m,-f.height/2],u_sdfgamma:d.width/(256*Math.min(l,m)*b.pixelRatio)/2,u_image:0,u_tex_y_a:e.y,u_tex_y_b:f.y,u_mix:c.t})};function bl(a,b){return 1/aH(a,1,b.tileZoom)}function bm(c,a,b){return c.translatePosMatrix(a.tileID.posMatrix,a,b.paint.get("line-translate"),b.paint.get("line-translate-anchor"))}let bn=(e,f,g,d,a)=>{var b,c;return{u_matrix:e,u_tl_parent:f,u_scale_parent:g,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(c=a.paint.get("raster-saturation"))>0?1-1/(1.001-c):-c,u_contrast_factor:(b=a.paint.get("raster-contrast"))>0?1/(1-b):1+b,u_spin_weights:bo(a.paint.get("raster-hue-rotate"))}};function bo(a){a*=Math.PI/180;let c=Math.sin(a),b=Math.cos(a);return[(2*b+1)/3,(-Math.sqrt(3)*c-b+1)/3,(Math.sqrt(3)*c-b+1)/3]}let bp=(a,b,e,f,d,g,h,i,j,k)=>{let c=d.transform;return{u_is_size_zoom_constant:+("constant"===a||"source"===a),u_is_size_feature_constant:+("constant"===a||"camera"===a),u_size_t:b?b.uSizeT:0,u_size:b?b.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+e,u_aspect_ratio:c.width/c.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:h,u_coord_matrix:i,u_is_text:+j,u_pitch_with_map:+f,u_texsize:k,u_texture:0}},bq=(e,f,g,c,b,h,i,j,k,l,m)=>{let d=b.transform;return a.extend(bp(e,f,g,c,b,h,i,j,k,l),{u_gamma_scale:c?Math.cos(d._pitch)*d.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:+m})},br=(b,c,d,e,f,g,h,i,j,k)=>a.extend(bq(b,c,d,e,f,g,h,i,!0,j,!0),{u_texsize_icon:k,u_texture_icon:1}),bs=(a,b,c)=>({u_matrix:a,u_opacity:b,u_color:c}),bt=(b,c,d,e,f,g)=>a.extend(function(f,c,b,a){let d=b.imageManager.getPattern(f.from.toString()),e=b.imageManager.getPattern(f.to.toString()),{width:k,height:l}=b.imageManager.getPixelSize(),g=Math.pow(2,a.tileID.overscaledZ),h=a.tileSize*Math.pow(2,b.transform.tileZoom)/g,i=h*(a.tileID.canonical.x+a.tileID.wrap*g),j=h*a.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:d.tl,u_pattern_br_a:d.br,u_pattern_tl_b:e.tl,u_pattern_br_b:e.br,u_texsize:[k,l],u_mix:c.t,u_pattern_size_a:d.displaySize,u_pattern_size_b:e.displaySize,u_scale_a:c.fromScale,u_scale_b:c.toScale,u_tile_units_to_pixels:1/aH(a,1,b.transform.tileZoom),u_pixel_coord_upper:[i>>16,j>>16],u_pixel_coord_lower:[65535&i,65535&j]}}(e,g,d,f),{u_matrix:b,u_opacity:c}),bu={fillExtrusion:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_lightpos:new a.Uniform3f(b,c.u_lightpos),u_lightintensity:new a.Uniform1f(b,c.u_lightintensity),u_lightcolor:new a.Uniform3f(b,c.u_lightcolor),u_vertical_gradient:new a.Uniform1f(b,c.u_vertical_gradient),u_opacity:new a.Uniform1f(b,c.u_opacity)}),fillExtrusionPattern:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_lightpos:new a.Uniform3f(b,c.u_lightpos),u_lightintensity:new a.Uniform1f(b,c.u_lightintensity),u_lightcolor:new a.Uniform3f(b,c.u_lightcolor),u_vertical_gradient:new a.Uniform1f(b,c.u_vertical_gradient),u_height_factor:new a.Uniform1f(b,c.u_height_factor),u_image:new a.Uniform1i(b,c.u_image),u_texsize:new a.Uniform2f(b,c.u_texsize),u_pixel_coord_upper:new a.Uniform2f(b,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(b,c.u_pixel_coord_lower),u_scale:new a.Uniform3f(b,c.u_scale),u_fade:new a.Uniform1f(b,c.u_fade),u_opacity:new a.Uniform1f(b,c.u_opacity)}),fill:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix)}),fillPattern:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_image:new a.Uniform1i(b,c.u_image),u_texsize:new a.Uniform2f(b,c.u_texsize),u_pixel_coord_upper:new a.Uniform2f(b,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(b,c.u_pixel_coord_lower),u_scale:new a.Uniform3f(b,c.u_scale),u_fade:new a.Uniform1f(b,c.u_fade)}),fillOutline:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_world:new a.Uniform2f(b,c.u_world)}),fillOutlinePattern:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_world:new a.Uniform2f(b,c.u_world),u_image:new a.Uniform1i(b,c.u_image),u_texsize:new a.Uniform2f(b,c.u_texsize),u_pixel_coord_upper:new a.Uniform2f(b,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(b,c.u_pixel_coord_lower),u_scale:new a.Uniform3f(b,c.u_scale),u_fade:new a.Uniform1f(b,c.u_fade)}),circle:(b,c)=>({u_camera_to_center_distance:new a.Uniform1f(b,c.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(b,c.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(b,c.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(b,c.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(b,c.u_matrix)}),collisionBox:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_camera_to_center_distance:new a.Uniform1f(b,c.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(b,c.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(b,c.u_extrude_scale),u_overscale_factor:new a.Uniform1f(b,c.u_overscale_factor)}),collisionCircle:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_inv_matrix:new a.UniformMatrix4f(b,c.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(b,c.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(b,c.u_viewport_size)}),debug:(b,c)=>({u_color:new a.UniformColor(b,c.u_color),u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_overlay:new a.Uniform1i(b,c.u_overlay),u_overlay_scale:new a.Uniform1f(b,c.u_overlay_scale)}),clippingMask:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix)}),heatmap:(b,c)=>({u_extrude_scale:new a.Uniform1f(b,c.u_extrude_scale),u_intensity:new a.Uniform1f(b,c.u_intensity),u_matrix:new a.UniformMatrix4f(b,c.u_matrix)}),heatmapTexture:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_world:new a.Uniform2f(b,c.u_world),u_image:new a.Uniform1i(b,c.u_image),u_color_ramp:new a.Uniform1i(b,c.u_color_ramp),u_opacity:new a.Uniform1f(b,c.u_opacity)}),hillshade:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_image:new a.Uniform1i(b,c.u_image),u_latrange:new a.Uniform2f(b,c.u_latrange),u_light:new a.Uniform2f(b,c.u_light),u_shadow:new a.UniformColor(b,c.u_shadow),u_highlight:new a.UniformColor(b,c.u_highlight),u_accent:new a.UniformColor(b,c.u_accent)}),hillshadePrepare:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_image:new a.Uniform1i(b,c.u_image),u_dimension:new a.Uniform2f(b,c.u_dimension),u_zoom:new a.Uniform1f(b,c.u_zoom),u_unpack:new a.Uniform4f(b,c.u_unpack)}),line:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_ratio:new a.Uniform1f(b,c.u_ratio),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(b,c.u_units_to_pixels)}),lineGradient:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_ratio:new a.Uniform1f(b,c.u_ratio),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(b,c.u_units_to_pixels),u_image:new a.Uniform1i(b,c.u_image),u_image_height:new a.Uniform1f(b,c.u_image_height)}),linePattern:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_texsize:new a.Uniform2f(b,c.u_texsize),u_ratio:new a.Uniform1f(b,c.u_ratio),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_image:new a.Uniform1i(b,c.u_image),u_units_to_pixels:new a.Uniform2f(b,c.u_units_to_pixels),u_scale:new a.Uniform3f(b,c.u_scale),u_fade:new a.Uniform1f(b,c.u_fade)}),lineSDF:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_ratio:new a.Uniform1f(b,c.u_ratio),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(b,c.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(b,c.u_patternscale_a),u_patternscale_b:new a.Uniform2f(b,c.u_patternscale_b),u_sdfgamma:new a.Uniform1f(b,c.u_sdfgamma),u_image:new a.Uniform1i(b,c.u_image),u_tex_y_a:new a.Uniform1f(b,c.u_tex_y_a),u_tex_y_b:new a.Uniform1f(b,c.u_tex_y_b),u_mix:new a.Uniform1f(b,c.u_mix)}),raster:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_tl_parent:new a.Uniform2f(b,c.u_tl_parent),u_scale_parent:new a.Uniform1f(b,c.u_scale_parent),u_buffer_scale:new a.Uniform1f(b,c.u_buffer_scale),u_fade_t:new a.Uniform1f(b,c.u_fade_t),u_opacity:new a.Uniform1f(b,c.u_opacity),u_image0:new a.Uniform1i(b,c.u_image0),u_image1:new a.Uniform1i(b,c.u_image1),u_brightness_low:new a.Uniform1f(b,c.u_brightness_low),u_brightness_high:new a.Uniform1f(b,c.u_brightness_high),u_saturation_factor:new a.Uniform1f(b,c.u_saturation_factor),u_contrast_factor:new a.Uniform1f(b,c.u_contrast_factor),u_spin_weights:new a.Uniform3f(b,c.u_spin_weights)}),symbolIcon:(b,c)=>({u_is_size_zoom_constant:new a.Uniform1i(b,c.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(b,c.u_is_size_feature_constant),u_size_t:new a.Uniform1f(b,c.u_size_t),u_size:new a.Uniform1f(b,c.u_size),u_camera_to_center_distance:new a.Uniform1f(b,c.u_camera_to_center_distance),u_pitch:new a.Uniform1f(b,c.u_pitch),u_rotate_symbol:new a.Uniform1i(b,c.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(b,c.u_aspect_ratio),u_fade_change:new a.Uniform1f(b,c.u_fade_change),u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(b,c.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(b,c.u_coord_matrix),u_is_text:new a.Uniform1i(b,c.u_is_text),u_pitch_with_map:new a.Uniform1i(b,c.u_pitch_with_map),u_texsize:new a.Uniform2f(b,c.u_texsize),u_texture:new a.Uniform1i(b,c.u_texture)}),symbolSDF:(b,c)=>({u_is_size_zoom_constant:new a.Uniform1i(b,c.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(b,c.u_is_size_feature_constant),u_size_t:new a.Uniform1f(b,c.u_size_t),u_size:new a.Uniform1f(b,c.u_size),u_camera_to_center_distance:new a.Uniform1f(b,c.u_camera_to_center_distance),u_pitch:new a.Uniform1f(b,c.u_pitch),u_rotate_symbol:new a.Uniform1i(b,c.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(b,c.u_aspect_ratio),u_fade_change:new a.Uniform1f(b,c.u_fade_change),u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(b,c.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(b,c.u_coord_matrix),u_is_text:new a.Uniform1i(b,c.u_is_text),u_pitch_with_map:new a.Uniform1i(b,c.u_pitch_with_map),u_texsize:new a.Uniform2f(b,c.u_texsize),u_texture:new a.Uniform1i(b,c.u_texture),u_gamma_scale:new a.Uniform1f(b,c.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(b,c.u_is_halo)}),symbolTextAndIcon:(b,c)=>({u_is_size_zoom_constant:new a.Uniform1i(b,c.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(b,c.u_is_size_feature_constant),u_size_t:new a.Uniform1f(b,c.u_size_t),u_size:new a.Uniform1f(b,c.u_size),u_camera_to_center_distance:new a.Uniform1f(b,c.u_camera_to_center_distance),u_pitch:new a.Uniform1f(b,c.u_pitch),u_rotate_symbol:new a.Uniform1i(b,c.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(b,c.u_aspect_ratio),u_fade_change:new a.Uniform1f(b,c.u_fade_change),u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(b,c.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(b,c.u_coord_matrix),u_is_text:new a.Uniform1i(b,c.u_is_text),u_pitch_with_map:new a.Uniform1i(b,c.u_pitch_with_map),u_texsize:new a.Uniform2f(b,c.u_texsize),u_texsize_icon:new a.Uniform2f(b,c.u_texsize_icon),u_texture:new a.Uniform1i(b,c.u_texture),u_texture_icon:new a.Uniform1i(b,c.u_texture_icon),u_gamma_scale:new a.Uniform1f(b,c.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(b,c.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(b,c.u_is_halo)}),background:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_opacity:new a.Uniform1f(b,c.u_opacity),u_color:new a.UniformColor(b,c.u_color)}),backgroundPattern:(b,c)=>({u_matrix:new a.UniformMatrix4f(b,c.u_matrix),u_opacity:new a.Uniform1f(b,c.u_opacity),u_image:new a.Uniform1i(b,c.u_image),u_pattern_tl_a:new a.Uniform2f(b,c.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(b,c.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(b,c.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(b,c.u_pattern_br_b),u_texsize:new a.Uniform2f(b,c.u_texsize),u_mix:new a.Uniform1f(b,c.u_mix),u_pattern_size_a:new a.Uniform2f(b,c.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(b,c.u_pattern_size_b),u_scale_a:new a.Uniform1f(b,c.u_scale_a),u_scale_b:new a.Uniform1f(b,c.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(b,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(b,c.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(b,c.u_tile_units_to_pixels)})};class bv{constructor(b,c,d){this.context=b;let a=b.gl;this.buffer=a.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),b.bindElementBuffer.set(this.buffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(b){let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,b.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let bw={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bx{constructor(c,b,d,e){this.length=b.length,this.attributes=d,this.itemSize=b.bytesPerElement,this.dynamicDraw=e,this.context=c;let a=c.gl;this.buffer=a.createBuffer(),c.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(b){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,b.arrayBuffer)}enableAttributes(c,d){for(let a=0;a<this.attributes.length;a++){let b=d.attributes[this.attributes[a].name];void 0!==b&&c.enableVertexAttribArray(b)}}setVertexAttribPointers(c,e,f){for(let b=0;b<this.attributes.length;b++){let a=this.attributes[b],d=e.attributes[a.name];void 0!==d&&c.vertexAttribPointer(d,a.components,c[bw[a.type]],!1,this.itemSize,a.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class C{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class by extends C{constructor(a,b){super(a),this.context=a,this.parent=b}getDefault(){return null}}class bz{constructor(a,c,d,e){this.context=a,this.width=c,this.height=d;let b=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new class extends by{setDirty(){this.dirty=!0}set(b){if(b===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0),this.current=b,this.dirty=!1}}(a,b),e&&(this.depthAttachment=new class extends by{set(b){if(b===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b),this.current=b,this.dirty=!1}}(a,b))}destroy(){let a=this.context.gl,b=this.colorAttachment.get();if(b&&a.deleteTexture(b),this.depthAttachment){let c=this.depthAttachment.get();c&&a.deleteRenderbuffer(c)}a.deleteFramebuffer(this.framebuffer)}}class b{constructor(a,b,c){this.blendFunction=a,this.blendColor=b,this.mask=c}}b.Replace=[1,0],b.disabled=new b(b.Replace,a.Color.transparent,[!1,!1,!1,!1]),b.unblended=new b(b.Replace,a.Color.transparent,[!0,!0,!0,!0]),b.alphaBlended=new b([1,771],a.Color.transparent,[!0,!0,!0,!0]);class d{constructor(a,b,c){this.func=a,this.mask=b,this.range=c}}d.ReadOnly=!1,d.ReadWrite=!0,d.disabled=new d(519,d.ReadOnly,[0,1]);class w{constructor(a,b,c,d,e,f){this.test=a,this.ref=b,this.mask=c,this.fail=d,this.depthFail=e,this.pass=f}}w.disabled=new w({func:519,mask:0},0,0,7680,7680,7680);class h{constructor(a,b,c){this.enable=a,this.mode=b,this.frontFace=c}}let bA;function bB(b,J,t,D,u,K,E){var v;let f=b.context,F=f.gl,L=b.useProgram("collisionBox"),l=[],g=0,G=0;for(let x=0;x<D.length;x++){let y=D[x],z=J.getTile(y),e=z.getBucket(t);if(!e)continue;let A=y.posMatrix;0===u[0]&&0===u[1]||(A=b.translatePosMatrix(y.posMatrix,z,u,K));let i=E?e.textCollisionBox:e.iconCollisionBox,B=e.collisionCircleArray;if(B.length>0){let m=a.create(),M=A;a.mul(m,e.placementInvProjMatrix,b.transform.glCoordMatrix),a.mul(m,m,e.placementViewportMatrix),l.push({circleArray:B,circleOffset:G,transform:M,invTransform:m}),g+=B.length/4,G=g}i&&L.draw(f,F.LINES,d.disabled,w.disabled,b.colorModeForRenderPass(),h.disabled,bd(A,b.transform,z),t.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,null,b.transform.zoom,null,null,i.collisionVertexBuffer)}if(!E||!l.length)return;let N=b.useProgram("collisionCircle"),c=new a.CollisionCircleLayoutArray;c.resize(4*g),c._trim();let n=0;for(let j of l)for(let C=0;C<j.circleArray.length/4;C++){let o=4*C,p=j.circleArray[o+0],q=j.circleArray[o+1],r=j.circleArray[o+2],s=j.circleArray[o+3];c.emplace(n++,p,q,r,s,0),c.emplace(n++,p,q,r,s,1),c.emplace(n++,p,q,r,s,2),c.emplace(n++,p,q,r,s,3)}(!bA||bA.length<2*g)&&(bA=function(f){let e=2*f,b=new a.QuadTriangleArray;b.resize(e),b._trim();for(let c=0;c<e;c++){let d=6*c;b.uint16[d+0]=4*c+0,b.uint16[d+1]=4*c+1,b.uint16[d+2]=4*c+2,b.uint16[d+3]=4*c+2,b.uint16[d+4]=4*c+3,b.uint16[d+5]=4*c+0}return b}(g));let H=f.createIndexBuffer(bA,!0),I=f.createVertexBuffer(c,a.collisionCircleLayout.members,!0);for(let k of l){let O={u_matrix:k.transform,u_inv_matrix:k.invTransform,u_camera_to_center_distance:(v=b.transform).cameraToCenterDistance,u_viewport_size:[v.width,v.height]};N.draw(f,F.TRIANGLES,d.disabled,w.disabled,b.colorModeForRenderPass(),h.disabled,O,t.id,I,H,a.SegmentVector.simpleSegment(0,2*k.circleOffset,k.circleArray.length,k.circleArray.length/2),null,b.transform.zoom,null,null,null)}I.destroy(),H.destroy()}h.disabled=new h(!1,1029,2305),h.backCCW=new h(!0,1029,2305);let bC=a.identity(new Float32Array(16));function bD(b,f,g,h,c,d){let{horizontalAlign:i,verticalAlign:j}=a.getAnchorAlignment(b),e=a.evaluateVariableOffset(b,h);return new a.pointGeometry((-(i-.5)*f/c+e[0])*d,(-(j-.5)*g/c+e[1])*d)}function bE(c,z,h,A,l,m,B,C,D,n){let o=c.text.placedSymbolArray,e=c.text.dynamicLayoutVertexArray,d=c.icon.dynamicLayoutVertexArray,p={};e.clear();for(let i=0;i<o.length;i++){let b=o.get(i),E=c.allowVerticalPlacement&&!b.placedOrientation,q=b.hidden||!b.crossTileID||E?null:A[b.crossTileID];if(q){let r=new a.pointGeometry(b.anchorX,b.anchorY),s=av(r,h?B:m),F=aw(l.cameraToCenterDistance,s.signedDistanceFromCamera),t=a.evaluateSizeForFeature(c.textSizeData,D,b)*F/a.ONE_EM;h&&(t*=c.tilePixelRatio/C);let{width:G,height:H,anchor:I,textOffset:J,textBoxScale:K}=q,j=bD(I,G,H,J,K,t),u=h?av(r.add(j),m).point:s.point.add(z?j.rotate(-l.angle):j),v=c.allowVerticalPlacement&&b.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let w=0;w<b.numGlyphs;w++)a.addDynamicAttributes(e,u,v);n&&b.associatedIconIndex>=0&&(p[b.associatedIconIndex]={shiftedAnchor:u,angle:v})}else aF(b.numGlyphs,e)}if(n){d.clear();let x=c.icon.placedSymbolArray;for(let f=0;f<x.length;f++){let g=x.get(f);if(g.hidden)aF(g.numGlyphs,d);else{let k=p[f];if(k)for(let y=0;y<g.numGlyphs;y++)a.addDynamicAttributes(d,k.shiftedAnchor,k.angle);else aF(g.numGlyphs,d)}}c.icon.dynamicLayoutVertexBuffer.updateData(d)}c.text.dynamicLayoutVertexBuffer.updateData(e)}function bF(a,b,c){return c.iconsInText&&b?"symbolTextAndIcon":a?"symbolSDF":"symbolIcon"}function bG(b,V,f,W,g,C,D,E,X,Y,F,G){let q=b.context,i=q.gl,H=b.transform,r="map"===E,j="map"===X,s="viewport"!==E&&"point"!==f.layout.get("symbol-placement"),t=r&&!j&&!s,Z=!f.layout.get("symbol-sort-key").isConstant(),I=!1,J=b.depthModeForSublayer(0,d.ReadOnly),K=f.layout.get("text-variable-anchor"),p=[];for(let m of W){let h=V.getTile(m),c=h.getBucket(f);if(!c)continue;let k=g?c.text:c.icon;if(!k||!k.segments.get().length)continue;let $=k.programConfigurations.get(f.id),n=g||c.sdfIcons,l=g?c.textSizeData:c.iconSizeData,L=j||0!==H.pitch,_=b.useProgram(bF(n,g,c),$),u=a.evaluateSizeForZoom(l,H.zoom),o,v,w,M,N=[0,0],O=null;if(g){if(v=h.glyphAtlasTexture,w=i.LINEAR,o=h.glyphAtlasTexture.size,c.iconsInText){N=h.imageAtlasTexture.size,O=h.imageAtlasTexture;let aa="composite"===l.kind||"camera"===l.kind;M=L||b.options.rotating||b.options.zooming||aa?i.LINEAR:i.NEAREST}}else{let ab=1!==f.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;v=h.imageAtlasTexture,w=n||b.options.rotating||b.options.zooming||ab||L?i.LINEAR:i.NEAREST,o=h.imageAtlasTexture.size}let P=aH(h,1,b.transform.zoom),Q=at(m.posMatrix,j,r,b.transform,P),R=au(m.posMatrix,j,r,b.transform,P),ac=K&&c.hasTextData(),ad="none"!==f.layout.get("icon-text-fit")&&ac&&c.hasIconData();if(s){let ae="map"===f.layout.get("text-rotation-alignment");ay(c,m.posMatrix,b,g,Q,R,j,Y,ae)}let x=b.translatePosMatrix(m.posMatrix,h,C,D),y=s||g&&K||ad?bC:Q,z=b.translatePosMatrix(R,h,C,D,!0),af=n&&0!==f.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1),S;S=n?c.iconsInText?br(l.kind,u,t,j,b,x,y,z,o,N):bq(l.kind,u,t,j,b,x,y,z,g,o,!0):bp(l.kind,u,t,j,b,x,y,z,g,o);let T={program:_,buffers:k,uniformValues:S,atlasTexture:v,atlasTextureIcon:O,atlasInterpolation:w,atlasInterpolationIcon:M,isSDF:n,hasHalo:af};if(Z&&c.canOverlap){I=!0;let ag=k.segments.get();for(let U of ag)p.push({segments:new a.SegmentVector([U]),sortKey:U.sortKey,state:T})}else p.push({segments:k.segments,sortKey:0,state:T})}for(let A of(I&&p.sort((a,b)=>a.sortKey-b.sortKey),p)){let e=A.state;if(q.activeTexture.set(i.TEXTURE0),e.atlasTexture.bind(e.atlasInterpolation,i.CLAMP_TO_EDGE),e.atlasTextureIcon&&(q.activeTexture.set(i.TEXTURE1),e.atlasTextureIcon&&e.atlasTextureIcon.bind(e.atlasInterpolationIcon,i.CLAMP_TO_EDGE)),e.isSDF){let B=e.uniformValues;e.hasHalo&&(B.u_is_halo=1,bH(e.buffers,A.segments,f,b,e.program,J,F,G,B)),B.u_is_halo=0}bH(e.buffers,A.segments,f,b,e.program,J,F,G,e.uniformValues)}}function bH(a,e,b,c,f,g,i,j,k){let d=c.context;f.draw(d,d.gl.TRIANGLES,g,i,j,h.disabled,k,b.id,a.layoutVertexBuffer,a.indexBuffer,e,b.paint,c.transform.zoom,a.programConfigurations.get(b.id),a.dynamicLayoutVertexBuffer,a.opacityVertexBuffer)}function bI(a,x,b,y,z,A,s){let d=a.context.gl,k=b.paint.get("fill-pattern"),f=k&&k.constantOr(1),l=b.getCrossfadeParameters(),m,g,n,o,p;for(let q of(s?(g=f&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",m=d.LINES):(g=f?"fillPattern":"fill",m=d.TRIANGLES),y)){let c=x.getTile(q);if(f&&!c.patternsLoaded())continue;let e=c.getBucket(b);if(!e)continue;let i=e.programConfigurations.get(b.id),B=a.useProgram(g,i);f&&(a.context.activeTexture.set(d.TEXTURE0),c.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),i.updatePaintBuffers(l));let r=k.constantOr(null);if(r&&c.imageAtlas){let t=c.imageAtlas,u=t.patternPositions[r.to.toString()],v=t.patternPositions[r.from.toString()];u&&v&&i.setConstantPatternPositions(u,v)}let j=a.translatePosMatrix(q.posMatrix,c,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));if(s){o=e.indexBuffer2,p=e.segments2;let w=[d.drawingBufferWidth,d.drawingBufferHeight];n="fillOutlinePattern"===g&&f?bb(j,a,l,c,w):ba(j,w)}else o=e.indexBuffer,p=e.segments,n=f?a9(j,a,l,c):a8(j);B.draw(a.context,m,z,a.stencilModeForClipping(q),A,h.disabled,n,b.id,e.layoutVertexBuffer,o,p,b.paint,a.transform.zoom,i)}}function bJ(b,t,a,u,v,w,x){let f=b.context,g=f.gl,l=a.paint.get("fill-extrusion-pattern"),i=l.constantOr(1),m=a.getCrossfadeParameters(),n=a.paint.get("fill-extrusion-opacity");for(let j of u){let c=t.getTile(j),d=c.getBucket(a);if(!d)continue;let e=d.programConfigurations.get(a.id),y=b.useProgram(i?"fillExtrusionPattern":"fillExtrusion",e);i&&(b.context.activeTexture.set(g.TEXTURE0),c.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),e.updatePaintBuffers(m));let k=l.constantOr(null);if(k&&c.imageAtlas){let o=c.imageAtlas,p=o.patternPositions[k.to.toString()],q=o.patternPositions[k.from.toString()];p&&q&&e.setConstantPatternPositions(p,q)}let r=b.translatePosMatrix(j.posMatrix,c,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),s=a.paint.get("fill-extrusion-vertical-gradient"),z=i?a7(r,b,s,n,j,m,c):a6(r,b,s,n);y.draw(f,f.gl.TRIANGLES,v,w,x,h.backCCW,z,a.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,a.paint,b.transform.zoom,e)}}function bK(b,e,f,i,j,k){let d=b.context,c=d.gl,g=e.fbo;if(!g)return;let l=b.useProgram("hillshade");d.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,g.colorAttachment.get());let m=((c,d,b)=>{let f=b.paint.get("hillshade-shadow-color"),g=b.paint.get("hillshade-highlight-color"),h=b.paint.get("hillshade-accent-color"),e=b.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===b.paint.get("hillshade-illumination-anchor")&&(e-=c.transform.angle);let i=!c.options.moving;return{u_matrix:c.transform.calculatePosMatrix(d.tileID.toUnwrapped(),i),u_image:0,u_latrange:function(e,b){let c=Math.pow(2,b.canonical.z),d=b.canonical.y;return[new a.MercatorCoordinate(0,d/c).toLngLat().lat,new a.MercatorCoordinate(0,(d+1)/c).toLngLat().lat]}(0,d.tileID),u_light:[b.paint.get("hillshade-exaggeration"),e],u_shadow:f,u_highlight:g,u_accent:h}})(b,e,f);l.draw(d,c.TRIANGLES,i,j,k,h.disabled,m,f.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function bL(e,b,m,n,o,p){let d=e.context,c=d.gl,f=b.dem;if(f&&f.data){let g=f.dim,q=f.stride,j=f.getPixels();if(d.activeTexture.set(c.TEXTURE1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),b.demTexture=b.demTexture||e.getTileTexture(q),b.demTexture){let k=b.demTexture;k.update(j,{premultiply:!1}),k.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else b.demTexture=new N(d,j,c.RGBA,{premultiply:!1}),b.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);d.activeTexture.set(c.TEXTURE0);let i=b.fbo;if(!i){let l=new N(d,{width:g,height:g,data:null},c.RGBA);l.bind(c.LINEAR,c.CLAMP_TO_EDGE),(i=b.fbo=d.createFramebuffer(g,g,!0)).colorAttachment.set(l.texture)}d.bindFramebuffer.set(i.framebuffer),d.viewport.set([0,0,g,g]),e.useProgram("hillshadePrepare").draw(d,c.TRIANGLES,n,o,p,h.disabled,((e,c)=>{let d=c.stride,b=a.create();return a.ortho(b,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(b,b,[0,-a.EXTENT,0]),{u_matrix:b,u_image:1,u_dimension:[d,d],u_zoom:e.overscaledZ,u_unpack:c.getUnpackVector()}})(b.tileID,f),m.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),b.needsHillshadePrepare=!1}}function bM(b,c,k,l,m){let d=l.paint.get("raster-fade-duration");if(d>0){let e=a.exported.now(),f=(e-b.timeAdded)/d,n=c?(e-c.timeAdded)/d:-1,g=k.getSource(),h=m.coveringZoomLevel({tileSize:g.tileSize,roundZoom:g.roundZoom}),i=!c||Math.abs(c.tileID.overscaledZ-h)>Math.abs(b.tileID.overscaledZ-h),j=i&&b.refreshedUponExpiration?1:a.clamp(i?f:1-n,0,1);return b.refreshedUponExpiration&&f>=1&&(b.refreshedUponExpiration=!1),c?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}let bN=new a.Color(1,0,0,1),bO=new a.Color(0,1,0,1),bP=new a.Color(0,0,1,1),bQ=new a.Color(1,0,1,1),bR=new a.Color(0,1,1,1);function bS(a,c,b,d){bU(a,0,c+b/2,a.transform.width,b,d)}function bT(a,c,b,d){bU(a,c-b/2,0,b,a.transform.height,d)}function bU(a,d,e,f,g,h){let c=a.context,b=c.gl;b.enable(b.SCISSOR_TEST),b.scissor(d*a.pixelRatio,e*a.pixelRatio,f*a.pixelRatio,g*a.pixelRatio),c.clear({color:h}),b.disable(b.SCISSOR_TEST)}function bV(c,i,e){let g=c.context,f=g.gl,j=e.posMatrix,k=c.useProgram("debug"),l=d.disabled,m=w.disabled,q=c.colorModeForRenderPass(),n="$debug";g.activeTexture.set(f.TEXTURE0),c.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),k.draw(g,f.LINE_STRIP,l,m,q,h.disabled,be(j,a.Color.red),n,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);let o=i.getTileByID(e.key).latestRawTileData,r=Math.floor((o&&o.byteLength||0)/1024),s=i.getTile(e).tileSize,t=512/Math.min(s,512)*(e.overscaledZ/c.transform.zoom)*.5,p=e.canonical.toString();e.overscaledZ!==e.canonical.z&&(p+=` => ${e.overscaledZ}`),function(b,d){b.initDebugOverlayCanvas();let c=b.debugOverlayCanvas,e=b.context.gl,a=b.debugOverlayCanvas.getContext("2d");a.clearRect(0,0,c.width,c.height),a.shadowColor="white",a.shadowBlur=2,a.lineWidth=1.5,a.strokeStyle="white",a.textBaseline="top",a.font="bold 36px Open Sans, sans-serif",a.fillText(d,5,5),a.strokeText(d,5,5),b.debugOverlayTexture.update(c),b.debugOverlayTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}(c,`${p} ${r}kb`),k.draw(g,f.TRIANGLES,l,m,b.alphaBlended,h.disabled,be(j,a.Color.transparent,t),n,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}let bW={symbol:function(c,d,b,e,h){if("translucent"!==c.renderPass)return;let f=w.disabled,g=c.colorModeForRenderPass();b.layout.get("text-variable-anchor")&&function(k,c,g,l,m,n,o){let d=c.transform,h="map"===m,i="map"===n;for(let e of k){let f=l.getTile(e),b=f.getBucket(g);if(!b||!b.text||!b.text.segments.get().length)continue;let j=a.evaluateSizeForZoom(b.textSizeData,d.zoom),p=aH(f,1,c.transform.zoom),q=at(e.posMatrix,i,h,c.transform,p),r="none"!==g.layout.get("icon-text-fit")&&b.hasIconData();if(j){let s=Math.pow(2,d.zoom-f.tileID.overscaledZ);bE(b,h,i,o,d,q,e.posMatrix,s,j,r)}}}(e,c,b,d,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),h),0!==b.paint.get("icon-opacity").constantOr(1)&&bG(c,d,b,e,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),f,g),0!==b.paint.get("text-opacity").constantOr(1)&&bG(c,d,b,e,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),f,g),d.map.showCollisionBoxes&&(bB(c,d,b,e,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),!0),bB(c,d,b,e,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),!1))},circle:function(c,r,b,i){if("translucent"!==c.renderPass)return;let s=b.paint.get("circle-opacity"),t=b.paint.get("circle-stroke-width"),u=b.paint.get("circle-stroke-opacity"),j=!b.layout.get("circle-sort-key").isConstant();if(0===s.constantOr(1)&&(0===t.constantOr(1)||0===u.constantOr(1)))return;let k=c.context,v=k.gl,x=c.depthModeForSublayer(0,d.ReadOnly),y=w.disabled,z=c.colorModeForRenderPass(),f=[];for(let g=0;g<i.length;g++){let l=i[g],m=r.getTile(l),e=m.getBucket(b);if(!e)continue;let n=e.programConfigurations.get(b.id),o={programConfiguration:n,program:c.useProgram("circle",n),layoutVertexBuffer:e.layoutVertexBuffer,indexBuffer:e.indexBuffer,uniformValues:bc(c,l,m,b)};if(j){let A=e.segments.get();for(let p of A)f.push({segments:new a.SegmentVector([p]),sortKey:p.sortKey,state:o})}else f.push({segments:e.segments,sortKey:0,state:o})}for(let q of(j&&f.sort((a,b)=>a.sortKey-b.sortKey),f)){let{programConfiguration:B,program:C,layoutVertexBuffer:D,indexBuffer:E,uniformValues:F}=q.state;C.draw(k,v.TRIANGLES,x,y,z,h.disabled,F,b.id,D,E,q.segments,b.paint,c.transform.zoom,B)}},heatmap:function(c,l,e,m){if(0!==e.paint.get("heatmap-opacity")){if("offscreen"===c.renderPass){let f=c.context,i=f.gl,p=w.disabled,q=new b([i.ONE,i.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(b,c,e){let a=b.gl;b.activeTexture.set(a.TEXTURE1),b.viewport.set([0,0,c.width/4,c.height/4]);let d=e.heatmapFbo;if(d)a.bindTexture(a.TEXTURE_2D,d.colorAttachment.get()),b.bindFramebuffer.set(d.framebuffer);else{let f=a.createTexture();a.bindTexture(a.TEXTURE_2D,f),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),d=e.heatmapFbo=b.createFramebuffer(c.width/4,c.height/4,!1),function(b,c,d,e){let a=b.gl;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c.width/4,c.height/4,0,a.RGBA,b.extRenderToTextureHalfFloat?b.extTextureHalfFloat.HALF_FLOAT_OES:a.UNSIGNED_BYTE,null),e.colorAttachment.set(d)}(b,c,f,d)}})(f,c,e),f.clear({color:a.Color.transparent});for(let j=0;j<m.length;j++){let k=m[j];if(l.hasRenderableParent(k))continue;let n=l.getTile(k),g=n.getBucket(e);if(!g)continue;let o=g.programConfigurations.get(e.id),r=c.useProgram("heatmap",o),{zoom:s}=c.transform;r.draw(f,i.TRIANGLES,d.disabled,p,q,h.disabled,bg(k.posMatrix,n,s,e.paint.get("heatmap-intensity")),e.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,e.paint,c.transform.zoom,o)}f.viewport.set([0,0,c.width,c.height])}else"translucent"===c.renderPass&&(c.context.setColorMode(c.colorModeForRenderPass()),function(b,e){let f=b.context,c=f.gl,i=e.heatmapFbo;if(!i)return;f.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,i.colorAttachment.get()),f.activeTexture.set(c.TEXTURE1);let g=e.colorRampTexture;g||(g=e.colorRampTexture=new N(f,e.colorRamp,c.RGBA)),g.bind(c.LINEAR,c.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(f,c.TRIANGLES,d.disabled,w.disabled,b.colorModeForRenderPass(),h.disabled,((b,e,f,g)=>{let c=a.create();a.ortho(c,0,b.width,b.height,0,0,1);let d=b.context.gl;return{u_matrix:c,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}})(b,e),e.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,e.paint,b.transform.zoom)}(c,e))}},line:function(c,r,b,A){if("translucent"!==c.renderPass)return;let B=b.paint.get("line-opacity"),C=b.paint.get("line-width");if(0===B.constantOr(1)||0===C.constantOr(1))return;let D=c.depthModeForSublayer(0,d.ReadOnly),E=c.colorModeForRenderPass(),k=b.paint.get("line-dasharray"),s=b.paint.get("line-pattern"),l=s.constantOr(1),o=b.paint.get("line-gradient"),p=b.getCrossfadeParameters(),F=l?"linePattern":k?"lineSDF":o?"lineGradient":"line",j=c.context,f=j.gl,t=!0;for(let m of A){let i=r.getTile(m);if(l&&!i.patternsLoaded())continue;let g=i.getBucket(b);if(!g)continue;let n=g.programConfigurations.get(b.id),G=c.context.program.get(),u=c.useProgram(F,n),H=t||u.program!==G,q=s.constantOr(null);if(q&&i.imageAtlas){let v=i.imageAtlas,w=v.patternPositions[q.to.toString()],x=v.patternPositions[q.from.toString()];w&&x&&n.setConstantPatternPositions(w,x)}let I=l?bj(c,i,b,p):k?bk(c,i,b,k,p):o?bi(c,i,b,g.lineClipsArray.length):bh(c,i,b);if(l)j.activeTexture.set(f.TEXTURE0),i.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),n.updatePaintBuffers(p);else if(k&&(H||c.lineAtlas.dirty))j.activeTexture.set(f.TEXTURE0),c.lineAtlas.bind(j);else if(o){let e=g.gradients[b.id],y=e.texture;if(b.gradientVersion!==e.version){let z=256;if(b.stepInterpolant){let J=r.getSource().maxzoom,K=m.canonical.z===J?Math.ceil(1<<c.transform.maxZoom-m.canonical.z):1;z=a.clamp(a.nextPowerOfTwo(g.maxLineLength/a.EXTENT*1024*K),256,j.maxTextureSize)}e.gradient=a.renderColorRamp({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:z,image:e.gradient||void 0,clips:g.lineClipsArray}),e.texture?e.texture.update(e.gradient):e.texture=new N(j,e.gradient,f.RGBA),e.version=b.gradientVersion,y=e.texture}j.activeTexture.set(f.TEXTURE0),y.bind(b.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}u.draw(j,f.TRIANGLES,D,c.stencilModeForClipping(m),E,h.disabled,I,b.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,b.paint,c.transform.zoom,n,g.layoutVertexBuffer2),t=!1}},fill:function(b,e,c,f){let i=c.paint.get("fill-color"),g=c.paint.get("fill-opacity");if(0===g.constantOr(1))return;let h=b.colorModeForRenderPass(),j=c.paint.get("fill-pattern"),k=b.opaquePassEnabledForLayer()&&!j.constantOr(1)&&1===i.constantOr(a.Color.transparent).a&&1===g.constantOr(0)?"opaque":"translucent";if(b.renderPass===k){let l=b.depthModeForSublayer(1,"opaque"===b.renderPass?d.ReadWrite:d.ReadOnly);bI(b,e,c,f,l,h,!1)}if("translucent"===b.renderPass&&c.paint.get("fill-antialias")){let m=b.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,d.ReadOnly);bI(b,e,c,f,m,h,!0)}},"fill-extrusion":function(a,e,c,f){let h=c.paint.get("fill-extrusion-opacity");if(0!==h&&"translucent"===a.renderPass){let g=new d(a.context.gl.LEQUAL,d.ReadWrite,a.depthRangeFor3D);if(1!==h||c.paint.get("fill-extrusion-pattern").constantOr(1))bJ(a,e,c,f,g,w.disabled,b.disabled),bJ(a,e,c,f,g,a.stencilModeFor3D(),a.colorModeForRenderPass());else{let i=a.colorModeForRenderPass();bJ(a,e,c,f,g,w.disabled,i)}}},hillshade:function(a,i,c,e){if("offscreen"!==a.renderPass&&"translucent"!==a.renderPass)return;let j=a.context,f=a.depthModeForSublayer(0,d.ReadOnly),g=a.colorModeForRenderPass(),[k,l]="translucent"===a.renderPass?a.stencilConfigForOverlap(e):[{},e];for(let h of l){let b=i.getTile(h);b.needsHillshadePrepare&&"offscreen"===a.renderPass?bL(a,b,c,f,w.disabled,g):"translucent"===a.renderPass&&bK(a,b,c,f,k[h.overscaledZ],g)}j.viewport.set([0,0,a.width,a.height])},raster:function(a,j,c,n){if("translucent"!==a.renderPass||0===c.paint.get("raster-opacity")||!n.length)return;let g=a.context,b=g.gl,k=j.getSource(),q=a.useProgram("raster"),r=a.colorModeForRenderPass(),[v,o]=k instanceof f?[{},n]:a.stencilConfigForOverlap(n),x=o[o.length-1].overscaledZ,y=!a.options.moving;for(let i of o){let s=a.depthModeForSublayer(i.overscaledZ-x,1===c.paint.get("raster-opacity")?d.ReadWrite:d.ReadOnly,b.LESS),e=j.getTile(i),z=a.transform.calculatePosMatrix(i.toUnwrapped(),y);e.registerFadeDuration(c.paint.get("raster-fade-duration"));let l=j.findLoadedParent(i,0),A=bM(e,l,j,c,a.transform),m,t,p="nearest"===c.paint.get("raster-resampling")?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),e.texture.bind(p,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),l?(l.texture.bind(p,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),m=Math.pow(2,l.tileID.overscaledZ-e.tileID.overscaledZ),t=[e.tileID.canonical.x*m%1,e.tileID.canonical.y*m%1]):e.texture.bind(p,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);let u=bn(z,t||[0,0],m||1,A,c);k instanceof f?q.draw(g,b.TRIANGLES,s,w.disabled,r,h.disabled,u,c.id,k.boundsBuffer,a.quadTriangleIndexBuffer,k.boundsSegments):q.draw(g,b.TRIANGLES,s,v[i.overscaledZ],r,h.disabled,u,c.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}},background:function(a,v,c){let g=c.paint.get("background-color"),e=c.paint.get("background-opacity");if(0===e)return;let f=a.context,i=f.gl,j=a.transform,k=j.tileSize,b=c.paint.get("background-pattern");if(a.isPatternMissing(b))return;let l=!b&&1===g.a&&1===e&&a.opaquePassEnabledForLayer()?"opaque":"translucent";if(a.renderPass!==l)return;let o=w.disabled,p=a.depthModeForSublayer(0,"opaque"===l?d.ReadWrite:d.ReadOnly),q=a.colorModeForRenderPass(),r=a.useProgram(b?"backgroundPattern":"background"),s=j.coveringTiles({tileSize:k});b&&(f.activeTexture.set(i.TEXTURE0),a.imageManager.bind(a.context));let t=c.getCrossfadeParameters();for(let m of s){let n=a.transform.calculatePosMatrix(m.toUnwrapped()),u=b?bt(n,e,a,b,{tileID:m,tileSize:k},t):bs(n,e,g);r.draw(f,i.TRIANGLES,p,o,q,h.disabled,u,c.id,a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}},debug:function(c,d,b){for(let a=0;a<b.length;a++)bV(c,d,b[a])},custom:function(a,h,f){let b=a.context,c=f.implementation;if("offscreen"===a.renderPass){let e=c.prerender;e&&(a.setCustomLayerDefaults(),b.setColorMode(a.colorModeForRenderPass()),e.call(c,b.gl,a.transform.customLayerMatrix()),b.setDirty(),a.setBaseState())}else if("translucent"===a.renderPass){a.setCustomLayerDefaults(),b.setColorMode(a.colorModeForRenderPass()),b.setStencilMode(w.disabled);let g="3d"===c.renderingMode?new d(a.context.gl.LEQUAL,d.ReadWrite,a.depthRangeFor3D):a.depthModeForSublayer(0,d.ReadOnly);b.setDepthMode(g),c.render(b.gl,a.transform.customLayerMatrix()),b.setDirty(),a.setBaseState(),b.bindFramebuffer.set(null)}}};class bX{constructor(c,d){this.context=new class{constructor(b){this.gl=b,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new class extends C{getDefault(){return a.Color.transparent}set(a){let b=this.current;(a.r!==b.r||a.g!==b.g||a.b!==b.b||a.a!==b.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}(this),this.clearDepth=new class extends C{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}(this),this.clearStencil=new class extends C{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}(this),this.colorMask=new class extends C{getDefault(){return[!0,!0,!0,!0]}set(a){let b=this.current;(a[0]!==b[0]||a[1]!==b[1]||a[2]!==b[2]||a[3]!==b[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}(this),this.depthMask=new class extends C{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}(this),this.stencilMask=new class extends C{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}(this),this.stencilFunc=new class extends C{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){let b=this.current;(a.func!==b.func||a.ref!==b.ref||a.mask!==b.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}(this),this.stencilOp=new class extends C{getDefault(){let a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){let b=this.current;(a[0]!==b[0]||a[1]!==b[1]||a[2]!==b[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}(this),this.stencilTest=new class extends C{getDefault(){return!1}set(b){if(b===this.current&&!this.dirty)return;let a=this.gl;b?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=b,this.dirty=!1}}(this),this.depthRange=new class extends C{getDefault(){return[0,1]}set(a){let b=this.current;(a[0]!==b[0]||a[1]!==b[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}(this),this.depthTest=new class extends C{getDefault(){return!1}set(b){if(b===this.current&&!this.dirty)return;let a=this.gl;b?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=b,this.dirty=!1}}(this),this.depthFunc=new class extends C{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}(this),this.blend=new class extends C{getDefault(){return!1}set(b){if(b===this.current&&!this.dirty)return;let a=this.gl;b?a.enable(a.BLEND):a.disable(a.BLEND),this.current=b,this.dirty=!1}}(this),this.blendFunc=new class extends C{getDefault(){let a=this.gl;return[a.ONE,a.ZERO]}set(a){let b=this.current;(a[0]!==b[0]||a[1]!==b[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}(this),this.blendColor=new class extends C{getDefault(){return a.Color.transparent}set(a){let b=this.current;(a.r!==b.r||a.g!==b.g||a.b!==b.b||a.a!==b.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}(this),this.blendEquation=new class extends C{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}(this),this.cullFace=new class extends C{getDefault(){return!1}set(b){if(b===this.current&&!this.dirty)return;let a=this.gl;b?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=b,this.dirty=!1}}(this),this.cullFaceSide=new class extends C{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}(this),this.frontFace=new class extends C{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}(this),this.program=new class extends C{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}(this),this.activeTexture=new class extends C{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}(this),this.viewport=new class extends C{getDefault(){let a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){let b=this.current;(a[0]!==b[0]||a[1]!==b[1]||a[2]!==b[2]||a[3]!==b[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}(this),this.bindFramebuffer=new class extends C{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}(this),this.bindRenderbuffer=new class extends C{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.bindRenderbuffer(b.RENDERBUFFER,a),this.current=a,this.dirty=!1}}(this),this.bindTexture=new class extends C{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.bindTexture(b.TEXTURE_2D,a),this.current=a,this.dirty=!1}}(this),this.bindVertexBuffer=new class extends C{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}(this),this.bindElementBuffer=new class extends C{getDefault(){return null}set(a){let b=this.gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new class extends C{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}(this),this.pixelStoreUnpack=new class extends C{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.pixelStorei(b.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}(this),this.pixelStoreUnpackPremultiplyAlpha=new class extends C{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}(this),this.pixelStoreUnpackFlipY=new class extends C{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let b=this.gl;b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}(this),this.extTextureFilterAnisotropic=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=b.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=b.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(b.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=b.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=b.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,b){return new bv(this,a,b)}createVertexBuffer(a,b,c){return new bx(this,a,b,c)}createRenderbuffer(c,d,e){let a=this.gl,b=a.createRenderbuffer();return this.bindRenderbuffer.set(b),a.renderbufferStorage(a.RENDERBUFFER,c,d,e),this.bindRenderbuffer.set(null),b}createFramebuffer(a,b,c){return new bz(this,a,b,c)}clear({color:c,depth:d}){let a=this.gl,b=0;c&&(b|=a.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(b|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),a.clear(b)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){I(a.blendFunction,b.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}(c),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=u.maxUnderzooming+u.maxOverzooming+1,this.depthEpsilon=1/65536,this.crossTileSymbolIndex=new aW,this.gpuTimers={}}resize(b,c,a){if(this.width=b*a,this.height=c*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style._order)this.style._layers[d].resize()}setup(){let b=this.context,d=new a.PosArray;d.emplaceBack(0,0),d.emplaceBack(a.EXTENT,0),d.emplaceBack(0,a.EXTENT),d.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=b.createVertexBuffer(d,a_.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);let e=new a.PosArray;e.emplaceBack(0,0),e.emplaceBack(a.EXTENT,0),e.emplaceBack(0,a.EXTENT),e.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=b.createVertexBuffer(e,a_.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);let f=new a.RasterBoundsArray;f.emplaceBack(0,0,0,0),f.emplaceBack(a.EXTENT,0,a.EXTENT,0),f.emplaceBack(0,a.EXTENT,0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=b.createVertexBuffer(f,Y.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);let g=new a.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=b.createVertexBuffer(g,a_.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);let c=new a.LineStripIndexArray;c.emplaceBack(0),c.emplaceBack(1),c.emplaceBack(3),c.emplaceBack(2),c.emplaceBack(0),this.tileBorderIndexBuffer=b.createIndexBuffer(c);let i=new a.TriangleIndexArray;i.emplaceBack(0,1,2),i.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=b.createIndexBuffer(i),this.emptyTexture=new N(b,{width:1,height:1,data:new Uint8Array([0,0,0,0])},b.gl.RGBA);let h=this.context.gl;this.stencilClearMode=new w({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO)}clearStencil(){let f=this.context,e=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let c=a.create();a.ortho(c,0,this.width,this.height,0,0,1),a.scale(c,c,[e.drawingBufferWidth,e.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,e.TRIANGLES,d.disabled,this.stencilClearMode,b.disabled,h.disabled,bf(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(f,c){if(this.currentStencilSource===f.source||!f.isTileClipped()||!c||!c.length)return;this.currentStencilSource=f.source;let e=this.context,a=e.gl;this.nextStencilID+c.length>256&&this.clearStencil(),e.setColorMode(b.disabled),e.setDepthMode(d.disabled);let i=this.useProgram("clippingMask");for(let g of(this._tileClippingMaskIDs={},c)){let j=this._tileClippingMaskIDs[g.key]=this.nextStencilID++;i.draw(e,a.TRIANGLES,d.disabled,new w({func:a.ALWAYS,mask:0},j,255,a.KEEP,a.KEEP,a.REPLACE),b.disabled,h.disabled,bf(g.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let b=this.nextStencilID++,a=this.context.gl;return new w({func:a.NOTEQUAL,mask:255},b,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(b){let a=this.context.gl;return new w({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[b.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(g){let b=this.context.gl,a=g.sort((a,b)=>b.overscaledZ-a.overscaledZ),e=a[a.length-1].overscaledZ,c=a[0].overscaledZ-e+1;if(c>1){this.currentStencilSource=void 0,this.nextStencilID+c>256&&this.clearStencil();let f={};for(let d=0;d<c;d++)f[d+e]=new w({func:b.GEQUAL,mask:255},d+this.nextStencilID,255,b.KEEP,b.KEEP,b.REPLACE);return this.nextStencilID+=c,[f,a]}return[{[e]:w.disabled},a]}colorModeForRenderPass(){let d=this.context.gl;if(this._showOverdrawInspector){let c=1/8;return new b([d.CONSTANT_COLOR,d.ONE],new a.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?b.unblended:b.alphaBlended}depthModeForSublayer(b,c,e){if(!this.opaquePassEnabledForLayer())return d.disabled;let a=1-((1+this.currentLayer)*this.numSublayers+b)*this.depthEpsilon;return new d(e||this.context.gl.LEQUAL,c,[a,a])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(d,k){this.style=d,this.options=k,this.lineAtlas=d.lineAtlas,this.imageManager=d.imageManager,this.glyphManager=d.glyphManager,this.symbolFadeChange=d.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();let b=this.style._order,c=this.style.sourceCaches;for(let s in c){let n=c[s];n.used&&n.prepare(this.context)}let h={},l={},o={};for(let g in c){let p=c[g];h[g]=p.getVisibleCoordinates(),l[g]=h[g].slice().reverse(),o[g]=p.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let i=0;i<b.length;i++)if(this.style._layers[b[i]].is3D()){this.opaquePassCutoff=i;break}for(let t of(this.renderPass="offscreen",b)){let e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;let q=l[e.source];("custom"===e.type||q.length)&&this.renderLayer(this,c[e.source],e,q)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:k.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=k.showOverdrawInspector,this.depthRangeFor3D=[0,1-(d._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){let j=this.style._layers[b[this.currentLayer]],u=c[j.source],r=h[j.source];this._renderTileClippingMasks(j,r),this.renderLayer(this,u,j,r)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){let f=this.style._layers[b[this.currentLayer]],v=c[f.source],w=("symbol"===f.type?o:l)[f.source];this._renderTileClippingMasks(f,h[f.source]),this.renderLayer(this,v,f,w)}if(this.options.showTileBoundaries){let m,x;Object.values(this.style._layers).forEach(a=>{a.source&&!a.isHidden(this.transform.zoom)&&(a.source!==(x&&x.id)&&(x=this.style.sourceCaches[a.source]),(!m||m.getSource().maxzoom<x.getSource().maxzoom)&&(m=x))}),m&&bW.debug(this,m,m.getVisibleCoordinates())}this.options.showPadding&&function(a){var c,d,e,f;let b=a.transform.padding;bS(a,a.transform.height-(b.top||0),3,bN),bS(a,b.bottom||0,3,bO),bT(a,b.left||0,3,bP),bT(a,a.transform.width-(b.right||0),3,bQ);let g=a.transform.centerPoint;c=a,d=g.x,e=a.transform.height-g.y,bU(c,d-1,e-10,2,20,f=bR),bU(c,d-10,e-1,20,2,f)}(this),this.context.setDefault()}renderLayer(c,d,a,b){a.isHidden(this.transform.zoom)||("background"===a.type||"custom"===a.type||b.length)&&(this.id=a.id,this.gpuTimingStart(a),bW[a.type](c,d,a,b,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;let b=this.context.extTimerQuery,a=this.gpuTimers[c.id];a||(a=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:b.createQueryEXT()}),a.calls++,b.beginQueryEXT(b.TIME_ELAPSED_EXT,a.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){let a=this.gpuTimers;return this.gpuTimers={},a}queryGpuTimers(b){let c={};for(let d in b){let e=b[d],a=this.context.extTimerQuery,f=a.getQueryObjectEXT(e.query,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(e.query),c[d]=f}return c}translatePosMatrix(e,f,b,g,c){if(!b[0]&&!b[1])return e;let d=c?"map"===g?this.transform.angle:0:"viewport"===g?-this.transform.angle:0;if(d){let h=Math.sin(d),i=Math.cos(d);b=[b[0]*i-b[1]*h,b[0]*h+b[1]*i]}let k=[c?b[0]:aH(f,b[0],this.transform.zoom),c?b[1]:aH(f,b[1],this.transform.zoom),0],j=new Float32Array(16);return a.translate(j,e,k),j}saveTileTexture(a){let b=this._tileTextures[a.size[0]];b?b.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(b){let a=this._tileTextures[b];return a&&a.length>0?a.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;let b=this.imageManager.getPattern(a.from.toString()),c=this.imageManager.getPattern(a.to.toString());return!b||!c}useProgram(a,b){this.cache=this.cache||{};let c=`${a}${b?b.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[c]||(this.cache[c]=new a4(this.context,a,a0[a],b,bu[a],this._showOverdrawInspector)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new N(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class bY{constructor(a,b){this.points=a,this.planes=b}static fromInvProjectionMatrix(e,f,b){let g=Math.pow(2,b),c=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>a.transformMat4([],b,e)).map(b=>a.scale$1([],b,1/b[3]/f*g)),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(d=>{var i,j,e,g,h,k,l,m,n,o,p,f,b,q,r,s,a;let t=(f=[],q=(b=(e=[],g=L([],c[d[0]],c[d[1]]),h=L([],c[d[2]],c[d[1]]),k=g[0],l=g[1],m=g[2],n=h[0],o=h[1],p=h[2],e[0]=l*p-m*o,e[1]=m*n-k*p,e[2]=k*o-l*n,e))[0],r=b[1],s=b[2],a=q*q+r*r+s*s,a>0&&(a=1/Math.sqrt(a)),f[0]=b[0]*a,f[1]=b[1]*a,f[2]=b[2]*a,f),u=-((i=t)[0]*(j=c[d[1]])[0]+i[1]*j[1]+i[2]*j[2]);return t.concat(u)});return new bY(c,d)}}class bZ{constructor(f,g){var a,c,d,b,e;this.min=f,this.max=g,this.center=(b=[],e=(a=[],c=this.min,d=this.max,a[0]=c[0]+d[0],a[1]=c[1]+d[1],a[2]=c[2]+d[2],a),b[0]=.5*e[0],b[1]=.5*e[1],b[2]=.5*e[2],b)}quadrant(d){let b=[d%2==0,d<2],e=K(this.min),c=K(this.max);for(let a=0;a<b.length;a++)e[a]=b[a]?this.min[a]:this.center[a],c[a]=b[a]?this.center[a]:this.max[a];return c[2]=this.max[2],new bZ(e,c)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(c){let d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],k=!0;for(let e=0;e<c.planes.length;e++){let m=c.planes[e],f=0;for(let g=0;g<d.length;g++)a.dot(m,d[g])>=0&&f++;if(0===f)return 0;f!==d.length&&(k=!1)}if(k)return 2;for(let b=0;b<3;b++){let h=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let j=0;j<c.points.length;j++){let l=c.points[j][b]-this.min[b];h=Math.min(h,l),i=Math.max(i,l)}if(i<0||h>this.max[b]-this.min[b])return 0}return 1}}class b${constructor(a=0,b=0,c=0,d=0){if(isNaN(a)||a<0||isNaN(b)||b<0||isNaN(c)||c<0||isNaN(d)||d<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=b,this.left=c,this.right=d}interpolate(b,c,d){return null!=c.top&&null!=b.top&&(this.top=a.number(b.top,c.top,d)),null!=c.bottom&&null!=b.bottom&&(this.bottom=a.number(b.bottom,c.bottom,d)),null!=c.left&&null!=b.left&&(this.left=a.number(b.left,c.left,d)),null!=c.right&&null!=b.right&&(this.right=a.number(b.right,c.right,d)),this}getCenter(b,c){let d=a.clamp((this.left+b-this.right)/2,0,b),e=a.clamp((this.top+c-this.bottom)/2,0,c);return new a.pointGeometry(d,e)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new b$(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class b_{constructor(e,f,b,c,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===d||!!d,this._minZoom=e||0,this._maxZoom=f||22,this._minPitch=null==b?0:b,this._maxPitch=null==c?60:c,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new b$,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){let a=new b_(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.tileSize=this.tileSize,a.latRange=this.latRange,a.width=this.width,a.height=this.height,a._center=this._center,a.zoom=this.zoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(m){var b,c,d,g,h,i,j,k,e,f;let l=-a.wrap(m,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(b=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b),c=this.rotationMatrix,d=this.rotationMatrix,g=this.angle,h=d[0],i=d[1],j=d[2],k=d[3],e=Math.sin(g),f=Math.cos(g),c[0]=h*f+j*e,c[1]=i*f+k*e,c[2]=-(h*e)+j*f,c[3]=-(i*e)+k*f)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){let b=a.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==b&&(this._unmodified=!1,this._pitch=b,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(b){let a=Math.min(Math.max(b,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,b,c){this._unmodified=!1,this._edgeInsets.interpolate(a,b,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){let b=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,b)}getVisibleUnwrappedCoordinates(c){let d=[new a.UnwrappedTileID(0,c)];if(this._renderWorldCopies){let e=this.pointCoordinate(new a.pointGeometry(0,0)),f=this.pointCoordinate(new a.pointGeometry(this.width,0)),g=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),h=this.pointCoordinate(new a.pointGeometry(0,this.height)),j=Math.floor(Math.min(e.x,f.x,g.x,h.x)),k=Math.floor(Math.max(e.x,f.x,g.x,h.x)),i=1;for(let b=j-i;b<=k+i;b++)0!==b&&d.push(new a.UnwrappedTileID(b,c))}return d}coveringTiles(d){let c=this.coveringZoomLevel(d),s=c;if(void 0!==d.minzoom&&c<d.minzoom)return[];void 0!==d.maxzoom&&c>d.maxzoom&&(c=d.maxzoom);let n=a.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,c),g=[o*n.x,o*n.y,0],t=bY.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),p=d.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(p=c);let i=a=>({aabb:new bZ([a*o,0,0],[(a+1)*o,o,0]),zoom:0,x:0,y:0,wrap:a,fullyVisible:!1}),e=[],q=[],j=c,u=d.reparseOverscaled?s:c;if(this._renderWorldCopies)for(let h=1;h<=3;h++)e.push(i(-h)),e.push(i(h));for(e.push(i(0));e.length>0;){let b=e.pop(),k=b.x,l=b.y,m=b.fullyVisible;if(!m){let r=b.aabb.intersects(t);if(0===r)continue;m=2===r}let v=b.aabb.distanceX(g),w=b.aabb.distanceY(g),x=Math.max(Math.abs(v),Math.abs(w)),y=3+(1<<j-b.zoom)-2;if(b.zoom===j||x>y&&b.zoom>=p)q.push({tileID:new a.OverscaledTileID(b.zoom===j?u:b.zoom,b.wrap,b.zoom,k,l),distanceSq:M([g[0]-.5-k,g[1]-.5-l])});else for(let f=0;f<4;f++){let z=(k<<1)+f%2,A=(l<<1)+(f>>1);e.push({aabb:b.aabb.quadrant(f),zoom:b.zoom+1,x:z,y:A,wrap:b.wrap,fullyVisible:m})}}return q.sort((a,b)=>a.distanceSq-b.distanceSq).map(a=>a.tileID)}resize(a,b){this.width=a,this.height=b,this.pixelsToGLUnits=[2/a,-2/b],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(b){let c=a.clamp(b.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(b.lng)*this.worldSize,a.mercatorYfromLat(c)*this.worldSize)}unproject(b){return new a.MercatorCoordinate(b.x/this.worldSize,b.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(e,f){let b=this.pointCoordinate(f),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(e),g=new a.MercatorCoordinate(d.x-(b.x-c.x),d.y-(b.y-c.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a){return this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}locationCoordinate(b){return a.MercatorCoordinate.fromLngLat(b)}coordinateLocation(a){return a.toLngLat()}pointCoordinate(d){let b=[d.x,d.y,0,1],c=[d.x,d.y,1,1];a.transformMat4(b,b,this.pixelMatrixInverse),a.transformMat4(c,c,this.pixelMatrixInverse);let e=b[3],f=c[3],j=b[1]/e,k=c[1]/f,g=b[2]/e,h=c[2]/f,i=g===h?0:(0-g)/(h-g);return new a.MercatorCoordinate(a.number(b[0]/e,c[0]/f,i)/this.worldSize,a.number(j,k,i)/this.worldSize)}coordinatePoint(c){let b=[c.x*this.worldSize,c.y*this.worldSize,0,1];return a.transformMat4(b,b,this.pixelMatrix),new a.pointGeometry(b[0]/b[3],b[1]/b[3])}getBounds(){return(new a.LngLatBounds).extend(this.pointLocation(new a.pointGeometry(0,0))).extend(this.pointLocation(new a.pointGeometry(this.width,0))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(g,h=!1){let c=g.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];let e=g.canonical,f=this.worldSize/this.zoomScale(e.z),i=e.x+Math.pow(2,e.z)*g.wrap,b=a.identity(new Float64Array(16));return a.translate(b,b,[i*f,e.y*f,0]),a.scale(b,b,[f/a.EXTENT,f/a.EXTENT,1]),a.multiply(b,h?this.alignedProjMatrix:this.projMatrix,b),d[c]=new Float32Array(b),d[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l,m,h,i,b=-90,c=90,d=-180,e=180,f=this.size,n=this._unmodified;if(this.latRange){let o=this.latRange;b=a.mercatorYfromLat(o[1])*this.worldSize,c=a.mercatorYfromLat(o[0])*this.worldSize,l=c-b<f.y?f.y/(c-b):0}if(this.lngRange){let p=this.lngRange;d=a.mercatorXfromLng(p[0])*this.worldSize,e=a.mercatorXfromLng(p[1])*this.worldSize,m=e-d<f.x?f.x/(e-d):0}let g=this.point,q=Math.max(m||0,l||0);if(q)return this.center=this.unproject(new a.pointGeometry(m?(e+d)/2:g.x,l?(c+b)/2:g.y)),this.zoom+=this.scaleZoom(q),this._unmodified=n,void(this._constraining=!1);if(this.latRange){let r=g.y,j=f.y/2;r-j<b&&(i=b+j),r+j>c&&(i=c-j)}if(this.lngRange){let s=g.x,k=f.x/2;s-k<d&&(h=d+k),s+k>e&&(h=e-k)}void 0===h&& void 0===i||(this.center=this.unproject(new a.pointGeometry(void 0!==h?h:g.x,void 0!==i?i:g.y))),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(!this.height)return;let c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;let o=Math.PI/2+this._pitch,i=this._fov*(.5+c.y/this.height),p=Math.sin(i)*this.cameraToCenterDistance/Math.sin(a.clamp(Math.PI-o-i,.01,Math.PI-.01)),j=this.point,d=j.x,e=j.y,q=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),r=this.height/50,b=new Float64Array(16);a.perspective(b,this._fov,this.width/this.height,r,q),b[8]=-(2*c.x)/this.width,b[9]=2*c.y/this.height,a.scale(b,b,[1,-1,1]),a.translate(b,b,[0,0,-this.cameraToCenterDistance]),a.rotateX(b,b,this._pitch),a.rotateZ(b,b,this.angle),a.translate(b,b,[-d,-e,0]),this.mercatorMatrix=a.scale([],b,[this.worldSize,this.worldSize,this.worldSize]),a.scale(b,b,[1,1,a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=b,this.invProjMatrix=a.invert([],this.projMatrix);let k=this.width%2/2,l=this.height%2/2,m=Math.cos(this.angle),n=Math.sin(this.angle),f=d-Math.round(d)+m*k+n*l,g=e-Math.round(e)+m*l+n*k,h=new Float64Array(b);if(a.translate(h,h,[f>.5?f-1:f,g>.5?g-1:g,0]),this.alignedProjMatrix=h,b=a.create(),a.scale(b,b,[this.width/2,-this.height/2,1]),a.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.create(),a.scale(b,b,[1,-1,1]),a.translate(b,b,[-1,-1,0]),a.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),b=a.invert(new Float64Array(16),this.pixelMatrix),!b)throw Error("failed to invert matrix");this.pixelMatrixInverse=b,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let b=this.pointCoordinate(new a.pointGeometry(0,0)),c=[b.x*this.worldSize,b.y*this.worldSize,0,1];return a.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let b=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,b))}getCameraQueryGeometry(h){let b=this.getCameraPoint();if(1===h.length)return[h[0],b];{let c=b.x,d=b.y,e=b.x,f=b.y;for(let g of h)c=Math.min(c,g.x),d=Math.min(d,g.y),e=Math.max(e,g.x),f=Math.max(f,g.y);return[new a.pointGeometry(c,d),new a.pointGeometry(e,d),new a.pointGeometry(e,f),new a.pointGeometry(c,f),new a.pointGeometry(c,d)]}}}let i={linearity:.3,easing:a.bezier(0,0,.3,1)},b0=a.extend({deceleration:2500,maxSpeed:1400},i),b1=a.extend({deceleration:20,maxSpeed:1400},i),b2=a.extend({deceleration:1e3,maxSpeed:360},i),b3=a.extend({deceleration:1e3,maxSpeed:90},i);function b4(a,b){(!a.duration||a.duration<b.duration)&&(a.duration=b.duration,a.easing=b.easing)}function b5(g,h,b){let{maxSpeed:c,linearity:d,deceleration:i}=b,e=a.clamp(g*d/(h/1e3),-c,c),f=Math.abs(e)/(i*d);return{easing:b.easing,duration:1e3*f,amount:e*(f/2)}}class b6 extends a.Event{constructor(f,b,d,g={}){let e=c.mousePos(b.getCanvasContainer(),d),h=b.unproject(e);super(f,a.extend({point:e,lngLat:h,originalEvent:d},g)),this._defaultPrevented=!1,this.target=b}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class b7 extends a.Event{constructor(e,f,b){let h="touchend"===e?b.changedTouches:b.touches,d=c.touchPos(f.getCanvasContainer(),h),i=d.map(a=>f.unproject(a)),g=d.reduce((a,b,d,c)=>a.add(b.div(c.length)),new a.pointGeometry(0,0));super(e,{points:d,point:g,lngLats:i,lngLat:f.unproject(g),originalEvent:b}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class b8 extends a.Event{constructor(a,c,b){super(a,{originalEvent:b}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class b9{constructor(a,b){this._map=a,this._clickTolerance=b.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new b8(a.type,this._map,a))}mousedown(a,b){return this._mousedownPos=b,this._firePreventable(new b6(a.type,this._map,a))}mouseup(a){this._map.fire(new b6(a.type,this._map,a))}click(a,b){this._mousedownPos&&this._mousedownPos.dist(b)>=this._clickTolerance||this._map.fire(new b6(a.type,this._map,a))}dblclick(a){return this._firePreventable(new b6(a.type,this._map,a))}mouseover(a){this._map.fire(new b6(a.type,this._map,a))}mouseout(a){this._map.fire(new b6(a.type,this._map,a))}touchstart(a){return this._firePreventable(new b7(a.type,this._map,a))}touchmove(a){this._map.fire(new b7(a.type,this._map,a))}touchend(a){this._map.fire(new b7(a.type,this._map,a))}touchcancel(a){this._map.fire(new b7(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ca{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(a){this._map.fire(new b6(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new b6("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new b6(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cb{constructor(a,b){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=b.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,b){this.isEnabled()&&a.shiftKey&&0===a.button&&(c.disableDrag(),this._startPos=this._lastPos=b,this._active=!0)}mousemoveWindow(f,g){if(!this._active)return;let a=g;if(this._lastPos.equals(a)|| !this._box&&a.dist(this._startPos)<this._clickTolerance)return;let b=this._startPos;this._lastPos=a,this._box||(this._box=c.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));let d=Math.min(b.x,a.x),h=Math.max(b.x,a.x),e=Math.min(b.y,a.y),i=Math.max(b.y,a.y);c.setTransform(this._box,`translate(${d}px,${e}px)`),this._box.style.width=h-d+"px",this._box.style.height=i-e+"px"}mouseupWindow(b,f){if(!this._active||0!==b.button)return;let d=this._startPos,e=f;if(this.reset(),c.suppressClick(),d.x!==e.x||d.y!==e.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:b})),{cameraAnimation:a=>a.fitScreenCoordinates(d,e,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",b)}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(c.remove(this._box),this._box=null),c.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(b,c){return this._map.fire(new a.Event(b,{originalEvent:c}))}}function cc(b,d){let c={};for(let a=0;a<b.length;a++)c[b[a].identifier]=d[a];return c}class cd{constructor(b){this.singleTap=new class{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(d,c,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=d.timeStamp),b.length===this.numTouches&&(this.centroid=function(b){let c=new a.pointGeometry(0,0);for(let d of b)c._add(d);return c.div(b.length)}(c),this.touches=cc(b,c)))}touchmove(g,c,d){if(this.aborted||!this.centroid)return;let e=cc(d,c);for(let a in this.touches){let f=this.touches[a],b=e[a];(!b||b.dist(f)>30)&&(this.aborted=!0)}}touchend(b,d,c){if((!this.centroid||b.timeStamp-this.startTime>500)&&(this.aborted=!0),0===c.length){let a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}(b),this.numTaps=b.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,b,c){this.singleTap.touchstart(a,b,c)}touchmove(a,b,c){this.singleTap.touchmove(a,b,c)}touchend(b,c,d){let a=this.singleTap.touchend(b,c,d);if(a){let e=b.timeStamp-this.lastTime<500,f=!this.lastTap||30>this.lastTap.dist(a);if(e&&f||this.reset(),this.count++,this.lastTime=b.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class ce{constructor(){this._zoomIn=new cd({numTouches:1,numTaps:2}),this._zoomOut=new cd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,b,c){this._zoomIn.touchstart(a,b,c),this._zoomOut.touchstart(a,b,c)}touchmove(a,b,c){this._zoomIn.touchmove(a,b,c),this._zoomOut.touchmove(a,b,c)}touchend(a,b,c){let d=this._zoomIn.touchend(a,b,c),e=this._zoomOut.touchend(a,b,c);return d?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(d)},{originalEvent:a})}):e?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(e)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let cf={0:1,2:2};class m{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(a,b){return!1}_move(a,b){return{}}mousedown(a,d){if(this._lastPoint)return;let b=c.mouseButton(a);this._correctButton(a,b)&&(this._lastPoint=d,this._eventButton=b)}mousemoveWindow(c,a){let b=this._lastPoint;if(b){if(c.preventDefault(),function(a,c){let b=cf[c];return void 0===a.buttons||(a.buttons&b)!==b}(c,this._eventButton))this.reset();else if(this._moved||!(a.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(b,a)}}mouseupWindow(a){this._lastPoint&&c.mouseButton(a)===this._eventButton&&(this._moved&&c.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cg extends m{mousedown(a,b){super.mousedown(a,b),this._lastPoint&&(this._active=!0)}_correctButton(a,b){return 0===b&&!a.ctrlKey}_move(b,a){return{around:a,panDelta:a.sub(b)}}}class ch extends m{_correctButton(b,a){return 0===a&&b.ctrlKey||2===a}_move(b,c){let a=.8*(c.x-b.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(a){a.preventDefault()}}class ci extends m{_correctButton(b,a){return 0===a&&b.ctrlKey||2===a}_move(b,c){let a=-0.5*(c.y-b.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(a){a.preventDefault()}}class cj{constructor(a){this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(a,b,c){return this._calculateTransform(a,b,c)}touchmove(a,c,b){if(this._active&&!(b.length<this._minTouches))return a.preventDefault(),this._calculateTransform(a,c,b)}touchend(b,c,a){this._calculateTransform(b,c,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,k,g){g.length>0&&(this._active=!0);let b=cc(g,k),h=new a.pointGeometry(0,0),d=new a.pointGeometry(0,0),c=0;for(let e in b){let f=b[e],i=this._touches[e];i&&(h._add(f),d._add(f.sub(i)),c++,b[e]=f)}if(this._touches=b,c<this._minTouches||!d.mag())return;let j=d.div(c);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(c),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class n{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(a){}_move(a,b,c){return{}}touchstart(c,b,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([b[0],b[1]]))}touchmove(c,d,e){if(!this._firstTwoTouches)return;c.preventDefault();let[f,g]=this._firstTwoTouches,a=ck(e,d,f),b=ck(e,d,g);if(!a||!b)return;let h=this._aroundCenter?null:a.add(b).div(2);return this._move([a,b],h,c)}touchend(h,a,b){if(!this._firstTwoTouches)return;let[d,e]=this._firstTwoTouches,f=ck(b,a,d),g=ck(b,a,e);f&&g||(this._active&&c.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ck(b,c,d){for(let a=0;a<b.length;a++)if(b[a].identifier===d)return c[a]}function cl(a,b){return Math.log(a/b)/Math.LN2}class cm extends n{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,b){let c=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(.1>Math.abs(cl(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:cl(this._distance,c),pinchAround:b}}}function cn(a,b){return 180*a.angleWith(b)/Math.PI}class co extends n{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,b){let c=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cn(this._vector,c),pinchAround:b}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());let b=25/(Math.PI*this._minDiameter)*360,c=cn(a,this._startVector);return Math.abs(c)<b}}function cp(a){return Math.abs(a.y)>Math.abs(a.x)}class cq extends n{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(a){this._lastPoints=a,cp(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,e,d){let b=a[0].sub(this._lastPoints[0]),c=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,c,d.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:-((b.y+c.y)/2*.5)}}gestureBeginsVertically(a,b,c){if(void 0!==this._valid)return this._valid;let d=a.mag()>=2,e=b.mag()>=2;if(!d&&!e)return;if(!d||!e)return void 0===this._firstMove&&(this._firstMove=c),c-this._firstMove<100&&void 0;let f=a.y>0==b.y>0;return cp(a)&&cp(b)&&f}}class cr{constructor(){let a={panStep:100,bearingStep:15,pitchStep:10};this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,b=0,c=0,e=0,f=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?b=-1:(a.preventDefault(),e=-1);break;case 39:a.shiftKey?b=1:(a.preventDefault(),e=1);break;case 38:a.shiftKey?c=1:(a.preventDefault(),f=-1);break;case 40:a.shiftKey?c=-1:(a.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(b=0,c=0),{cameraAnimation:g=>{let h=g.getZoom();g.easeTo({duration:300,easeId:"keyboardHandler",easing:cs,zoom:d?Math.round(h)+d*(a.shiftKey?2:1):h,bearing:g.getBearing()+b*this._bearingStep,pitch:g.getPitch()+c*this._pitchStep,offset:[-e*this._panStep,-f*this._panStep],center:g.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cs(a){return a*(2-a)}let ct=4.000244140625;class cu{constructor(b,c){this._map=b,this._el=b.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active|| void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=a&&"center"===a.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(c){if(!this.isEnabled())return;let b=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,d=a.exported.now(),e=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,0!==b&&b%ct==0?this._type="wheel":0!==b&&4>Math.abs(b)?this._type="trackpad":e>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=200>Math.abs(e*b)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),c.shiftKey&&b&&(b/=4),this._type&&(this._lastWheelEvent=c,this._delta-=b,this._active||this._start(c)),c.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(b){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let d=c.mousePos(this._el,b);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let b=this._map.transform;if(0!==this._delta){let j="wheel"===this._type&&Math.abs(this._delta)>ct?this._wheelZoomRate:this._defaultZoomRate,c=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&0!==c&&(c=1/c);let k="number"==typeof this._targetZoom?b.zoomScale(this._targetZoom):b.scale;this._targetZoom=Math.min(b.maxZoom,Math.max(b.minZoom,b.scaleZoom(k*c))),"wheel"===this._type&&(this._startZoom=b.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let f="number"==typeof this._targetZoom?this._targetZoom:b.zoom,g=this._startZoom,h=this._easing,e,d=!1;if("wheel"===this._type&&g&&h){let i=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),l=h(i);e=a.number(g,f,l),i<1?this._frameId||(this._frameId=!0):d=!0}else e=f,d=!0;return this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!d,zoomDelta:e-b.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(g){let c=a.ease;if(this._prevEase){let b=this._prevEase,e=(a.exported.now()-b.start)/b.duration,f=b.easing(e+.01)-b.easing(e),d=.27/Math.sqrt(f*f+1e-4)*.01,h=Math.sqrt(.0729-d*d);c=a.bezier(d,h,.25,1)}return this._prevEase={start:a.exported.now(),duration:g,easing:c},c}reset(){this._active=!1}}class cv{constructor(a,b){this._clickZoom=a,this._tapZoom=b}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cw{constructor(){this.reset()}reset(){this._active=!1}dblclick(a,b){return a.preventDefault(),{cameraAnimation(c){c.easeTo({duration:300,zoom:c.getZoom()+(a.shiftKey?-1:1),around:c.unproject(b)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cx{constructor(){this._tap=new cd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(b,c,a){this._swipePoint||(this._tapTime&&b.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=c[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(b,c,a))}touchmove(a,b,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let d=b[0],e=d.y-this._swipePoint.y;return this._swipePoint=d,a.preventDefault(),this._active=!0,{zoomDelta:e/128}}}else this._tap.touchmove(a,b,c)}touchend(a,c,b){this._tapTime?this._swipePoint&&0===b.length&&this.reset():this._tap.touchend(a,c,b)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cy{constructor(a,b,c){this._el=a,this._mousePan=b,this._touchPan=c}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cz{constructor(a,b,c){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=b,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cA{constructor(a,b,c,d){this._el=a,this._touchZoom=b,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let cB=a=>a.zoom||a.drag||a.pitch||a.rotate;class cC extends a.Event{}function cD(a){return a.panDelta&&a.panDelta.mag()||a.zoomDelta||a.bearingDelta||a.pitchDelta}let D={extend:(b,...c)=>a.extend(b,...c),run(a){a()},logToElement(b,c=!1,d="log"){let a=window.document.getElementById(d);a&&(c&&(a.innerHTML=""),a.innerHTML+=`<br>${b}`)}};class cE extends a.Evented{constructor(b,c){super(),this._moving=!1,this._zooming=!1,this.transform=b,this._bearingSnap=c.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,b){return this.jumpTo({center:a},b)}panBy(b,c,d){return b=a.pointGeometry.convert(b).mult(-1),this.panTo(this.transform.center,a.extend({offset:b},c),d)}panTo(b,c,d){return this.easeTo(a.extend({center:b},c),d)}getZoom(){return this.transform.zoom}setZoom(a,b){return this.jumpTo({zoom:a},b),this}zoomTo(b,c,d){return this.easeTo(a.extend({zoom:b},c),d)}zoomIn(a,b){return this.zoomTo(this.getZoom()+1,a,b),this}zoomOut(a,b){return this.zoomTo(this.getZoom()-1,a,b),this}getBearing(){return this.transform.bearing}setBearing(a,b){return this.jumpTo({bearing:a},b),this}getPadding(){return this.transform.padding}setPadding(a,b){return this.jumpTo({padding:a},b),this}rotateTo(b,c,d){return this.easeTo(a.extend({bearing:b},c),d)}resetNorth(b,c){return this.rotateTo(0,a.extend({duration:1e3},b),c),this}resetNorthPitch(b,c){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},b),c),this}snapToNorth(a,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,b):this}getPitch(){return this.transform.pitch}setPitch(a,b){return this.jumpTo({pitch:a},b),this}cameraForBounds(b,c){b=a.LngLatBounds.convert(b);let d=c&&c.bearing||0;return this._cameraForBoxAndBearing(b.getNorthWest(),b.getSouthEast(),d,c)}_cameraForBoxAndBearing(p,q,d,b){let i={top:0,bottom:0,right:0,left:0};if("number"==typeof(b=a.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding){let e=b.padding;b.padding={top:e,bottom:e,right:e,left:e}}b.padding=a.extend(i,b.padding);let c=this.transform,f=c.padding,j=c.project(a.LngLat.convert(p)),k=c.project(a.LngLat.convert(q)),g=j.rotate(-d*Math.PI/180),h=k.rotate(-d*Math.PI/180),r=new a.pointGeometry(Math.max(g.x,h.x),Math.max(g.y,h.y)),s=new a.pointGeometry(Math.min(g.x,h.x),Math.min(g.y,h.y)),l=r.sub(s),m=(c.width-(f.left+f.right+b.padding.left+b.padding.right))/l.x,n=(c.height-(f.top+f.bottom+b.padding.top+b.padding.bottom))/l.y;if(n<0||m<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let o=Math.min(c.scaleZoom(c.scale*Math.min(m,n)),b.maxZoom),t=a.pointGeometry.convert(b.offset),u=new a.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(d*Math.PI/180),v=t.add(u).mult(c.scale/c.zoomScale(o));return{center:c.unproject(j.add(k).div(2).sub(v)),zoom:o,bearing:d}}fitBounds(b,a,c){return this._fitInternal(this.cameraForBounds(b,a),a,c)}fitScreenCoordinates(c,d,e,b,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(c)),this.transform.pointLocation(a.pointGeometry.convert(d)),e,b),b,f)}_fitInternal(c,b,d){return c?(delete(b=a.extend(c,b)).padding,b.linear?this.easeTo(b,d):this.flyTo(b,d)):this}jumpTo(b,c){this.stop();let d=this.transform,e=!1,f=!1,g=!1;return"zoom"in b&&d.zoom!== +b.zoom&&(e=!0,d.zoom=+b.zoom),void 0!==b.center&&(d.center=a.LngLat.convert(b.center)),"bearing"in b&&d.bearing!== +b.bearing&&(f=!0,d.bearing=+b.bearing),"pitch"in b&&d.pitch!== +b.pitch&&(g=!0,d.pitch=+b.pitch),null==b.padding||d.isPaddingEqual(b.padding)||(d.padding=b.padding),this.fire(new a.Event("movestart",c)).fire(new a.Event("move",c)),e&&this.fire(new a.Event("zoomstart",c)).fire(new a.Event("zoom",c)).fire(new a.Event("zoomend",c)),f&&this.fire(new a.Event("rotatestart",c)).fire(new a.Event("rotate",c)).fire(new a.Event("rotateend",c)),g&&this.fire(new a.Event("pitchstart",c)).fire(new a.Event("pitch",c)).fire(new a.Event("pitchend",c)),this.fire(new a.Event("moveend",c))}easeTo(b,k){this._stop(!1,b.easeId),(!1===(b=a.extend({offset:[0,0],duration:500,easing:a.ease},b)).animate|| !b.essential&&a.exported.prefersReducedMotion)&&(b.duration=0);let c=this.transform,d=this.getZoom(),e=this.getBearing(),f=this.getPitch(),t=this.getPadding(),g="zoom"in b?+b.zoom:d,l="bearing"in b?this._normalizeBearing(b.bearing,e):e,m="pitch"in b?+b.pitch:f,n="padding"in b?b.padding:c.padding,o=a.pointGeometry.convert(b.offset),p=c.centerPoint.add(o),h=c.pointLocation(p),i=a.LngLat.convert(b.center||h);this._normalizeCenter(i);let q=c.project(h),u=c.project(i).sub(q),v=c.zoomScale(g-d),j,r;b.around&&(j=a.LngLat.convert(b.around),r=c.locationPoint(j));let s={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||g!==d,this._rotating=this._rotating||e!==l,this._pitching=this._pitching||m!==f,this._padding=!c.isPaddingEqual(n),this._easeId=b.easeId,this._prepareEase(k,b.noMoveStart,s),this._ease(b=>{if(this._zooming&&(c.zoom=a.number(d,g,b)),this._rotating&&(c.bearing=a.number(e,l,b)),this._pitching&&(c.pitch=a.number(f,m,b)),this._padding&&(c.interpolatePadding(t,n,b),p=c.centerPoint.add(o)),j)c.setLocationAtPoint(j,r);else{let i=c.zoomScale(c.zoom-d),s=g>d?Math.min(2,v):Math.max(.5,v),w=Math.pow(s,1-b),h=c.unproject(q.add(u.mult(b*w)).mult(i));c.setLocationAtPoint(c.renderWorldCopies?h.wrap():h,p)}this._fireMoveEvents(k)},a=>{this._afterEase(k,a)},b),this}_prepareEase(b,d,c={}){this._moving=!0,d||c.moving||this.fire(new a.Event("movestart",b)),this._zooming&&!c.zooming&&this.fire(new a.Event("zoomstart",b)),this._rotating&&!c.rotating&&this.fire(new a.Event("rotatestart",b)),this._pitching&&!c.pitching&&this.fire(new a.Event("pitchstart",b))}_fireMoveEvents(b){this.fire(new a.Event("move",b)),this._zooming&&this.fire(new a.Event("zoom",b)),this._rotating&&this.fire(new a.Event("rotate",b)),this._pitching&&this.fire(new a.Event("pitch",b))}_afterEase(b,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;let d=this._zooming,e=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.Event("zoomend",b)),e&&this.fire(new a.Event("rotateend",b)),f&&this.fire(new a.Event("pitchend",b)),this.fire(new a.Event("moveend",b))}flyTo(b,g){if(!b.essential&&a.exported.prefersReducedMotion){let q=a.pick(b,["center","zoom","bearing","pitch","around"]);return this.jumpTo(q,g)}this.stop(),b=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},b);let c=this.transform,f=this.getZoom(),h=this.getBearing(),k=this.getPitch(),E=this.getPadding(),l="zoom"in b?a.clamp(+b.zoom,c.minZoom,c.maxZoom):f,r="bearing"in b?this._normalizeBearing(b.bearing,h):h,s="pitch"in b?+b.pitch:k,t="padding"in b?b.padding:c.padding,u=c.zoomScale(l-f),v=a.pointGeometry.convert(b.offset),w=c.centerPoint.add(v),m=c.pointLocation(w),n=a.LngLat.convert(b.center||m);this._normalizeCenter(n);let x=c.project(m),y=c.project(n).sub(x),d=b.curve,e=Math.max(c.width,c.height),i=e/u,o=y.mag();if("minZoom"in b){let z=a.clamp(Math.min(b.minZoom,f,l),c.minZoom,c.maxZoom),A=e/c.zoomScale(z-f);d=Math.sqrt(A/o*2)}let F=d*d;function p(b){let a=(i*i-e*e+(b?-1:1)*F*F*o*o)/(2*(b?i:e)*F*o);return Math.log(Math.sqrt(a*a+1)-a)}function G(a){return(Math.exp(a)-Math.exp(-a))/2}function H(a){return(Math.exp(a)+Math.exp(-a))/2}let B=p(0),C=function(a){return H(B)/H(B+d*a)},D=function(b){var a;return e*((H(B)*(G(a=B+d*b)/H(a))-G(B))/F)/o},j=(p(1)-B)/d;if(1e-6>Math.abs(o)||!isFinite(j)){if(1e-6>Math.abs(e-i))return this.easeTo(b,g);let I=i<e?-1:1;j=Math.abs(Math.log(i/e))/d,D=function(){return 0},C=function(a){return Math.exp(I*d*a)}}return b.duration="duration"in b?+b.duration:1e3*j/("screenSpeed"in b?+b.screenSpeed/d:+b.speed),b.maxDuration&&b.duration>b.maxDuration&&(b.duration=0),this._zooming=!0,this._rotating=h!==r,this._pitching=s!==k,this._padding=!c.isPaddingEqual(t),this._prepareEase(g,!1),this._ease(b=>{let d=b*j,e=1/C(d);c.zoom=1===b?l:f+c.scaleZoom(e),this._rotating&&(c.bearing=a.number(h,r,b)),this._pitching&&(c.pitch=a.number(k,s,b)),this._padding&&(c.interpolatePadding(E,t,b),w=c.centerPoint.add(v));let i=1===b?n:c.unproject(x.add(y.mult(D(d))).mult(e));c.setLocationAtPoint(c.renderWorldCopies?i.wrap():i,w),this._fireMoveEvents(g)},()=>this._afterEase(g),b),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(b,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,c)}if(!b){let a=this.handlers;a&&a.stop(!1)}return this}_ease(c,d,b){!1===b.animate||0===b.duration?(c(1),d()):(this._easeStart=a.exported.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let b=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(b)),b<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(b,c){b=a.wrap(b,-180,180);let d=Math.abs(b-c);return Math.abs(b-360-c)<d&&(b-=360),Math.abs(b+360-c)<d&&(b+=360),b}_normalizeCenter(b){let a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;let c=b.lng-a.center.lng;b.lng+=c>180?-360:c< -180?360:0}}class E{constructor(b={}){this.options=b,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options&&this.options.compact,this._container=c.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=c.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=c.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){c.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,c){let b=this._map._getUIString(`AttributionControl.${c}`);a.title=b,a.setAttribute("aria-label",b)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(a){a&&("metadata"===a.sourceDataType||"visibility"===a.sourceDataType||"style"===a.dataType)&&this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(a=>"string"!=typeof a?"":a)):"string"==typeof this.options.customAttribution&&a.push(this.options.customAttribution)),this._map.style.stylesheet){let d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}let e=this._map.style.sourceCaches;for(let g in e){let f=e[g];if(f.used){let b=f.getSource();b.attribution&&0>a.indexOf(b.attribution)&&a.push(b.attribution)}}(a=a.filter(a=>String(a).trim())).sort((a,b)=>a.length-b.length),a=a.filter((c,d)=>{for(let b=d+1;b<a.length;b++)if(a[b].indexOf(c)>=0)return!1;return!0});let c=a.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,a.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class F{constructor(b={}){this.options=b,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(b){this._map=b,this._compact=this.options&&this.options.compact,this._container=c.create("div","maplibregl-ctrl mapboxgl-ctrl");let a=c.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){c.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){let a=this._container.children;if(a.length){let b=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&b.classList.add("maplibregl-compact","mapboxgl-compact"):b.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class cF{constructor(d,b,e=!1){this._clickTolerance=10,this.element=b,this.mouseRotate=new ch({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,e&&(this.mousePitch=new ci({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener(b,"mousedown",this.mousedown),c.addEventListener(b,"touchstart",this.touchstart,{passive:!1}),c.addEventListener(b,"touchmove",this.touchmove),c.addEventListener(b,"touchend",this.touchend),c.addEventListener(b,"touchcancel",this.reset)}down(a,b){this.mouseRotate.mousedown(a,b),this.mousePitch&&this.mousePitch.mousedown(a,b),c.disableDrag()}move(d,e){let a=this.map,b=this.mouseRotate.mousemoveWindow(d,e);if(b&&b.bearingDelta&&a.setBearing(a.getBearing()+b.bearingDelta),this.mousePitch){let c=this.mousePitch.mousemoveWindow(d,e);c&&c.pitchDelta&&a.setPitch(a.getPitch()+c.pitchDelta)}}off(){let a=this.element;c.removeEventListener(a,"mousedown",this.mousedown),c.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),c.removeEventListener(a,"touchmove",this.touchmove),c.removeEventListener(a,"touchend",this.touchend),c.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){c.enableDrag(),c.removeEventListener(window,"mousemove",this.mousemove),c.removeEventListener(window,"mouseup",this.mouseup)}mousedown(b){this.down(a.extend({},b,{ctrlKey:!0,preventDefault:()=>b.preventDefault()}),c.mousePos(this.element,b)),c.addEventListener(window,"mousemove",this.mousemove),c.addEventListener(window,"mouseup",this.mouseup)}mousemove(a){this.move(a,c.mousePos(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=c.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=c.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function cG(b,d,c){if(b=new a.LngLat(b.lng,b.lat),d){let f=new a.LngLat(b.lng-360,b.lat),g=new a.LngLat(b.lng+360,b.lat),h=c.locationPoint(b).distSqr(d);c.locationPoint(f).distSqr(d)<h?b=f:c.locationPoint(g).distSqr(d)<h&&(b=g)}for(;Math.abs(b.lng-c.center.lng)>180;){let e=c.locationPoint(b);if(e.x>=0&&e.y>=0&&e.x<=c.width&&e.y<=c.height)break;b.lng>c.center.lng?b.lng-=360:b.lng+=360}return b}let cH={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function cI(e,b,a){let c=e.classList;for(let d in cH)c.remove(`maplibregl-${a}-anchor-${d}`,`mapboxgl-${a}-anchor-${d}`);c.add(`maplibregl-${a}-anchor-${b}`,`mapboxgl-${a}-anchor-${b}`)}class G extends a.Evented{constructor(b,q){if(super(),(b instanceof HTMLElement||q)&&(b=a.extend({element:b},q)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=b&&b.anchor||"center",this._color=b&&b.color||"#3FB1CE",this._scale=b&&b.scale||1,this._draggable=b&&b.draggable||!1,this._clickTolerance=b&&b.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=b&&b.rotation||0,this._rotationAlignment=b&&b.rotationAlignment||"auto",this._pitchAlignment=b&&b.pitchAlignment&&"auto"!==b.pitchAlignment?b.pitchAlignment:this._rotationAlignment,b&&b.element)this._element=b.element,this._offset=a.pointGeometry.convert(b&&b.offset||[0,0]);else{this._defaultMarker=!0,this._element=c.create("div"),this._element.setAttribute("aria-label","Map marker");let d=c.createNS("http://www.w3.org/2000/svg","svg"),m=41,n=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${n}px`),d.setAttributeNS(null,"viewBox",`0 0 ${n} ${m}`);let i=c.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"stroke","none"),i.setAttributeNS(null,"stroke-width","1"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"fill-rule","evenodd");let e=c.createNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"fill-rule","nonzero");let j=c.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(3.0, 29.0)"),j.setAttributeNS(null,"fill","#000000");let u=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let r of u){let f=c.createNS("http://www.w3.org/2000/svg","ellipse");f.setAttributeNS(null,"opacity","0.04"),f.setAttributeNS(null,"cx","10.5"),f.setAttributeNS(null,"cy","5.80029008"),f.setAttributeNS(null,"rx",r.rx),f.setAttributeNS(null,"ry",r.ry),j.appendChild(f)}let o=c.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill",this._color);let s=c.createNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),o.appendChild(s);let k=c.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");let t=c.createNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(t);let p=c.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"transform","translate(6.0, 7.0)"),p.setAttributeNS(null,"fill","#FFFFFF");let l=c.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(8.0, 8.0)");let g=c.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");let h=c.createNS("http://www.w3.org/2000/svg","circle");h.setAttributeNS(null,"fill","#FFFFFF"),h.setAttributeNS(null,"cx","5.5"),h.setAttributeNS(null,"cy","5.5"),h.setAttributeNS(null,"r","5.4999962"),l.appendChild(g),l.appendChild(h),e.appendChild(j),e.appendChild(o),e.appendChild(k),e.appendChild(p),e.appendChild(l),d.appendChild(e),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",n*this._scale+"px"),this._element.appendChild(d),this._offset=a.pointGeometry.convert(b&&b.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),cI(this._element,this._anchor,"marker"),this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),c.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=a.LngLat.convert(b),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){let b=38.1,a=13.5,d=Math.sqrt(Math.pow(a,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-b],"bottom-left":[d,-1*(b-a+d)],"bottom-right":[-d,-1*(b-a+d)],left:[a,-1*(b-a)],right:[-a,-1*(b-a)]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(a){let b=a.code,c=a.charCode||a.keyCode;"Space"!==b&&"Enter"!==b&&32!==c&&13!==c||this.togglePopup()}_onMapClick(c){let a=c.originalEvent.target,b=this._element;this._popup&&(a===b||b.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let a=this._popup;return a&&(a.isOpen()?a.remove():a.addTo(this._map)),this}_update(d){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=cG(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let a="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?a=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(a=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?b="rotateX(0deg)":"map"===this._pitchAlignment&&(b=`rotateX(${this._map.getPitch()}deg)`),d&&"moveend"!==d.type||(this._pos=this._pos.round()),c.setTransform(this._element,`${cH[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${a}`)}getOffset(){return this._offset}setOffset(b){return this._offset=a.pointGeometry.convert(b),this._update(),this}_onMove(b){if(!this._isDragging){let c=this._clickTolerance||this._map._clickTolerance;this._isDragging=b.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=b.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&"auto"!==a?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let cJ,cK=0,cL=!1;function cM(a,d,b){let c=b&&b.maxWidth||100,g=a._container.clientHeight/2,h=a.unproject([0,g]),i=a.unproject([c,g]),e=h.distanceTo(i);if(b&&"imperial"===b.unit){let f=3.2808*e;f>5280?cN(d,c,f/5280,a._getUIString("ScaleControl.Miles")):cN(d,c,f,a._getUIString("ScaleControl.Feet"))}else b&&"nautical"===b.unit?cN(d,c,e/1852,a._getUIString("ScaleControl.NauticalMiles")):e>=1e3?cN(d,c,e/1e3,a._getUIString("ScaleControl.Kilometers")):cN(d,c,e,a._getUIString("ScaleControl.Meters"))}function cN(a,d,b,e){let c=function(b){let c=Math.pow(10,`${Math.floor(b)}`.length-1),a=b/c;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(a){let b=Math.pow(10,Math.ceil(-Math.log(a)/Math.LN10));return Math.round(a*b)/b}(a),c*a}(b);a.style.width=d*(c/b)+"px",a.innerHTML=`${c}&nbsp;${e}`}function cO(b){if(b){if("number"==typeof b){let d=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,b),"top-left":new a.pointGeometry(d,d),"top-right":new a.pointGeometry(-d,d),bottom:new a.pointGeometry(0,-b),"bottom-left":new a.pointGeometry(d,-d),"bottom-right":new a.pointGeometry(-d,-d),left:new a.pointGeometry(b,0),right:new a.pointGeometry(-b,0)}}if(b instanceof a.pointGeometry||Array.isArray(b)){let c=a.pointGeometry.convert(b);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:a.pointGeometry.convert(b.center||[0,0]),top:a.pointGeometry.convert(b.top||[0,0]),"top-left":a.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(b["top-right"]||[0,0]),bottom:a.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(b["bottom-right"]||[0,0]),left:a.pointGeometry.convert(b.left||[0,0]),right:a.pointGeometry.convert(b.right||[0,0])}}return cO(new a.pointGeometry(0,0))}let x={supported:y,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends cE{constructor(b){var d;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),null!=(b=a.extend({},{center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},b)).minZoom&&null!=b.maxZoom&&b.minZoom>b.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=b.minPitch&&null!=b.maxPitch&&b.minPitch>b.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=b.minPitch&&b.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=b.maxPitch&&b.maxPitch>85)throw Error("maxPitch must be less than or equal to 85");if(super(new b_(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),{bearingSnap:b.bearingSnap}),this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new class{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(b){let a=++this._id;return this._queue.push({callback:b,id:a,cancelled:!1}),a}remove(c){let a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(let b of d)if(b.id===c)return void(b.cancelled=!0)}run(b=0){let c=this._currentlyRunning=this._queue;for(let a of(this._queue=[],c))if(!a.cancelled&&(a.callback(b),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}},this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},{"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},b.locale),this._clickTolerance=b.clickTolerance,this._pixelRatio=null!==(d=b.pixelRatio)&& void 0!==d?d:devicePixelRatio,this._requestManager=new class{constructor(a){this._transformRequestFn=a}transformRequest(a,b){return this._transformRequestFn&&this._transformRequestFn(a,b)||{url:a}}normalizeSpriteURL(b,c,d){let a=function(b){let a=b.match(J);if(!a)throw Error(`Unable to parse URL "${b}"`);return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}(b);return a.path+=`${c}${d}`,function(a){let b=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${b}`}(a)}setTransformRequest(a){this._transformRequestFn=a}}(b.transformRequest),"string"==typeof b.container){if(this._container=document.getElementById(b.container),!this._container)throw Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),"undefined"!=typeof window&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new class{constructor(d,e){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new class{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(b){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:b})}_drainInertiaBuffer(){let b=this._inertiaBuffer,c=a.exported.now();for(;b.length>0&&c-b[0].time>160;)b.shift()}_onMoveEnd(k){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let b={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:d}of this._inertiaBuffer)b.zoom+=d.zoomDelta||0,b.bearing+=d.bearingDelta||0,b.pitch+=d.pitchDelta||0,d.panDelta&&b.pan._add(d.panDelta),d.around&&(b.around=d.around),d.pinchAround&&(b.pinchAround=d.pinchAround);let e=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(b.pan.mag()){let f=b5(b.pan.mag(),e,a.extend({},b0,k||{}));c.offset=b.pan.mult(f.amount/b.pan.mag()),c.center=this._map.transform.center,b4(c,f)}if(b.zoom){let g=b5(b.zoom,e,b1);c.zoom=this._map.transform.zoom+g.amount,b4(c,g)}if(b.bearing){let h=b5(b.bearing,e,b2);c.bearing=this._map.transform.bearing+a.clamp(h.amount,-179,179),b4(c,h)}if(b.pitch){let i=b5(b.pitch,e,b3);c.pitch=this._map.transform.pitch+i.amount,b4(c,i)}if(c.zoom||c.bearing){let j=void 0===b.pinchAround?b.around:b.pinchAround;c.around=j?this._map.unproject(j):this._map.getCenter()}return this.clear(),a.extend(c,{noMoveStart:!0})}}(d),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e),a.bindAll(["handleEvent","handleWindowEvent"],this);let b=this._el;for(let[f,g,h]of(this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[window,"blur",void 0]],this._listeners))c.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,h)}destroy(){for(let[a,b,d]of this._listeners)c.removeEventListener(a,b,a===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(b){let a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new b9(a,b));let n=a.boxZoom=new cb(a,b);this._add("boxZoom",n);let e=new ce,f=new cw;a.doubleClickZoom=new cv(f,e),this._add("tapZoom",e),this._add("clickZoom",f);let g=new cx;this._add("tapDragZoom",g);let o=a.touchPitch=new cq;this._add("touchPitch",o);let h=new ch(b),i=new ci(b);a.dragRotate=new cz(b,h,i),this._add("mouseRotate",h,["mousePitch"]),this._add("mousePitch",i,["mouseRotate"]);let j=new cg(b),k=new cj(b);a.dragPan=new cy(d,j,k),this._add("mousePan",j),this._add("touchPan",k,["touchZoom","touchRotate"]);let l=new co,m=new cm;a.touchZoomRotate=new cA(d,m,l,g),this._add("touchRotate",l,["touchPan","touchZoom"]),this._add("touchZoom",m,["touchPan","touchRotate"]);let p=a.scrollZoom=new cu(a,this);this._add("scrollZoom",p,["mousePan"]);let q=a.keyboard=new cr;for(let c of(this._add("keyboard",q),this._add("blockableMapEvent",new ca(a)),["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"]))b.interactive&&b[c]&&a[c].enable(b[c])}_add(a,b,c){this._handlers.push({handlerName:a,handler:b,allowed:c}),this._handlersById[a]=b}stop(a){if(!this._updatingCamera){for(let{handler:b}of this._handlers)b.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(let{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(cB(this._eventsInProgress))||this.isZooming()}_blockedByActive(c,a,d){for(let b in c)if(b!==d&&(!a||0>a.indexOf(b)))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(c){let a=[];for(let b of c)this._el.contains(b.target)&&a.push(b);return a}handleEvent(a,j){if("blur"===a.type)return void this.stop(!0);this._updatingCamera=!0;let k="renderFrame"===a.type?void 0:a,d={needsRenderFrame:!1},l={},e={},m=a.touches,g=m?this._getMapTouches(m):void 0,p=g?c.touchPos(this._el,g):c.mousePos(this._el,a);for(let{handlerName:h,handler:b,allowed:q}of this._handlers){if(!b.isEnabled())continue;let f;this._blockedByActive(e,q,h)?b.reset():b[j||a.type]&&(f=b[j||a.type](a,p,g),this.mergeHandlerResult(d,l,f,h,k),f&&f.needsRenderFrame&&this._triggerRenderFrame()),(f||b.isActive())&&(e[h]=b)}let i={};for(let n in this._previousActiveHandlers)e[n]||(i[n]=k);this._previousActiveHandlers=e,(Object.keys(i).length||cD(d))&&(this._changes.push([d,l,i]),this._triggerRenderFrame()),(Object.keys(e).length||cD(d))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:o}=d;o&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],o(this._map))}mergeHandlerResult(e,c,b,f,g){if(!b)return;a.extend(e,b);let d={handlerName:f,originalEvent:b.originalEvent||g};void 0!==b.zoomDelta&&(c.zoom=d),void 0!==b.panDelta&&(c.drag=d),void 0!==b.pitchDelta&&(c.pitch=d),void 0!==b.bearingDelta&&(c.rotate=d)}_applyChanges(){let c={},d={},e={};for(let[b,f,g]of this._changes)b.panDelta&&(c.panDelta=(c.panDelta||new a.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(c.around=b.around),void 0!==b.pinchAround&&(c.pinchAround=b.pinchAround),b.noInertia&&(c.noInertia=b.noInertia),a.extend(d,f),a.extend(e,g);this._updateMapTransform(c,d,e),this._changes=[]}_updateMapTransform(c,e,f){let d=this._map,b=d.transform;if(!cD(c))return this._fireEvents(e,f,!0);let{panDelta:g,zoomDelta:h,bearingDelta:i,pitchDelta:j,around:a,pinchAround:k}=c;void 0!==k&&(a=k),d._stop(!0),a=a||d.transform.centerPoint;let l=b.pointLocation(g?a.sub(g):a);i&&(b.bearing+=i),j&&(b.pitch+=j),h&&(b.zoom+=h),b.setLocationAtPoint(l,a),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(e,f,!0)}_fireEvents(b,p,q){let j=cB(this._eventsInProgress),c=cB(b),g={};for(let d in b){let{originalEvent:r}=b[d];this._eventsInProgress[d]||(g[`${d}start`]=r),this._eventsInProgress[d]=b[d]}for(let k in!j&&c&&this._fireEvent("movestart",c.originalEvent),g)this._fireEvent(k,g[k]);for(let l in c&&this._fireEvent("move",c.originalEvent),b){let{originalEvent:s}=b[l];this._fireEvent(l,s)}let h={},e;for(let i in this._eventsInProgress){let{handlerName:m,originalEvent:t}=this._eventsInProgress[i];this._handlersById[m].isActive()||(delete this._eventsInProgress[i],e=p[m]||t,h[`${i}end`]=e)}for(let n in h)this._fireEvent(n,h[n]);let u=cB(this._eventsInProgress);if(q&&(j||c)&&!u){this._updatingCamera=!0;let f=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),o=a=>0!==a&& -this._bearingSnap<a&&a<this._bearingSnap;f?(o(f.bearing||this._map.getBearing())&&(f.bearing=0),this._map.easeTo(f,{originalEvent:e})):(this._map.fire(new a.Event("moveend",{originalEvent:e})),o(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,b){this._map.fire(new a.Event(c,b?{originalEvent:b}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new cC("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}(this,b),this._hash=b.hash&&new class{constructor(b){this._hashName=b&&encodeURIComponent(b),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(a,b){let c=!1,d=null,e=()=>{d=null,c&&(a(),d=setTimeout(e,300),c=!1)};return()=>(c=!0,d||e(),d)}(this._updateHashUnthrottled.bind(this))}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(j){let e=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,b=Math.pow(10,Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10)),f=Math.round(e.lng*b)/b,g=Math.round(e.lat*b)/b,h=this._map.getBearing(),d=this._map.getPitch(),a="";if(a+=j?`/${f}/${g}/${c}`:`${c}/${g}/${f}`,(h||d)&&(a+="/"+Math.round(10*h)/10),d&&(a+=`/${Math.round(d)}`),this._hashName){let k=this._hashName,l=!1,i=window.location.hash.slice(1).split("&").map(b=>{let c=b.split("=")[0];return c===k?(l=!0,`${c}=${a}`):b}).filter(a=>a);return l||i.push(`${k}=${a}`),`#${i.join("&")}`}return`#${a}`}_getCurrentHash(){let a=window.location.hash.replace("#","");if(this._hashName){let b;return a.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(b=a)}),(b&&b[1]||"").split("/")}return a.split("/")}_onHashChange(){let a=this._getCurrentHash();if(a.length>=3&&!a.some(a=>isNaN(a))){let b=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:b,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){let a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch(b){}}}("string"==typeof b.hash&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,a.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new E({customAttribution:b.customAttribution})),b.maplibreLogo&&this.addControl(new F,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",b=>{this._update("style"===b.dataType),this.fire(new a.Event(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new a.Event(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new a.Event("sourcedataabort",b))})}_getMapId(){return this._mapId}addControl(b,c){if(void 0===c&&(c=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new a.ErrorEvent(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let e=b.onAdd(this);this._controls.push(b);let d=this._controlPositions[c];return -1!==c.indexOf("bottom")?d.insertBefore(e,d.firstChild):d.appendChild(e),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new a.ErrorEvent(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let c=this._controls.indexOf(b);return c> -1&&this._controls.splice(c,1),b.onRemove(this),this}hasControl(a){return this._controls.indexOf(a)> -1}resize(b){let e=this._containerDimensions(),c=e[0],d=e[1];this._resizeCanvas(c,d,this.getPixelRatio()),this.transform.resize(c,d),this.painter.resize(c,d,this.getPixelRatio());let f=!this._moving;return f&&(this.stop(),this.fire(new a.Event("movestart",b)).fire(new a.Event("move",b))),this.fire(new a.Event("resize",b)),f&&this.fire(new a.Event("moveend",b)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(a){let[b,c]=this._containerDimensions();this._pixelRatio=a,this._resizeCanvas(b,c,a),this.painter.resize(b,c,a)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(a.LngLatBounds.convert(b)),this._update()}setMinZoom(a){if((a=null==a?-2:a)>= -2&&a<=this.transform.maxZoom)return this.transform.minZoom=a,this._update(),this.getZoom()<a&&this.setZoom(a),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(a){if((a=null==a?22:a)>=this.transform.minZoom)return this.transform.maxZoom=a,this._update(),this.getZoom()>a&&this.setZoom(a),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(a){if((a=null==a?0:a)<0)throw Error("minPitch must be greater than or equal to 0");if(a>=0&&a<=this.transform.maxPitch)return this.transform.minPitch=a,this._update(),this.getPitch()<a&&this.setPitch(a),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(a){if((a=null==a?60:a)>85)throw Error("maxPitch must be less than or equal to 85");if(a>=this.transform.minPitch)return this.transform.maxPitch=a,this._update(),this.getPitch()>a&&this.setPitch(a),this;throw Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(a){return this.transform.renderWorldCopies=a,this._update()}project(b){return this.transform.locationPoint(a.LngLat.convert(b))}unproject(b){return this.transform.pointLocation(a.pointGeometry.convert(b))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(a,b,c){if("mouseenter"===a||"mouseover"===a){let g=!1,d=d=>{let e=this.getLayer(b)?this.queryRenderedFeatures(d.point,{layers:[b]}):[];e.length?g||(g=!0,c.call(this,new b6(a,this,d.originalEvent,{features:e}))):g=!1};return{layer:b,listener:c,delegates:{mousemove:d,mouseout(){g=!1}}}}if("mouseleave"===a||"mouseout"===a){let h=!1,e=d=>{(this.getLayer(b)?this.queryRenderedFeatures(d.point,{layers:[b]}):[]).length?h=!0:h&&(h=!1,c.call(this,new b6(a,this,d.originalEvent)))},f=b=>{h&&(h=!1,c.call(this,new b6(a,this,b.originalEvent)))};return{layer:b,listener:c,delegates:{mousemove:e,mouseout:f}}}return{layer:b,listener:c,delegates:{[a]:a=>{let d=this.getLayer(b)?this.queryRenderedFeatures(a.point,{layers:[b]}):[];d.length&&(a.features=d,c.call(this,a),delete a.features)}}}}on(a,c,d){if(void 0===d)return super.on(a,c);let b=this._createDelegatedListener(a,c,d);for(let e in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[a]=this._delegatedListeners[a]||[],this._delegatedListeners[a].push(b),b.delegates)this.on(e,b.delegates[e]);return this}once(a,b,c){if(void 0===c)return super.once(a,b);let d=this._createDelegatedListener(a,b,c);for(let e in d.delegates)this.once(e,d.delegates[e]);return this}off(a,b,c){return void 0===c?super.off(a,b):(this._delegatedListeners&&this._delegatedListeners[a]&&(h=>{let f=this._delegatedListeners[a];for(let d=0;d<f.length;d++){let e=f[d];if(e.layer===b&&e.listener===c){for(let g in e.delegates)this.off(g,e.delegates[g]);return f.splice(d,1),this}}})(),this)}queryRenderedFeatures(b,c){if(!this.style)return[];let e;if(void 0!==c|| void 0===b||b instanceof a.pointGeometry||Array.isArray(b)||(c=b,b=void 0),c=c||{},(b=b||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||"number"==typeof b[0])e=[a.pointGeometry.convert(b)];else{let d=a.pointGeometry.convert(b[0]),f=a.pointGeometry.convert(b[1]);e=[d,new a.pointGeometry(f.x,d.y),f,new a.pointGeometry(d.x,f.y),d]}return this.style.queryRenderedFeatures(e,c,this.transform)}querySourceFeatures(a,b){return this.style.querySourceFeatures(a,b)}setStyle(c,b){return!1!==(b=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(c,b))}setTransformRequest(a){return this._requestManager.setTransformRequest(a),this}_getUIString(a){let b=this._locale[a];if(null==b)throw Error(`Missing UI string '${a}'`);return b}_updateStyle(a,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),a?(this.style=new g(this,b||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof a?this.style.loadURL(a):this.style.loadJSON(a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new g(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,c){if("string"==typeof b){let d=this._requestManager.transformRequest(b,a.ResourceType.Style);a.getJSON(d,(b,d)=>{b?this.fire(new a.ErrorEvent(b)):d&&this._updateDiff(d,c)})}else"object"==typeof b&&this._updateDiff(b,c)}_updateDiff(c,d){try{this.style.setState(c)&&this._update(!0)}catch(b){a.warnOnce(`Unable to perform style diff: ${b.message||b.error||b}.  Rebuilding the style from scratch.`),this._updateStyle(c,d)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(a,b){return this._lazyInitEmptyStyle(),this.style.addSource(a,b),this._update(!0)}isSourceLoaded(b){let c=this.style&&this.style.sourceCaches[b];if(void 0!==c)return c.loaded();this.fire(new a.ErrorEvent(Error(`There is no source with ID '${b}'`)))}areTilesLoaded(){let a=this.style&&this.style.sourceCaches;for(let d in a){let b=a[d]._tiles;for(let e in b){let c=b[e];if("loaded"!==c.state&&"errored"!==c.state)return!1}}return!0}addSourceType(a,b,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(a,b,c)}removeSource(a){return this.style.removeSource(a),this._update(!0)}getSource(a){return this.style.getSource(a)}addImage(c,b,{pixelRatio:e=1,sdf:f=!1,stretchX:g,stretchY:h,content:i}={}){if(this._lazyInitEmptyStyle(),b instanceof HTMLImageElement||a.isImageBitmap(b)){let{width:j,height:k,data:l}=a.exported.getImageData(b);this.style.addImage(c,{data:new a.RGBAImage({width:j,height:k},l),pixelRatio:e,stretchX:g,stretchY:h,content:i,sdf:f,version:0})}else{if(void 0===b.width|| void 0===b.height)return this.fire(new a.ErrorEvent(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:m,height:n,data:o}=b,d=b;this.style.addImage(c,{data:new a.RGBAImage({width:m,height:n},new Uint8Array(o)),pixelRatio:e,stretchX:g,stretchY:h,content:i,sdf:f,version:0,userImage:d}),d.onAdd&&d.onAdd(this,c)}}}updateImage(d,b){let c=this.style.getImage(d);if(!c)return this.fire(new a.ErrorEvent(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=b instanceof HTMLImageElement||a.isImageBitmap(b)?a.exported.getImageData(b):b,{width:e,height:f,data:h}=g;if(void 0===e|| void 0===f)return this.fire(new a.ErrorEvent(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(e!==c.data.width||f!==c.data.height)return this.fire(new a.ErrorEvent(Error("The width and height of the updated image must be that same as the previous version of the image")));let i=!(b instanceof HTMLImageElement||a.isImageBitmap(b));c.data.replace(h,i),this.style.updateImage(d,c)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new a.ErrorEvent(Error("Missing required image id"))),!1)}removeImage(a){this.style.removeImage(a)}loadImage(b,c){a.getImage(this._requestManager.transformRequest(b,a.ResourceType.Image),c)}listImages(){return this.style.listImages()}addLayer(a,b){return this._lazyInitEmptyStyle(),this.style.addLayer(a,b),this._update(!0)}moveLayer(a,b){return this.style.moveLayer(a,b),this._update(!0)}removeLayer(a){return this.style.removeLayer(a),this._update(!0)}getLayer(a){return this.style.getLayer(a)}setLayerZoomRange(a,b,c){return this.style.setLayerZoomRange(a,b,c),this._update(!0)}setFilter(a,b,c={}){return this.style.setFilter(a,b,c),this._update(!0)}getFilter(a){return this.style.getFilter(a)}setPaintProperty(a,b,c,d={}){return this.style.setPaintProperty(a,b,c,d),this._update(!0)}getPaintProperty(a,b){return this.style.getPaintProperty(a,b)}setLayoutProperty(a,b,c,d={}){return this.style.setLayoutProperty(a,b,c,d),this._update(!0)}getLayoutProperty(a,b){return this.style.getLayoutProperty(a,b)}setLight(a,b={}){return this._lazyInitEmptyStyle(),this.style.setLight(a,b),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(a,b){return this.style.setFeatureState(a,b),this._update()}removeFeatureState(a,b){return this.style.removeFeatureState(a,b),this._update()}getFeatureState(a){return this.style.getFeatureState(a)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let a=0,b=0;return this._container&&(a=this._container.clientWidth||400,b=this._container.clientHeight||300),[a,b]}_setupContainer(){let a=this._container;a.classList.add("maplibregl-map","mapboxgl-map");let b=this._canvasContainer=c.create("div","maplibregl-canvas-container mapboxgl-canvas-container",a);this._interactive&&b.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=c.create("canvas","maplibregl-canvas mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let d=this._containerDimensions();this._resizeCanvas(d[0],d[1],this.getPixelRatio());let e=this._controlContainer=c.create("div","maplibregl-control-container mapboxgl-control-container",a),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{f[a]=c.create("div",`maplibregl-ctrl-${a} mapboxgl-ctrl-${a}`,e)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(a,b,c){this._canvas.width=c*a,this._canvas.height=c*b,this._canvas.style.width=`${a}px`,this._canvas.style.height=`${b}px`}_setupPainter(){let c=a.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);b?(this.painter=new bX(b,this.transform),a.exported$1.testSupport(b)):this.fire(new a.ErrorEvent(Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:b}))}_onMapScroll(a){if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(a){return this.style&&(this._styleDirty=this._styleDirty||a,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(a){return this._update(),this._renderTaskQueue.add(a)}_cancelRenderFrame(a){this._renderTaskQueue.remove(a)}_render(k){let c,e=0,b=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(c=b.createQueryEXT(),b.beginQueryEXT(b.TIME_ELAPSED_EXT,c),e=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(k),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let g=this.transform.zoom,h=a.exported.now();this.style.zoomHistory.update(g,h);let i=new a.EvaluationParameters(g,{now:h,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),d=i.crossFadingFactor();1===d&&d===this._crossFadingFactor||(f=!0,this._crossFadingFactor=d),this.style.update(i)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){let l=a.exported.now()-e;b.endQueryEXT(b.TIME_ELAPSED_EXT,c),setTimeout(()=>{let d=b.getQueryObjectEXT(c,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(c),this.fire(new a.Event("gpu-timing-frame",{cpuTime:l,gpuTime:d}))},50)}if(this.listens("gpu-timing-layer")){let m=this.painter.collectGpuTimers();setTimeout(()=>{let b=this.painter.queryGpuTimers(m);this.fire(new a.Event("gpu-timing-layer",{layerTimes:b}))},50)}let j=this._sourcesDirty||this._styleDirty||this._placementDirty;return j||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){for(let d of(this._hash&&this._hash.remove(),this._controls))d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));let b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),c.remove(this._canvasContainer),c.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(b=>{a.PerformanceUtils.frame(b),this._frame=null,this._render(b)}))}_onWindowOnline(){this._update()}_onWindowResize(a){this._trackResize&&this.resize({originalEvent:a})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(a){this._showTileBoundaries!==a&&(this._showTileBoundaries=a,this._update())}get showPadding(){return!!this._showPadding}set showPadding(a){this._showPadding!==a&&(this._showPadding=a,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(a){this._showCollisionBoxes!==a&&(this._showCollisionBoxes=a,a?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(a){this._showOverdrawInspector!==a&&(this._showOverdrawInspector=a,this._update())}get repaint(){return!!this._repaint}set repaint(a){this._repaint!==a&&(this._repaint=a,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(a){this._vertices=a,this._update()}_setCacheLimits(b,c){a.setCacheLimits(b,c)}},NavigationControl:class{constructor(b){this.options=a.extend({},{showCompass:!0,showZoom:!0,visualizePitch:!1},b),this._container=c.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),c.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),c.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=c.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let a=this._map.getZoom(),b=a===this._map.getMaxZoom(),c=a===this._map.getMinZoom();this._zoomInButton.disabled=b,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",b.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){let a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a}onAdd(a){return this._map=a,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cF(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){c.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,d){let a=c.create("button",b,this._container);return a.type="button",a.addEventListener("click",d),a}_setButtonTitle(a,c){let b=this._map._getUIString(`NavigationControl.${c}`);a.title=b,a.setAttribute("aria-label",b)}},GeolocateControl:class extends a.Evented{constructor(b){super(),this.options=a.extend({},{positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},b),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(b){var a;return this._map=b,this._container=c.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),a=this._setupUI,void 0!==cJ?a(cJ):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(b=>{a(cJ="denied"!==b.state)}):a(cJ=!!window.navigator.geolocation),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),c.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,cK=0,cL=!1}_isOutOfMapMaxBounds(c){let a=this._map.getMaxBounds(),b=c.coords;return a&&(b.longitude<a.getWest()||b.longitude>a.getEast()||b.latitude<a.getSouth()||b.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(b),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(b),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",b)),this._finish()}}_updateCamera(b){let c=new a.LngLat(b.coords.longitude,b.coords.latitude),d=b.coords.accuracy,e=this._map.getBearing(),f=a.extend({bearing:e},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(d),f,{geolocateSource:!0})}_updateMarker(b){if(b){let c=new a.LngLat(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let a=this._map._container.clientHeight/2,c=this._map.unproject([0,a]),d=this._map.unproject([1,a]),e=c.distanceTo(d),b=Math.ceil(2*this._accuracy/e);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(b){if(this._map){if(this.options.trackUserLocation){if(1===b.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===b.code&&cL)return;this._setErrorState()}}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=c.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),c.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{let d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=c.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new G(this._dotElement),this._circleElement=c.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new G({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",b=>{b.geolocateSource||"ACTIVE_LOCK"!==this._watchState||b.originalEvent&&"resize"===b.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":cK--,cL=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if("OFF"===this._watchState&& void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++cK>1?(b={maximumAge:6e5,timeout:0},cL=!0):(b=this.options.positionOptions,cL=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:E,LogoControl:F,ScaleControl:class{constructor(b){this.options=a.extend({},{maxWidth:100,unit:"metric"},b),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){cM(this._map,this._container,this.options)}onAdd(a){return this._map=a,this._container=c.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",a.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){c.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(a){this.options.unit=a,cM(this._map,this._container,this.options)}},FullscreenControl:class{constructor(b){this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=c.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){c.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){let a=this._fullscreenButton=c.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);c.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",a).setAttribute("aria-hidden","true"),a.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let a=this._getTitle();this._fullscreenButton.setAttribute("aria-label",a),this._fullscreenButton.title=a}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(b){super(),this.options=a.extend(Object.create({closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"}),b),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&c.remove(this._content),this._container&&(c.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=a.LngLat.convert(b),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(a){return this.setDOMContent(document.createTextNode(a))}setHTML(d){let a=document.createDocumentFragment(),b=document.createElement("body"),c;for(b.innerHTML=d;c=b.firstChild;)a.appendChild(c);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(a){return this.options.maxWidth=a,this._update(),this}setDOMContent(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=c.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(a){this._container&&this._container.classList.add(a)}removeClassName(a){this._container&&this._container.classList.remove(a)}setOffset(a){return this.options.offset=a,this._update(),this}toggleClassName(a){if(this._container)return this._container.classList.toggle(a)}_createCloseButton(){this.options.closeButton&&(this._closeButton=c.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(a){this._update(a.point)}_onMouseMove(a){this._update(a.point)}_onDrag(a){this._update(a.point)}_update(e){if(!this._map|| !this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=c.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=c.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(a=>this._container.classList.add(a)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cG(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e))return;let a=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),b=this.options.anchor,f=cO(this.options.offset);if(!b){let g=this._container.offsetWidth,h=this._container.offsetHeight,d;d=a.y+f.bottom.y<h?["top"]:a.y>this._map.transform.height-h?["bottom"]:[],a.x<g/2?d.push("left"):a.x>this._map.transform.width-g/2&&d.push("right"),b=0===d.length?"bottom":d.join("-")}let i=a.add(f[b]).round();c.setTransform(this._container,`${cH[b]} translate(${i.x}px,${i.y}px)`),cI(this._container,b,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let a=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");a&&a.focus()}_onClose(){this.remove()}},Marker:G,Style:g,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:t,GeoJSONSource:r,ImageSource:f,RasterDEMTileSource:q,RasterTileSource:k,VectorTileSource:p,VideoSource:s,prewarm:function(){ag().acquire(ae)},clearPrewarmedResources:function(){let a=af;a&&(a.isPreloaded()&&1===a.numActive()?(a.release(ae),af=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return l.workerCount},set workerCount(t){l.workerCount=t},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){a.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(b){a.clearTileCache(b)},workerUrl:"",addProtocol(b,c){a.config.REGISTERED_PROTOCOLS[b]=c},removeProtocol(b){delete a.config.REGISTERED_PROTOCOLS[b]}};return D.extend(x,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),x}),b})}}])